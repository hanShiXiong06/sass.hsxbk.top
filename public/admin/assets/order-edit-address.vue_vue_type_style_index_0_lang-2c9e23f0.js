import{d as pe,r as m,n as B,l as me,q as d,aJ as ve,cq as ye,Q as x,cN as w,ao as fe,h as u,s as h,w as c,a as U,e as s,i as P,t as M,u as n,R as Y,c as k,F as V,T as C,B as j,v as ke,a$ as ge,aH as be,cO as he,as as Le,at as xe,L as Ve,K as we,aa as Ce,aB as Ee,M as De,E as Me,X as Te,Y as Fe}from"./index-6ea097a6.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                       *//* empty css                 */import{g as Re,i as Ae}from"./delivery-057b70d4.js";import{i as W,j as Ie,k as Se}from"./order-d7ffe8c0.js";import{l as qe}from"./weapp-d2a52090.js";import{a as Be,c as Ue,l as Pe}from"./qqmap-011f3cfb.js";const je={id:"container",class:"w-[500px] h-[270px] relative"},Ne={key:0,class:"text-[#f52222] text-[12px] line-height-[15px]"},Oe={class:"dialog-footer"},ut=pe({__name:"order-edit-address",emits:["complete"],setup($e,{expose:Z,emit:N}){const L=m(!1),v=m(!1),ee=m([]),O=m([]),te=m(!1),$=m([]);Re({}).then(a=>{ee.value=a.data.data}),qe().then(a=>{te.value=a.data.is_trade_managed});const t=B({...{order_id:0,delivery_type:"",taker_name:"",taker_mobile:"",taker_latitude:"",taker_longitude:"",taker_full_address:"",taker_address:"",taker_province:0,taker_city:0,taker_district:0,is_delivery_address:0,is_refund_address:0,is_default_delivery:0,is_default_refund:0,take_store_id:""}}),G=m(),ae=me(()=>({delivery_type:[{required:!0,message:d("deliveryTypePlaceholder"),trigger:"blur"}],taker_name:[{required:!0,validator:le,trigger:"blur"}],taker_mobile:[{required:!0,validator:re,trigger:"blur"}]})),le=(a,e,l)=>{t.delivery_type=="express"&&e===""?l(new Error(d("contactsPlaceholder"))):l()},re=(a,e,l)=>{if(t.delivery_type=="express"){const o=/^1[23456789]\d{9}$/;e===""?l(new Error(d("ContactInformationPlaceholder"))):e.length!=11?l(new Error("请输入11位手机号")):o.test(e)||l(new Error("请输入正确的手机号"))}l()},oe=a=>{t.take_store_id=a},ie=async a=>{v.value||!a||await a.validate(async e=>{if(e)if(v.value=!0,_.value=="express"||_.value=="local_delivery"){const l=[t.taker_province?A.value.selectedLabel:"",t.taker_city?I.value.selectedLabel:"",t.taker_district?S.value.selectedLabel:"",t.taker_address];t.taker_full_address=l.join(""),t.delivery_type=_.value,W(t).then(o=>{v.value=!1,L.value=!1,N("complete")}).catch(()=>{v.value=!1}),J()}else{const l={order_id:t.order_id,delivery_type:_.value,take_store_id:t.take_store_id};W(l).then(o=>{v.value=!1,L.value=!1,N("complete")}).catch(()=>{v.value=!1})}})},de=a=>{Se(a).then(e=>{for(const l in t)e.data[l]&&(t[l]=e.data[l]);z(t.delivery_type),v.value=!1})},se=async a=>{v.value=!0;const e={order_id:a.order_id,delivery_type:a.delivery_type};ge(()=>{ne(),de(e)})};(()=>{Ae().then(a=>{const e=a.data?be(a.data):[];O.value=e.filter(l=>l.status==1)})})();const _=m(),z=a=>{_.value=a,_.value=="local_delivery"&&E()};(()=>{Ie().then(a=>{$.value=a.data})})();let g=null,T=null;const K=m(!0),F=m(""),ne=()=>{const a=window.TMap,e=a.LatLng,l=new e(t.taker_latitude,t.taker_longitude);g=new a.Map("container",{center:l,zoom:14}),g.on("tilesloaded",()=>{K.value=!1}),T=Ue(g),g.on("click",o=>{g.setCenter(o.latLng),T.updateGeometries({id:"center",position:o.latLng}),H(o.latLng.lat,o.latLng.lng)}),H(l.lat,l.lng)},H=(a,e)=>{Pe({mapKey:R,lat:a,lng:e}).then(({message:l,result:o})=>{l=="query ok"||l=="Success"?(t.taker_latitude=o.location.lat,t.taker_longitude=o.location.lng,t.taker_address=o.formatted_addresses.recommend,he(o.ad_info.adcode).then(({data:i})=>{p.taker_province=i.province?i.province.id:0,p.taker_city=i.city?i.city.id:0,p.taker_district=i.district?i.district.id:0})):(F.value="地图加载失败："+l,console.log(l,o))}).catch(l=>{console.log(l)})},p=B({taker_province:0,taker_city:0,taker_district:0});let R="";ve(()=>{const a=document.createElement("script");ye().then(e=>{R=e.data.key,a.type="text/javascript",a.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+e.data.key,document.body.appendChild(a)})});const f=B({province:[],city:[],district:[]}),A=m(),I=m(),S=m();x(()=>t.taker_province,a=>{a?w(t.taker_province).then(e=>{f.city=e.data;const l=t.taker_city;if(l){let o=!1;for(let i=0;i<e.data.length;i++)if(l==e.data[i].id){o=!0;break}if(o){t.taker_city=l;return}}t.taker_city=0,_.value=="local_delivery"&&E()}):t.taker_city=0}),x(()=>t.taker_city,a=>{a?w(t.taker_city).then(e=>{f.district=e.data;const l=t.taker_district;if(l){let o=!1;for(let i=0;i<e.data.length;i++)if(l==e.data[i].id){o=!0;break}if(o){t.taker_district=l;return}}_.value=="local_delivery"&&E(),t.taker_district=0}):t.taker_district=0}),x(()=>t.taker_district,a=>{a&&_.value=="local_delivery"&&E()});const E=fe(()=>{setTimeout(()=>{const a=[t.taker_province?A.value.selectedLabel:"",t.taker_city?I.value.selectedLabel:"",t.taker_district?S.value.selectedLabel:"",t.taker_address];Be({mapKey:R,address:a.join("")}).then(({message:e,result:l})=>{if(e=="Success"||e=="query ok"){const o=new window.TMap.LatLng(l.location.lat,l.location.lng);g.setCenter(o),T.updateGeometries({id:"center",position:o}),t.taker_latitude=l.location.lat,t.taker_longitude=l.location.lng}else console.error(e,l)})},500)},500);x(()=>p.taker_province,a=>{a&&w(p.taker_province).then(e=>{f.city=e.data,t.taker_province=p.taker_province,t.taker_city=p.taker_city})}),x(()=>p.taker_city,a=>{a&&w(p.taker_city).then(e=>{f.district=e.data,t.taker_city=p.taker_city,t.taker_district=p.taker_district})}),x(()=>p.taker_district,a=>{a&&(t.taker_district=p.taker_district)}),w(0).then(a=>{f.province=a.data});const ce=a=>{g=null,J(),a()},J=()=>{const a={order_id:0,delivery_type:"",taker_name:"",taker_mobile:"",taker_latitude:"",taker_longitude:"",taker_full_address:"",taker_address:"",taker_province:0,taker_city:0,taker_district:0,is_delivery_address:0,is_refund_address:0,is_default_delivery:0,is_default_refund:0,take_store_id:""};Object.keys(t).forEach(e=>{a[e]!=null&&(t[e]=a[e])})};return Z({showDialog:L,setFormData:se}),(a,e)=>{const l=Le,o=xe,i=Ve,q=we,b=Ce,D=Ee,ue=De,Q=Me,_e=Te,X=Fe;return u(),h(_e,{modelValue:L.value,"onUpdate:modelValue":e[10]||(e[10]=r=>L.value=r),title:n(d)("editAddress"),width:"700px",class:"diy-dialog-wrap","destroy-on-close":!0,"before-close":ce},{footer:c(()=>[U("span",Oe,[s(Q,{onClick:e[8]||(e[8]=r=>L.value=!1)},{default:c(()=>[P(M(n(d)("cancel")),1)]),_:1}),s(Q,{type:"primary",loading:v.value,onClick:e[9]||(e[9]=r=>ie(G.value))},{default:c(()=>[P(M(n(d)("confirm")),1)]),_:1},8,["loading"])])]),default:c(()=>[Y((u(),k("div",null,[s(ue,{model:t,"label-width":"100px",ref_key:"formRef",ref:G,rules:n(ae),class:"page-form mb-[30px]"},{default:c(()=>[s(i,{label:n(d)("deliveryType"),prop:"delivery_type"},{default:c(()=>[s(o,{modelValue:t.delivery_type,"onUpdate:modelValue":e[0]||(e[0]=r=>t.delivery_type=r),onChange:z},{default:c(()=>[(u(!0),k(V,null,C(O.value,(r,y)=>(u(),h(l,{label:r.key,key:y,status:""},{default:c(()=>[P(M(r.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),_.value=="express"||_.value=="local_delivery"?(u(),k(V,{key:0},[s(i,{label:n(d)("contacts"),prop:"taker_name"},{default:c(()=>[s(q,{modelValue:t.taker_name,"onUpdate:modelValue":e[1]||(e[1]=r=>t.taker_name=r),modelModifiers:{trim:!0},clearable:"",placeholder:n(d)("contactsPlaceholder"),class:"input-width",maxlength:"10"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(i,{label:n(d)("ContactInformation"),prop:"taker_mobile"},{default:c(()=>[s(q,{modelValue:t.taker_mobile,"onUpdate:modelValue":e[2]||(e[2]=r=>t.taker_mobile=r),modelModifiers:{trim:!0},clearable:"",placeholder:n(d)("ContactInformationPlaceholder"),class:"input-width",maxlength:"15"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(i,{label:n(d)("address")},{default:c(()=>[s(D,{modelValue:t.taker_province,"onUpdate:modelValue":e[3]||(e[3]=r=>t.taker_province=r),"value-key":"id",clearable:"",class:"w-[150px]",ref_key:"provinceRef",ref:A,placeholder:n(d)("province")},{default:c(()=>[s(b,{label:n(d)("province"),value:0},null,8,["label"]),(u(!0),k(V,null,C(f.province,(r,y)=>(u(),h(b,{key:y,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),s(D,{modelValue:t.taker_city,"onUpdate:modelValue":e[4]||(e[4]=r=>t.taker_city=r),"value-key":"id",clearable:"",class:"w-[150px] ml-3",ref_key:"cityRef",ref:I,placeholder:n(d)("city")},{default:c(()=>[s(b,{label:n(d)("city"),value:0},null,8,["label"]),(u(!0),k(V,null,C(f.city,(r,y)=>(u(),h(b,{key:y,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),s(D,{modelValue:t.taker_district,"onUpdate:modelValue":e[5]||(e[5]=r=>t.taker_district=r),"value-key":"id",clearable:"",class:"w-[150px] mt-[20px]",ref_key:"districtRef",ref:S,placeholder:n(d)("area")},{default:c(()=>[s(b,{label:n(d)("area"),value:0},null,8,["label"]),(u(!0),k(V,null,C(f.district,(r,y)=>(u(),h(b,{key:y,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),s(q,{modelValue:t.taker_address,"onUpdate:modelValue":e[6]||(e[6]=r=>t.taker_address=r),modelModifiers:{trim:!0},clearable:"",placeholder:n(d)("detailedAddress"),class:"!w-[214px] mt-[20px] ml-3",maxlength:"30"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):j("",!0),s(i,null,{default:c(()=>[U("div",{class:ke(["h-[0px] overflow-hidden",{"!h-auto":_.value=="local_delivery"}])},[Y(U("div",je,null,512),[[X,K.value]])],2),_.value=="local_delivery"&&F.value?(u(),k("div",Ne,M(F.value),1)):j("",!0)]),_:1}),_.value=="store"?(u(),h(i,{key:1,label:n(d)("selfPickupStores")},{default:c(()=>[s(D,{modelValue:t.take_store_id,"onUpdate:modelValue":e[7]||(e[7]=r=>t.take_store_id=r),"value-key":"store_id",onChange:oe},{default:c(()=>[(u(!0),k(V,null,C($.value,(r,y)=>(u(),h(b,{key:y,label:r.store_name,value:r.store_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):j("",!0)]),_:1},8,["model","rules"])])),[[X,v.value]])]),_:1},8,["modelValue","title"])}}});export{ut as _};
