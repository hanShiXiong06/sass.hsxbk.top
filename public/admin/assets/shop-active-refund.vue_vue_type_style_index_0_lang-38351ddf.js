import{d as $,r as f,n as L,h as v,s as q,w as n,a as s,e as a,i as E,t as i,u as d,q as _,R as z,c as x,B as K,A as W,U as X,a$ as Y,aW as j,L as H,ad as J,aa as O,ae as Q,K as Z,M as ee,E as oe,X as te,Y as le}from"./index-99f00cf3.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               */import"./el-form-item-4ed993c7.js";/* empty css                 */import{t as se}from"./order-b4e82541.js";const ne=s("p",null,"商家主动退款功能仅作为退款维权业务的补充功能，请勿过度依赖和使用。此功能支持多次退款操作。",-1),ae=s("p",null,"如果订单项全部退款，运费将在最后一次退款时一并退还，同时使用的优惠券也将返还给用户，退款金额将原路返还至用户的支付账户。",-1),de={class:"text-[red]"},re={key:0,class:"text-[#999] text-[24rpx]"},_e={class:"flex cursor-pointer"},ie={class:"flex items-center min-w-[50px] mr-[10px]"},ue=["src"],ce={key:1,class:"w-[50px] h-[50px]",src:"",alt:""},me={class:"flex flex-col"},fe={class:"max-w-[250px]"},pe={class:"multi-hidden text-[14px]"},ye={class:"text-[12px] text-[#999] truncate"},ve={class:"flex flex-col"},he={class:"text-[13px]"},xe={class:"flex flex-col"},ge={class:"text-[13px]"},be={class:"flex flex-col"},ke={class:"text-[13px] mt-[5px]"},we={class:"dialog-footer"},qe=$({__name:"shop-active-refund",emits:["complete"],setup(Ee,{expose:F,emit:T}){const p=f(!1),c=f(!1),V={order_goods_ids:[],refund_money:0,shop_active_refund_remark:""},g=f([]),b=f(null),e=L({...V}),k=f();let h=0,m=f(!1);const D=(t,o)=>{e.refund_money=0,m.value=!1,e.order_goods_ids=[],t.forEach((r,u)=>{e.refund_money+=r.refund_money,e.order_goods_ids.push(r.order_goods_id)}),t.length==h&&(e.refund_money+=parseFloat(e.delivery_money),m.value=!0),e.refund_money=e.refund_money.toFixed(2)},R=t=>{e.refund_money=0,m.value=!1,e.order_goods_ids=[],t.forEach((o,r)=>{e.refund_money+=o.refund_money,e.order_goods_ids.push(o.order_goods_id)}),t.length==h&&(e.refund_money+=parseFloat(e.delivery_money),m.value=!0),e.refund_money=e.refund_money.toFixed(2)},A=(t,o)=>{let r=!1;return t.status==1&&(r=!0),r},C=async t=>{if(!(c.value||!t)){if(e.order_goods_ids.length<=0){X({message:_("refundGoodsPlaceholder"),type:"warning"});return}await t.validate(async o=>{o&&(c.value=!0,se(e).then(u=>{c.value=!1,p.value=!1,T("complete"),B()}).catch(u=>{}))})}},S=async(t=null)=>{c.value=!0,t&&(h=0,e.refund_money=0,e.order_goods_ids=[],g.value=t.order_goods,g.value.forEach((o,r,u)=>{u[r].refund_money=o.goods_money-o.discount_money,o.status==1&&(h++,e.refund_money+=u[r].refund_money,e.order_goods_ids.push(o.order_goods_id))}),e.delivery_money=t.delivery_money,e.refund_money+=parseFloat(t.delivery_money),m.value=!0,e.refund_money=e.refund_money.toFixed(2),e.shop_active_refund_remark=""),Y(()=>{setTimeout(()=>{b.value.toggleAllSelection()},100)}),c.value=!1},B=()=>{e.order_goods_id=0,e.refund_money=0,e.shop_active_refund_status="partial_refund",e.shop_active_money_type="back_refund",e.shop_active_refund_remark=""};return F({showDialog:p,setFormData:S}),(t,o)=>{const r=j,u=H,y=J,I=O,N=Q,G=Z,M=ee,w=oe,P=te,U=le;return v(),q(P,{modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=l=>p.value=l),title:d(_)("refundTitle"),width:"800px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:n(()=>[s("span",we,[a(w,{onClick:o[1]||(o[1]=l=>p.value=!1)},{default:n(()=>[E(i(d(_)("cancel")),1)]),_:1}),a(w,{type:"primary",loading:c.value,onClick:o[2]||(o[2]=l=>C(k.value))},{default:n(()=>[E(i(d(_)("confirm")),1)]),_:1},8,["loading"])])]),default:n(()=>[z((v(),x("div",null,[a(r,{type:"warning",closable:!1,class:"!mb-[10px]"},{default:n(()=>[ne,ae]),_:1}),a(M,{model:e,"label-width":"100px",ref_key:"formRef",ref:k,rules:t.formRules,class:"page-form mb-[30px]"},{default:n(()=>[a(u,{label:d(_)("refundMoney")},{default:n(()=>[s("div",de,[s("span",null,"￥"+i(e.refund_money),1),d(m)?(v(),x("span",re,"（运费:￥"+i(e.delivery_money)+"）",1)):K("",!0)])]),_:1},8,["label"]),a(u,{label:d(_)("refundGoodsItem")},{default:n(()=>[a(N,{data:g.value,size:"large",ref_key:"refundTableRef",ref:b,onSelect:D,onSelectAll:R},{default:n(()=>[a(y,{type:"selection",width:"40",selectable:A}),a(y,{align:"left","min-width":"200",label:d(_)("refundGoodsInfo")},{default:n(({row:l})=>[s("div",_e,[s("div",ie,[l.goods_image?(v(),x("img",{key:0,class:"w-[50px] h-[50px]",src:d(W)(l.goods_image),alt:""},null,8,ue)):(v(),x("img",ce))]),s("div",me,[a(I,{class:"box-item",effect:"light",placement:"top"},{content:n(()=>[s("div",fe,i(l.goods_name),1)]),default:n(()=>[s("p",pe,i(l.goods_name),1)]),_:2},1024),s("span",ye,i(l.sku_name),1)])])]),_:1},8,["label"]),a(y,{"min-width":"60",label:d(_)("refundPayPrice")},{default:n(({row:l})=>[s("div",ve,[s("span",he,"￥"+i(l.refund_money),1)])]),_:1},8,["label"]),a(y,{"min-width":"80",label:d(_)("refundGoodsPrice")},{default:n(({row:l})=>[s("div",xe,[s("span",ge,"￥"+i(l.price),1)])]),_:1},8,["label"]),a(y,{"min-width":"60",label:d(_)("refundGoodsNum")},{default:n(({row:l})=>[s("div",be,[s("span",ke,i(l.num)+i(d(_)("piece")),1)])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["label"]),a(u,{label:d(_)("refundInstructions"),prop:"shop_active_refund_remark"},{default:n(()=>[a(G,{modelValue:e.shop_active_refund_remark,"onUpdate:modelValue":o[0]||(o[0]=l=>e.shop_active_refund_remark=l),modelModifiers:{trim:!0},rows:5,type:"textarea",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])),[[U,c.value]])]),_:1},8,["modelValue","title"])}}});export{qe as _};
