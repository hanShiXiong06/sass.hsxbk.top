import{d as U,r as c,n as j,l as D,Q as v,h as s,s as z,w as a,e as o,a as m,R as F,i as V,c as p,t as d,u as g,q as k,B as I,a0 as q,av as M,L as P,E as Q,ac as $,aE as A,ad as G,M as H}from"./index-37fee5a0.js";/* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css               *//* empty css                  */import"./el-form-item-4ed993c7.js";import J from"./coupon-select-popup-79da368c.js";import{c as K}from"./marketing-ce45fa4b.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                  *//* empty css                  */import"./_plugin-vue_export-helper-c27b6911.js";const W={class:"flex items-center"},X=m("span",{class:"ml-[10px] el-form-item__label"},"送优惠券",-1),Y={key:0,class:"mt-[10px]"},Z={key:0},ee={key:1},te={key:0},oe={key:1},Ee=U({__name:"gift-coupon",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(x,{expose:C,emit:E}){const w=x,R=c(null),e=c({is_use:0,coupon_id:[],coupon_list:{}}),h=c(null),B=j({coupon_id:[{validator:(l,i,n)=>{e.value.is_use&&(e.value.coupon_id.length||n("请输入选择优惠券"),e.value.coupon_id.forEach(_=>{e.value.coupon_list["id_"+_]||n("请输入赠券数量")})),n()}}]}),f=D({get(){return w.modelValue},set(l){E("update:modelValue",l)}}),r=c([]);v(()=>f.value,(l,i)=>{(!i||!Object.keys(i).length)&&Object.keys(l).length&&(e.value=f.value)},{immediate:!0}),v(()=>e.value,()=>{f.value=e.value},{deep:!0}),v(()=>e.value.coupon_id,()=>{e.value.coupon_id.length?K({coupon_id:e.value.coupon_id.toString()}).then(({data:l})=>{r.value=l}):(e.value.coupon_list={},r.value=[])},{deep:!0,immediate:!0});const N=async()=>{var i;let l=!0;return await((i=h.value)==null?void 0:i.validate(n=>{l=n})),l},S=l=>{delete e.value.coupon_list["id_"+l.id],e.value.coupon_id.splice(e.value.coupon_id.indexOf(l.id),1)};return C({verify:N}),(l,i)=>{const n=M,_=P,b=Q,u=$,L=A,O=G,T=H;return s(),z(T,{ref_key:"formRef",ref:h,model:e.value,rules:B},{default:a(()=>[o(_,{label:"",class:"!mb-0"},{default:a(()=>[m("div",W,[o(n,{modelValue:e.value.is_use,"onUpdate:modelValue":i[0]||(i[0]=t=>e.value.is_use=t),label:"","true-label":1,"false-label":0,size:"large",class:"!mr-0"},null,8,["modelValue"]),X])]),_:1}),F(o(_,{label:"",prop:"coupon_id"},{default:a(()=>[m("div",null,[m("div",null,[o(J,{modelValue:e.value.coupon_id,"onUpdate:modelValue":i[1]||(i[1]=t=>e.value.coupon_id=t),ref_key:"selectCouponRef",ref:R},{default:a(()=>[o(b,{type:"primary",link:""},{default:a(()=>[V("选择优惠券")]),_:1})]),_:1},8,["modelValue"])]),r.value.length?(s(),p("div",Y,[o(O,{data:r.value,size:"default",ref:"couponListTableRef","max-height":"400"},{default:a(()=>[o(u,{prop:"title",label:"名称","min-width":"130"}),o(u,{prop:"type_name",label:"类型","min-width":"130"}),o(u,{prop:"price",label:"面值","min-width":"130"},{default:a(({row:t})=>[m("span",null,"¥"+d(t.price),1)]),_:1}),o(u,{label:"使用门槛","min-width":"130"},{default:a(({row:t})=>[t.min_condition_money=="0.00"?(s(),p("span",Z,"无门槛")):(s(),p("span",ee,"满"+d(t.min_condition_money)+"元可用",1))]),_:1}),o(u,{label:"有效期","min-width":"210"},{default:a(({row:t})=>[t.valid_type==1?(s(),p("span",te," 领取之日起"+d(t.length||"")+" 天内有效",1)):(s(),p("span",oe," 使用截止时间至"+d(t.valid_end_time||""),1))]),_:1}),o(u,{label:"赠券数","min-width":"130"},{default:a(({row:t})=>[o(L,{modelValue:e.value.coupon_list["id_"+t.id],"onUpdate:modelValue":y=>e.value.coupon_list["id_"+t.id]=y,min:1,"controls-position":"right",class:"!w-[100px]"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(u,{label:g(k)("operation"),align:"right",fixed:"right"},{default:a(({row:t})=>[o(b,{type:"primary",link:"",onClick:y=>S(t)},{default:a(()=>[V(d(g(k)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])])):I("",!0)])]),_:1},512),[[q,e.value.is_use]])]),_:1},8,["model","rules"])}}});export{Ee as default};
