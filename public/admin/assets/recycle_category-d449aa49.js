import{d as Z,x as ee,cA as te,r as E,n as U,aJ as ae,a$ as oe,a3 as R,f as se,a2 as le,h as x,c as ie,e as l,w as r,a as c,t as f,u as i,i as S,q as n,R as ne,s as T,A as L,j as F,B,a5 as re,E as ce,ax as de,ay as pe,ac as _e,J as me,aS as ue,ad as ge,a7 as he,bk as fe,Y as ye,p as ve,g as xe}from"./index-a3bdc7eb.js";/* empty css                   *//* empty css                        *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                    *//* empty css                  */import{_ as P}from"./category_default-35af358b.js";import{c as be,u as we,e as M,d as Ce}from"./recycle_category-0dc5f62b.js";import{_ as ke}from"./recycle-category-edit.vue_vue_type_style_index_0_lang-d8a5f244.js";import{S as Ie}from"./sortable.esm-be94e56d.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                   *//* empty css                */import"./index-a76a08b7.js";import"./index.vue_vue_type_style_index_0_lang-56f89855.js";import"./attachment-00d8a467.js";import"./index.vue_vue_type_script_setup_true_lang-58bfacba.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-d51e8a6d.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-d42256f5.js";const $=b=>(ve("data-v-743a2687"),b=b(),xe(),b),Re={class:"main-container"},Te={class:"flex justify-between items-center mb-[5px]"},Ve={class:"text-page-title"},De={class:"mt-[10px]"},Se=$(()=>c("i",{class:"order-0 iconfont icontuodong vues-rank mr-[8px]"},null,-1)),Be={class:"order-2"},$e={class:"h-[30px]"},Ne=$(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:P})],-1)),je={class:"h-[30px]"},Ue=$(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:P})],-1)),Le=Z({__name:"recycle_category",setup(b){const q=ee().meta.title,N=te();E("");const s=U({loading:!0,data:[]});ae(()=>{oe(()=>{z()}),V()});const _=E([]),z=()=>{const t=N.value.$el.querySelector(".el-table__body-wrapper tbody");Ie.create(t,{handle:".vues-rank",animation:300,onMove:({dragged:a,related:d})=>{const m=_.value[a.rowIndex],u=_.value[d.rowIndex];if(m.pid!==u.pid)return!1},onStart:()=>{_.value=A(R(s.data))},onEnd:a=>{var I;const d=_.value[a.oldIndex],m=_.value[a.newIndex];if(a.oldIndex===a.newIndex||d.pid!==m.pid||_.value.indexOf(d)<0)return!1;const o=_.value.splice(a.oldIndex,1)[0];_.value.splice(a.newIndex,0,o);const C=m.pid,k=(I=_.value.filter(p=>p.pid===C))==null?void 0:I.map((p,v)=>{if(p.level===1&&p.category_id===o.category_id&&(s.data=s.data.filter(g=>g.category_id!==o.category_id),s.data.splice(v,0,o)),p.level===2&&p.category_id===o.category_id){const g=s.data.findIndex(e=>e.category_id===p.pid),D=R(s.data[g].child_list.filter(e=>e.category_id!==o.category_id));s.data[g].child_list=[],s.data[g].child_list.push(...D),s.data[g].child_list.splice(v,0,o)}return{category_id:p.category_id,sort:9999-v}});J({category_sort_array:k})}})},A=(t,a="child_list")=>{const d=[],m=u=>{u&&u.length>0&&u.filter(o=>o).forEach(o=>{d.push(o),m(o[a]||[])})};return m(t),d},V=()=>{s.loading=!0,be().then(t=>{s.loading=!1,s.data=t.data}).catch(()=>{s.loading=!1})},J=t=>{we(t).then(a=>{})},w=U({show:!1,index:0}),j=E([]),G=t=>{w.show=!0,j.value=[t.images]},O=t=>{const a=R(t);delete a.child_list,M(a)},Y=t=>{const a=R(t);delete a.child_list,M(a)},y=E(null),H=()=>{y.value.setFormData(),y.value.showDialog=!0},K=t=>{y.value.setFormData(t),y.value.showDialog=!0},Q=t=>{re.confirm(!t.child_list||!t.child_list.length?n("categoryDeleteTips"):n("categoryDeleteTips1"),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{Ce(t.category_id).then(()=>{V()}).catch(()=>{})})},W=se(),X=t=>{W.push({path:t})};return(t,a)=>{const d=ce,m=de,u=pe,o=_e,C=me,k=ue,I=ge,p=he,v=le("goods-category-spread-popup"),g=fe,D=ye;return x(),ie("div",Re,[l(p,{class:"box-card !border-none",shadow:"never"},{default:r(()=>[c("div",Te,[c("span",Ve,f(i(q)),1),l(d,{type:"primary",onClick:H},{default:r(()=>[S(f(i(n)("addCategory")),1)]),_:1})]),l(u,{class:"demo-tabs","model-value":"/phone_shop_price/goods/category",onTabChange:X},{default:r(()=>[l(m,{label:i(n)("tabGoodsCategory"),name:"/phone_shop_price/goods/category"},null,8,["label"])]),_:1}),c("div",De,[ne((x(),T(I,{data:s.data,ref_key:"tableRef",ref:N,size:"large","row-key":"category_id","tree-props":{hasChildren:"hasChildren",children:"child_list"}},{empty:r(()=>[c("span",null,f(s.loading?"":i(n)("emptyData")),1)]),default:r(()=>[l(o,{label:i(n)("categoryName"),"min-width":"120"},{default:r(({row:e})=>[Se,c("span",Be,f(e.category_name),1)]),_:1},8,["label"]),l(o,{label:i(n)("image"),width:"170",align:"left"},{default:r(({row:e})=>[c("div",$e,[l(C,{class:"w-[30px] h-[30px]",src:i(L)(e.image),fit:"contain"},{error:r(()=>[Ne]),_:2},1032,["src"])])]),_:1},8,["label"]),l(o,{prop:"is_show",label:i(n)("是否显示")},{default:r(({row:e})=>[l(k,{modelValue:e.is_show,"onUpdate:modelValue":h=>e.is_show=h,"active-value":1,"inactive-value":0,onChange:h=>O(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),l(o,{prop:"need_vip",label:i(n)("是否需要VIP")},{default:r(({row:e})=>[l(k,{modelValue:e.need_vip,"onUpdate:modelValue":h=>e.need_vip=h,"active-value":1,"inactive-value":0,onChange:h=>Y(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),l(o,{label:i(n)("报价"),width:"170",align:"left"},{default:r(({row:e})=>[c("div",je,[l(C,{class:"w-[30px] h-[30px]",onClick:h=>G(e),src:i(L)(e.images),fit:"contain"},{error:r(()=>[Ue]),_:2},1032,["onClick","src"])])]),_:1},8,["label"]),l(o,{label:i(n)("operation"),fixed:"right",align:"right",width:"200"},{default:r(({row:e})=>[i(F)().siteInfo.site_id==e.site_id?(x(),T(d,{key:0,type:"primary",link:"",onClick:h=>K(e)},{default:r(()=>[S(f(i(n)("edit")),1)]),_:2},1032,["onClick"])):B("",!0),i(F)().siteInfo.site_id==e.site_id?(x(),T(d,{key:1,type:"primary",link:"",onClick:h=>Q(e)},{default:r(()=>[S(f(i(n)("delete")),1)]),_:2},1032,["onClick"])):B("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[D,s.loading]])]),l(ke,{ref_key:"editCategoryDialog",ref:y,onComplete:V},null,512)]),_:1}),l(v,{ref:"goodsCategorySpreadPopupRef"},null,512),w.show?(x(),T(g,{key:0,"url-list":j.value,onClose:a[0]||(a[0]=e=>w.show=!1),"initial-index":w.index,"zoom-rate":1},null,8,["url-list","initial-index"])):B("",!0)])}}});const It=Ee(Le,[["__scopeId","data-v-743a2687"]]);export{It as default};
