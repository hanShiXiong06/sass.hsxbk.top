import{d as de,x as ue,f as ce,r as F,n as O,aJ as me,cn as pe,l as _e,q as r,h as d,c as m,e as o,w as n,u as s,F as g,T as y,s as P,a as h,i as S,t as V,B as q,cO as he,cK as G,cP as fe,Q as be,cQ as ve,U as Q,aQ as ge,a7 as ye,ax as Ve,ay as we,K as ke,L as xe,ab as Ce,aC as Pe,E as Le,d1 as Me,M as Ee,p as Fe,g as Se}from"./index-6f32d09b.js";/* empty css                *//* empty css                     */import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang-edd497b7.js";/* empty css                  */import Te from"./index-4df26bee.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                    *//* empty css                *//* empty css                   *//* empty css                       */import{i as Ue,j as Oe,k as qe,l as De}from"./tourism-dc4cc108.js";import{j as Ie}from"./poster-11e724dc.js";import{_ as je}from"./_plugin-vue_export-helper-c27b6911.js";import"./index.vue_vue_type_style_index_0_lang-972988e5.js";/* empty css                  *//* empty css                   */import"./attachment-503e95ee.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-bee7eaa7.js";/* empty css                        *//* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-ad575143.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-0724e2f9.js";import"./sortable.esm-be94e56d.js";const He=L=>(Fe("data-v-c32bfa4b"),L=L(),Se(),L),Be={class:"main-container"},Ne={key:0},Re=He(()=>h("div",{class:"mt-4"},[h("div",{id:"TxMap",class:"map-item w-[800px] h-[500px]"})],-1)),$e={class:"ml-[10px]"},Ge={key:1},Qe={key:2},ze={class:"fixed-footer-wrap"},Ke={class:"fixed-footer"},Je=de({__name:"edit_hotel",setup(L){const z=ue(),D=ce(),w=F("first"),b=O({province:[],city:[],district:[]});(()=>{he(1).then(l=>{b.province=l.data})})();const I=l=>{Object.keys(l).length==0?l.id=e.province_id:(e.province_id=l.id,e.province_name=l.name),G(l.id).then(t=>{b.city=t.data})},j=l=>{Object.keys(l).length==0?l.id=e.city_id:(e.city_id=l.id,e.city_name=l.name),G(l.id).then(t=>{b.district=t.data})},K=l=>{e.district_id=l.id,e.district_name=l.name},J=()=>{e.province_id&&e.city_id&&e.district_id&&e.address&&(e.full_address=e.province_name+e.city_name+e.district_name+e.address,fe({address:e.full_address}).then(l=>{e.latitude=l.data.result.location.lat,e.longitude=l.data.result.location.lng}))};let k=null;const W=()=>{let l=e.latitude,t=e.longitude;e.latitude==0&&(l="39.90469"),e.longitude==0&&(t="116.40717");const i=new window.TMap.LatLng(l,t);k=new window.TMap.Map("TxMap",{center:i,zoom:17,viewMode:"2D",showControl:!0}),k.on("click",_=>{const x={lat:_.latLng.getLat().toFixed(6),lng:_.latLng.getLng().toFixed(6)};X(x.lat,x.lng,1),u.updateGeometries({id:"shop",position:_.latLng})});const u=new window.TMap.MultiMarker({id:"marker-layer",map:k,minimumClusterSize:1});u.updateGeometries({id:"shop",position:i}),k.on("idle",()=>{be(()=>e.latitude,(_,x)=>{const v=new window.TMap.LatLng(e.latitude,e.longitude);k.panTo(v,1),u.updateGeometries({id:"shop",position:v})})})};me(()=>{const l=document.createElement("script");pe().then(t=>{l.type="text/javascript",l.src="https://map.qq.com/api/gljs?v=1.exp&key="+t.data.key,document.body.appendChild(l)}),l.onload=()=>{setTimeout(()=>{W()},500)}});const X=(l,t,i)=>{ve({location:l+","+t}).then(u=>{u.data.result?(e.province_name=u.data.result.address_component.province,e.city_name=u.data.result.address_component.city,e.district_name=u.data.result.address_component.district,i==1&&(e.address=u.data.result.formatted_addresses.recommend,e.full_address=e.province_name+e.city_name+e.district_name+e.address,e.latitude=l,e.longitude=t)):Q({type:"warning",message:u.data.message})})},H=F([]);(()=>{Ue().then(l=>{H.value=l.data})})();const Y=l=>{e.hotel_attribute.length<=0?e.hotel_attribute.push(l):e.hotel_attribute.indexOf(l)!=-1?e.hotel_attribute.splice(e.hotel_attribute.indexOf(l),1):e.hotel_attribute.push(l)},M=parseInt(z.query.id),E=F(!1),B={hotel_id:0,hotel_name:"",hotel_star:"",hotel_tag:"",hotel_cover:"",hotel_images:"",hotel_attribute:[],province_id:"",province_name:"",city_id:"",city_name:"",district_id:"",district_name:"",address:"",longitude:0,latitude:0,hotel_desc:"",price:"",full_address:"",poster_id:""},e=O({...B});M&&(async(l=0)=>{Object.assign(e,B);const t=await(await Oe(l)).data;Object.keys(e).forEach(i=>{t[i]!=null&&i!="hotel_attribute"&&(e[i]=t[i]),i=="hotel_attribute"&&t[i]!=null&&(e[i]=t[i].split(","))}),e.hotel_id=l,e.province_id>0&&I({}),e.city_id>0&&j({})})(M);const N=F(),Z=_e(()=>({hotel_name:[{required:!0,message:r("hotelNamePlaceholder"),trigger:"blur"}],hotel_star:[{required:!0,message:r("starRatingPlaceholder"),trigger:"blur"}],hotel_cover:[{required:!0,validator:te,trigger:"blur"}],address_area:[{required:!0,validator:ee,trigger:"blur"}],address:[{required:!0,message:r("hotelAddressDetailPlaceholder"),trigger:"blur"}]})),ee=(l,t,i)=>{(e.province_name==""||e.city_name==""||e.district_name=="")&&i(new Error(r("hotelAddressPlaceholder"))),i()},te=(l,t,i)=>{e.hotel_cover==""&&i(new Error(r("hotelCoverPlaceholder"))),i()},le=async l=>{E.value||!l||await l.validate(async t=>{t&&(E.value=!0,e.hotel_attribute=e.hotel_attribute.join(","),(M?qe:De)(e).then(_=>{E.value=!1,history.back()}).catch(()=>{E.value=!1}))})},A=O([]),ae=()=>{const l=D.resolve({path:"/poster/list"});window.open(l.href)},R=(l=!1)=>{Ie({type:"tourism_hotel"}).then(t=>{const i=t.data;i&&(A.splice(0,A.length,...i),l&&Q({message:r("refreshSuccess"),type:"success"}))})};R();const oe=()=>{history.back()};return(l,t)=>{const i=ge,u=ye,_=Ve,x=we,v=ke,p=xe,c=Ce,C=Pe,$=Te,T=Le,re=Ae,se=Me,ie=Ee;return d(),m("div",Be,[o(u,{class:"card !border-none mb-[15px]",shadow:"never"},{default:n(()=>[o(i,{content:s(M)?s(r)("editHotel"):s(r)("addHotel"),icon:l.ArrowLeft,onBack:t[0]||(t[0]=a=>s(D).push({path:"/tourism/product/hotel/hotel"}))},null,8,["content","icon"])]),_:1}),o(u,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[o(x,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=a=>w.value=a),class:"demo-tabs"},{default:n(()=>[o(_,{label:s(r)("basicInformation"),name:"first"},null,8,["label"]),o(_,{label:s(r)("hotelIntroduce"),name:"introduce"},null,8,["label"]),o(_,{label:s(r)("hotelPeriphery"),name:"periphery"},null,8,["label"])]),_:1},8,["modelValue"]),o(ie,{model:e,"label-width":"120px",ref_key:"formRef",ref:N,rules:s(Z),class:"page-form"},{default:n(()=>[w.value=="first"?(d(),m("div",Ne,[o(p,{label:s(r)("hotelName"),prop:"hotel_name"},{default:n(()=>[o(v,{modelValue:e.hotel_name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.hotel_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:s(r)("hotelNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(p,{label:s(r)("starRating"),prop:"hotel_star"},{default:n(()=>[o(C,{modelValue:e.hotel_star,"onUpdate:modelValue":t[3]||(t[3]=a=>e.hotel_star=a),clearable:"",class:"input-width"},{default:n(()=>[o(c,{label:s(r)("oneStar"),value:1},null,8,["label"]),o(c,{label:s(r)("twoStar"),value:2},null,8,["label"]),o(c,{label:s(r)("threeStar"),value:3},null,8,["label"]),o(c,{label:s(r)("fourStar"),value:4},null,8,["label"]),o(c,{label:s(r)("fiveStar"),value:5},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(p,{label:s(r)("hotelLabel")},{default:n(()=>[o(v,{modelValue:e.hotel_tag,"onUpdate:modelValue":t[4]||(t[4]=a=>e.hotel_tag=a),modelModifiers:{trim:!0},clearable:"",placeholder:s(r)("hotelLabelPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(p,{label:s(r)("hotelCover"),prop:"hotel_cover"},{default:n(()=>[o($,{modelValue:e.hotel_cover,"onUpdate:modelValue":t[5]||(t[5]=a=>e.hotel_cover=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(p,{label:s(r)("hotelImages")},{default:n(()=>[o($,{modelValue:e.hotel_images,"onUpdate:modelValue":t[6]||(t[6]=a=>e.hotel_images=a),limit:"10"},null,8,["modelValue"])]),_:1},8,["label"]),o(p,{label:s(r)("hotelAddress"),prop:"address_area"},{default:n(()=>[o(C,{modelValue:e.province_name,"onUpdate:modelValue":t[7]||(t[7]=a=>e.province_name=a),"value-key":"id",clearable:"",class:"w-[200px]",onChange:I},{default:n(()=>[o(c,{label:s(r)("provincePlaceholder"),value:""},null,8,["label"]),(d(!0),m(g,null,y(b.province,(a,f)=>(d(),P(c,{key:f,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(C,{modelValue:e.city_name,"onUpdate:modelValue":t[8]||(t[8]=a=>e.city_name=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",onChange:j},{default:n(()=>[o(c,{label:s(r)("cityPlaceholder"),value:""},null,8,["label"]),(d(!0),m(g,null,y(b.city,(a,f)=>(d(),P(c,{key:f,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(C,{modelValue:e.district_name,"onUpdate:modelValue":t[9]||(t[9]=a=>e.district_name=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",onChange:K},{default:n(()=>[o(c,{label:s(r)("districtPlaceholder"),value:""},null,8,["label"]),(d(!0),m(g,null,y(b.district,(a,f)=>(d(),P(c,{key:f,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(p,{label:s(r)("hotelAddressDetail"),prop:"address"},{default:n(()=>[h("div",null,[h("div",null,[o(v,{modelValue:e.address,"onUpdate:modelValue":t[10]||(t[10]=a=>e.address=a),modelModifiers:{trim:!0},clearable:"",placeholder:s(r)("hotelAddressDetailPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),o(T,{class:"ml-3",onClick:J},{default:n(()=>[S(V(s(r)("search")),1)]),_:1})]),Re])]),_:1},8,["label"]),o(p,{label:s(r)("poster")},{default:n(()=>[o(C,{modelValue:e.poster_id,"onUpdate:modelValue":t[11]||(t[11]=a=>e.poster_id=a),placeholder:s(r)("posterPlaceholder"),clearable:""},{default:n(()=>[(d(!0),m(g,null,y(A,a=>(d(),P(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),h("div",$e,[h("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:t[12]||(t[12]=a=>R(!0))},V(s(r)("refresh")),1),h("span",{class:"cursor-pointer text-primary",onClick:ae},V(s(r)("addGoodsPoster")),1)])]),_:1},8,["label"])])):q("",!0),w.value=="introduce"?(d(),m("div",Ge,[o(p,{label:s(r)("hotelIntroduce")},{default:n(()=>[o(re,{modelValue:e.hotel_desc,"onUpdate:modelValue":t[13]||(t[13]=a=>e.hotel_desc=a)},null,8,["modelValue"])]),_:1},8,["label"])])):q("",!0),w.value=="periphery"?(d(),m("div",Qe,[(d(!0),m(g,null,y(H.value,(a,f)=>(d(),P(p,{label:a.name,key:f},{default:n(()=>[(d(!0),m(g,null,y(a.attr,(U,ne)=>(d(),m("span",{key:ne},[o(se,{style:{"margin-right":"8px"},checked:e.hotel_attribute.indexOf(U[0])!=-1,onChange:Ze=>Y(U[0])},{default:n(()=>[S(V(U[0]),1)]),_:2},1032,["checked","onChange"])]))),128))]),_:2},1032,["label"]))),128))])):q("",!0)]),_:1},8,["model","rules"])]),_:1}),h("div",ze,[h("div",Ke,[o(T,{type:"primary",onClick:t[14]||(t[14]=a=>le(N.value))},{default:n(()=>[S(V(s(r)("save")),1)]),_:1}),o(T,{onClick:t[15]||(t[15]=a=>oe())},{default:n(()=>[S(V(s(r)("cancel")),1)]),_:1})])])])}}});const Ht=je(Je,[["__scopeId","data-v-c32bfa4b"]]);export{Ht as default};
