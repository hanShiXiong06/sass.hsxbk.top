import{d as T,r as c,n as U,l as j,Q as v,h as u,s as D,w as a,e as o,a as m,R as z,i as g,c as p,t as d,F as I,u as V,q as k,B as q,a0 as M,av as P,L as Q,E as $,ac as A,aE as G,ad as H,M as J}from"./index-a3bdc7eb.js";/* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css               *//* empty css                  */import"./el-form-item-4ed993c7.js";import K from"./coupon-select-popup-6c4ed582.js";import{c as W}from"./marketing-17dac742.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                  *//* empty css                  */import"./_plugin-vue_export-helper-c27b6911.js";const X={class:"flex items-center"},Y=m("span",{class:"ml-[10px] el-form-item__label"},"送优惠券",-1),Z={key:0,class:"mt-[10px]"},ee={key:0},te={key:1},oe={key:0},le={key:1},ae={key:1},Re=T({__name:"gift-coupon",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(x,{expose:C,emit:E}){const w=x,R=c(null),e=c({is_use:0,coupon_id:[],coupon_list:{}}),h=c(null),B=U({coupon_id:[{validator:(l,i,n)=>{e.value.is_use&&(e.value.coupon_id.length||n("请输入选择优惠券"),e.value.coupon_id.forEach(_=>{e.value.coupon_list["id_"+_]||n("请输入赠券数量")})),n()}}]}),f=j({get(){return w.modelValue},set(l){E("update:modelValue",l)}}),r=c([]);v(()=>f.value,(l,i)=>{(!i||!Object.keys(i).length)&&Object.keys(l).length&&(e.value=f.value)},{immediate:!0}),v(()=>e.value,()=>{f.value=e.value},{deep:!0}),v(()=>e.value.coupon_id,()=>{e.value.coupon_id.length?W({coupon_id:e.value.coupon_id.toString()}).then(({data:l})=>{r.value=l}):(e.value.coupon_list={},r.value=[])},{deep:!0,immediate:!0});const N=async()=>{var i;let l=!0;return await((i=h.value)==null?void 0:i.validate(n=>{l=n})),l},S=l=>{delete e.value.coupon_list["id_"+l.id],e.value.coupon_id.splice(e.value.coupon_id.indexOf(l.id),1)};return C({verify:N}),(l,i)=>{const n=P,_=Q,b=$,s=A,F=G,L=H,O=J;return u(),D(O,{ref_key:"formRef",ref:h,model:e.value,rules:B},{default:a(()=>[o(_,{label:"",class:"!mb-0"},{default:a(()=>[m("div",X,[o(n,{modelValue:e.value.is_use,"onUpdate:modelValue":i[0]||(i[0]=t=>e.value.is_use=t),label:"","true-label":1,"false-label":0,size:"large",class:"!mr-0"},null,8,["modelValue"]),Y])]),_:1}),z(o(_,{label:"",prop:"coupon_id"},{default:a(()=>[m("div",null,[m("div",null,[o(K,{modelValue:e.value.coupon_id,"onUpdate:modelValue":i[1]||(i[1]=t=>e.value.coupon_id=t),ref_key:"selectCouponRef",ref:R},{default:a(()=>[o(b,{type:"primary",link:""},{default:a(()=>[g("选择优惠券")]),_:1})]),_:1},8,["modelValue"])]),r.value.length?(u(),p("div",Z,[o(L,{data:r.value,size:"default",ref:"couponListTableRef","max-height":"400"},{default:a(()=>[o(s,{prop:"title",label:"名称","min-width":"130"}),o(s,{prop:"type_name",label:"类型","min-width":"130"}),o(s,{prop:"price",label:"面值","min-width":"130"},{default:a(({row:t})=>[m("span",null,"¥"+d(t.price),1)]),_:1}),o(s,{label:"使用门槛","min-width":"130"},{default:a(({row:t})=>[t.min_condition_money=="0.00"?(u(),p("span",ee,"无门槛")):(u(),p("span",te,"满"+d(t.min_condition_money)+"元可用",1))]),_:1}),o(s,{label:"有效期","min-width":"210"},{default:a(({row:t})=>[t.receive_type==1?(u(),p(I,{key:0},[t.valid_type==1?(u(),p("span",oe," 领取之日起"+d(t.length||"")+" 天内有效",1)):(u(),p("span",le," 使用截止时间至"+d(t.valid_end_time||""),1))],64)):(u(),p("span",ae,"--"))]),_:1}),o(s,{label:"赠券数","min-width":"130"},{default:a(({row:t})=>[o(F,{modelValue:e.value.coupon_list["id_"+t.id],"onUpdate:modelValue":y=>e.value.coupon_list["id_"+t.id]=y,min:1,"controls-position":"right",class:"!w-[100px]"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(s,{label:V(k)("operation"),align:"right",fixed:"right"},{default:a(({row:t})=>[o(b,{type:"primary",link:"",onClick:y=>S(t)},{default:a(()=>[g(d(V(k)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])])):q("",!0)])]),_:1},512),[[M,e.value.is_use]])]),_:1},8,["model","rules"])}}});export{Re as default};
