import{d as ee,x as te,cB as ae,r as E,n as j,aK as oe,a$ as se,a3 as R,f as le,a2 as ie,h as b,c as ne,e as l,w as r,a as c,t as f,u as i,i as S,q as n,R as re,s as T,A as L,j as z,B,a5 as ce,E as de,ay as pe,az as _e,ad as me,J as ue,aT as ge,ae as he,a7 as fe,bk as ye,Y as ve,p as be,g as xe}from"./index-99f00cf3.js";/* empty css                   *//* empty css                        *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                    *//* empty css                  */import{_ as M}from"./category_default-35af358b.js";import{c as we,u as Ce,e as F,d as ke}from"./recycle_category-02e95fa2.js";import{_ as Ie}from"./recycle-category-edit.vue_vue_type_style_index_0_lang-321d7c8e.js";import{S as Ee}from"./sortable.esm-be94e56d.js";import{_ as Re}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                   *//* empty css                */import"./index-015c0c3e.js";import"./index.vue_vue_type_style_index_0_lang-2e54ab99.js";import"./attachment-6fc096d0.js";import"./index.vue_vue_type_script_setup_true_lang-a59c79e6.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-bde8c802.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-49ab6f2c.js";const $=x=>(be("data-v-f847bdae"),x=x(),xe(),x),Te={class:"main-container"},Ve={class:"flex justify-between items-center mb-[5px]"},De={class:"text-page-title"},Se={class:"mt-[10px]"},Be=$(()=>c("i",{class:"order-0 iconfont icontuodong vues-rank mr-[8px]"},null,-1)),$e={class:"order-2"},Ne={class:"h-[30px]"},Ue=$(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:M})],-1)),je={class:"h-[30px]"},Le=$(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:M})],-1)),ze=ee({__name:"recycle_category",setup(x){const P=te().meta.title,N=ae();E("");const s=j({loading:!0,data:[]});oe(()=>{se(()=>{q()}),V()});const _=E([]),q=()=>{const e=N.value.$el.querySelector(".el-table__body-wrapper tbody");Ee.create(e,{handle:".vues-rank",animation:300,onMove:({dragged:a,related:d})=>{const m=_.value[a.rowIndex],u=_.value[d.rowIndex];if(m.pid!==u.pid)return!1},onStart:()=>{_.value=W(R(s.data))},onEnd:a=>{var I;const d=_.value[a.oldIndex],m=_.value[a.newIndex];if(a.oldIndex===a.newIndex||d.pid!==m.pid||_.value.indexOf(d)<0)return!1;const o=_.value.splice(a.oldIndex,1)[0];_.value.splice(a.newIndex,0,o);const C=m.pid,k=(I=_.value.filter(p=>p.pid===C))==null?void 0:I.map((p,v)=>{if(p.level===1&&p.category_id===o.category_id&&(s.data=s.data.filter(g=>g.category_id!==o.category_id),s.data.splice(v,0,o)),p.level===2&&p.category_id===o.category_id){const g=s.data.findIndex(t=>t.category_id===p.pid),D=R(s.data[g].child_list.filter(t=>t.category_id!==o.category_id));s.data[g].child_list=[],s.data[g].child_list.push(...D),s.data[g].child_list.splice(v,0,o)}return{category_id:p.category_id,sort:9999-v}});A({category_sort_array:k})}})},W=(e,a="child_list")=>{const d=[],m=u=>{u&&u.length>0&&u.filter(o=>o).forEach(o=>{d.push(o),m(o[a]||[])})};return m(e),d},V=()=>{s.loading=!0,we().then(e=>{s.loading=!1,s.data=e.data}).catch(()=>{s.loading=!1})},A=e=>{Ce(e).then(a=>{})},w=j({show:!1,index:0}),U=E([]),G=e=>{w.show=!0,U.value=[J(e.images)]},J=e=>e.startsWith("http://")||e.startsWith("https://")?e:""+e,K=e=>{const a=R(e);delete a.child_list,F(a)},O=e=>{const a=R(e);delete a.child_list,F(a)},y=E(null),Y=()=>{y.value.setFormData(),y.value.showDialog=!0},H=e=>{y.value.setFormData(e),y.value.showDialog=!0},Q=e=>{ce.confirm(!e.child_list||!e.child_list.length?n("categoryDeleteTips"):n("categoryDeleteTips1"),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{ke(e.category_id).then(()=>{V()}).catch(()=>{})})},X=le(),Z=e=>{X.push({path:e})};return(e,a)=>{const d=de,m=pe,u=_e,o=me,C=ue,k=ge,I=he,p=fe,v=ie("goods-category-spread-popup"),g=ye,D=ve;return b(),ne("div",Te,[l(p,{class:"box-card !border-none",shadow:"never"},{default:r(()=>[c("div",Ve,[c("span",De,f(i(P)),1),l(d,{type:"primary",onClick:Y},{default:r(()=>[S(f(i(n)("addCategory")),1)]),_:1})]),l(u,{class:"demo-tabs","model-value":"/phone_shop_price/goods/category",onTabChange:Z},{default:r(()=>[l(m,{label:i(n)("tabGoodsCategory"),name:"/phone_shop_price/goods/category"},null,8,["label"])]),_:1}),c("div",Se,[re((b(),T(I,{data:s.data,ref_key:"tableRef",ref:N,size:"large","row-key":"category_id","tree-props":{hasChildren:"hasChildren",children:"child_list"}},{empty:r(()=>[c("span",null,f(s.loading?"":i(n)("emptyData")),1)]),default:r(()=>[l(o,{label:i(n)("categoryName"),"min-width":"120"},{default:r(({row:t})=>[Be,c("span",$e,f(t.category_name),1)]),_:1},8,["label"]),l(o,{label:i(n)("image"),width:"170",align:"left"},{default:r(({row:t})=>[c("div",Ne,[l(C,{class:"w-[30px] h-[30px]",src:i(L)(t.image),fit:"contain"},{error:r(()=>[Ue]),_:2},1032,["src"])])]),_:1},8,["label"]),l(o,{prop:"is_show",label:i(n)("是否显示")},{default:r(({row:t})=>[l(k,{modelValue:t.is_show,"onUpdate:modelValue":h=>t.is_show=h,"active-value":1,"inactive-value":0,onChange:h=>K(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),l(o,{prop:"need_vip",label:i(n)("是否需要VIP")},{default:r(({row:t})=>[l(k,{modelValue:t.need_vip,"onUpdate:modelValue":h=>t.need_vip=h,"active-value":1,"inactive-value":0,onChange:h=>O(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),l(o,{label:i(n)("报价"),width:"170",align:"left"},{default:r(({row:t})=>[c("div",je,[l(C,{class:"w-[30px] h-[30px]",onClick:h=>G(t),src:i(L)(t.images),fit:"contain"},{error:r(()=>[Le]),_:2},1032,["onClick","src"])])]),_:1},8,["label"]),l(o,{label:i(n)("operation"),fixed:"right",align:"right",width:"200"},{default:r(({row:t})=>[i(z)().siteInfo.site_id==t.site_id?(b(),T(d,{key:0,type:"primary",link:"",onClick:h=>H(t)},{default:r(()=>[S(f(i(n)("edit")),1)]),_:2},1032,["onClick"])):B("",!0),i(z)().siteInfo.site_id==t.site_id?(b(),T(d,{key:1,type:"primary",link:"",onClick:h=>Q(t)},{default:r(()=>[S(f(i(n)("delete")),1)]),_:2},1032,["onClick"])):B("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[D,s.loading]])]),l(Ie,{ref_key:"editCategoryDialog",ref:y,onComplete:V},null,512)]),_:1}),l(v,{ref:"goodsCategorySpreadPopupRef"},null,512),w.show?(b(),T(g,{key:0,"url-list":U.value,onClose:a[0]||(a[0]=t=>w.show=!1),"initial-index":w.index,"zoom-rate":1},null,8,["url-list","initial-index"])):B("",!0)])}}});const Et=Re(ze,[["__scopeId","data-v-f847bdae"]]);export{Et as default};
