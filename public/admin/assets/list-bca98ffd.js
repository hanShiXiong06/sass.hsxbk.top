import{d as ge,x as he,f as ye,n as R,r as v,a2 as ve,h as p,c as h,e as o,w as n,a as d,t as r,u as t,i as u,q as l,F as A,T as q,s as y,R as be,A as ke,B as b,a5 as Q,U as H,ap as Ce,E as xe,K as Ee,L as Te,ab as Ve,aC as Pe,M as we,a7 as $e,ax as Re,ay as Se,av as Be,ac as Oe,J as Ue,a1 as Fe,aU as Ie,ak as Ge,ad as ze,W as Le,Y as Ne}from"./index-6f32d09b.js";/* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                        *//* empty css                    *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                  */import{_ as De}from"./goods_default-995568ac.js";import{j as Me,e as je,m as S,k as Ae,l as qe}from"./giftcard-011e4eb3.js";import{g as Qe}from"./category-ed8b5ac2.js";import{_ as He}from"./giftcard-spread-popup.vue_vue_type_script_setup_true_lang-6731bedd.js";/* empty css                  *//* empty css                   */import"./browser-a1ac24ac.js";const Je={class:"main-container"},Ke={class:"flex justify-between items-center"},We={class:"text-lg"},Ye={class:"mt-[10px]"},Xe={class:"mb-[10px] flex items-center"},Ze={class:"flex items-center cursor-pointer"},et={class:"min-w-[80px] h-[50px] flex items-center justify-center"},tt=d("div",{class:"image-slot"},[d("img",{class:"w-[80px] h-[50px]",src:De})],-1),at={class:"ml-2"},lt=["title"],ot={class:"text-primary text-[12px]"},nt={key:0},st={key:1},it={key:2},rt={style:{display:"inline-flex","align-items":"center"}},dt={class:"mr-[5px]"},ct=d("br",null,null,-1),pt={key:0},ut={key:1},mt={style:{display:"inline-flex","align-items":"center"}},_t={class:"mr-[5px]"},ft={class:"mt-[16px] flex justify-end"},qt=ge({__name:"list",setup(gt){const J=he(),C=ye(),K=J.meta.title;let i=R({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{type:"",category_id:"",card_right_type:"",card_name:"",status:"",order:"",sort:""}});const B=v(),m=(s=1)=>{i.loading=!0,i.page=s,Me({page:i.page,limit:i.limit,...i.searchParam}).then(a=>{i.loading=!1,i.data=a.data.data,i.total=a.data.total}).catch(()=>{i.loading=!1})},P=R([]),O=R({});(()=>{Qe({}).then(s=>{const a=s.data;a&&P.splice(0,P.length,...a)}),je({}).then(s=>{const a=s.data;a&&Object.assign(O,a)}),m()})();const W=(s,a)=>{i.searchParam.type=s.props.name,m()},T=v(),V=v(!1),Y=s=>{V.value=!1,U.value.toggleAllSelection()},U=v(),k=v([]),X=s=>{k.value=s,T.value=!1,k.value.length>0&&k.value.length<i.data.length?V.value=!0:V.value=!1,k.value.length==i.data.length&&(T.value=!0)},g=v(!1),Z=s=>{let a="";s.order=="ascending"?a="asc":s.order=="descending"&&(a="desc"),a&&(i.searchParam.order=s.prop,i.searchParam.sort=a),m()},F=(s,a)=>{if(a){if(g.value)return;g.value=!0,S({giftcard_ids:s.giftcard_id,status:a}).then(c=>{m(),g.value=!1}).catch(()=>{g.value=!1})}else Q.confirm(l("modifyStatusEventTips"),l("warning"),{confirmButtonText:l("confirm"),cancelButtonText:l("cancel"),type:"warning"}).then(()=>{S({giftcard_ids:s.giftcard_id,status:a}).then(c=>{m()})})},I=s=>{if(k.value.length==0){H({type:"warning",message:`${l("batchEmptySelectedGiftcardTips")}`});return}if(g.value)return;g.value=!0;const a=[];k.value.forEach(c=>{a.push(c.giftcard_id)}),S({giftcard_ids:a,status:s}).then(c=>{m(),g.value=!1}).catch(()=>{g.value=!1})},ee=Ce((s,a)=>{if(isNaN(s)||!/^\d{0,10}$/.test(s)){H({type:"warning",message:`${l("sortTips")}`});return}s>99999999&&(a.sort=99999999),Ae({giftcard_id:a.giftcard_id,sort:s}).then(c=>{})}),te=()=>{C.push("/shop_giftcard/giftcard/edit")},ae=s=>{C.push("/shop_giftcard/giftcard/edit?giftcard_id="+s.giftcard_id)},le=s=>{C.push(`/shop_giftcard/giftcard/detail?giftcard_id=${s.giftcard_id}`)},G=v(null),oe=s=>{G.value.show(s)},ne=s=>{const a=C.resolve({path:"/shop_giftcard/makecard",query:{giftcard_id:s.giftcard_id}});window.open(a.href)},se=s=>{const a=C.resolve({path:"/shop_giftcard/order/list",query:{giftcard_id:s.giftcard_id}});window.open(a.href)},ie=s=>{Q.confirm(l("giftcardDeleteTips"),l("warning"),{confirmButtonText:l("confirm"),cancelButtonText:l("cancel"),type:"warning"}).then(()=>{qe(s).then(()=>{m()}).catch(()=>{})})},re=s=>{s&&(s.resetFields(),m())};return(s,a)=>{const c=xe,z=Ee,x=Te,E=Ve,w=Pe,de=we,L=$e,$=Re,ce=Se,pe=Be,_=Oe,ue=Ue,N=ve("QuestionFilled"),D=Fe,M=Ie,j=Ge,me=ze,_e=Le,fe=Ne;return p(),h("div",Je,[o(L,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[d("div",Ke,[d("span",We,r(t(K)),1),o(c,{type:"primary",onClick:te},{default:n(()=>[u(r(t(l)("addGiftcard")),1)]),_:1})]),o(L,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:n(()=>[o(de,{inline:!0,model:t(i).searchParam,ref_key:"searchFormRef",ref:B},{default:n(()=>[o(x,{label:t(l)("cardName"),prop:"card_name"},{default:n(()=>[o(z,{modelValue:t(i).searchParam.card_name,"onUpdate:modelValue":a[0]||(a[0]=e=>t(i).searchParam.card_name=e),modelModifiers:{trim:!0},placeholder:t(l)("cardNamePlaceholder"),maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(x,{label:t(l)("categoryId"),prop:"category_id"},{default:n(()=>[o(w,{modelValue:t(i).searchParam.category_id,"onUpdate:modelValue":a[1]||(a[1]=e=>t(i).searchParam.category_id=e),modelModifiers:{trim:!0},placeholder:t(l)("categoryIdPlaceholder"),clearable:""},{default:n(()=>[(p(!0),h(A,null,q(P,e=>(p(),y(E,{key:e.category_id,label:e.category_name,value:e.category_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(x,{label:t(l)("cardRightType"),prop:"card_right_type"},{default:n(()=>[o(w,{modelValue:t(i).searchParam.card_right_type,"onUpdate:modelValue":a[2]||(a[2]=e=>t(i).searchParam.card_right_type=e),modelModifiers:{trim:!0},placeholder:t(l)("cardRightTypePlaceholder"),clearable:""},{default:n(()=>[(p(!0),h(A,null,q(O,e=>(p(),y(E,{key:e.type,label:e.name,value:e.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(x,{label:t(l)("status"),prop:"status"},{default:n(()=>[o(w,{modelValue:t(i).searchParam.status,"onUpdate:modelValue":a[3]||(a[3]=e=>t(i).searchParam.status=e),placeholder:t(l)("statusPlaceholder")},{default:n(()=>[o(E,{label:t(l)("statusAll"),value:""},null,8,["label"]),o(E,{label:t(l)("statusOn"),value:"1"},null,8,["label"]),o(E,{label:t(l)("statusOff"),value:"0"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(x,null,{default:n(()=>[o(c,{type:"primary",onClick:a[4]||(a[4]=e=>m())},{default:n(()=>[u(r(t(l)("search")),1)]),_:1}),o(c,{onClick:a[5]||(a[5]=e=>re(B.value))},{default:n(()=>[u(r(t(l)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),d("div",Ye,[o(ce,{modelValue:t(i).searchParam.type,"onUpdate:modelValue":a[6]||(a[6]=e=>t(i).searchParam.type=e),onTabClick:W},{default:n(()=>[o($,{label:t(l)("typeAll"),name:""},null,8,["label"]),o($,{label:t(l)("typeVirtual"),name:"virtual"},null,8,["label"]),o($,{label:t(l)("typeReal"),name:"real"},null,8,["label"])]),_:1},8,["modelValue"]),d("div",Xe,[o(pe,{modelValue:T.value,"onUpdate:modelValue":a[7]||(a[7]=e=>T.value=e),size:"large",class:"px-[14px]",onChange:Y,indeterminate:V.value},null,8,["modelValue","indeterminate"]),o(c,{onClick:a[8]||(a[8]=e=>I(1)),size:"small"},{default:n(()=>[u(r(t(l)("batchOn")),1)]),_:1}),o(c,{onClick:a[9]||(a[9]=e=>I(0)),size:"small"},{default:n(()=>[u(r(t(l)("batchOff")),1)]),_:1})]),be((p(),y(me,{data:t(i).data,size:"large",ref_key:"giftcardListTableRef",ref:U,onSortChange:Z,onSelectionChange:X},{empty:n(()=>[d("span",null,r(t(i).loading?"":t(l)("emptyData")),1)]),default:n(()=>[o(_,{type:"selection",width:"55"}),o(_,{prop:"giftcard_id",label:t(l)("cardInfo"),"min-width":"230"},{default:n(({row:e})=>[d("div",Ze,[d("div",et,[o(ue,{class:"w-[80px] h-[50px]",src:t(ke)(e.cover.split(",")[0]),fit:"contain"},{error:n(()=>[tt]),_:2},1032,["src"])]),d("div",at,[d("span",{title:e.card_name,class:"multi-hidden"},r(e.card_name),9,lt),d("span",ot,r(e.type_name),1)])])]),_:1},8,["label"]),o(_,{prop:"category_id",label:t(l)("categoryId"),"min-width":"120","show-overflow-tooltip":!0},{default:n(({row:e})=>[d("div",null,r(e.category.category_name),1)]),_:1},8,["label"]),o(_,{prop:"card_right_type_name",label:t(l)("cardRightType"),"min-width":"100","show-overflow-tooltip":!0},null,8,["label"]),o(_,{prop:"validity_type",label:t(l)("validityType"),"min-width":"180"},{default:n(({row:e})=>[e.validity_type=="forever"?(p(),h("div",nt,r(t(l)("validityForever")),1)):b("",!0),e.validity_type=="day"?(p(),h("div",st,"购买后"+r(e.validity_day)+"天有效",1)):b("",!0),e.validity_type=="date"?(p(),h("div",it,"使用截止时间为："+r(e.validity_time||""),1)):b("",!0)]),_:1},8,["label"]),o(_,{prop:"sale_count",label:t(l)("saleCount"),"min-width":"170","show-overflow-tooltip":!0,sortable:"custom"},{header:n(()=>[d("div",rt,[d("span",dt,r(t(l)("saleCount")),1),o(M,{class:"box-item",effect:"light",placement:"top"},{content:n(()=>[u(r(t(l)("saleCountTips1")),1),ct,u(r(t(l)("saleCountTips2")),1)]),default:n(()=>[o(D,{color:"#666"},{default:n(()=>[o(N)]),_:1})]),_:1})])]),default:n(({row:e})=>[e.type=="virtual"?(p(),h("div",pt,r(e.sale_count),1)):e.type=="real"?(p(),h("div",ut,r(e.activate_count),1)):b("",!0)]),_:1},8,["label"]),o(_,{prop:"sort","min-width":"120","show-overflow-tooltip":!0,sortable:"custom"},{header:n(()=>[d("div",mt,[d("span",_t,r(t(l)("sort")),1),o(M,{class:"box-item",effect:"light",content:t(l)("sortRules"),placement:"top"},{default:n(()=>[o(D,{color:"#666"},{default:n(()=>[o(N)]),_:1})]),_:1},8,["content"])])]),default:n(({row:e})=>[o(z,{modelValue:e.sort,"onUpdate:modelValue":f=>e.sort=f,class:"w-[70px]",maxlength:"8",onBlur:f=>t(ee)(e.sort,e)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),o(_,{prop:"status",label:t(l)("status"),"min-width":"80","show-overflow-tooltip":!0},{default:n(({row:e})=>[e.status==1?(p(),y(j,{key:0,type:"success",onClick:f=>F(e,0),class:"cursor-pointer"},{default:n(()=>[u(r(t(l)("statusOn")),1)]),_:2},1032,["onClick"])):(p(),y(j,{key:1,type:"info",onClick:f=>F(e,1),class:"cursor-pointer"},{default:n(()=>[u(r(t(l)("statusOff")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"]),o(_,{prop:"use_count",label:t(l)("useCount"),"min-width":"120","show-overflow-tooltip":!0,sortable:"custom"},null,8,["label"]),o(_,{prop:"create_time",label:t(l)("createTime"),"min-width":"150",sortable:"custom"},{default:n(({row:e})=>[d("div",null,r(e.create_time),1)]),_:1},8,["label"]),o(_,{label:t(l)("operation"),fixed:"right",align:"right","min-width":"120"},{default:n(({row:e})=>[o(c,{type:"primary",link:"",onClick:f=>le(e)},{default:n(()=>[u(r(t(l)("giftcardDetail")),1)]),_:2},1032,["onClick"]),o(c,{type:"primary",link:"",onClick:f=>ae(e)},{default:n(()=>[u(r(t(l)("edit")),1)]),_:2},1032,["onClick"]),o(c,{type:"primary",link:"",onClick:f=>oe(e)},{default:n(()=>[u(r(t(l)("spreadGiftcard")),1)]),_:2},1032,["onClick"]),e.type=="real"?(p(),y(c,{key:0,type:"primary",link:"",onClick:f=>ne(e)},{default:n(()=>[u(r(t(l)("makeCard")),1)]),_:2},1032,["onClick"])):b("",!0),e.type=="virtual"?(p(),y(c,{key:1,type:"primary",link:"",onClick:f=>se(e)},{default:n(()=>[u(r(t(l)("toOrder")),1)]),_:2},1032,["onClick"])):b("",!0),e.status==0?(p(),y(c,{key:2,type:"primary",link:"",onClick:f=>ie(e.giftcard_id)},{default:n(()=>[u(r(t(l)("delete")),1)]),_:2},1032,["onClick"])):b("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[fe,t(i).loading]]),d("div",ft,[o(_e,{"current-page":t(i).page,"onUpdate:current-page":a[10]||(a[10]=e=>t(i).page=e),"page-size":t(i).limit,"onUpdate:page-size":a[11]||(a[11]=e=>t(i).limit=e),layout:"total, sizes, prev, pager, next, jumper",total:t(i).total,onSizeChange:a[12]||(a[12]=e=>m()),onCurrentChange:m},null,8,["current-page","page-size","total"])])])]),_:1}),o(He,{ref_key:"giftcardSpreadPopupRef",ref:G},null,512)])}}});export{qt as default};
