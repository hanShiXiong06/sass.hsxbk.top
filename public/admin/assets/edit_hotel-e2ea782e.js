import{d as de,x as ue,f as ce,r as L,n as U,aJ as pe,cn as me,l as _e,q as o,h as d,c as _,a as p,u as i,t as b,e as s,w as n,F as g,T as y,s as x,i as E,B as A,cO as he,cK as $,cP as be,Q as fe,cQ as ve,U as G,ax as ge,ay as ye,K as Ve,L as ke,ab as we,aC as xe,E as Ce,d0 as Pe,M as Me,a7 as Le,p as Ee,g as Fe}from"./index-2a89d409.js";/* empty css                *//* empty css                *//* empty css                     */import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang-1e5c6518.js";/* empty css                  */import Te from"./index-deaeeb3b.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                    */import{i as Ue,j as Ae,k as Oe,l as je}from"./tourism-4aef9104.js";import{j as qe}from"./poster-2c5e3245.js";import{_ as De}from"./_plugin-vue_export-helper-c27b6911.js";import"./index.vue_vue_type_style_index_0_lang-5224d015.js";/* empty css                  *//* empty css                   */import"./attachment-851184b5.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-bee04220.js";/* empty css                        *//* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-f1303253.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-4e818418.js";import"./sortable.esm-be94e56d.js";const O=C=>(Ee("data-v-5be1bba0"),C=C(),Fe(),C),Ie={class:"main-container"},He={class:"detail-head"},Ne=O(()=>p("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),Re={class:"ml-[1px]"},Be=O(()=>p("span",{class:"adorn"},"|",-1)),$e={key:0,class:"right"},Ge={key:1,class:"right"},ze={key:0},Ke=O(()=>p("div",{class:"mt-4"},[p("div",{id:"TxMap",class:"map-item w-[800px] h-[500px]"})],-1)),Qe={class:"ml-[10px]"},Je={key:1},We={key:2},Xe={class:"fixed-footer-wrap"},Ye={class:"fixed-footer"},Ze=de({__name:"edit_hotel",setup(C){const z=ue(),j=ce(),V=L("first"),v=U({province:[],city:[],district:[]});(()=>{he(1).then(l=>{v.province=l.data})})();const q=l=>{Object.keys(l).length==0?l.id=e.province_id:(e.province_id=l.id,e.province_name=l.name),$(l.id).then(t=>{v.city=t.data})},D=l=>{Object.keys(l).length==0?l.id=e.city_id:(e.city_id=l.id,e.city_name=l.name),$(l.id).then(t=>{v.district=t.data})},K=l=>{e.district_id=l.id,e.district_name=l.name},Q=()=>{e.province_id&&e.city_id&&e.district_id&&e.address&&(e.full_address=e.province_name+e.city_name+e.district_name+e.address,be({address:e.full_address}).then(l=>{e.latitude=l.data.result.location.lat,e.longitude=l.data.result.location.lng}))};let k=null;const J=()=>{let l=e.latitude,t=e.longitude;e.latitude==0&&(l="39.90469"),e.longitude==0&&(t="116.40717");const r=new window.TMap.LatLng(l,t);k=new window.TMap.Map("TxMap",{center:r,zoom:17,viewMode:"2D",showControl:!0}),k.on("click",h=>{const c={lat:h.latLng.getLat().toFixed(6),lng:h.latLng.getLng().toFixed(6)};W(c.lat,c.lng,1),m.updateGeometries({id:"shop",position:h.latLng})});const m=new window.TMap.MultiMarker({id:"marker-layer",map:k,minimumClusterSize:1});m.updateGeometries({id:"shop",position:r}),k.on("idle",()=>{fe(()=>e.latitude,(h,c)=>{const u=new window.TMap.LatLng(e.latitude,e.longitude);k.panTo(u,1),m.updateGeometries({id:"shop",position:u})})})};pe(()=>{const l=document.createElement("script");me().then(t=>{l.type="text/javascript",l.src="https://map.qq.com/api/gljs?v=1.exp&key="+t.data.key,document.body.appendChild(l)}),l.onload=()=>{setTimeout(()=>{J()},500)}});const W=(l,t,r)=>{ve({location:l+","+t}).then(m=>{m.data.result?(e.province_name=m.data.result.address_component.province,e.city_name=m.data.result.address_component.city,e.district_name=m.data.result.address_component.district,r==1&&(e.address=m.data.result.formatted_addresses.recommend,e.full_address=e.province_name+e.city_name+e.district_name+e.address,e.latitude=l,e.longitude=t)):G({type:"warning",message:m.data.message})})},I=L([]);(()=>{Ue().then(l=>{I.value=l.data})})();const X=l=>{e.hotel_attribute.length<=0?e.hotel_attribute.push(l):e.hotel_attribute.indexOf(l)!=-1?e.hotel_attribute.splice(e.hotel_attribute.indexOf(l),1):e.hotel_attribute.push(l)},P=parseInt(z.query.id),M=L(!1),H={hotel_id:0,hotel_name:"",hotel_star:"",hotel_tag:"",hotel_cover:"",hotel_images:"",hotel_attribute:[],province_id:"",province_name:"",city_id:"",city_name:"",district_id:"",district_name:"",address:"",longitude:0,latitude:0,hotel_desc:"",price:"",full_address:"",poster_id:""},e=U({...H});P&&(async(l=0)=>{Object.assign(e,H);const t=await(await Ae(l)).data;Object.keys(e).forEach(r=>{t[r]!=null&&r!="hotel_attribute"&&(e[r]=t[r]),r=="hotel_attribute"&&t[r]!=null&&(e[r]=t[r].split(","))}),e.hotel_id=l,e.province_id>0&&q({}),e.city_id>0&&D({})})(P);const N=L(),Y=_e(()=>({hotel_name:[{required:!0,message:o("hotelNamePlaceholder"),trigger:"blur"}],hotel_star:[{required:!0,message:o("starRatingPlaceholder"),trigger:"blur"}],hotel_cover:[{required:!0,validator:ee,trigger:"blur"}],address_area:[{required:!0,validator:Z,trigger:"blur"}],address:[{required:!0,message:o("hotelAddressDetailPlaceholder"),trigger:"blur"}]})),Z=(l,t,r)=>{(e.province_name==""||e.city_name==""||e.district_name=="")&&r(new Error(o("hotelAddressPlaceholder"))),r()},ee=(l,t,r)=>{e.hotel_cover==""&&r(new Error(o("hotelCoverPlaceholder"))),r()},te=async l=>{M.value||!l||await l.validate(async t=>{t&&(M.value=!0,e.hotel_attribute=e.hotel_attribute.join(","),(P?Oe:je)(e).then(h=>{M.value=!1,history.back()}).catch(()=>{M.value=!1}))})},F=U([]),le=()=>{const l=j.resolve({path:"/poster/list"});window.open(l.href)},R=(l=!1)=>{qe({type:"tourism_hotel"}).then(t=>{const r=t.data;r&&(F.splice(0,F.length,...r),l&&G({message:o("refreshSuccess"),type:"success"}))})};R();const ae=()=>{history.back()};return(l,t)=>{const r=ge,m=ye,h=Ve,c=ke,u=we,w=xe,B=Te,S=Ce,oe=Se,se=Pe,ie=Me,re=Le;return d(),_("div",Ie,[p("div",He,[p("div",{class:"left",onClick:t[0]||(t[0]=a=>i(j).push("/tourism/product/hotel/hotel"))},[Ne,p("span",Re,b(i(o)("returnToPreviousPage")),1)]),Be,i(P)?(d(),_("span",$e,b(i(o)("editHotel")),1)):(d(),_("span",Ge,b(i(o)("addHotel")),1))]),s(re,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[s(m,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=a=>V.value=a),class:"demo-tabs"},{default:n(()=>[s(r,{label:i(o)("basicInformation"),name:"first"},null,8,["label"]),s(r,{label:i(o)("hotelIntroduce"),name:"introduce"},null,8,["label"]),s(r,{label:i(o)("hotelPeriphery"),name:"periphery"},null,8,["label"])]),_:1},8,["modelValue"]),s(ie,{model:e,"label-width":"120px",ref_key:"formRef",ref:N,rules:i(Y),class:"page-form"},{default:n(()=>[V.value=="first"?(d(),_("div",ze,[s(c,{label:i(o)("hotelName"),prop:"hotel_name"},{default:n(()=>[s(h,{modelValue:e.hotel_name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.hotel_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:i(o)("hotelNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(c,{label:i(o)("starRating"),prop:"hotel_star"},{default:n(()=>[s(w,{modelValue:e.hotel_star,"onUpdate:modelValue":t[3]||(t[3]=a=>e.hotel_star=a),clearable:"",class:"input-width"},{default:n(()=>[s(u,{label:i(o)("oneStar"),value:1},null,8,["label"]),s(u,{label:i(o)("twoStar"),value:2},null,8,["label"]),s(u,{label:i(o)("threeStar"),value:3},null,8,["label"]),s(u,{label:i(o)("fourStar"),value:4},null,8,["label"]),s(u,{label:i(o)("fiveStar"),value:5},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(c,{label:i(o)("hotelLabel")},{default:n(()=>[s(h,{modelValue:e.hotel_tag,"onUpdate:modelValue":t[4]||(t[4]=a=>e.hotel_tag=a),modelModifiers:{trim:!0},clearable:"",placeholder:i(o)("hotelLabelPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(c,{label:i(o)("hotelCover"),prop:"hotel_cover"},{default:n(()=>[s(B,{modelValue:e.hotel_cover,"onUpdate:modelValue":t[5]||(t[5]=a=>e.hotel_cover=a)},null,8,["modelValue"])]),_:1},8,["label"]),s(c,{label:i(o)("hotelImages")},{default:n(()=>[s(B,{modelValue:e.hotel_images,"onUpdate:modelValue":t[6]||(t[6]=a=>e.hotel_images=a),limit:"10"},null,8,["modelValue"])]),_:1},8,["label"]),s(c,{label:i(o)("hotelAddress"),prop:"address_area"},{default:n(()=>[s(w,{modelValue:e.province_name,"onUpdate:modelValue":t[7]||(t[7]=a=>e.province_name=a),"value-key":"id",clearable:"",class:"w-[200px]",onChange:q},{default:n(()=>[s(u,{label:i(o)("provincePlaceholder"),value:""},null,8,["label"]),(d(!0),_(g,null,y(v.province,(a,f)=>(d(),x(u,{key:f,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(w,{modelValue:e.city_name,"onUpdate:modelValue":t[8]||(t[8]=a=>e.city_name=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",onChange:D},{default:n(()=>[s(u,{label:i(o)("cityPlaceholder"),value:""},null,8,["label"]),(d(!0),_(g,null,y(v.city,(a,f)=>(d(),x(u,{key:f,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(w,{modelValue:e.district_name,"onUpdate:modelValue":t[9]||(t[9]=a=>e.district_name=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",onChange:K},{default:n(()=>[s(u,{label:i(o)("districtPlaceholder"),value:""},null,8,["label"]),(d(!0),_(g,null,y(v.district,(a,f)=>(d(),x(u,{key:f,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(c,{label:i(o)("hotelAddressDetail"),prop:"address"},{default:n(()=>[p("div",null,[p("div",null,[s(h,{modelValue:e.address,"onUpdate:modelValue":t[10]||(t[10]=a=>e.address=a),modelModifiers:{trim:!0},clearable:"",placeholder:i(o)("hotelAddressDetailPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),s(S,{class:"ml-3",onClick:Q},{default:n(()=>[E(b(i(o)("search")),1)]),_:1})]),Ke])]),_:1},8,["label"]),s(c,{label:i(o)("poster")},{default:n(()=>[s(w,{modelValue:e.poster_id,"onUpdate:modelValue":t[11]||(t[11]=a=>e.poster_id=a),placeholder:i(o)("posterPlaceholder"),clearable:""},{default:n(()=>[(d(!0),_(g,null,y(F,a=>(d(),x(u,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),p("div",Qe,[p("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:t[12]||(t[12]=a=>R(!0))},b(i(o)("refresh")),1),p("span",{class:"cursor-pointer text-primary",onClick:le},b(i(o)("addGoodsPoster")),1)])]),_:1},8,["label"])])):A("",!0),V.value=="introduce"?(d(),_("div",Je,[s(c,{label:i(o)("hotelIntroduce")},{default:n(()=>[s(oe,{modelValue:e.hotel_desc,"onUpdate:modelValue":t[13]||(t[13]=a=>e.hotel_desc=a)},null,8,["modelValue"])]),_:1},8,["label"])])):A("",!0),V.value=="periphery"?(d(),_("div",We,[(d(!0),_(g,null,y(I.value,(a,f)=>(d(),x(c,{label:a.name,key:f},{default:n(()=>[(d(!0),_(g,null,y(a.attr,(T,ne)=>(d(),_("span",{key:ne},[s(se,{style:{"margin-right":"8px"},checked:e.hotel_attribute.indexOf(T[0])!=-1,onChange:at=>X(T[0])},{default:n(()=>[E(b(T[0]),1)]),_:2},1032,["checked","onChange"])]))),128))]),_:2},1032,["label"]))),128))])):A("",!0)]),_:1},8,["model","rules"])]),_:1}),p("div",Xe,[p("div",Ye,[s(S,{type:"primary",onClick:t[14]||(t[14]=a=>te(N.value))},{default:n(()=>[E(b(i(o)("save")),1)]),_:1}),s(S,{onClick:t[15]||(t[15]=a=>ae())},{default:n(()=>[E(b(i(o)("cancel")),1)]),_:1})])])])}}});const Rt=De(Ze,[["__scopeId","data-v-5be1bba0"]]);export{Rt as default};
