import{d as J,f as z,r as g,l as A,q as i,h as y,c as H,a as s,u as d,t as p,e as t,w as o,ca as P,i as u,s as h,B as w,R as c,c1 as Q,a0 as f,K as W,L as X,as as Y,at as Z,bN as ee,bO as le,M as te,a6 as oe,E as ae}from"./index-f7a01263.js";/* empty css                  *//* empty css                *//* empty css                     *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                          *//* empty css               *//* empty css                    *//* empty css                 *//* empty css                       */import{c as ie,d as re}from"./marketing-fa8c56a7.js";import de from"./goods-select-popup-d9818c3b.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                  *//* empty css                  *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                        */import"./goods_default-664bb559.js";import"./goods-d18d2d10.js";import"./_plugin-vue_export-helper-c27b6911.js";const ue={class:"main-container"},ne={class:"detail-head"},se=s("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),me={class:"ml-[1px]"},pe=s("span",{class:"adorn"},"|",-1),_e={class:"right"},ve={class:"flex items-center",style:{"padding-left":"5px"}},ce={class:"flex items-center",style:{"padding-left":"5px"}},fe={class:"w-[220px]",style:{"padding-left":"5px"}},ge=s("div",{class:"form-tip"},"开启手动领取后，会员可以直接在优惠券列表以及优惠券推广中直接领取",-1),ye={class:"w-[180px]"},Ve=s("div",{class:"form-tip"},"最多发放100000张",-1),be={class:"fixed-footer-wrap"},he={class:"fixed-footer"},Ze=J({__name:"add",setup(we){const T=z(),V=g(!1),R=g(null),q=new Date,b=new Date;b.setTime(b.getTime()+3600*1e3*2*360);const e=g({title:"",price:"",type:1,limit:2,receive_type:1,remain_count:1e3,threshold:2,limit_count:1,min_condition_money:1,length:30,goods_ids:[],goods_category_ids:[],receive_type_time:2,valid_type:1,receive_time:[q,b],valid_time:b}),C=g(),D=A(()=>({title:[{required:!0,message:i("titlePlaceholder"),trigger:"blur"}],price:[{required:!0,validator:K,trigger:"blur"}],goods_ids:[{required:!0,message:i("请选择商品"),trigger:"blur"}],goods_category_ids:[{required:!0,message:i("请选择商品分类"),trigger:"blur"}],min_condition_money:[{required:!0,validator:L,trigger:"blur"}],valid_time:[{required:!0,validator:N,trigger:"blur"}],receive_time:[{required:!0,validator:S,trigger:"blur"}],remain_count:[{required:!0,validator:B,trigger:"blur"}],limit_count:[{required:!0,validator:O,trigger:"blur"}]})),S=(_,l,r)=>{e.value.receive_type_time==1&&e.value.receive_type==1&&((!e.value.receive_time[0]||x(e.value.receive_time[0])<=Date.now())&&r(new Error(i("领取开始时间不能小于等于当前时间"))),(!e.value.receive_time[1]||x(e.value.receive_time[1])<=x(e.value.receive_time[0]))&&r(new Error(i("领取结束时间不能小于等于领取开始时间")))),r()},N=(_,l,r)=>{e.value.valid_type==2&&e.value.valid_time<=Date.now()&&r(new Error(i("有效期不能小于等于当前时间"))),r()},L=(_,l,r)=>{e.value.threshold==1&&e.value.min_condition_money<=0&&r(new Error(i("使用门槛最低不能小于0元"))),r()},B=(_,l,r)=>{e.value.remain_count!=""&&e.value.remain_count>1e5&&r(new Error(i("remainCountPlaceholder"))),(!e.value.remain_count||e.value.remain_count!=""&&e.value.remain_count<1)&&r(new Error(i("发放数量不能小于1张"))),r()},K=(_,l,r)=>{(!e.value.price||e.value.price==""||e.value.price<=0)&&r(new Error(i("pricePlaceholder"))),r()},O=(_,l,r)=>{e.value.limit_count!=""&&e.value.limit_count<1&&r(new Error(i("userLimitCountPlaceholder"))),r()},x=_=>{var l=new Date(_);return l.getTime()},F={multiple:!0},E=g([]);(()=>{ie({}).then(_=>{E.value=_.data.goods_category_tree})})();const M=async _=>{V.value||!_||await _.validate(async l=>{if(l){V.value=!0;let r=JSON.parse(JSON.stringify(e.value));r.type==1?(delete r.goods_category_ids,delete r.goods_ids):r.type==2?delete r.goods_ids:r.type==3&&delete r.goods_category_ids,re(r).then(m=>{V.value=!1,history.back()}).catch(m=>{V.value=!1})}})},$=()=>{history.back()};return(_,l)=>{const r=W,n=X,m=Y,v=Z,j=ee,U=le,G=te,I=oe,k=ae;return y(),H("div",ue,[s("div",ne,[s("div",{class:"left",onClick:l[0]||(l[0]=a=>d(T).push("/shop/marketing/coupon/list"))},[se,s("span",me,p(d(i)("returnToPreviousPage")),1)]),pe,s("span",_e,p(d(i)("addCoupon")),1)]),t(I,{class:"box-card !border-none",shadow:"never"},{default:o(()=>[t(G,{model:e.value,"label-width":"120px",ref_key:"formRef",ref:C,rules:d(D),class:"page-form"},{default:o(()=>[t(n,{label:d(i)("title"),prop:"title"},{default:o(()=>[t(r,{modelValue:e.value.title,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.title=a),modelModifiers:{trim:!0},clearable:"",placeholder:d(i)("titlePlaceholder"),class:"input-width",maxlength:20},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(n,{label:d(i)("price"),prop:"price"},{default:o(()=>[t(r,{modelValue:e.value.price,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.price=a),clearable:"",placeholder:d(i)("pricePlaceholder"),class:"input-width",maxlength:"5",onKeyup:l[3]||(l[3]=a=>d(P)(a))},{append:o(()=>[u("元")]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(n,{label:d(i)("type"),prop:"type"},{default:o(()=>[t(v,{modelValue:e.value.type,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.type=a)},{default:o(()=>[t(m,{label:1},{default:o(()=>[u("通用券")]),_:1}),t(m,{label:2},{default:o(()=>[u("品类券")]),_:1}),t(m,{label:3},{default:o(()=>[u("商品券")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.type==2?(y(),h(n,{key:0,prop:"goods_category_ids"},{default:o(()=>[s("div",null,[t(j,{modelValue:e.value.goods_category_ids,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.goods_category_ids=a),options:E.value,props:F,placeholder:"请选择商品分类","collapse-tags":"","collapse-tags-tooltip":"",clearable:""},null,8,["modelValue","options"])])]),_:1})):w("",!0),e.value.type==3?(y(),h(n,{key:1,prop:"goods_ids"},{default:o(()=>[s("div",null,[t(n,null,{default:o(()=>[t(de,{ref_key:"goodsSelectPopupRef",ref:R,modelValue:e.value.goods_ids,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.goods_ids=a),min:1,max:99},null,8,["modelValue"])]),_:1})])]),_:1})):w("",!0),t(n,{label:d(i)("threshold")},{default:o(()=>[t(v,{modelValue:e.value.threshold,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.threshold=a)},{default:o(()=>[t(m,{label:1},{default:o(()=>[u(p(d(i)("reduction")),1)]),_:1}),t(m,{label:2},{default:o(()=>[u(p(d(i)("noThreshold")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.threshold==1?(y(),h(n,{key:2,prop:"min_condition_money"},{default:o(()=>[u(" 最低满 "),s("div",ve,[t(r,{modelValue:e.value.min_condition_money,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.min_condition_money=a),onKeyup:l[9]||(l[9]=a=>d(P)(a)),clearable:"",class:"!w-[100px]"},null,8,["modelValue"])]),u(" 元可用 ")]),_:1})):w("",!0),t(n,{label:d(i)("validType")},{default:o(()=>[t(v,{modelValue:e.value.valid_type,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.valid_type=a)},{default:o(()=>[t(m,{label:1},{default:o(()=>[u(p(d(i)("days")),1)]),_:1}),t(m,{label:2},{default:o(()=>[u(p(d(i)("times")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),c(t(n,null,{default:o(()=>[u(" 领劵后立即生效，有效期 "),s("div",ce,[t(r,{modelValue:e.value.length,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.length=a),onKeyup:l[12]||(l[12]=a=>d(Q)(a)),clearable:"",class:"!w-[100px]"},null,8,["modelValue"]),u(" 天 ")])]),_:1},512),[[f,e.value.valid_type==1]]),e.value.valid_type==2?(y(),h(n,{key:3,prop:"valid_time"},{default:o(()=>[u(" 领劵后立即生效，使用时间截止至 "),s("div",fe,[t(U,{modelValue:e.value.valid_time,"onUpdate:modelValue":l[13]||(l[13]=a=>e.value.valid_time=a),type:"datetime"},null,8,["modelValue"])])]),_:1})):w("",!0),t(n,{label:d(i)("receiveType")},{default:o(()=>[s("div",null,[t(v,{modelValue:e.value.receive_type,"onUpdate:modelValue":l[14]||(l[14]=a=>e.value.receive_type=a)},{default:o(()=>[t(m,{label:1},{default:o(()=>[u(p(d(i)("user")),1)]),_:1}),t(m,{label:2},{default:o(()=>[u(p(d(i)("grant")),1)]),_:1})]),_:1},8,["modelValue"])]),ge]),_:1},8,["label"]),c(t(n,{label:d(i)("receiveTime")},{default:o(()=>[t(v,{modelValue:e.value.receive_type_time,"onUpdate:modelValue":l[15]||(l[15]=a=>e.value.receive_type_time=a)},{default:o(()=>[t(m,{label:1},{default:o(()=>[u(p(d(i)("limitedTime")),1)]),_:1}),t(m,{label:2},{default:o(()=>[u(p(d(i)("unlimitedTime")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),[[f,e.value.receive_type==1]]),c(t(n,{prop:"receive_time"},{default:o(()=>[s("div",ye,[t(U,{modelValue:e.value.receive_time,"onUpdate:modelValue":l[16]||(l[16]=a=>e.value.receive_time=a),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])]),_:1},512),[[f,e.value.receive_type_time==1&&e.value.receive_type==1]]),c(t(n,{label:d(i)("receiveNumber")},{default:o(()=>[t(v,{modelValue:e.value.limit,"onUpdate:modelValue":l[17]||(l[17]=a=>e.value.limit=a)},{default:o(()=>[t(m,{label:1},{default:o(()=>[u(p(d(i)("limit")),1)]),_:1}),t(m,{label:2},{default:o(()=>[u(p(d(i)("unlimited")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),[[f,e.value.receive_type==1]]),c(t(n,{prop:"remain_count"},{default:o(()=>[s("div",null,[t(r,{onkeypress:"return( /[\\d]/.test(String.fromCharCode(event.keyCode) ) )",modelValue:e.value.remain_count,"onUpdate:modelValue":l[18]||(l[18]=a=>e.value.remain_count=a),clearable:"",placeholder:d(i)("remainCountPlaceholder"),class:"input-width",min:1,max:1e5,controls:!1},{append:o(()=>[u("张")]),_:1},8,["modelValue","placeholder"])]),Ve]),_:1},512),[[f,e.value.limit==1&&e.value.receive_type==1]]),c(t(n,{label:d(i)("userLimitCount"),prop:"limit_count"},{default:o(()=>[t(r,{onkeypress:"return( /[\\d]/.test(String.fromCharCode(event.keyCode) ) )",modelValue:e.value.limit_count,"onUpdate:modelValue":l[19]||(l[19]=a=>e.value.limit_count=a),clearable:"",placeholder:d(i)("userLimitCountPlaceholder"),class:"input-width",min:1,max:1e5},{append:o(()=>[u("张")]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),[[f,e.value.receive_type==1]])]),_:1},8,["model","rules"])]),_:1}),s("div",be,[s("div",he,[t(k,{type:"primary",onClick:l[20]||(l[20]=a=>M(C.value))},{default:o(()=>[u(p(d(i)("save")),1)]),_:1}),t(k,{onClick:l[21]||(l[21]=a=>$())},{default:o(()=>[u(p(d(i)("cancel")),1)]),_:1})])])])}}});export{Ze as default};
