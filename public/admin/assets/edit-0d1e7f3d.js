import{d as Z,x as ee,r as y,n as S,cN as V,aJ as le,cq as te,cO as ae,l as ie,q as o,Q as g,ao as de,h as m,c as w,a as _,t as x,u as r,R as L,s as k,w as u,e as s,a0 as K,c1 as oe,F as U,T as B,i as G,au as se,L as re,K as ne,aa as ce,aB as ue,M as _e,a6 as pe,E as me,Y as fe}from"./index-6ea097a6.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                    */import{g as ve,e as be,a as ye}from"./shop_address-15b82c11.js";import{c as ge,l as he,a as Ve}from"./qqmap-011f3cfb.js";const we={class:"main-container"},xe={class:"detail-head"},Le=_("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),ke={class:"ml-[1px]"},Ee=_("span",{class:"adorn"},"|",-1),Pe={class:"right"},Ce={class:"flex flex-col"},Re={id:"container",class:"w-[800px] h-[520px] relative"},Te={class:"fixed-footer-wrap"},Ae={class:"fixed-footer !z-[1000]"},Qe=Z({__name:"edit",setup(Me){const N=ee(),E=parseInt(N.query.id),f=y(!1),J=N.meta.title,p=S({province:[],city:[],district:[]}),P=y(),C=y(),R=y();V(0).then(i=>{p.province=i.data});let T="";le(()=>{const i=document.createElement("script");te().then(e=>{T=e.data.key,i.type="text/javascript",i.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+e.data.key,document.body.appendChild(i)}),i.onload=()=>{setTimeout(()=>{Q()},500)}});let b,A;const j=y(!0),Q=()=>{const i=window.TMap,e=i.LatLng,t=new e(l.lat,l.lng);b=new i.Map("container",{center:t,zoom:14}),b.on("tilesloaded",()=>{j.value=!1}),A=ge(b),b.on("click",d=>{b.setCenter(d.latLng),A.updateGeometries({id:"center",position:d.latLng}),D(d.latLng.lat,d.latLng.lng)}),D(t.lat,t.lng)},c=S({province_id:0,city_id:0,district_id:0}),D=(i,e)=>{he({mapKey:T,lat:i,lng:e}).then(({message:t,result:d})=>{t=="query ok"||t=="Success"?(l.lat=d.location.lat,l.lng=d.location.lng,l.address=d.formatted_addresses.recommend,ae(d.ad_info.adcode).then(({data:n})=>{c.province_id=n.province?n.province.id:0,c.city_id=n.city?n.city.id:0,c.district_id=n.district?n.district.id:0})):console.error(t,d)}).catch(t=>{console.log(t)})},F={id:0,contact_name:"",mobile:"",province_id:0,city_id:0,district_id:0,address:"",full_address:"",lat:39.908626,lng:116.39719,is_delivery_address:0,is_refund_address:0,is_default_delivery:0,is_default_refund:0},l=S({...F});E&&(async(i=0)=>{f.value=!0,Object.assign(l,F);const e=await(await ve(i)).data;Object.keys(l).forEach(t=>{e[t]!=null&&(l[t]=e[t])}),f.value=!1})(E);const I=y(),Y=ie(()=>({address_type:[{validator:(i,e,t)=>{!l.is_delivery_address&&!l.is_refund_address&&t(new Error(o("addressTypeRequire"))),t()}}],contact_name:[{required:!0,message:o("contactNamePlaceholder"),trigger:"blur"}],mobile:[{required:!0,message:o("mobilePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(i,e,t)=>{e&&!/^1[3-9]\d{9}$/.test(e)&&t(new Error(o("mobileTips"))),t()}}],address_area:[{validator:(i,e,t)=>{l.province_id||t(new Error(o("provincePlaceholder"))),l.city_id||t(new Error(o("cityPlaceholder"))),p.district.length&&!l.district_id&&t(new Error(o("districtPlaceholder"))),t()}}],address:[{required:!0,message:o("addressPlaceholder"),trigger:"blur"}]}));g(()=>l.province_id,i=>{i?V(l.province_id).then(e=>{p.city=e.data;const t=l.city_id;if(t){let d=!1;for(let n=0;n<e.data.length;n++)if(t==e.data[n].id){d=!0;break}if(d){l.city_id=t;return}}l.city_id=0,M()}):l.city_id=0}),g(()=>l.city_id,i=>{i?V(l.city_id).then(e=>{p.district=e.data;const t=l.district_id;if(t){let d=!1;for(let n=0;n<e.data.length;n++)if(t==e.data[n].id){d=!0;break}if(d){l.district_id=t;return}}M(),l.district_id=0}):l.district_id=0}),g(()=>l.district_id,i=>{i&&M()});const M=de(()=>{setTimeout(()=>{const i=[l.province_id?P.value.selectedLabel:"",l.city_id?C.value.selectedLabel:"",l.district_id?R.value.selectedLabel:""];Ve({mapKey:T,address:i.join("")}).then(({message:e,result:t})=>{if(e=="Success"||e=="query ok"){const d=new window.TMap.LatLng(t.location.lat,t.location.lng);b.setCenter(d),A.updateGeometries({id:"center",position:d}),l.lat=t.location.lat,l.lng=t.location.lng}else console.error(e,t)})},500)},500);g(()=>c.province_id,i=>{i&&V(c.province_id).then(e=>{p.city=e.data,l.province_id=c.province_id,l.city_id=c.city_id})}),g(()=>c.city_id,i=>{i&&V(c.city_id).then(e=>{p.district=e.data,l.city_id=c.city_id,l.district_id=c.district_id})}),g(()=>c.district_id,i=>{i&&(l.district_id=c.district_id)});const H=async i=>{f.value||!i||await i.validate(async e=>{if(e){f.value=!0;const t=l,d=[t.province_id?P.value.selectedLabel:"",t.city_id?C.value.selectedLabel:"",t.district_id?R.value.selectedLabel:"",t.address];t.full_address=d.join(""),(E?be:ye)(t).then(v=>{f.value=!1,history.back()}).catch(()=>{f.value=!1})}})},O=()=>{history.back()};return(i,e)=>{const t=se,d=re,n=ne,v=ce,q=ue,W=_e,X=pe,$=me,z=fe;return m(),w("div",we,[_("div",xe,[_("div",{class:"left",onClick:e[0]||(e[0]=a=>O())},[Le,_("span",ke,x(r(o)("returnToPreviousPage")),1)]),Ee,_("span",Pe,x(r(J)),1)]),L((m(),k(X,{class:"box-card !border-none",shadow:"never"},{default:u(()=>[s(W,{model:l,"label-width":"90px",ref_key:"formRef",ref:I,rules:r(Y),class:"page-form"},{default:u(()=>[s(d,{label:r(o)("addressType"),prop:"address_type"},{default:u(()=>[_("div",Ce,[_("div",null,[s(t,{modelValue:l.is_delivery_address,"onUpdate:modelValue":e[1]||(e[1]=a=>l.is_delivery_address=a),label:r(o)("deliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),L(s(t,{modelValue:l.is_default_delivery,"onUpdate:modelValue":e[2]||(e[2]=a=>l.is_default_delivery=a),label:r(o)("defaultDeliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[K,l.is_delivery_address]])]),_("div",null,[s(t,{modelValue:l.is_refund_address,"onUpdate:modelValue":e[3]||(e[3]=a=>l.is_refund_address=a),label:r(o)("refundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),L(s(t,{modelValue:l.is_default_refund,"onUpdate:modelValue":e[4]||(e[4]=a=>l.is_default_refund=a),label:r(o)("defaultRefundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[K,l.is_refund_address]])])])]),_:1},8,["label"]),s(d,{label:r(o)("contactName"),prop:"contact_name"},{default:u(()=>[s(n,{modelValue:l.contact_name,"onUpdate:modelValue":e[5]||(e[5]=a=>l.contact_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("contactNamePlaceholder"),class:"input-width",maxlength:"10"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(d,{label:r(o)("mobile"),prop:"mobile"},{default:u(()=>[s(n,{modelValue:l.mobile,"onUpdate:modelValue":e[6]||(e[6]=a=>l.mobile=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("mobilePlaceholder"),class:"input-width",onKeyup:e[7]||(e[7]=a=>r(oe)(a)),onBlur:e[8]||(e[8]=a=>l.mobile=a.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(d,{label:r(o)("fullAddress"),prop:"address_area"},{default:u(()=>[s(q,{modelValue:l.province_id,"onUpdate:modelValue":e[9]||(e[9]=a=>l.province_id=a),"value-key":"id",clearable:"",class:"w-[200px]",ref_key:"provinceRef",ref:P},{default:u(()=>[s(v,{label:r(o)("provincePlaceholder"),value:0},null,8,["label"]),(m(!0),w(U,null,B(p.province,(a,h)=>(m(),k(v,{key:h,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(q,{modelValue:l.city_id,"onUpdate:modelValue":e[10]||(e[10]=a=>l.city_id=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"cityRef",ref:C},{default:u(()=>[s(v,{label:r(o)("cityPlaceholder"),value:0},null,8,["label"]),(m(!0),w(U,null,B(p.city,(a,h)=>(m(),k(v,{key:h,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(q,{modelValue:l.district_id,"onUpdate:modelValue":e[11]||(e[11]=a=>l.district_id=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"districtRef",ref:R},{default:u(()=>[s(v,{label:r(o)("districtPlaceholder"),value:0},null,8,["label"]),(m(!0),w(U,null,B(p.district,(a,h)=>(m(),k(v,{key:h,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(d,{prop:"address"},{default:u(()=>[s(n,{modelValue:l.address,"onUpdate:modelValue":e[12]||(e[12]=a=>l.address=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("addressPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1}),s(d,null,{default:u(()=>[L(_("div",Re,null,512),[[z,j.value]])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[z,f.value]]),_("div",Te,[_("div",Ae,[s($,{type:"primary",onClick:e[13]||(e[13]=a=>H(I.value))},{default:u(()=>[G(x(r(o)("save")),1)]),_:1}),s($,{onClick:e[14]||(e[14]=a=>O())},{default:u(()=>[G(x(r(o)("cancel")),1)]),_:1})])])])}}});export{Qe as default};
