import{d as fe,r as k,x as me,f as ce,n as ve,cR as he,l as B,q as l,H as O,h as C,c as j,a as h,t as c,u as n,e as t,w as i,R as q,s as H,i as g,ca as x,B as ge,a0 as X,F as ye,K as be,L as Ve,as as ke,at as Se,ab as we,E as xe,ac as Ee,aS as Ce,M as Ue,a6 as De,av as Be,V as Ne,X as Ae,Y as Te,p as Pe,g as Re}from"./index-6ea097a6.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                    *//* empty css                *//* empty css                     *//* empty css                  *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                  *//* empty css                        *//* empty css               *//* empty css                       *//* empty css                 *//* empty css                 */import{x as ze,y as Ie,z as Ke}from"./delivery-057b70d4.js";import{_ as Fe}from"./_plugin-vue_export-helper-c27b6911.js";const Y=U=>(Pe("data-v-39f07a33"),U=U(),Re(),U),Oe={class:"main-container"},je={class:"detail-head"},qe=Y(()=>h("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),Le={class:"ml-[1px]"},We=Y(()=>h("span",{class:"adorn"},"|",-1)),Ze={class:"right"},Me={class:"area-input"},Ge=["onClick"],He={key:1},Xe={class:"mt-[10px]"},Ye={class:"area-input"},Je={class:"form-tip"},Qe={class:"mt-[10px]"},$e={class:"area-input"},ea={class:"mt-[10px]"},aa={class:"fixed-footer-wrap"},la={class:"fixed-footer"},ta={class:"dialog-footer"},na=fe({__name:"template_edit",setup(U){const E=k(!1),N=me(),L=ce(),b=k(!1),J={template_id:"",template_name:"",fee_type:"num",area:[],no_delivery:0,is_free_shipping:0,fee_data:[],free_shipping_data:[],no_delivery_data:[]},Q=N.meta.title,m=ve({...J}),W=k(),A=k([]);N.query.id&&(b.value=!0,ze(N.query.id).then(({data:s})=>{s&&(Object.keys(m).forEach(e=>{s[e]!=null&&(m[e]=s[e])}),f.value=s.fee_data,y.value=s.no_delivery_data,v.value=s.free_shipping_data),b.value=!1}).catch(()=>{b.value=!1})),he(2).then(s=>{A.value=s.data}).catch();const $=B(()=>({template_name:[{required:!0,message:l("templateNamePlaceholder"),trigger:"blur"}],fee_data:[{validator:ee}],free_shipping_data:[{validator:ae}],no_delivery_data:[{validator:le}]})),ee=(s,e,o)=>{for(let p=0;p<f.value.length;p++){const d=f.value[p];if(!d.area_ids.length){o(new Error(l("areaPlaceholder")));break}if(O.empty(d.snum)||d.snum<0){o(new Error(D.value.first+l("notUnderZero")));break}if(O.empty(d.xnum)||d.snum<0){o(new Error(D.value.continue+l("notUnderZero")));break}}o()},ae=(s,e,o)=>{if(m.is_free_shipping){for(let p=0;p<v.value.length;p++){const d=v.value[p];if(!d.area_ids.length){o(new Error(l("freeShippingPlaceholder")));break}if(O.empty(d.free_shipping_num)||d.free_shipping_num<0){o(new Error(Z.value+l("notUnderZero")));break}}o()}else o()},le=(s,e,o)=>{if(m.no_delivery){for(let p=0;p<y.value.length;p++)if(!y.value[p].area_ids.length){o(new Error(l("noDeliveryPlaceholder")));break}o()}else o()},D=B(()=>({num:{first:l("firstNum"),continue:l("continueNum")},weight:{first:l("firstWeight"),continue:l("continueWeight")},volume:{first:l("firstVolume"),continue:l("continueVolume")}})[m.fee_type]),Z=B(()=>({num:l("freeShippingNum"),weight:l("freeShippingWeight"),volume:l("freeShippingVolume")})[m.fee_type]),f=k([{area_ids:[0],fee_area_names:"全国",snum:1,sprice:0,xnum:1,xprice:0}]),v=k([]),y=k([]),T=s=>{switch(s){case"fee":f.value.push({area_ids:[],fee_area_names:"",snum:1,sprice:0,xnum:1,xprice:0});break;case"free_shipping":v.value.push({area_ids:[],free_shipping_area_names:"",free_shipping_num:0,free_shipping_price:0});break;case"no_delivery":y.value.push({area_ids:[],no_delivery_area_names:""});break}},P=(s,e)=>{switch(s){case"fee":f.value.splice(e,1);break;case"free_shipping":v.value.splice(e,1);break;case"no_delivery":y.value.splice(e,1);break}};let R=[];const z=k([]);let S={type:"",index:0};const I=(s,e)=>{S={type:s,index:e};let o=[];switch(s){case"fee":o=f.value;break;case"free_shipping":o=v.value;break;case"no_delivery":o=y.value;break}R=o[e].area_ids,z.value=[],o.forEach((p,d)=>{e!=d&&z.value.push(...p.area_ids)}),E.value=!0},te=B(()=>(A.value.forEach(s=>{s.child.forEach(e=>{e.disabled=z.value.includes(e.id)})}),A.value)),K=k(),ne=()=>{const s=K.value.getCheckedNodes(!1,!1),e=[],o=[];switch(s.forEach(p=>{p.level==2&&(e.push(p.id),o.push(p.name))}),S.type){case"fee":f.value[S.index].area_ids=e,f.value[S.index].fee_area_names=o.toString();break;case"free_shipping":v.value[S.index].area_ids=e,v.value[S.index].free_shipping_area_names=o.toString();break;case"no_delivery":y.value[S.index].area_ids=e,y.value[S.index].no_delivery_area_names=o.toString();break}E.value=!1},re=()=>{K.value.setCheckedKeys(R,!1)},ie=async s=>{if(b.value||!s)return;const e=m.template_id?Ie:Ke;await s.validate(async o=>{if(o){b.value=!0;const p={template_id:m.template_id,template_name:m.template_name,fee_type:m.fee_type,no_delivery:y.value.length?1:0,is_free_shipping:v.value.length?1:0},d={};f.value.forEach(_=>{_.area_ids.forEach(u=>{d["city_"+u]={city_id:u,fee_area_ids:_.area_ids.toString(),fee_area_names:_.fee_area_names,snum:_.snum,sprice:_.sprice,xnum:_.xnum,xprice:_.xprice}})}),v.value.forEach(_=>{_.area_ids.forEach(u=>{d["city_"+u]?Object.assign(d["city_"+u],{free_shipping_area_ids:_.area_ids.toString(),free_shipping_area_names:_.free_shipping_area_names,free_shipping_num:_.free_shipping_num,free_shipping_price:_.free_shipping_price}):d["city_"+u]={city_id:u,free_shipping_area_ids:_.area_ids.toString(),free_shipping_area_names:_.free_shipping_area_names,free_shipping_num:_.free_shipping_num,free_shipping_price:_.free_shipping_price}})}),y.value.forEach(_=>{_.area_ids.forEach(u=>{d["city_"+u]?Object.assign(d["city_"+u],{no_delivery_area_ids:_.area_ids.toString(),no_delivery_area_names:_.no_delivery_area_names}):d["city_"+u]={city_id:u,no_delivery_area_ids:_.area_ids.toString(),no_delivery_area_names:_.no_delivery_area_names}})}),p.area=Object.values(d),e(p).then(()=>{b.value=!1,L.push({path:"/shop/order/shipping/template"})}).catch(()=>{b.value=!1})}})},M=()=>{L.push({path:"/shop/order/shipping/template"})};return(s,e)=>{const o=be,p=Ve,d=ke,_=Se,u=we,V=xe,F=Ee,G=Ce,oe=Ue,se=De,pe=Be,de=Ne,_e=Ae,ue=Te;return C(),j(ye,null,[h("div",Oe,[h("div",je,[h("div",{class:"left",onClick:M},[qe,h("span",Le,c(n(l)("returnToPreviousPage")),1)]),We,h("span",Ze,c(n(Q)),1)]),t(se,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[q((C(),H(oe,{model:m,"label-width":"120px",ref_key:"formRef",ref:W,rules:n($),class:"page-form"},{default:i(()=>[t(p,{label:n(l)("templateName"),prop:"template_name"},{default:i(()=>[t(o,{modelValue:m.template_name,"onUpdate:modelValue":e[0]||(e[0]=a=>m.template_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:n(l)("templateNamePlaceholder"),class:"input-width",maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:n(l)("feeTypeName"),prop:"fee_type"},{default:i(()=>[t(_,{modelValue:m.fee_type,"onUpdate:modelValue":e[1]||(e[1]=a=>m.fee_type=a)},{default:i(()=>[t(d,{label:"num",size:"large"},{default:i(()=>[g(c(n(l)("num")),1)]),_:1}),t(d,{label:"weight",size:"large"},{default:i(()=>[g(c(n(l)("weight")),1)]),_:1}),t(d,{label:"volume",size:"large"},{default:i(()=>[g(c(n(l)("volume")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(p,{label:n(l)("feeSetting"),prop:"fee_data"},{default:i(()=>[t(F,{data:f.value,style:{width:"100%"},size:"default"},{default:i(()=>[t(u,{label:n(l)("deliveryArea")},{default:i(({row:a,$index:r})=>[h("div",Me,[r?(C(),j("span",{key:0,onClick:w=>I("fee",r),class:"cursor-pointer"},c(a.fee_area_names?a.fee_area_names:n(l)("areaPlaceholder")),9,Ge)):(C(),j("span",He,c(a.fee_area_names?a.fee_area_names:n(l)("areaPlaceholder")),1))])]),_:1},8,["label"]),t(u,{label:n(D).first},{default:i(({$index:a})=>[t(o,{modelValue:f.value[a].snum,"onUpdate:modelValue":r=>f.value[a].snum=r,maxlength:"8",onKeyup:e[2]||(e[2]=r=>n(x)(r)),onBlur:r=>f.value[a].snum=r.target.value},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1},8,["label"]),t(u,{label:n(l)("fee")},{default:i(({$index:a})=>[t(o,{modelValue:f.value[a].sprice,"onUpdate:modelValue":r=>f.value[a].sprice=r,maxlength:"8",onKeyup:e[3]||(e[3]=r=>n(x)(r)),onBlur:r=>f.value[a].sprice=r.target.value},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1},8,["label"]),t(u,{label:n(D).continue},{default:i(({$index:a})=>[t(o,{modelValue:f.value[a].xnum,"onUpdate:modelValue":r=>f.value[a].xnum=r,maxlength:"8",onKeyup:e[4]||(e[4]=r=>n(x)(r)),onBlur:r=>f.value[a].xnum=r.target.value},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1},8,["label"]),t(u,{label:n(l)("continueFee")},{default:i(({$index:a})=>[t(o,{modelValue:f.value[a].xprice,"onUpdate:modelValue":r=>f.value[a].xprice=r,onKeyup:e[5]||(e[5]=r=>n(x)(r)),maxlength:"8",onBlur:r=>f.value[a].xprice=r.target.value},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1},8,["label"]),t(u,{label:n(l)("operation"),align:"right",width:"150"},{default:i(({$index:a})=>[a?(C(),H(V,{key:0,type:"primary",onClick:r=>P("fee",a),link:""},{default:i(()=>[g(c(n(l)("delete")),1)]),_:2},1032,["onClick"])):ge("",!0)]),_:1},8,["label"])]),_:1},8,["data"]),h("div",Xe,[t(V,{type:"primary",onClick:e[6]||(e[6]=a=>T("fee"))},{default:i(()=>[g(c(n(l)("addDeliveryArea")),1)]),_:1})])]),_:1},8,["label"]),t(p,{label:n(l)("freeShipping"),prop:"is_free_shipping"},{default:i(()=>[t(G,{modelValue:m.is_free_shipping,"onUpdate:modelValue":e[7]||(e[7]=a=>m.is_free_shipping=a),size:"small","inactive-value":0,"active-value":1},null,8,["modelValue"])]),_:1},8,["label"]),q(t(p,{prop:"free_shipping_data"},{default:i(()=>[t(F,{data:v.value,style:{width:"100%"},size:"default"},{default:i(()=>[t(u,{label:n(l)("freeShippingArea")},{default:i(({row:a,$index:r})=>[h("div",Ye,[t(o,{modelValue:a.free_shipping_area_names,"onUpdate:modelValue":w=>a.free_shipping_area_names=w,placeholder:n(l)("areaPlaceholder"),readonly:"",onClick:w=>I("free_shipping",r)},null,8,["modelValue","onUpdate:modelValue","placeholder","onClick"])])]),_:1},8,["label"]),t(u,{label:n(Z)},{default:i(({$index:a})=>[t(o,{modelValue:v.value[a].free_shipping_num,"onUpdate:modelValue":r=>v.value[a].free_shipping_num=r,onKeyup:e[8]||(e[8]=r=>n(x)(r)),maxlength:"8",onBlur:r=>v.value[a].free_shipping_num=r.target.value},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1},8,["label"]),t(u,{label:n(l)("freeShippingPrice")},{default:i(({$index:a})=>[t(o,{modelValue:v.value[a].free_shipping_price,"onUpdate:modelValue":r=>v.value[a].free_shipping_price=r,onKeyup:e[9]||(e[9]=r=>n(x)(r)),maxlength:"8",onBlur:r=>v.value[a].free_shipping_price=r.target.value},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1},8,["label"]),t(u,{label:n(l)("operation"),align:"right",width:"150"},{default:i(({$index:a})=>[t(V,{type:"primary",onClick:r=>P("free_shipping",a),link:""},{default:i(()=>[g(c(n(l)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),h("div",Je,c(n(l)("freeShippingAreaTips")),1),h("div",Qe,[t(V,{type:"primary",onClick:e[10]||(e[10]=a=>T("free_shipping"))},{default:i(()=>[g(c(n(l)("addFreeShippingArea")),1)]),_:1})])]),_:1},512),[[X,m.is_free_shipping]]),t(p,{label:n(l)("noDelivery"),prop:"no_delivery"},{default:i(()=>[t(G,{modelValue:m.no_delivery,"onUpdate:modelValue":e[11]||(e[11]=a=>m.no_delivery=a),size:"small","inactive-value":0,"active-value":1},null,8,["modelValue"])]),_:1},8,["label"]),q(t(p,{prop:"no_delivery_data"},{default:i(()=>[t(F,{data:y.value,style:{width:"100%"},size:"default"},{default:i(()=>[t(u,{label:n(l)("noDelivery")},{default:i(({row:a,$index:r})=>[h("div",$e,[t(o,{modelValue:a.no_delivery_area_names,"onUpdate:modelValue":w=>a.no_delivery_area_names=w,readonly:"",onClick:w=>I("no_delivery",r),placeholder:n(l)("areaPlaceholder")},null,8,["modelValue","onUpdate:modelValue","onClick","placeholder"])])]),_:1},8,["label"]),t(u,{label:n(l)("operation"),align:"right",width:"150"},{default:i(({$index:a})=>[t(V,{type:"primary",onClick:r=>P("no_delivery",a),link:""},{default:i(()=>[g(c(n(l)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),h("div",ea,[t(V,{type:"primary",onClick:e[12]||(e[12]=a=>T("no_delivery"))},{default:i(()=>[g(c(n(l)("addNoDelivery")),1)]),_:1})])]),_:1},512),[[X,m.no_delivery]])]),_:1},8,["model","rules"])),[[ue,b.value]])]),_:1}),h("div",aa,[h("div",la,[t(V,{type:"primary",onClick:e[13]||(e[13]=a=>ie(W.value)),disabled:b.value},{default:i(()=>[g(c(n(l)("save")),1)]),_:1},8,["disabled"]),t(V,{onClick:e[14]||(e[14]=a=>M())},{default:i(()=>[g(c(n(l)("cancel")),1)]),_:1})])])]),t(_e,{modelValue:E.value,"onUpdate:modelValue":e[16]||(e[16]=a=>E.value=a),title:n(l)("selectArea"),width:"80%",class:"diy-dialog-wrap","destroy-on-close":!0,onOpened:re},{footer:i(()=>[h("span",ta,[t(V,{onClick:e[15]||(e[15]=a=>E.value=!1)},{default:i(()=>[g(c(n(l)("cancel")),1)]),_:1}),t(V,{type:"primary",loading:b.value,onClick:ne},{default:i(()=>[g(c(n(l)("confirm")),1)]),_:1},8,["loading"])])]),default:i(()=>[t(de,{height:"50vh"},{default:i(()=>[t(pe,{data:n(te),props:{children:"child",label:"name"},"default-expand-all":"","show-checkbox":"",ref_key:"areaTreeRef",ref:K,"default-checked-keys":n(R),"node-key":"id"},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["modelValue","title"])],64)}}});const Ea=Fe(na,[["__scopeId","data-v-39f07a33"]]);export{Ea as default};
