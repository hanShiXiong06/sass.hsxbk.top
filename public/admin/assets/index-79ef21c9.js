import{d as b,x as h,f as x,r,l as w,n as I,h as C,c as D,a as s,e as n,t as m,w as l,i as c,u as f,q as S,aW as q,E as A}from"./index-99f00cf3.js";/* empty css                  *//* empty css                 */import{a as E,c as F,b as N,d as B}from"./config-a403397f.js";const P={class:"main-container"},R={class:"!border-none mt-4",shadow:"never",style:{width:"640px"}},V={class:"flex ml-6 mt-6 mb-6 items-center"},$=s("div",{class:"text-slate-400 text-xs"},"站点KEY:",-1),J={class:"text-[#1F1F1F] font-bold ml-2"},O={class:"fixed-footer-wrap"},U={class:"fixed-footer"},L=b({__name:"index",setup(K){const p=h(),g=x();p.meta.title,r();const _=r(!1),t=r(!0),v=async()=>{t.value=!0;try{await F(),g.push("/channel/weapp/code")}catch{}finally{t.value=!1}},y=r();(()=>{let a="00",e="-1";localStorage.getItem("admin.userinfo")&&(a=JSON.parse(localStorage.getItem("admin.userinfo")).uid),localStorage.getItem("site.userinfo")&&(e=JSON.parse(localStorage.getItem("site.userinfo")).uid),a===e&&(_.value=!0)})(),w(()=>({pub_id:[{required:!0,message:"聚推客pub_id必须填写",trigger:"blur"}],api_key:[{required:!0,message:"聚推客apikey必须填写",trigger:"blur"}],mapi_key:[{required:!0,message:"蚂蚁星球apikey必须填写",trigger:"blur"}],secret:[{required:!0,message:"蚂蚁星球secret必须填写",trigger:"blur"}]}));const o=I({...{pub_id:"",api_key:"",mapi_key:"",secret:"",site_key:""}});(async()=>{t.value=!0;const a=await N();for(const e in o)o[e]=a.data[e];t.value=!1})();const k=async a=>{t.value||!a||await a.validate(async e=>{e&&(t.value=!0,B(o).then(i=>{t.value=!1}).catch(()=>{t.value=!1}))})};return(a,e)=>{const d=q,i=A;return C(),D("div",P,[s("div",R,[n(d,{type:"info",title:"请先在渠道-微信小程序里面配置好小程序APPID、密钥和上传密钥，小程序需要关闭白名单或者放行IP；这里上传的小程序带插件，没有申请插件会自动尝试申请",closable:!1,"show-icon":""}),s("div",V,[$,s("div",J,m(o.site_key),1)]),n(i,{loading:t.value,class:"mb-6 ml-6",type:"primary",plain:"",onClick:e[0]||(e[0]=u=>f(E)())},{default:l(()=>[c(" 申请小程序插件 ")]),_:1},8,["loading"]),n(i,{loading:t.value,class:"mb-6 ml-6",type:"primary",onClick:e[1]||(e[1]=u=>v())},{default:l(()=>[c(" 云上传小程序 ")]),_:1},8,["loading"])]),s("div",O,[s("div",U,[n(i,{type:"primary",loading:t.value,onClick:e[2]||(e[2]=u=>k(y.value))},{default:l(()=>[c(m(f(S)("confirm")),1)]),_:1},8,["loading"])])])])}}});export{L as default};
