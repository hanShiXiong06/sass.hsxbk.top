import{d as k,r as g,n as N,h as B,s as I,w as d,a as n,e as t,i as h,t as m,u as l,q as a,c8 as L,a3 as R,K as z,L as K,M as P,ac as S,aU as $,ad as q,E as G,X as O}from"./index-a3bdc7eb.js";/* empty css                  *//* empty css                   *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 */import{o as X}from"./order-e3f0cd95.js";const A={class:"max-h-[600px] overflow-y-auto"},H={class:"panel-title ml-[10px]"},J={class:"mb-[20px]"},Q={class:"multi-hidden text-[14px]"},W=n("text",{class:"nc-iconfont nc-icon-bangzhuV6xx ml-[5px] text-[12px]"},null,-1),Y=n("h3",{class:"panel-title ml-[10px]"},[n("span",{class:"text-primary"},"实际商品金额"),n("span",null," = 商品总额 - 优惠金额 + 调价")],-1),Z=n("h3",{class:"panel-title ml-[10px]"},[n("span",{class:"text-primary"},"订单总额"),n("span",null," = 实际商品金额 + 运费")],-1),ee={class:"dialog-footer"},ge=k({__name:"adjust-money",emits:["complete"],setup(oe,{expose:j,emit:v}){const u=g(!1),f=g(!1),r=N({}),_=g(0),M=o=>{L(o),_.value=o.target.value},V=o=>{for(let e in r)delete r[e];Object.assign(r,R(o)),r.order_goods.forEach(e=>{e.adjust_money="",e.total=(parseFloat(e.goods_money)-parseFloat(e.discount_money)).toFixed(2)}),_.value=r.delivery_money},w=(o,e,c)=>{let i=parseFloat(c.goods_money)-parseFloat(c.discount_money);o.length==0||isNaN(o)?(o=0,r.order_goods[e].adjust_money=""):o=parseFloat(o),parseFloat(o)+i<0?(o=i,r.order_goods[e].adjust_money=-o,i=0):i+=o,i=Math.round(i*100)/100,r.order_goods[e].total=i.toFixed(2)},y=g(!1),E=()=>{if(f.value=!0,y.value)return;y.value=!0;let o={};r.order_goods.forEach(e=>{e.adjust_money&&(o[e.order_goods_id]={money:e.adjust_money})}),X({order_id:r.order_id,delivery_money:parseFloat(_.value),order_goods_data:o}).then(e=>{y.value=!1,f.value=!1,u.value=!1,v("complete")}).catch(()=>{y.value=!1,f.value=!1})};return j({showDialog:u,setFormData:V}),(o,e)=>{const c=z,i=K,F=P,p=S,D=$,C=q,x=G,T=O;return B(),I(T,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),title:l(a)("adjustMoneyDialogTitle"),width:"1000px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:d(()=>[n("span",ee,[t(x,{onClick:e[2]||(e[2]=s=>u.value=!1)},{default:d(()=>[h(m(l(a)("cancel")),1)]),_:1}),t(x,{type:"primary",loading:f.value,onClick:e[3]||(e[3]=s=>E(o.formRef))},{default:d(()=>[h(m(l(a)("confirm")),1)]),_:1},8,["loading"])])]),default:d(()=>[n("div",A,[n("h3",H,m(l(a)("adjustMoneyTips")),1),t(F,{"label-width":"50px",ref:"formRef",class:"page-form"},{default:d(()=>[t(i,{label:l(a)("adjustMoneyDeliveryMoney"),prop:"express_number"},{default:d(()=>[t(c,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),modelModifiers:{trim:!0},clearable:"",placeholder:"0.00",class:"!w-[200px]",maxlength:"8",onKeyup:e[1]||(e[1]=s=>M(s))},{append:d(()=>[h(m(l(a)("adjustMoneyUnit")),1)]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},512),n("div",J,[t(C,{data:r.order_goods,size:"large"},{default:d(()=>[t(p,{label:l(a)("adjustMoneyGoodsInfo"),align:"left",width:"200"},{default:d(({row:s})=>[n("p",Q,m(s.goods_name),1)]),_:1},8,["label"]),t(p,{prop:"price",label:l(a)("adjustMoneyPrice"),"min-width":"50",align:"left"},null,8,["label"]),t(p,{prop:"num",label:l(a)("adjustMoneyNum"),"min-width":"50",align:"right"},null,8,["label"]),t(p,{prop:"goods_money",label:l(a)("adjustMoneySubTotal"),"min-width":"50",align:"right"},null,8,["label"]),t(p,{prop:"discount_money",label:l(a)("adjustMoneyDiscountMoney"),"min-width":"50",align:"right"},null,8,["label"]),t(p,{prop:"goods_name",label:l(a)("adjustMoneyLabel"),"min-width":"100"},{header:d(()=>[n("div",null,[n("span",null,m(l(a)("adjustMoneyLabel")),1),t(D,{effect:"dark",content:"负数表示下调金额，正数表示上调金额",placement:"top"},{default:d(()=>[W]),_:1})])]),default:d(({row:s,$index:U})=>[t(c,{modelValue:s.adjust_money,"onUpdate:modelValue":b=>s.adjust_money=b,modelModifiers:{trim:!0},clearable:"",placeholder:"0.00",maxlength:"6",onChange:b=>w(b,U,s)},{append:d(()=>[h(m(l(a)("adjustMoneyUnit")),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),t(p,{prop:"total",label:l(a)("adjustMoneyTotal"),"min-width":"70",align:"right"},null,8,["label"])]),_:1},8,["data"])]),Y,Z])]),_:1},8,["modelValue","title"])}}});export{ge as _};
