import{d as q,n as P,q as a,l as T,r as y,h as D,c as K,a as i,b as W,e as s,w as c,i as g,t as r,u as o,R as b,a0 as w,s as X,A as J,a3 as Q,a$ as Z,U as E,E as ee,K as te,L as ae,bO as le,M as oe,ac as se,ad as ne,W as ie,X as ce,Y as re}from"./index-6f32d09b.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                       *//* empty css                  */import"./el-form-item-4ed993c7.js";import{a as pe}from"./tourism-dc4cc108.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const me={class:"inline-block ml-[10px] text-[14px]"},ue={class:"text-primary mx-[2px]"},_e={class:"flex items-center"},fe={class:"min-w-[60px] h-[60px] flex items-center justify-center"},ge=["src"],he=["title"],ve={class:"mt-[16px] flex"},Se={class:"flex items-center flex-1"},xe={class:"layui-table-bottom-left-container mr-[10px]"},be={class:"text-primary mx-[2px]"},ke={class:"dialog-footer"},Pe=q({__name:"tickets-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue"],setup($,{expose:N,emit:F}){const m=$,R=P({1:a("oneStar"),2:a("twoStar"),3:a("threeStar"),4:a("fourStar"),5:a("fiveStar")}),_=T({get(){return m.modelValue},set(l){F("update:modelValue",l)}}),h=y(!1),p=P({}),f=T(()=>Object.keys(p).length),t=P({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{scenic_name:"",create_time:"",goods_type:"scenic"}}),C=y(),x=y(),z=(l,e)=>{let d=!1;for(let u=0;u<l.length;u++)if(l[u].scenic_id==e.scenic_id){d=!0;break}d?p["scenic_"+e.scenic_id]=e:delete p["scenic_"+e.scenic_id]},A=l=>{l.length?l.forEach(e=>{p["scenic_"+e.scenic_id]=e}):t.data.forEach(e=>{delete p["scenic_"+e.scenic_id]})},S=(l=1,e=null)=>{t.loading=!0,t.page=l;const d=Q(t.searchParam);pe({page:t.page,limit:t.limit,...d}).then(u=>{t.loading=!1,t.data=u.data.data,t.total=u.data.total,e&&e(),V()}).catch(()=>{t.loading=!1})},V=()=>{Z(()=>{if(x.value)for(let l=0;l<t.data.length;l++)x.value.toggleRowSelection(t.data[l],!1),p["scenic_"+t.data[l].scenic_id]&&x.value.toggleRowSelection(t.data[l],!0)})},B=l=>{l&&(l.resetFields(),S())},G=()=>{S(1,()=>{if(_.value){const l=[];for(let e=0;e<t.data.length;e++)_.value.indexOf(t.data[e].scenic_id)!=-1&&(l.push(t.data[e].scenic_id),p["scenic_"+t.data[e].scenic_id]=t.data[e]);_.value=l}}),h.value=!0},I=()=>{for(const l in p)delete p[l];V()},L=()=>{if(m.min&&f.value<m.min){E({type:"warning",message:`${a("ticketsSelectPopupGoodsMinTip")}${m.min}${a("goodsSelectPopupPiece")}`});return}if(m.max&&m.max>0&&f.value&&f.value>m.max){E({type:"warning",message:`${a("ticketsSelectPopupGoodsMaxTip")}${m.max}${a("goodsSelectPopupPiece")}`});return}const l=[];for(const e in p)l.push(parseInt(e.replace("scenic_","")));_.value.splice(0,_.value.length,...l),h.value=!1};return N({showDialog:h,selectScenic:p,selectGoodsNum:f}),(l,e)=>{const d=ee,u=te,k=ae,M=le,U=oe,v=se,j=ne,Y=ie,O=ce,H=re;return D(),K("div",null,[i("div",{onClick:G},[W(l.$slots,"default",{},()=>[s(d,null,{default:c(()=>[g(r(o(a)("ticketsSelectPopupAllTickets")),1)]),_:1}),b(i("div",me,[i("span",null,r(o(a)("goodsSelectPopupSelect")),1),i("span",ue,r(o(_).length),1),i("span",null,r(o(a)("goodsSelectPopupPiece")),1)],512),[[w,o(_).length]])],!0)]),s(O,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=n=>h.value=n),title:o(a)("ticketsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:c(()=>[i("span",ke,[s(d,{onClick:e[7]||(e[7]=n=>h.value=!1)},{default:c(()=>[g(r(o(a)("cancel")),1)]),_:1}),s(d,{type:"primary",onClick:L},{default:c(()=>[g(r(o(a)("confirm")),1)]),_:1})])]),default:c(()=>[s(U,{inline:!0,model:t.searchParam,ref_key:"searchFormRef",ref:C},{default:c(()=>[s(k,{label:o(a)("scenicNameSelectPopup"),prop:"scenic_name",class:"form-item-wrap"},{default:c(()=>[s(u,{modelValue:t.searchParam.scenic_name,"onUpdate:modelValue":e[0]||(e[0]=n=>t.searchParam.scenic_name=n),placeholder:o(a)("scenicNameSelectPopupPlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(k,{label:o(a)("createTime"),prop:"create_time",class:"form-item-wrap"},{default:c(()=>[s(M,{modelValue:t.searchParam.create_time,"onUpdate:modelValue":e[1]||(e[1]=n=>t.searchParam.create_time=n),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":o(a)("startDate"),"end-placeholder":o(a)("endDate")},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1},8,["label"]),s(k,{class:"form-item-wrap"},{default:c(()=>[s(d,{type:"primary",onClick:e[2]||(e[2]=n=>S())},{default:c(()=>[g(r(o(a)("search")),1)]),_:1}),s(d,{onClick:e[3]||(e[3]=n=>B(C.value))},{default:c(()=>[g(r(o(a)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),b((D(),X(j,{data:t.data,size:"large",ref_key:"scenicListTableRef",ref:x,"max-height":"400",onSelect:z,onSelectAll:A},{empty:c(()=>[i("span",null,r(t.loading?"":o(a)("emptyData")),1)]),default:c(()=>[s(v,{type:"selection",width:"55"}),s(v,{"show-overflow-tooltip":!0,label:o(a)("scenicInfo"),"min-width":"180",align:"left"},{default:c(({row:n})=>[i("div",_e,[i("div",fe,[i("img",{class:"max-w-[60px] max-h-[60px]",src:o(J)(n.cover_thumb_small)},null,8,ge)]),i("a",{href:"javascript:;",title:n.scenic_name,class:"multi-hidden ml-2"},r(n.scenic_name),9,he)])]),_:1},8,["label"]),s(v,{prop:"scenic_star",label:o(a)("scenicStar"),"min-width":"100"},{default:c(({row:n})=>[g(r(R[n.scenic_level]),1)]),_:1},8,["label"]),s(v,{prop:"full_address",label:o(a)("scenicFullAddress"),"min-width":"150"},null,8,["label"]),s(v,{prop:"status_name",label:o(a)("scenicStatus"),"min-width":"100"},null,8,["label"]),s(v,{prop:"create_time",label:o(a)("goodsSelectPopupCreateTime"),"min-width":"120"},null,8,["label"])]),_:1},8,["data"])),[[H,t.loading]]),i("div",ve,[i("div",Se,[b(i("div",xe,[i("span",null,r(o(a)("goodsSelectPopupBeforeTip")),1),i("span",be,r(o(f)),1),i("span",null,r(o(a)("ticketsSelectPopupAfterTip")),1)],512),[[w,o(f)]]),b(s(d,{type:"primary",link:"",onClick:I},{default:c(()=>[g(r(o(a)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[w,o(f)]])]),s(Y,{"current-page":t.page,"onUpdate:current-page":e[4]||(e[4]=n=>t.page=n),"page-size":t.limit,"onUpdate:page-size":e[5]||(e[5]=n=>t.limit=n),layout:"total, sizes, prev, pager, next, jumper",total:t.total,onSizeChange:e[6]||(e[6]=n=>S()),onCurrentChange:S},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const Oe=de(Pe,[["__scopeId","data-v-528edb70"]]);export{Oe as default};
