import{d as oe,l as D,r as k,n as w,h as C,c as I,a as n,b as te,e as d,w as i,i as h,t as g,u as a,q as l,R as E,a0 as G,s as N,A as ae,a3 as le,a$ as se,U as B,E as de,ab as ne,aC as ie,L as pe,K as re,bF as ce,M as ge,ac as me,J as ue,ak as _e,ad as fe,W as he,X as ve,Y as ye,p as Se,g as xe}from"./index-a3bdc7eb.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                        *//* empty css                *//* empty css                          *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  */import{_ as F}from"./goods_default-665e448a.js";import{g as Pe}from"./category-2b62e3d4.js";import{g as be}from"./goods-2414a609.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";const Ce=x=>(Se("data-v-910fcd3d"),x=x(),xe(),x),Ee={class:"inline-block ml-[10px] text-[14px]"},Ve={class:"text-primary mx-[2px]"},we={class:"flex items-center cursor-pointer"},Ge={class:"min-w-[60px] h-[60px] flex items-center justify-center"},Te=Ce(()=>n("div",{class:"image-slot"},[n("img",{class:"w-[60px] h-[60px]",src:F})],-1)),$e={key:1,class:"w-[70px] h-[60px]",src:F,fit:"contain"},De={class:"ml-2"},Ie=["title"],Ne={class:"mt-[16px] flex"},Be={class:"flex items-center flex-1"},Fe={class:"layui-table-bottom-left-container mr-[10px]"},Re={class:"text-primary mx-[2px]"},Ue={class:"dialog-footer"},ze=oe({__name:"goods-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue"],setup(x,{expose:R,emit:U}){const u=x,m=D({get(){return u.modelValue},set(t){U("update:modelValue",t)}}),v=k(!1),c=w({}),_=D(()=>Object.keys(c).length),o=w({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{goods_name:"",goods_category:"",select_type:"all",goods_ids:"",verify_goods_ids:""}}),T=k(),z=t=>{y()},V=w([]);(()=>{Pe().then(t=>{const e=t.data;if(e){const r=[];e.forEach(p=>{const S=[];p.children&&p.children.forEach(f=>{S.push({value:f.category_id,label:f.category_name})}),r.push({value:p.category_id,label:p.category_name,children:S})}),V.splice(0,V.length,...r)}})})();const P=k();k([]);const L=(t,e)=>{let r=!1;for(let p=0;p<t.length;p++)if(t[p].goods_id==e.goods_id){r=!0;break}r?c["goods_"+e.goods_id]=e:delete c["goods_"+e.goods_id]},A=t=>{t.length?t.forEach(e=>{c["goods_"+e.goods_id]=e}):o.data.forEach(e=>{delete c["goods_"+e.goods_id]})},y=(t=1,e=null)=>{o.loading=!0,o.page=t;const r=le(o.searchParam);if(r.select_type=="selected"){const p=[];for(let S in c)p.push(parseInt(S.replace("goods_","")));r.goods_ids=p}else r.goods_ids="";be({page:o.page,limit:o.limit,...r}).then(p=>{o.loading=!1,o.data=p.data.data,o.total=p.data.total,e&&e(p.data.verify_goods_ids),$()}).catch(()=>{o.loading=!1})},$=()=>{se(()=>{if(P.value)for(let t=0;t<o.data.length;t++)P.value.toggleRowSelection(o.data[t],!1),c["goods_"+o.data[t].goods_id]&&P.value.toggleRowSelection(o.data[t],!0)})},M=t=>{t&&(t.resetFields(),y())},O=()=>{for(let t in c)delete c[t];o.searchParam.verify_goods_ids=m.value,y(1,t=>{if(m.value){m.value.splice(0,m.value.length,...t),m.value.forEach(e=>{c["goods_"+e]||(c["goods_"+e]={})});for(let e=0;e<o.data.length;e++)m.value.indexOf(o.data[e].goods_id)!=-1&&(c["goods_"+o.data[e].goods_id]=o.data[e])}}),v.value=!0},j=()=>{for(let t in c)delete c[t];$()},q=()=>{if(u.min&&_.value<u.min){B({type:"warning",message:`${l("goodsSelectPopupGoodsMinTip")}${u.min}${l("goodsSelectPopupPiece")}`});return}if(u.max&&u.max>0&&_.value&&_.value>u.max){B({type:"warning",message:`${l("goodsSelectPopupGoodsMaxTip")}${u.max}${l("goodsSelectPopupPiece")}`});return}let t=[];for(let e in c)t.push(parseInt(e.replace("goods_","")));m.value.splice(0,m.value.length,...t),v.value=!1};return R({showDialog:v,selectGoods:c,selectGoodsNum:_}),(t,e)=>{const r=de,p=ne,S=ie,f=pe,J=re,K=ce,W=ge,b=me,X=ue,Y=_e,H=fe,Q=he,Z=ve,ee=ye;return C(),I("div",null,[n("div",{onClick:O},[te(t.$slots,"default",{},()=>[d(r,null,{default:i(()=>[h(g(a(l)("goodsSelectPopupSelectGoodsButton")),1)]),_:1}),E(n("div",Ee,[n("span",null,g(a(l)("goodsSelectPopupSelect")),1),n("span",Ve,g(a(m).length),1),n("span",null,g(a(l)("goodsSelectPopupPiece")),1)],512),[[G,a(m).length]])],!0)]),d(Z,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=s=>v.value=s),title:a(l)("goodsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:i(()=>[n("span",Ue,[d(r,{onClick:e[8]||(e[8]=s=>v.value=!1)},{default:i(()=>[h(g(a(l)("cancel")),1)]),_:1}),d(r,{type:"primary",onClick:q},{default:i(()=>[h(g(a(l)("confirm")),1)]),_:1})])]),default:i(()=>[d(W,{inline:!0,model:o.searchParam,ref_key:"searchFormRef",ref:T},{default:i(()=>[d(f,{prop:"select_type",class:"form-item-wrap"},{default:i(()=>[d(S,{modelValue:o.searchParam.select_type,"onUpdate:modelValue":e[0]||(e[0]=s=>o.searchParam.select_type=s),onChange:z},{default:i(()=>[d(p,{label:a(l)("goodsSelectPopupAllGoods"),value:"all"},null,8,["label"]),d(p,{label:a(l)("goodsSelectPopupSelectedGoods"),value:"selected"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),d(f,{label:a(l)("goodsSelectPopupGoodsName"),prop:"goods_name",class:"form-item-wrap"},{default:i(()=>[d(J,{modelValue:o.searchParam.goods_name,"onUpdate:modelValue":e[1]||(e[1]=s=>o.searchParam.goods_name=s),placeholder:a(l)("goodsSelectPopupGoodsNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(f,{label:a(l)("goodsSelectPopupGoodsCategory"),prop:"goods_category",class:"form-item-wrap"},{default:i(()=>[d(K,{modelValue:o.searchParam.goods_category,"onUpdate:modelValue":e[2]||(e[2]=s=>o.searchParam.goods_category=s),props:{value:"value",label:"label",emitPath:!1},options:V,placeholder:a(l)("goodsSelectPopupGoodsCategoryPlaceholder"),clearable:""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),d(f,{class:"form-item-wrap"},{default:i(()=>[d(r,{type:"primary",onClick:e[3]||(e[3]=s=>y())},{default:i(()=>[h(g(a(l)("search")),1)]),_:1}),d(r,{onClick:e[4]||(e[4]=s=>M(T.value))},{default:i(()=>[h(g(a(l)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),E((C(),N(H,{data:o.data,size:"large",ref_key:"goodsListTableRef",ref:P,"max-height":"400",onSelect:L,onSelectAll:A},{empty:i(()=>[n("span",null,g(o.loading?"":a(l)("emptyData")),1)]),default:i(()=>[d(b,{type:"selection",width:"55"}),d(b,{prop:"goods_id",label:a(l)("goodsSelectPopupGoodsInfo"),"min-width":"300"},{default:i(({row:s})=>[n("div",we,[n("div",Ge,[s.goods_cover?(C(),N(X,{key:0,class:"w-[60px] h-[60px]",src:a(ae)(s.goods_cover),fit:"contain"},{error:i(()=>[Te]),_:2},1032,["src"])):(C(),I("img",$e))]),n("div",De,[n("span",{title:s.goods_name,class:"multi-hidden"},g(s.goods_name),9,Ie),n("div",null,[d(Y,null,{default:i(()=>[h(g(s.buy_type_name),1)]),_:2},1024)])])])]),_:1},8,["label"]),d(b,{prop:"price",label:a(l)("goodsSelectPopupPrice"),"min-width":"300",align:"center"},{default:i(({row:s})=>[n("div",null,"ï¿¥"+g(s.price),1)]),_:1},8,["label"]),d(b,{prop:"sale_num",label:a(l)("goodsSelectPopupStock"),"min-width":"220",align:"center"},null,8,["label"])]),_:1},8,["data"])),[[ee,o.loading]]),n("div",Ne,[n("div",Be,[E(n("div",Fe,[n("span",null,g(a(l)("goodsSelectPopupBeforeTip")),1),n("span",Re,g(a(_)),1),n("span",null,g(a(l)("goodsSelectPopupAfterTip")),1)],512),[[G,a(_)]]),E(d(r,{type:"primary",link:"",onClick:j},{default:i(()=>[h(g(a(l)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[G,a(_)]])]),d(Q,{"current-page":o.page,"onUpdate:current-page":e[5]||(e[5]=s=>o.page=s),"page-size":o.limit,"onUpdate:page-size":e[6]||(e[6]=s=>o.limit=s),layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:e[7]||(e[7]=s=>y()),onCurrentChange:y},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const uo=ke(ze,[["__scopeId","data-v-910fcd3d"]]);export{uo as default};
