import{d as X,l as V,r as b,n as $,h as P,c as T,a as s,b as Y,e as d,w as p,i as h,t as r,u as a,q as l,R as k,a0 as w,s as I,A as H,a3 as Q,a$ as Z,U as D,E as ee,K as oe,L as te,M as ae,ad as le,J as se,ae as ne,W as ie,X as de,Y as pe,p as re,g as ce}from"./index-99f00cf3.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                        *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                  */import{g as me}from"./vipcard-cf1e419a.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const N=""+new URL("goods_default-9268386d.png",import.meta.url).href,ge=v=>(re("data-v-2cbe1a5c"),v=v(),ce(),v),_e={class:"inline-block ml-[10px] text-[14px]"},fe={class:"text-primary mx-[2px]"},he={class:"flex items-center cursor-pointer"},ve={class:"min-w-[60px] h-[60px] flex items-center justify-center"},xe=ge(()=>s("div",{class:"image-slot"},[s("img",{class:"w-[60px] h-[60px]",src:N})],-1)),Se={key:1,class:"w-[70px] h-[60px]",src:N,fit:"contain"},ye={class:"ml-2"},be=["title"],Pe={class:"text-primary text-[12px]"},ke={class:"mt-[16px] flex"},we={class:"flex items-center flex-1"},Ce={class:"layui-table-bottom-left-container mr-[10px]"},Ee={class:"text-primary mx-[2px]"},Ge={class:"dialog-footer"},Ve=X({__name:"goods-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0},type:{type:String,default:"service"}},emits:["update:modelValue"],setup(v,{expose:R,emit:B}){const m=v,_=V({get(){return m.modelValue},set(t){B("update:modelValue",t)}}),f=b(!1),c=$({}),g=V(()=>Object.keys(c).length),o=$({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{goods_type:"",goods_name:""}});o.searchParam.goods_type=m.type;const C=b(),S=b();b([]);const j=(t,e)=>{let i=!1;for(let u=0;u<t.length;u++)if(t[u].goods_id==e.goods_id){i=!0;break}i?c["goods_"+e.goods_id]=e:delete c["goods_"+e.goods_id]},z=t=>{t.length?t.forEach(e=>{c["goods_"+e.goods_id]=e}):o.data.forEach(e=>{delete c["goods_"+e.goods_id]})},x=(t=1,e=null)=>{o.loading=!0,o.page=t;const i=Q(o.searchParam);me({page:o.page,limit:o.limit,...i}).then(u=>{o.loading=!1,o.data=u.data.data,o.total=u.data.total,E()}).catch(()=>{o.loading=!1})},E=()=>{Z(()=>{if(S.value)for(let t=0;t<o.data.length;t++)S.value.toggleRowSelection(o.data[t],!1),c["goods_"+o.data[t].goods_id]&&S.value.toggleRowSelection(o.data[t],!0)})},F=t=>{t&&(t.resetFields(),x())},L=()=>{x(1,t=>{if(_.value){let e=[];for(let i=0;i<o.data.length;i++)_.value.indexOf(o.data[i].goods_id)!=-1&&(e.push(o.data[i].goods_id),c["goods_"+o.data[i].goods_id]=o.data[i]||{});_.value=e.join(",")}}),f.value=!0},U=()=>{for(let t in c)delete c[t];E()},A=()=>{if(m.min&&g.value<m.min){D({type:"warning",message:`${l("goodsSelectPopupGoodsMinTip")}${m.min}${l("goodsSelectPopupPiece")}`});return}if(m.max&&m.max>0&&g.value&&g.value>m.max){D({type:"warning",message:`${l("goodsSelectPopupGoodsMaxTip")}${m.max}${l("goodsSelectPopupPiece")}`});return}let t=[];for(let e in c)t.push(parseInt(e.replace("goods_","")));_.value=t.join(","),f.value=!1};return R({showDialog:f,selectGoods:c,selectGoodsNum:g}),(t,e)=>{const i=ee,u=oe,G=te,M=ae,y=le,O=se,q=ne,J=ie,K=de,W=pe;return P(),T("div",null,[s("div",{onClick:L},[Y(t.$slots,"default",{},()=>[d(i,null,{default:p(()=>[h(r(a(l)("goodsSelectPopupSelectGoodsButton")),1)]),_:1}),k(s("div",_e,[s("span",null,r(a(l)("goodsSelectPopupSelect")),1),s("span",fe,r(a(_).length),1),s("span",null,r(a(l)("goodsSelectPopupPiece")),1)],512),[[w,a(_).length]])],!0)]),d(K,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=n=>f.value=n),title:a(l)("goodsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:p(()=>[s("span",Ge,[d(i,{onClick:e[6]||(e[6]=n=>f.value=!1)},{default:p(()=>[h(r(a(l)("cancel")),1)]),_:1}),d(i,{type:"primary",onClick:A},{default:p(()=>[h(r(a(l)("confirm")),1)]),_:1})])]),default:p(()=>[d(M,{inline:!0,model:o.searchParam,ref_key:"searchFormRef",ref:C},{default:p(()=>[d(G,{label:a(l)("goodsSelectPopupGoodsName"),prop:"keyword",class:"form-item-wrap"},{default:p(()=>[d(u,{modelValue:o.searchParam.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>o.searchParam.keyword=n),placeholder:a(l)("goodsSelectPopupGoodsNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(G,{class:"form-item-wrap"},{default:p(()=>[d(i,{type:"primary",onClick:e[1]||(e[1]=n=>x())},{default:p(()=>[h(r(a(l)("search")),1)]),_:1}),d(i,{onClick:e[2]||(e[2]=n=>F(C.value))},{default:p(()=>[h(r(a(l)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),k((P(),I(q,{data:o.data,size:"large",ref_key:"goodsListTableRef",ref:S,"max-height":"400",onSelect:j,onSelectAll:z},{empty:p(()=>[s("span",null,r(o.loading?"":a(l)("emptyData")),1)]),default:p(()=>[d(y,{type:"selection",width:"55"}),d(y,{prop:"goods_id",label:a(l)("goodsSelectPopupGoodsInfo"),"min-width":"350"},{default:p(({row:n})=>[s("div",he,[s("div",ve,[n.cover_thumb_small?(P(),I(O,{key:0,class:"w-[60px] h-[60px]",src:a(H)(n.cover_thumb_small),fit:"contain"},{error:p(()=>[xe]),_:2},1032,["src"])):(P(),T("img",Se))]),s("div",ye,[s("span",{title:n.goods_name,class:"multi-hidden"},r(n.goods_name),9,be),s("span",Pe,r(n.goods_type_name),1)])])]),_:1},8,["label"]),d(y,{prop:"price",label:a(l)("goodsSelectPopupPrice"),"min-width":"120"},{default:p(({row:n})=>[s("div",null,"ï¿¥"+r(n.price),1)]),_:1},8,["label"]),d(y,{prop:"stock",label:a(l)("goodsSelectPopupStock"),"min-width":"120",align:"right"},null,8,["label"])]),_:1},8,["data"])),[[W,o.loading]]),s("div",ke,[s("div",we,[k(s("div",Ce,[s("span",null,r(a(l)("goodsSelectPopupBeforeTip")),1),s("span",Ee,r(a(g)),1),s("span",null,r(a(l)("goodsSelectPopupAfterTip")),1)],512),[[w,a(g)]]),k(d(i,{type:"primary",link:"",onClick:U},{default:p(()=>[h(r(a(l)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[w,a(g)]])]),d(J,{"current-page":o.page,"onUpdate:current-page":e[3]||(e[3]=n=>o.page=n),"page-size":o.limit,"onUpdate:page-size":e[4]||(e[4]=n=>o.limit=n),layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:e[5]||(e[5]=n=>x()),onCurrentChange:x},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const Qe=ue(Ve,[["__scopeId","data-v-2cbe1a5c"]]);export{Qe as default};
