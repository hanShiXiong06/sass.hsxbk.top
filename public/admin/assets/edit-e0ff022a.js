import{d as de,f as ne,x as ie,r as N,n as E,l as ue,q as t,h as p,c as k,e as i,w as n,u as d,aQ as pe,R as ce,s as f,F as S,T,i as V,t as g,B as w,a as _,A as _e,U as ge,aJ as me,aR as fe,a7 as he,K as be,L as ye,ac as ke,aD as xe,au as ve,av as Ve,J as we,ad as Ce,E as Ee,ae as Se,bF as Te,aw as Ge,c2 as Le,M as je,Y as Pe}from"./index-99f00cf3.js";/* empty css                   *//* empty css                *//* empty css                          *//* empty css                    *//* empty css                          *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                 *//* empty css                     *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                        *//* empty css                 *//* empty css                        *//* empty css                       *//* empty css                  *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                   *//* empty css                       */import{_ as F}from"./goods_default-995568ac.js";import{G as Re,H as Ue,I as Be,J as Ne}from"./marketing-47e9cfd6.js";import qe from"./goods-select-popup-4022fc08.js";import{g as De,a1 as Oe,a2 as Ie}from"./goods-4a8ebb3e.js";/* empty css                  *//* empty css                   *//* empty css                      */import"./_plugin-vue_export-helper-c27b6911.js";const Me={class:"main-container"},$e={class:"flex items-center cursor-pointer"},Fe={class:"min-w-[60px] h-[60px] flex items-center justify-center"},Je=_("div",{class:"image-slot"},[_("img",{class:"w-[60px] h-[60px]",src:F})],-1),He={key:1,class:"w-[70px] h-[60px]",src:F,fit:"contain"},ze={class:"ml-2"},Ae=["title"],Ke={class:"text-primary text-[12px]"},Qe={class:"ml-[10px]"},Ye={class:"ml-[10px]"},We={class:"ml-[10px]"},Xe={class:"fixed-footer-wrap"},Ze={class:"fixed-footer"},No=de({__name:"edit",setup(eo){const x=ne(),J=ie(),q=N(!0),C=J.query.rank_id,o=E({name:"",show_goods_num:"",goods_source:"goods",rank_type:"",sort:"",rule_type:"sale",category_ids:[],brand_ids:[],label_ids:[],goods_json:[],goods_ids:[]}),v=E({rankTypeList:[],goodsSourceList:[],ruleTypeList:[]}),D=N(),H=ue(()=>({name:[{required:!0,message:t("ramkkNamePlaceholder"),trigger:"blur"}],rule_type:[{required:!0,message:t("ruleTypePlaceholder"),trigger:"change"}],rank_type:[{required:!0,message:t("rankTypePlaceholder"),trigger:"change"}],goods_source:[{required:!0,message:t("goodsSourcePlaceholder"),trigger:"change"}],label_ids:[{validator:(r,e,l)=>{o.goods_source==="label"&&(!e||e.length===0)?l(t("labelTips")):l()},trigger:"change"}],show_goods_num:[{required:!0,validator:(r,e,l)=>{o.goods_source!="goods"&&(!e||e.length===0)?l(t("showGoodsNumTips")):l()},trigger:"change"}],brand_ids:[{required:!0,validator:(r,e,l)=>{o.goods_source==="brand"&&(!e||e.length===0)?l(t("brandTips")):l()},trigger:"change"}],category_ids:[{required:!0,validator:(r,e,l)=>{o.goods_source==="category"&&(!e||e.length===0)?l(t("categoryTips")):l()},trigger:"change"}],goods_json:[{required:!0,trigger:"blur",validator:(r,e,l)=>{o.goods_source=="goods"&&(o.goods_json.length==0?l(new Error(t("goodsJsonEmpty"))):l())}}]}));(()=>{if(Re().then(r=>{q.value=!1,console.log(r),v.rankTypeList=r.data.rank_type,v.goodsSourceList=r.data.goods_source,v.ruleTypeList=r.data.rule_type}),C){const r=Number(C);Ue(r).then(e=>{const l=e.data;l&&(Object.assign(o,l),o.goods_source=="goods"&&(o.goods_ids.splice(0,o.goods_ids.length),o.goods_json.forEach(a=>{o.goods_ids.push(a.goods_id)})),o.goods_json=l.goods_list.map(a=>({goods_id:a.goods_id,sort:a.sort,price:a.goodsSku.price,goods_type_name:a.goods_type_name,goods_name:a.goods_name,goods_image:a.goodsSku.sku_image})))})}})();const P=E([]),z={multiple:!0},A=r=>{console.log(r,o.category_ids,o.category_ids.toString())},K=()=>{const r=x.resolve({path:"/shop/goods/category"});window.open(r.href)},O=(r=!1)=>{De().then(e=>{const l=e.data;if(l){const a=[];l.forEach(u=>{const c=[];u.child_list&&u.child_list.forEach(h=>{c.push({value:h.category_id,label:h.category_name})}),a.push({value:u.category_id,label:u.category_name,children:c})}),P.splice(0,P.length,...a),r&&a({message:t("refreshSuccess"),type:"success"})}})};O();const R=E([]),Q=()=>{const r=x.resolve({path:"/shop/goods/brand"});window.open(r.href)},I=(r=!1)=>{Oe({}).then(e=>{const l=e.data;l&&(R.splice(0,R.length,...l),r&&ge({message:t("refreshSuccess"),type:"success"}))})};I();const U=E([]),Y=()=>{const r=x.resolve({path:"/shop/goods/label"});window.open(r.href)},M=()=>{Ie({}).then(r=>{const e=r.data;e&&U.splice(0,U.length,...e)})};M();const W=r=>{let e=[...o.goods_json];const l=e.map(a=>a.sort).sort((a,u)=>a-u);for(let a in r){let u=r[a],c={goods_id:u.goods_id,price:u.goodsSku.price,goods_type_name:u.goods_type_name,goods_image:u.goods_cover,goods_name:u.goods_name};const h=e.findIndex(b=>b.goods_id==c.goods_id);if(h!==-1)e[h]={...e[h],...c};else{let b=1;for(;l.includes(b);)b++;c.sort=b,e.push(me(c)),l.push(b),l.sort((G,L)=>G-L)}}o.goods_json=e.sort((a,u)=>a.sort-u.sort)},X=(r,e)=>{o.goods_json.splice(e,1),o.goods_ids.splice(o.goods_ids.indexOf(r.goods_id),1)},y=N(!1),Z=async()=>{var r;y.value||await((r=D.value)==null?void 0:r.validate(async e=>{if(e){o.goods_json=o.goods_json.map(a=>({goods_id:a.goods_id,sort:a.sort}));const l=[];o.category_ids.forEach(a=>{typeof a=="object"?a.forEach(u=>{l.indexOf(u)==-1&&l.push(u)}):l.indexOf(a)==-1&&l.push(a)}),o.category_ids=l,y.value=!0,C?(o.id=C,Be(o).then(a=>{y.value=!1,a.data&&x.push("/shop/marketing/goods_rank/list")}).catch(()=>{y.value=!1})):Ne(o).then(a=>{y.value=!1,a.data&&x.push("/shop/marketing/goods_rank/list")}).catch(()=>{y.value=!1})}else y.value=!1}))},$=()=>{x.back()};return(r,e)=>{const l=fe,a=he,u=be,c=ye,h=ke,b=xe,G=ve,L=Ve,ee=we,j=Ce,B=Ee,oe=Se,se=Te,te=Ge,le=Le,ae=je,re=Pe;return p(),k("div",Me,[i(a,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[i(l,{content:d(C)?d(t)("updateRanking"):d(t)("addRanking"),icon:d(pe),onBack:e[0]||(e[0]=s=>$())},null,8,["content","icon"])]),_:1}),ce((p(),f(a,{class:"box-card mt-[15px] !border-none",shadow:"never"},{default:n(()=>[i(ae,{model:o,"label-width":"120px",ref_key:"formRef",ref:D,rules:d(H),class:"page-form"},{default:n(()=>[i(c,{label:d(t)("rankName"),prop:"name"},{default:n(()=>[i(u,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=s=>o.name=s),modelModifiers:{trim:!0},clearable:"",placeholder:d(t)("ramkkNamePlaceholder"),class:"input-width",maxlength:"20","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(c,{label:d(t)("rankType"),prop:"rank_type"},{default:n(()=>[i(b,{modelValue:o.rank_type,"onUpdate:modelValue":e[2]||(e[2]=s=>o.rank_type=s),placeholder:d(t)("rankTypePlaceholder"),clearable:""},{default:n(()=>[(p(!0),k(S,null,T(v.rankTypeList,(s,m)=>(p(),f(h,{key:m,label:s,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),i(c,{label:d(t)("ruleType"),prop:"rule_type"},{default:n(()=>[i(L,{modelValue:o.rule_type,"onUpdate:modelValue":e[3]||(e[3]=s=>o.rule_type=s)},{default:n(()=>[(p(!0),k(S,null,T(v.ruleTypeList,(s,m)=>(p(),f(G,{key:m,label:m},{default:n(()=>[V(g(s),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(c,{label:d(t)("goodsSource"),prop:"goods_source"},{default:n(()=>[i(L,{modelValue:o.goods_source,"onUpdate:modelValue":e[4]||(e[4]=s=>o.goods_source=s)},{default:n(()=>[(p(!0),k(S,null,T(v.goodsSourceList,(s,m)=>(p(),f(G,{key:m,label:m},{default:n(()=>[V(g(s),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o.goods_source=="goods"?(p(),f(c,{key:0,label:d(t)("selectGoods"),prop:"goods_json"},{default:n(()=>[i(qe,{ref:"goodsSelectPopupRef",modelValue:o.goods_ids,"onUpdate:modelValue":e[5]||(e[5]=s=>o.goods_ids=s),onGoodsSelect:W,min:1,max:99},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),o.goods_json&&o.goods_json.length&&o.goods_source=="goods"?(p(),f(c,{key:1},{default:n(()=>[i(oe,{data:o.goods_json,size:"large","max-height":"400"},{default:n(()=>[i(j,{prop:"goods_id",label:d(t)("goodsSelectPopupGoodsInfo"),"min-width":"300"},{default:n(({row:s})=>[_("div",$e,[_("div",Fe,[s.goods_image?(p(),f(ee,{key:0,class:"w-[60px] h-[60px]",src:d(_e)(s.goods_image),fit:"contain"},{error:n(()=>[Je]),_:2},1032,["src"])):(p(),k("img",He))]),_("div",ze,[_("span",{title:s.sku_name,class:"multi-hidden"},g(s.sku_name?s.goods_name+" "+s.sku_name:s.goods_name),9,Ae),_("span",Ke,g(s.goods_type_name),1)])])]),_:1},8,["label"]),i(j,{prop:"price",label:d(t)("goodsSelectPopupPrice"),"min-width":"120"},{default:n(({row:s})=>[_("div",null,"￥"+g(s.price),1)]),_:1},8,["label"]),i(j,{prop:"sort",label:d(t)("排序"),"min-width":"120",sortable:"custom"},{default:n(({row:s})=>[i(u,{modelValue:s.sort,"onUpdate:modelValue":m=>s.sort=m,modelModifiers:{number:!0},class:"w-[70px]",maxlength:"8"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),i(j,{label:d(t)("operation"),align:"right","min-width":"160"},{default:n(({row:s,$index:m})=>[i(B,{type:"primary",link:"",onClick:so=>X(s,m)},{default:n(()=>[V(g(d(t)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})):w("",!0),o.goods_source=="category"?(p(),f(c,{key:2,label:d(t)("goodsSelectPopupGoodsCategory"),prop:"category_ids"},{default:n(()=>[i(se,{modelValue:o.category_ids,"onUpdate:modelValue":e[6]||(e[6]=s=>o.category_ids=s),options:P,props:z,clearable:"",filterable:"",onChange:A,"popper-class":"choice"},null,8,["modelValue","options"]),_("div",Qe,[_("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:e[7]||(e[7]=s=>O(!0))},g(d(t)("refresh")),1),_("span",{class:"cursor-pointer text-primary",onClick:K},g(d(t)("addCategory")),1)])]),_:1},8,["label"])):w("",!0),o.goods_source=="brand"?(p(),f(c,{key:3,label:d(t)("brand"),prop:"brand_ids"},{default:n(()=>[i(b,{modelValue:o.brand_ids,"onUpdate:modelValue":e[8]||(e[8]=s=>o.brand_ids=s),placeholder:d(t)("brandPlaceholder"),clearable:"",multiple:""},{default:n(()=>[(p(!0),k(S,null,T(R,s=>(p(),f(h,{key:s.brand_id,label:s.brand_name,value:s.brand_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),_("div",Ye,[_("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:e[9]||(e[9]=s=>I(!0))},g(d(t)("refresh")),1),_("span",{class:"cursor-pointer text-primary",onClick:Q},g(d(t)("addBrand")),1)])]),_:1},8,["label"])):w("",!0),o.goods_source=="label"?(p(),f(c,{key:4,label:d(t)("label"),prop:"label_ids"},{default:n(()=>[i(le,{modelValue:o.label_ids,"onUpdate:modelValue":e[10]||(e[10]=s=>o.label_ids=s)},{default:n(()=>[(p(!0),k(S,null,T(U,(s,m)=>(p(),f(te,{label:s.label_id,key:m},{default:n(()=>[V(g(s.label_name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),_("div",We,[_("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:M},g(d(t)("refresh")),1),_("span",{class:"cursor-pointer text-primary",onClick:Y},g(d(t)("addLabel")),1)])]),_:1},8,["label"])):w("",!0),o.goods_source!="goods"?(p(),f(c,{key:5,label:d(t)("showGoodsNum"),prop:"show_goods_num"},{default:n(()=>[i(u,{modelValue:o.show_goods_num,"onUpdate:modelValue":e[11]||(e[11]=s=>o.show_goods_num=s),modelModifiers:{number:!0},clearable:"",placeholder:d(t)("showGoodsNumPlaceholder"),class:"input-width",maxlength:"20","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),i(c,{label:d(t)("sort"),prop:"sort"},{default:n(()=>[i(u,{modelValue:o.sort,"onUpdate:modelValue":e[12]||(e[12]=s=>o.sort=s),modelModifiers:{number:!0},clearable:"",placeholder:d(t)("sortPlaceholder"),class:"input-width",maxlength:"6","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1})),[[re,q.value]]),_("div",Xe,[_("div",Ze,[i(B,{type:"primary",onClick:e[13]||(e[13]=s=>Z())},{default:n(()=>[V(g(d(t)("save")),1)]),_:1}),i(B,{onClick:e[14]||(e[14]=s=>$())},{default:n(()=>[V(g(d(t)("cancel")),1)]),_:1})])])])}}});export{No as default};
