import{d as T,r as c,n as U,l as j,Q as v,h as s,s as D,w as a,e as o,a as m,R as z,i as g,c as p,t as d,F as I,u as x,q as V,B as q,a0 as M,av as P,L as Q,E as $,ac as A,aE as G,ad as H,M as J}from"./index-6f32d09b.js";/* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css               *//* empty css                  */import"./el-form-item-4ed993c7.js";import K from"./coupon-select-popup-10e08d74.js";import{c as W}from"./marketing-5bb2c182.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                  *//* empty css                  */import"./_plugin-vue_export-helper-c27b6911.js";const X={class:"flex items-center"},Y=m("span",{class:"ml-[10px] el-form-item__label"},"送优惠券",-1),Z={class:"flex-1 max-w-[600px]"},ee={key:0,class:"mt-[10px] w-[100%]"},te={key:0},oe={key:1},le={key:0},ae={key:1},ie={key:1},Be=T({__name:"gift-coupon",props:{modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(k,{expose:C,emit:E}){const w=k,R=c(null),e=c({is_use:0,coupon_id:[],coupon_list:{}}),h=c(null),B=U({coupon_id:[{validator:(l,i,n)=>{e.value.is_use&&(e.value.coupon_id.length||n("请输入选择优惠券"),e.value.coupon_id.forEach(r=>{e.value.coupon_list["id_"+r]||n("请输入赠券数量")})),n()}}]}),f=j({get(){return w.modelValue},set(l){E("update:modelValue",l)}}),_=c([]);v(()=>f.value,(l,i)=>{(!i||!Object.keys(i).length)&&Object.keys(l).length&&(e.value=f.value)},{immediate:!0}),v(()=>e.value,()=>{f.value=e.value},{deep:!0}),v(()=>e.value.coupon_id,()=>{e.value.coupon_id.length?W({coupon_id:e.value.coupon_id.toString()}).then(({data:l})=>{_.value=l}):(e.value.coupon_list={},_.value=[])},{deep:!0,immediate:!0});const N=async()=>{var i;let l=!0;return await((i=h.value)==null?void 0:i.validate(n=>{l=n})),l},S=l=>{delete e.value.coupon_list["id_"+l.id],e.value.coupon_id.splice(e.value.coupon_id.indexOf(l.id),1)};return C({verify:N}),(l,i)=>{const n=P,r=Q,b=$,u=A,F=G,L=H,O=J;return s(),D(O,{ref_key:"formRef",ref:h,model:e.value,rules:B},{default:a(()=>[o(r,{label:"",class:"!mb-0"},{default:a(()=>[m("div",X,[o(n,{modelValue:e.value.is_use,"onUpdate:modelValue":i[0]||(i[0]=t=>e.value.is_use=t),label:"","true-label":1,"false-label":0,size:"large",class:"!mr-0"},null,8,["modelValue"]),Y])]),_:1}),z(o(r,{label:"",prop:"coupon_id"},{default:a(()=>[m("div",Z,[m("div",null,[o(K,{modelValue:e.value.coupon_id,"onUpdate:modelValue":i[1]||(i[1]=t=>e.value.coupon_id=t),ref_key:"selectCouponRef",ref:R},{default:a(()=>[o(b,{type:"primary",link:""},{default:a(()=>[g("选择优惠券")]),_:1})]),_:1},8,["modelValue"])]),_.value.length?(s(),p("div",ee,[o(L,{data:_.value,size:"default",ref:"couponListTableRef","max-height":"400"},{default:a(()=>[o(u,{prop:"title",label:"名称","min-width":"130"}),o(u,{prop:"type_name",label:"类型","min-width":"130"}),o(u,{prop:"price",label:"面值","min-width":"130"},{default:a(({row:t})=>[m("span",null,"¥"+d(t.price),1)]),_:1}),o(u,{label:"使用门槛","min-width":"130"},{default:a(({row:t})=>[t.min_condition_money=="0.00"?(s(),p("span",te,"无门槛")):(s(),p("span",oe,"满"+d(t.min_condition_money)+"元可用",1))]),_:1}),o(u,{label:"有效期","min-width":"210"},{default:a(({row:t})=>[t.receive_type==1?(s(),p(I,{key:0},[t.valid_type==1?(s(),p("span",le," 领取之日起"+d(t.length||"")+" 天内有效",1)):(s(),p("span",ae," 使用截止时间至"+d(t.valid_end_time||""),1))],64)):(s(),p("span",ie,"--"))]),_:1}),o(u,{label:"赠券数","min-width":"130"},{default:a(({row:t})=>[o(F,{modelValue:e.value.coupon_list["id_"+t.id],"onUpdate:modelValue":y=>e.value.coupon_list["id_"+t.id]=y,min:1,precision:0,max:t.limit_count,"controls-position":"right",class:"!w-[100px]"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),o(u,{label:x(V)("operation"),align:"right",fixed:"right"},{default:a(({row:t})=>[o(b,{type:"primary",link:"",onClick:y=>S(t)},{default:a(()=>[g(d(x(V)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])])):q("",!0)])]),_:1},512),[[M,e.value.is_use]])]),_:1},8,["model","rules"])}}});export{Be as default};
