import{d as W,l as D,r as S,n as R,h as v,c as b,a as c,b as X,e as s,w as p,i as y,t as i,u as l,q as o,R as w,a0 as E,s as Y,bu as G,a$ as H,U as T,E as J,K as Q,L as Z,M as ee,ab as te,ac as ae,W as le,X as oe,Y as ne}from"./index-6ea097a6.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                     *//* empty css                  */import{g as se}from"./marketing-1b9fc0f4.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";const pe={class:"inline-block ml-[10px] text-[14px]"},re={class:"text-primary mx-[2px]"},de={key:0},ce={key:1},ue={key:0},me={key:1},_e={class:"mt-[16px] flex"},fe={class:"flex items-center flex-1"},ge={class:"layui-table-bottom-left-container mr-[10px]"},he={class:"text-primary mx-[2px]"},ve={class:"dialog-footer"},ye=W({__name:"coupon-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue","couponSelect"],setup(z,{expose:F,emit:V}){const m=z,_=D({get(){return m.modelValue},set(e){V("update:modelValue",e)}}),g=S(!1),r=R({}),f=D(()=>Object.keys(r).length),a=R({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{title:""}}),$=S(),k=S();S([]);const I=(e,t)=>{let d=!1;for(let u=0;u<e.length;u++)if(e[u].id==t.id){d=!0;break}d?r["coupon_"+t.id]=t:delete r["coupon_"+t.id]},L=e=>{e.length?e.forEach(t=>{r["coupon_"+t.id]=t}):a.data.forEach(t=>{delete r["coupon_"+t.id]})},x=(e=1,t=null)=>{a.loading=!0,a.page=e;const d=G(a.searchParam);if(d.select_type=="selected"){const u=[];for(let C in r)u.push(parseInt(C.replace("coupon_","")));d.ids=u}else d.ids="";se({page:a.page,limit:a.limit,...d}).then(u=>{a.loading=!1,a.data=u.data.data,a.total=u.data.total,t&&t(),P()}).catch(()=>{a.loading=!1})},P=()=>{H(()=>{if(k.value)for(let e=0;e<a.data.length;e++)k.value.toggleRowSelection(a.data[e],!1),r["coupon_"+a.data[e].id]&&k.value.toggleRowSelection(a.data[e],!0)})},N=e=>{e&&(e.resetFields(),x())},B=()=>{x(1,()=>{if(_.value){_.value.forEach(e=>{r["coupon_"+e]||(r["coupon_"+e]={})});for(let e=0;e<a.data.length;e++)_.value.indexOf(a.data[e].id)!=-1&&(r["coupon_"+a.data[e].id]=a.data[e])}}),g.value=!0},U=()=>{for(let e in r)delete r[e];P()},j=()=>{if(m.min&&f.value<m.min){T({type:"warning",message:`${o("所选优惠券数量不能少于")}${m.min}${o("张")}`});return}if(m.max&&m.max>0&&f.value&&f.value>m.max){T({type:"warning",message:`${o("所选优惠券数量不能超过")}${m.max}${o("张")}`});return}let e=[];for(let t in r)e.push(parseInt(t.replace("coupon_","")));_.value.splice(0,_.value.length,...e),V("couponSelect",r),g.value=!1};return F({showDialog:g,selectCoupon:r,selectCouponNum:f}),(e,t)=>{const d=J,u=Q,C=Z,A=ee,h=te,M=ae,O=le,q=oe,K=ne;return v(),b("div",null,[c("div",{onClick:B},[X(e.$slots,"default",{},()=>[s(d,null,{default:p(()=>[y(i(l(o)("选择优惠券")),1)]),_:1}),w(c("div",pe,[c("span",null,i(l(o)("已选")),1),c("span",re,i(l(_).length),1),c("span",null,i(l(o)("张")),1)],512),[[E,l(_).length]])],!0)]),s(q,{modelValue:g.value,"onUpdate:modelValue":t[7]||(t[7]=n=>g.value=n),title:l(o)("优惠券选择"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:p(()=>[c("span",ve,[s(d,{onClick:t[6]||(t[6]=n=>g.value=!1)},{default:p(()=>[y(i(l(o)("cancel")),1)]),_:1}),s(d,{type:"primary",onClick:j},{default:p(()=>[y(i(l(o)("confirm")),1)]),_:1})])]),default:p(()=>[s(A,{inline:!0,model:a.searchParam,ref_key:"searchFormRef",ref:$},{default:p(()=>[s(C,{label:l(o)("优惠券名称"),prop:"keyword",class:"form-item-wrap"},{default:p(()=>[s(u,{modelValue:a.searchParam.title,"onUpdate:modelValue":t[0]||(t[0]=n=>a.searchParam.title=n),placeholder:l(o)("请输入优惠券名称"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(C,{class:"form-item-wrap"},{default:p(()=>[s(d,{type:"primary",onClick:t[1]||(t[1]=n=>x())},{default:p(()=>[y(i(l(o)("search")),1)]),_:1}),s(d,{onClick:t[2]||(t[2]=n=>N($.value))},{default:p(()=>[y(i(l(o)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),w((v(),Y(M,{data:a.data,size:"large",ref_key:"couponListTableRef",ref:k,"max-height":"400",onSelect:I,onSelectAll:L},{empty:p(()=>[c("span",null,i(a.loading?"":l(o)("emptyData")),1)]),default:p(()=>[s(h,{type:"selection",width:"55"}),s(h,{prop:"title",label:l(o)("名称"),"min-width":"130"},null,8,["label"]),s(h,{prop:"type_name",label:l(o)("类型"),"min-width":"130"},null,8,["label"]),s(h,{prop:"price",label:l(o)("面值"),"min-width":"130"},{default:p(({row:n})=>[c("span",null,"¥"+i(n.price),1)]),_:1},8,["label"]),s(h,{label:l(o)("使用门槛"),"min-width":"130"},{default:p(({row:n})=>[n.min_condition_money=="0.00"?(v(),b("span",de,"无门槛")):(v(),b("span",ce,"满"+i(n.min_condition_money)+"元可用",1))]),_:1},8,["label"]),s(h,{label:l(o)("有效期"),"min-width":"210"},{default:p(({row:n})=>[n.valid_type==1?(v(),b("span",ue," 领取之日起"+i(n.length||"")+" 天内有效",1)):(v(),b("span",me," 使用截止时间至"+i(n.valid_end_time||""),1))]),_:1},8,["label"])]),_:1},8,["data"])),[[K,a.loading]]),c("div",_e,[c("div",fe,[w(c("div",ge,[c("span",null,i(l(o)("已选择")),1),c("span",he,i(l(f)),1),c("span",null,i(l(o)("张优惠券")),1)],512),[[E,l(f)]]),w(s(d,{type:"primary",link:"",onClick:U},{default:p(()=>[y(i(l(o)("取消选择")),1)]),_:1},512),[[E,l(f)]])]),s(O,{"current-page":a.page,"onUpdate:current-page":t[3]||(t[3]=n=>a.page=n),"page-size":a.limit,"onUpdate:page-size":t[4]||(t[4]=n=>a.limit=n),layout:"total, sizes, prev, pager, next, jumper",total:a.total,onSizeChange:t[5]||(t[5]=n=>x()),onCurrentChange:x},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const Ue=ie(ye,[["__scopeId","data-v-404e9c2d"]]);export{Ue as default};
