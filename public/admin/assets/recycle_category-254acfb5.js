import{d as Z,x as ee,cB as te,r as E,n as U,aK as oe,a$ as ae,a3 as T,f as se,a2 as le,h as x,c as ie,e as l,w as r,a as c,t as f,u as i,i as S,q as n,R as ne,s as R,A as L,j as z,B,a5 as re,E as ce,ay as de,az as pe,ad as _e,J as me,aT as ue,ae as ge,a7 as he,bk as fe,Y as ye,p as ve,g as xe}from"./index-99f00cf3.js";/* empty css                   *//* empty css                        *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                    *//* empty css                  */import{_ as M}from"./category_default-35af358b.js";import{c as be,e as F,d as we}from"./recycle_category-02e95fa2.js";import{_ as Ce}from"./recycle-category-edit.vue_vue_type_style_index_0_lang-321d7c8e.js";import{S as ke}from"./sortable.esm-be94e56d.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                   *//* empty css                */import"./index-015c0c3e.js";import"./index.vue_vue_type_style_index_0_lang-2e54ab99.js";import"./attachment-6fc096d0.js";import"./index.vue_vue_type_script_setup_true_lang-a59c79e6.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-bde8c802.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-49ab6f2c.js";const $=b=>(ve("data-v-c14113f6"),b=b(),xe(),b),Ee={class:"main-container"},Te={class:"flex justify-between items-center mb-[5px]"},Re={class:"text-page-title"},Ve={class:"mt-[10px]"},De=$(()=>c("i",{class:"order-0 iconfont icontuodong vues-rank mr-[8px]"},null,-1)),Se={class:"order-2"},Be={class:"h-[30px]"},$e=$(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:M})],-1)),Ne={class:"h-[30px]"},je=$(()=>c("div",{class:"image-slot"},[c("img",{class:"w-[30px] h-[30px]",src:M})],-1)),Ue=Z({__name:"recycle_category",setup(b){const P=ee().meta.title,N=te();E("");const s=U({loading:!0,data:[]});oe(()=>{ae(()=>{q()}),V()});const _=E([]),q=()=>{const t=N.value.$el.querySelector(".el-table__body-wrapper tbody");ke.create(t,{handle:".vues-rank",animation:300,onMove:({dragged:o,related:d})=>{const m=_.value[o.rowIndex],u=_.value[d.rowIndex];if(m.pid!==u.pid)return!1},onStart:()=>{_.value=A(T(s.data))},onEnd:o=>{var I;const d=_.value[o.oldIndex],m=_.value[o.newIndex];if(o.oldIndex===o.newIndex||d.pid!==m.pid||_.value.indexOf(d)<0)return!1;const a=_.value.splice(o.oldIndex,1)[0];_.value.splice(o.newIndex,0,a);const C=m.pid,k=(I=_.value.filter(p=>p.pid===C))==null?void 0:I.map((p,v)=>{if(p.level===1&&p.category_id===a.category_id&&(s.data=s.data.filter(g=>g.category_id!==a.category_id),s.data.splice(v,0,a)),p.level===2&&p.category_id===a.category_id){const g=s.data.findIndex(e=>e.category_id===p.pid),D=T(s.data[g].child_list.filter(e=>e.category_id!==a.category_id));s.data[g].child_list=[],s.data[g].child_list.push(...D),s.data[g].child_list.splice(v,0,a)}return{category_id:p.category_id,sort:9999-v}});G({category_sort_array:k})}})},A=(t,o="child_list")=>{const d=[],m=u=>{u&&u.length>0&&u.filter(a=>a).forEach(a=>{d.push(a),m(a[o]||[])})};return m(t),d},V=()=>{s.loading=!0,be().then(t=>{s.loading=!1,s.data=t.data}).catch(()=>{s.loading=!1})},G=t=>{updateCategory(t).then(o=>{})},w=U({show:!1,index:0}),j=E([]),J=t=>{w.show=!0,j.value=[t.images]},K=t=>{const o=T(t);delete o.child_list,F(o)},O=t=>{const o=T(t);delete o.child_list,F(o)},y=E(null),Y=()=>{y.value.setFormData(),y.value.showDialog=!0},H=t=>{y.value.setFormData(t),y.value.showDialog=!0},Q=t=>{re.confirm(!t.child_list||!t.child_list.length?n("categoryDeleteTips"):n("categoryDeleteTips1"),n("warning"),{confirmButtonText:n("confirm"),cancelButtonText:n("cancel"),type:"warning"}).then(()=>{we(t.category_id).then(()=>{V()}).catch(()=>{})})},W=se(),X=t=>{W.push({path:t})};return(t,o)=>{const d=ce,m=de,u=pe,a=_e,C=me,k=ue,I=ge,p=he,v=le("goods-category-spread-popup"),g=fe,D=ye;return x(),ie("div",Ee,[l(p,{class:"box-card !border-none",shadow:"never"},{default:r(()=>[c("div",Te,[c("span",Re,f(i(P)),1),l(d,{type:"primary",onClick:Y},{default:r(()=>[S(f(i(n)("addCategory")),1)]),_:1})]),l(u,{class:"demo-tabs","model-value":"/phone_shop_price/goods/category",onTabChange:X},{default:r(()=>[l(m,{label:i(n)("tabGoodsCategory"),name:"/phone_shop_price/goods/category"},null,8,["label"])]),_:1}),c("div",Ve,[ne((x(),R(I,{data:s.data,ref_key:"tableRef",ref:N,size:"large","row-key":"category_id","tree-props":{hasChildren:"hasChildren",children:"child_list"}},{empty:r(()=>[c("span",null,f(s.loading?"":i(n)("emptyData")),1)]),default:r(()=>[l(a,{label:i(n)("categoryName"),"min-width":"120"},{default:r(({row:e})=>[De,c("span",Se,f(e.category_name),1)]),_:1},8,["label"]),l(a,{label:i(n)("image"),width:"170",align:"left"},{default:r(({row:e})=>[c("div",Be,[l(C,{class:"w-[30px] h-[30px]",src:i(L)(e.image),fit:"contain"},{error:r(()=>[$e]),_:2},1032,["src"])])]),_:1},8,["label"]),l(a,{prop:"is_show",label:i(n)("是否显示")},{default:r(({row:e})=>[l(k,{modelValue:e.is_show,"onUpdate:modelValue":h=>e.is_show=h,"active-value":1,"inactive-value":0,onChange:h=>K(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),l(a,{prop:"need_vip",label:i(n)("是否需要VIP")},{default:r(({row:e})=>[l(k,{modelValue:e.need_vip,"onUpdate:modelValue":h=>e.need_vip=h,"active-value":1,"inactive-value":0,onChange:h=>O(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),l(a,{label:i(n)("报价"),width:"170",align:"left"},{default:r(({row:e})=>[c("div",Ne,[l(C,{class:"w-[30px] h-[30px]",onClick:h=>J(e),src:i(L)(e.images),fit:"contain"},{error:r(()=>[je]),_:2},1032,["onClick","src"])])]),_:1},8,["label"]),l(a,{label:i(n)("operation"),fixed:"right",align:"right",width:"200"},{default:r(({row:e})=>[i(z)().siteInfo.site_id==e.site_id?(x(),R(d,{key:0,type:"primary",link:"",onClick:h=>H(e)},{default:r(()=>[S(f(i(n)("edit")),1)]),_:2},1032,["onClick"])):B("",!0),i(z)().siteInfo.site_id==e.site_id?(x(),R(d,{key:1,type:"primary",link:"",onClick:h=>Q(e)},{default:r(()=>[S(f(i(n)("delete")),1)]),_:2},1032,["onClick"])):B("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[D,s.loading]])]),l(Ce,{ref_key:"editCategoryDialog",ref:y,onComplete:V},null,512)]),_:1}),l(v,{ref:"goodsCategorySpreadPopupRef"},null,512),w.show?(x(),R(g,{key:0,"url-list":j.value,onClose:o[0]||(o[0]=e=>w.show=!1),"initial-index":w.index,"zoom-rate":1},null,8,["url-list","initial-index"])):B("",!0)])}}});const kt=Ie(Ue,[["__scopeId","data-v-c14113f6"]]);export{kt as default};
