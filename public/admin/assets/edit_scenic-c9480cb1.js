import{d as Z,x as ee,f as le,r as j,n as S,aK as te,co as ae,l as oe,q as n,h as p,c as h,e as o,w as i,u as s,F as x,T as M,s as P,a as f,t as y,i as U,cT as ne,cP as N,cU as se,Q as ie,cV as de,U as B,aR as re,a7 as ce,K as ue,L as me,ac as pe,aD as _e,E as fe,M as ve,p as be,g as ge}from"./index-99f00cf3.js";/* empty css                */import{_ as he}from"./index.vue_vue_type_script_setup_true_lang-2f14504d.js";/* empty css                  */import ye from"./index-015c0c3e.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                   *//* empty css                       */import{M as Ve,N as we,O as ke}from"./tourism-22ca545e.js";import{j as xe}from"./poster-a2e7062d.js";import{_ as Me}from"./_plugin-vue_export-helper-c27b6911.js";import"./index.vue_vue_type_style_index_0_lang-2e54ab99.js";/* empty css                  *//* empty css                   */import"./attachment-6fc096d0.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-a59c79e6.js";/* empty css                        *//* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-bde8c802.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-49ab6f2c.js";import"./sortable.esm-be94e56d.js";const Pe=V=>(be("data-v-542bf0a6"),V=V(),ge(),V),Ce={class:"main-container"},Le={class:"ml-[10px]"},Se=Pe(()=>f("div",{id:"TxMap",class:"w-[800px] h-[500px]"},null,-1)),Ue={class:"fixed-footer-wrap"},Ee={class:"fixed-footer"},Te=Z({__name:"edit_scenic",setup(V){const R=ee(),E=le(),w=parseInt(R.query.id),k=j(!1),_=S({province:[],city:[],district:[]});(()=>{ne(1).then(t=>{_.province=t.data})})();const T=t=>{Object.keys(t).length==0?t.id=e.province_id:(e.province_id=t.id,e.province_name=t.name),N(t.id).then(l=>{_.city=l.data})},A=t=>{Object.keys(t).length==0?t.id=e.city_id:(e.city_id=t.id,e.city_name=t.name),N(t.id).then(l=>{_.district=l.data})},G=t=>{e.district_id=t.id,e.district_name=t.name},$=()=>{e.province_id&&e.city_id&&e.district_id&&e.address&&se({address:e.province_name+e.city_name+e.district_name+e.address}).then(t=>{e.latitude=t.data.result.location.lat,e.longitude=t.data.result.location.lng})};let v=null;const z=()=>{let t=e.latitude,l=e.longitude;e.latitude==0&&(t="39.90469"),e.longitude==0&&(l="116.40717");const d=new window.TMap.LatLng(t,l);v=new window.TMap.Map("TxMap",{center:d,zoom:17,viewMode:"2D",showControl:!0}),v.on("click",m=>{const r={lat:m.latLng.getLat().toFixed(6),lng:m.latLng.getLng().toFixed(6)};K(r.lat,r.lng,1),u.updateGeometries({id:"shop",position:m.latLng})});const u=new window.TMap.MultiMarker({id:"marker-layer",map:v,minimumClusterSize:1});u.updateGeometries({id:"shop",position:d}),v.on("idle",()=>{ie(()=>e.latitude,(m,r)=>{const c=new window.TMap.LatLng(e.latitude,e.longitude);v.panTo(c,1),u.updateGeometries({id:"shop",position:c})})})};te(()=>{const t=document.createElement("script");ae().then(l=>{t.type="text/javascript",t.src="https://map.qq.com/api/gljs?v=1.exp&key="+l.data.key,document.body.appendChild(t)}),t.onload=()=>{setTimeout(()=>{z()},500)}});const K=(t,l,d)=>{de({location:t+","+l}).then(u=>{u.data.result?(e.province_name=u.data.result.address_component.province,e.city_name=u.data.result.address_component.city,e.district_name=u.data.result.address_component.district,d==1&&(e.address=u.data.result.formatted_addresses.recommend,e.full_address=e.province_name+e.city_name+e.district_name+e.address,e.latitude=t,e.longitude=l)):B({type:"warning",message:u.data.message})})},F={scenic_id:0,scenic_name:"",latitude:0,longitude:0,province_id:0,province_name:"",city_id:0,city_name:"",district_id:0,district_name:"",address:"",scenic_level:"",open_time:"",telephone:"",scenic_desc:"",surround:"",scenic_cover:"",scenic_images:"",full_address:"",poster_id:""},e=S({...F});w&&(async(t=0)=>{Object.assign(e,F);const l=await(await Ve(t)).data;Object.keys(e).forEach(d=>{l[d]!=null&&(e[d]=l[d])}),e.province_id>0&&T({}),e.city_id>0&&A({})})(w);const I=j(),H=oe(()=>({scenic_name:[{required:!0,message:n("scenicNamePlaceholder"),trigger:"blur"}],scenic_level:[{required:!0,message:n("scenicLevelPlaceholder"),trigger:"blur"}],scenic_cover:[{required:!0,message:n("scenicCoverPlaceholder"),trigger:"blur"}],addressId:[{required:!0,validator:Q,trigger:"blur"}]})),Q=(t,l,d)=>{(e.province_name==""||e.city_name==""||e.district_name=="")&&d(new Error(n("addressPlaceholder"))),d()},J=async t=>{k.value||!t||await t.validate(async l=>{l&&(k.value=!0,(w?we:ke)(e).then(m=>{k.value=!1,history.back()}).catch(()=>{k.value=!1}))})},C=S([]),W=()=>{const t=E.resolve({path:"/poster/list"});window.open(t.href)},D=(t=!1)=>{xe({type:"tourism_scenic"}).then(l=>{const d=l.data;d&&(C.splice(0,C.length,...d),t&&B({message:n("refreshSuccess"),type:"success"}))})};D();const X=()=>{history.back()};return(t,l)=>{const d=re,u=ce,m=ue,r=me,c=pe,b=_e,q=ye,L=fe,O=he,Y=ve;return p(),h("div",Ce,[o(u,{class:"card !border-none mb-[15px]",shadow:"never"},{default:i(()=>[o(d,{content:s(w)?s(n)("editScenic"):s(n)("addScenic"),icon:t.ArrowLeft,onClick:l[0]||(l[0]=a=>s(E).push({path:"/tourism/product/scenic/scenic"}))},null,8,["content","icon"])]),_:1}),o(u,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[o(Y,{model:e,"label-width":"90px",ref_key:"formRef",ref:I,rules:s(H),class:"page-form"},{default:i(()=>[o(r,{label:s(n)("scenicName"),prop:"scenic_name"},{default:i(()=>[o(m,{modelValue:e.scenic_name,"onUpdate:modelValue":l[1]||(l[1]=a=>e.scenic_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:s(n)("scenicNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(r,{label:s(n)("scenicLevel"),prop:"scenic_level"},{default:i(()=>[o(b,{modelValue:e.scenic_level,"onUpdate:modelValue":l[2]||(l[2]=a=>e.scenic_level=a),clearable:"",class:"input-width"},{default:i(()=>[o(c,{label:s(n)("oneStar"),value:1},null,8,["label"]),o(c,{label:s(n)("twoStar"),value:2},null,8,["label"]),o(c,{label:s(n)("threeStar"),value:3},null,8,["label"]),o(c,{label:s(n)("fourStar"),value:4},null,8,["label"]),o(c,{label:s(n)("fiveStar"),value:5},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(r,{label:s(n)("openTime"),class:"input-width"},{default:i(()=>[o(m,{modelValue:e.open_time,"onUpdate:modelValue":l[3]||(l[3]=a=>e.open_time=a),modelModifiers:{trim:!0},clearable:"",placeholder:s(n)("openTimePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(r,{label:s(n)("telephone")},{default:i(()=>[o(m,{modelValue:e.telephone,"onUpdate:modelValue":l[4]||(l[4]=a=>e.telephone=a),modelModifiers:{trim:!0},clearable:"",placeholder:s(n)("telephonePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(r,{label:s(n)("scenicCover"),prop:"scenic_cover"},{default:i(()=>[o(q,{modelValue:e.scenic_cover,"onUpdate:modelValue":l[5]||(l[5]=a=>e.scenic_cover=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(r,{label:s(n)("scenicImgs"),prop:"scenic_images"},{default:i(()=>[o(q,{modelValue:e.scenic_images,"onUpdate:modelValue":l[6]||(l[6]=a=>e.scenic_images=a),limit:"10"},null,8,["modelValue"])]),_:1},8,["label"]),o(r,{label:s(n)("poster")},{default:i(()=>[o(b,{modelValue:e.poster_id,"onUpdate:modelValue":l[7]||(l[7]=a=>e.poster_id=a),placeholder:s(n)("posterPlaceholder"),clearable:""},{default:i(()=>[(p(!0),h(x,null,M(C,a=>(p(),P(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),f("div",Le,[f("span",{class:"cursor-pointer text-primary mr-[10px]",onClick:l[8]||(l[8]=a=>D(!0))},y(s(n)("refresh")),1),f("span",{class:"cursor-pointer text-primary",onClick:W},y(s(n)("addGoodsPoster")),1)])]),_:1},8,["label"]),o(r,{label:s(n)("address"),prop:"addressId"},{default:i(()=>[o(b,{modelValue:e.province_name,"onUpdate:modelValue":l[9]||(l[9]=a=>e.province_name=a),"value-key":"name",clearable:"",class:"input-width",onChange:T},{default:i(()=>[o(c,{label:s(n)("provincePlaceholder"),value:""},null,8,["label"]),(p(!0),h(x,null,M(_.province,(a,g)=>(p(),P(c,{key:g,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(b,{modelValue:e.city_name,"onUpdate:modelValue":l[10]||(l[10]=a=>e.city_name=a),"value-key":"id",clearable:"",class:"input-width ml-3",onChange:A},{default:i(()=>[o(c,{label:s(n)("cityPlaceholder"),value:""},null,8,["label"]),(p(!0),h(x,null,M(_.city,(a,g)=>(p(),P(c,{key:g,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(b,{modelValue:e.district_name,"onUpdate:modelValue":l[11]||(l[11]=a=>e.district_name=a),"value-key":"id",clearable:"",class:"input-width ml-3",onChange:G},{default:i(()=>[o(c,{label:s(n)("districtPlaceholder"),value:""},null,8,["label"]),(p(!0),h(x,null,M(_.district,(a,g)=>(p(),P(c,{key:g,label:a.name,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(r,{label:s(n)("detailAddress"),prop:"address"},{default:i(()=>[o(m,{modelValue:e.address,"onUpdate:modelValue":l[12]||(l[12]=a=>e.address=a),modelModifiers:{trim:!0},clearable:"",placeholder:s(n)("detailAddressPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),o(L,{class:"ml-3",onClick:$},{default:i(()=>[U(y(s(n)("search")),1)]),_:1})]),_:1},8,["label"]),o(r,null,{default:i(()=>[Se]),_:1}),o(r,{label:s(n)("scenicDesc")},{default:i(()=>[o(O,{modelValue:e.scenic_desc,"onUpdate:modelValue":l[13]||(l[13]=a=>e.scenic_desc=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(r,{label:s(n)("surround")},{default:i(()=>[o(O,{modelValue:e.surround,"onUpdate:modelValue":l[14]||(l[14]=a=>e.surround=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1}),f("div",Ue,[f("div",Ee,[o(L,{type:"primary",onClick:l[15]||(l[15]=a=>J(I.value))},{default:i(()=>[U(y(s(n)("save")),1)]),_:1}),o(L,{onClick:l[16]||(l[16]=a=>X())},{default:i(()=>[U(y(s(n)("cancel")),1)]),_:1})])])])}}});const hl=Me(Te,[["__scopeId","data-v-542bf0a6"]]);export{hl as default};
