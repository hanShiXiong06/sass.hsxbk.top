import{d as J,x as z,cA as O,n as Y,aJ as H,a$ as K,r as T,a3 as I,f as Q,h as S,c as U,e as a,w as r,a as m,t as u,u as i,i as v,q as s,R as W,s as X,A as Z,a5 as ee,E as te,ax as oe,ay as ae,ac as se,J as le,ak as ne,ad as re,a7 as ie,Y as ce,p as de,g as pe}from"./index-37fee5a0.js";/* empty css                   *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                        *//* empty css                        *//* empty css                    *//* empty css                  */import{_ as _e}from"./category_default-57987dd3.js";import{g as me,u as ge,r as ue,s as fe}from"./goods-26f79dea.js";import{_ as he}from"./category-edit.vue_vue_type_style_index_0_lang-bbf0596d.js";import{_ as ye}from"./goods-category-spread-popup.vue_vue_type_script_setup_true_lang-1b20fef8.js";import{S as ve}from"./sortable.esm-be94e56d.js";import{_ as be}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                  *//* empty css                   *//* empty css                *//* empty css                  */import"./index-75241224.js";import"./index.vue_vue_type_style_index_0_lang-9e528ade.js";import"./attachment-78567e2f.js";import"./index.vue_vue_type_script_setup_true_lang-1f515813.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-a7856b99.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-165de32d.js";import"./browser-a1ac24ac.js";const B=b=>(de("data-v-12cd5637"),b=b(),pe(),b),xe={class:"main-container"},we={class:"flex justify-between items-center mb-[5px]"},Ce={class:"text-page-title"},ke={class:"mt-[10px]"},Ee=B(()=>m("i",{class:"order-0 iconfont icontuodong vues-rank mr-[8px]"},null,-1)),Te={class:"order-2"},Ie={class:"h-[30px]"},Re=B(()=>m("div",{class:"image-slot"},[m("img",{class:"w-[30px] h-[30px]",src:_e})],-1)),De=J({__name:"category",setup(b){const $=z().meta.title,R=O(),l=Y({loading:!0,data:[]});H(()=>{K(()=>{N()}),x()});const _=T([]),N=()=>{const e=R.value.$el.querySelector(".el-table__body-wrapper tbody");ve.create(e,{handle:".vues-rank",animation:300,onMove:({dragged:n,related:c})=>{const d=_.value[n.rowIndex],g=_.value[c.rowIndex];if(d.pid!==g.pid)return!1},onStart:()=>{_.value=j(I(l.data))},onEnd:n=>{var w;const c=_.value[n.oldIndex],d=_.value[n.newIndex];if(n.oldIndex===n.newIndex||c.pid!==d.pid||_.value.indexOf(c)<0)return!1;const t=_.value.splice(n.oldIndex,1)[0];_.value.splice(n.newIndex,0,t);const C=d.pid,k=(w=_.value.filter(p=>p.pid===C))==null?void 0:w.map((p,h)=>{if(p.level===1&&p.category_id===t.category_id&&(l.data=l.data.filter(o=>o.category_id!==t.category_id),l.data.splice(h,0,t)),p.level===2&&p.category_id===t.category_id){const o=l.data.findIndex(E=>E.category_id===p.pid),y=I(l.data[o].child_list.filter(E=>E.category_id!==t.category_id));l.data[o].child_list=[],l.data[o].child_list.push(...y),l.data[o].child_list.splice(h,0,t)}return{category_id:p.category_id,sort:9999-h}});F({category_sort_array:k})}})},j=(e,n="child_list")=>{const c=[],d=g=>{g&&g.length>0&&g.filter(t=>t).forEach(t=>{c.push(t),d(t[n]||[])})};return d(e),c},x=()=>{l.loading=!0,me().then(e=>{l.loading=!1,l.data=e.data}).catch(()=>{l.loading=!1})},F=e=>{ge(e).then(n=>{x()})},G=e=>{e.is_show=e.is_show===1?2:1;const n=I(e);delete n.child_list,ue(n)},f=T(null),L=()=>{f.value.setFormData(),f.value.showDialog=!0},M=e=>{f.value.setFormData(e),f.value.showDialog=!0},P=e=>{ee.confirm(!e.child_list||!e.child_list.length?s("categoryDeleteTips"):s("categoryDeleteTips1"),s("warning"),{confirmButtonText:s("confirm"),cancelButtonText:s("cancel"),type:"warning"}).then(()=>{fe(e.category_id).then(()=>{x()}).catch(()=>{})})},D=T(null),V=e=>{D.value.show(e)},q=Q(),A=e=>{q.push({path:e})};return(e,n)=>{const c=te,d=oe,g=ae,t=se,C=le,k=ne,w=re,p=ie,h=ce;return S(),U("div",xe,[a(p,{class:"box-card !border-none",shadow:"never"},{default:r(()=>[m("div",we,[m("span",Ce,u(i($)),1),a(c,{type:"primary",onClick:L},{default:r(()=>[v(u(i(s)("addCategory")),1)]),_:1})]),a(g,{class:"demo-tabs","model-value":"/shop/goods/category",onTabChange:A},{default:r(()=>[a(d,{label:i(s)("tabGoodsCategory"),name:"/shop/goods/category"},null,8,["label"]),a(d,{label:i(s)("tabGoodsCategoryConfig"),name:"/shop/goods/category/config"},null,8,["label"])]),_:1}),m("div",ke,[W((S(),X(w,{data:l.data,ref_key:"tableRef",ref:R,size:"large","row-key":"category_id","tree-props":{hasChildren:"hasChildren",children:"child_list"}},{empty:r(()=>[m("span",null,u(l.loading?"":i(s)("emptyData")),1)]),default:r(()=>[a(t,{label:i(s)("categoryName"),"min-width":"120"},{default:r(({row:o})=>[Ee,m("span",Te,u(o.category_name),1)]),_:1},8,["label"]),a(t,{label:i(s)("image"),width:"170",align:"left"},{default:r(({row:o})=>[m("div",Ie,[a(C,{class:"w-[30px] h-[30px]",src:i(Z)(o.image),fit:"contain"},{error:r(()=>[Re]),_:2},1032,["src"])])]),_:1},8,["label"]),a(t,{prop:"is_show",label:i(s)("isShow"),width:"400"},{default:r(({row:o})=>[a(k,{class:"cursor-pointer",type:o.is_show!=2?"success":"danger",onClick:y=>G(o)},{default:r(()=>[v(u(o.is_show!=2?"是":"否"),1)]),_:2},1032,["type","onClick"])]),_:1},8,["label"]),a(t,{prop:"sort",label:i(s)("sort"),width:"120"},null,8,["label"]),a(t,{label:i(s)("operation"),fixed:"right",align:"right",width:"200"},{default:r(({row:o})=>[a(c,{type:"primary",link:"",onClick:y=>V(o)},{default:r(()=>[v(u(i(s)("spreadGoodsCategory")),1)]),_:2},1032,["onClick"]),a(c,{type:"primary",link:"",onClick:y=>M(o)},{default:r(()=>[v(u(i(s)("edit")),1)]),_:2},1032,["onClick"]),a(c,{type:"primary",link:"",onClick:y=>P(o)},{default:r(()=>[v(u(i(s)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[h,l.loading]])]),a(he,{ref_key:"editCategoryDialog",ref:f,onComplete:x},null,512)]),_:1}),a(ye,{ref_key:"goodsCategorySpreadPopupRef",ref:D},null,512)])}}});const vt=be(De,[["__scopeId","data-v-12cd5637"]]);export{vt as default};
