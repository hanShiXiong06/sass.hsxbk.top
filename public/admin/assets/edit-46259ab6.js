import{d as te,x as ie,r as c,n as S,l as ne,q as i,h as g,c as T,a as _,e as a,w as t,u as n,b_ as R,i as m,F as L,T as q,s as v,t as y,C as re,R as se,a$ as de,a3 as me,aQ as ue,a7 as pe,K as ge,L as ce,at as _e,au as be,ab as fe,aC as ve,ak as he,E as Ve,M as we,ac as xe,ad as ye,W as ke,X as Ee,Y as Pe}from"./index-6f32d09b.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                  *//* empty css                       *//* empty css                 */import Ce from"./index-4df26bee.js";import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                   *//* empty css                       */import{b as Te,c as Le,d as Ue,f as Fe,h as Re}from"./technician-58e7674a.js";import{k as qe}from"./goods-1bc81d7b.js";import{_ as Be}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-972988e5.js";import"./attachment-503e95ee.js";import"./index.vue_vue_type_script_setup_true_lang-bee7eaa7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-ad575143.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-0724e2f9.js";import"./sortable.esm-be94e56d.js";const De={class:"main-container"},Me={class:"!w-[200px] border-[1px] border-[#e4e4e4] border-solid px-[11px] h-[30px]"},je={class:"fixed-footer-wrap"},ze={class:"fixed-footer"},Ie={class:"mt-[16px] flex justify-end"},Ke=te({__name:"edit",setup(Ne){const G=ie(),h=parseInt(G.query.id),k=c(!1),B={id:h??"",name:"",headimg:"",age:"",sex:1,mobile:"",working_age:"",status:"1",position_id:"",position_name:"",label:[],goods_ids:[],member_nickname:"",member_id:"",images:"",desc:""},o=S({...B}),U=c(!1),V=c(""),D=c(),O=s=>{o.label.splice(o.label.indexOf(s),1)},A=()=>{U.value=!0,de(()=>{D.value.input.focus()})},M=()=>{V.value&&o.label.push(V.value),U.value=!1,V.value=""};h&&(async(s=0)=>{Object.assign(o,B);const e=await(await Te(s)).data;Object.keys(o).forEach(r=>{e[r]!=null&&(o[r]=e[r]),e[r]!=null&&r=="label"&&(e[r]!=""?o[r]=e[r].split(","):o[r]=[])}),o.member_nickname=e.member.nickname,e.goods.length&&(o.goods_ids=e.goods.map(r=>r.goods_id))})(h);const E=c([]);(()=>{Le().then(s=>{E.value=s.data})})();const j=c([]);(()=>{qe().then(s=>{j.value=s.data})})();const d=S({page:1,limit:10,total:0,loading:!1,data:[]}),F=(s=1)=>{d.loading=!0,d.page=s,Ue({page:d.page,limit:d.limit}).then(e=>{d.loading=!1,d.total=e.data.total,d.data=e.data.data})};F();const P=c(!1),H=s=>{o.member_id=s.member_id,o.member_nickname=s.nickname,P.value=!1},z=c(),Q=(s,e,r)=>{const w=/^1[3456789]\d{9}$/;return e?w.test(e)?r():r(new Error("联系电话格式不正确")):r(new Error("请输入联系电话"))},W=ne(()=>({name:[{required:!0,message:i("technicianNamePlaceholder"),trigger:"blur"}],headimg:[{required:!0,message:i("headimgPlaceholder"),trigger:"change"}],age:[{required:!0,message:i("agePlaceholder"),trigger:"blur"}],position_name:[{required:!0,message:i("positionPlaceholder"),trigger:"change"}],working_age:[{required:!0,message:i("seniorityPlaceholder"),trigger:"blur"}],mobile:[{required:!0,validator:Q,trigger:"blur"}],goods_ids:[{required:!0,message:i("projectPlaceholder"),trigger:"change"}],member_id:[{required:!0,message:i("memberPlaceholder"),trigger:"blur"}]})),X=async s=>{k.value||!s||await s.validate(async e=>{if(e){k.value=!0,E.value.length>0&&E.value.forEach(p=>{(p.id=o.position_id)&&(o.position_name=p.name)});const r=me(o);r.label=r.label.join(","),r.goods_ids=r.goods_ids.toString(),(h?Fe:Re)(r).then(p=>{k.value=!1,history.back()}).catch(()=>{k.value=!1})}})},I=()=>{history.back()};return(s,e)=>{const r=ue,w=pe,p=ge,u=ce,Y=Ce,b=_e,K=be,N=fe,$=ve,J=he,x=Ve,Z=we,C=xe,ee=ye,le=ke,ae=Ee,oe=Pe;return g(),T(L,null,[_("div",De,[a(w,{class:"card !border-none mb-[15px]",shadow:"never"},{default:t(()=>[a(r,{content:n(h)?n(i)("editTechnician"):n(i)("addTechnician"),icon:s.ArrowLeft,onBack:I},null,8,["content","icon"])]),_:1}),a(w,{class:"box-card !border-none",shadow:"never"},{default:t(()=>[a(Z,{model:o,"label-width":"90px",ref_key:"formRef",ref:z,rules:n(W),class:"page-form"},{default:t(()=>[a(u,{label:n(i)("technicianName"),prop:"name"},{default:t(()=>[a(p,{modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.name=l),modelModifiers:{trim:!0},clearable:"",placeholder:n(i)("technicianNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:n(i)("headimg"),prop:"headimg"},{default:t(()=>[a(Y,{modelValue:o.headimg,"onUpdate:modelValue":e[1]||(e[1]=l=>o.headimg=l)},null,8,["modelValue"])]),_:1},8,["label"]),a(u,{label:n(i)("age"),prop:"age"},{default:t(()=>[a(p,{modelValue:o.age,"onUpdate:modelValue":e[2]||(e[2]=l=>o.age=l),modelModifiers:{trim:!0},placeholder:n(i)("agePlaceholder"),onKeyup:e[3]||(e[3]=l=>n(R)(l)),class:"input-width",onBlur:e[4]||(e[4]=l=>o.age=l.target.value),maxlength:"8"},{append:t(()=>[m("岁")]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:n(i)("sex")},{default:t(()=>[a(K,{modelValue:o.sex,"onUpdate:modelValue":e[5]||(e[5]=l=>o.sex=l)},{default:t(()=>[a(b,{label:1},{default:t(()=>[m("男")]),_:1}),a(b,{label:2},{default:t(()=>[m("女")]),_:1}),a(b,{label:0},{default:t(()=>[m("保密")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(u,{label:n(i)("mobile"),prop:"mobile"},{default:t(()=>[a(p,{modelValue:o.mobile,"onUpdate:modelValue":e[6]||(e[6]=l=>o.mobile=l),modelModifiers:{trim:!0},clearable:"",placeholder:n(i)("mobilePlaceholder"),onKeyup:e[7]||(e[7]=l=>n(R)(l)),class:"input-width",onBlur:e[8]||(e[8]=l=>o.mobile=l.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:n(i)("seniority"),prop:"working_age"},{default:t(()=>[a(p,{modelValue:o.working_age,"onUpdate:modelValue":e[9]||(e[9]=l=>o.working_age=l),modelModifiers:{trim:!0},placeholder:n(i)("seniorityPlaceholder"),onKeyup:e[10]||(e[10]=l=>n(R)(l)),class:"input-width",onBlur:e[11]||(e[11]=l=>o.working_age=l.target.value)},{append:t(()=>[m("年")]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:n(i)("status")},{default:t(()=>[a(K,{modelValue:o.status,"onUpdate:modelValue":e[12]||(e[12]=l=>o.status=l)},{default:t(()=>[a(b,{label:"1"},{default:t(()=>[m("在职")]),_:1}),a(b,{label:"-1"},{default:t(()=>[m("离职")]),_:1}),a(b,{label:"0"},{default:t(()=>[m("休息中")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(u,{label:n(i)("position"),prop:"position"},{default:t(()=>[a($,{modelValue:o.position_id,"onUpdate:modelValue":e[13]||(e[13]=l=>o.position_id=l),"value-key":"id",placeholder:n(i)("positionPlaceholder"),class:"input-width"},{default:t(()=>[(g(!0),T(L,null,q(E.value,(l,f)=>(g(),v(N,{key:f,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:n(i)("label")},{default:t(()=>[_("div",null,[(g(!0),T(L,null,q(o.label,(l,f)=>(g(),v(J,{key:f,class:"mx-1",closable:"","disable-transitions":!1,onClose:Oe=>O(l)},{default:t(()=>[m(y(l),1)]),_:2},1032,["onClose"]))),128)),U.value?(g(),v(p,{key:0,ref_key:"InputRef",ref:D,modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=l=>V.value=l),modelModifiers:{trim:!0},class:"ml-1 !w-20",size:"small",onKeyup:re(M,["enter"]),onBlur:M},null,8,["modelValue","onKeyup"])):(g(),v(x,{key:1,class:"button-new-tag ml-1",size:"small",onClick:A},{default:t(()=>[m(" 新增标签 ")]),_:1}))])]),_:1},8,["label"]),a(u,{label:n(i)("project"),prop:"goods_ids"},{default:t(()=>[a($,{modelValue:o.goods_ids,"onUpdate:modelValue":e[15]||(e[15]=l=>o.goods_ids=l),multiple:"",placeholder:n(i)("projectPlaceholder"),class:"input-width"},{default:t(()=>[(g(!0),T(L,null,q(j.value,(l,f)=>(g(),v(N,{label:l.goods_name,value:l.goods_id,key:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:n(i)("member"),prop:"member_id"},{default:t(()=>[_("div",Me,y(o.member_nickname),1),a(x,{class:"ml-[10px]",type:"primary",onClick:e[16]||(e[16]=l=>P.value=!0)},{default:t(()=>[m("选择会员")]),_:1})]),_:1},8,["label"]),a(u,{label:n(i)("desc"),prop:"desc"},{default:t(()=>[a(p,{modelValue:o.desc,"onUpdate:modelValue":e[17]||(e[17]=l=>o.desc=l),modelModifiers:{trim:!0},autosize:{minRows:2,maxRows:4},type:"textarea",clearable:"",placeholder:n(i)("labelPlaceholder"),class:"input-width",maxlength:"200"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1}),_("div",je,[_("div",ze,[a(x,{type:"primary",onClick:e[18]||(e[18]=l=>X(z.value))},{default:t(()=>[m(y(n(i)("save")),1)]),_:1}),a(x,{onClick:e[19]||(e[19]=l=>I())},{default:t(()=>[m(y(n(i)("cancel")),1)]),_:1})])])]),a(ae,{modelValue:P.value,"onUpdate:modelValue":e[22]||(e[22]=l=>P.value=l),title:"请选择会员",width:"600px"},{default:t(()=>[se((g(),v(ee,{data:d.data,class:"member-table"},{empty:t(()=>[_("span",null,y(d.loading?"":n(i)("emptyData")),1)]),default:t(()=>[a(C,{prop:"nickname",label:"昵称",width:"180"}),a(C,{prop:"username",label:"用户名"}),a(C,{prop:"mobile",label:"手机号",width:"180"}),a(C,{label:n(i)("operation"),fixed:"right","min-width":"50",align:"right"},{default:t(({row:l})=>[a(x,{type:"primary",link:"",onClick:f=>H(l)},{default:t(()=>[m("确定")]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[oe,d.loading]]),_("div",Ie,[a(le,{"current-page":d.page,"onUpdate:current-page":e[20]||(e[20]=l=>d.page=l),"page-size":d.limit,"onUpdate:page-size":e[21]||(e[21]=l=>d.limit=l),layout:"total, sizes, prev, pager, next, jumper",total:d.total,onSizeChange:F,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])],64)}}});const ql=Be(Ke,[["__scopeId","data-v-11591ffd"]]);export{ql as default};
