import{d as Z,r as p,n as ee,l as le,q as o,h as d,s as m,w as r,a as v,e as s,i as k,t as y,u as n,R as ae,c as f,B as g,F as R,T as S,bu as M,U as te,aW as oe,as as re,at as se,L as ne,aa as ie,aB as de,K as pe,M as ue,ab as _e,ac as me,E as ce,X as ye,Y as ve}from"./index-f7a01263.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                 */import{g as fe}from"./delivery-3ed9abb1.js";import{o as ge,d as be}from"./order-1274d9d3.js";import{l as xe}from"./weapp-e18c2e8e.js";const he=v("p",null,"您已开通微信小程序发货信息管理服务，平台会将发货信息以消息的形式推送给购买的微信用户。",-1),Ee=v("p",null,"注意：每个订单只能更新一次发货信息，请谨慎操作！",-1),Ve={class:"flex items-center"},De={key:0,class:"text-[#999] px-[3px] text-[12px] ml-[4px]"},ke={class:"dialog-footer"},Ye=Z({__name:"delivery-action",emits:["complete"],setup(we,{expose:U,emit:q}){const _=p(!1),u=p(!1),w=p([]),b=p(!1),x=p([]),C=p(!1);fe({}).then(a=>{w.value=a.data.data}),xe().then(a=>{C.value=a.data.is_trade_managed});const h=p([]),l=ee({...{order_id:0,delivery_type:"",express_company_id:"",express_number:"",order_goods_ids:[]}}),N=p(),L=le(()=>({delivery_type:[{required:!0,message:o("deliveryTypePlaceholder"),trigger:"blur"}],express_company_id:[{required:!0,validator:A,trigger:"blur"}],express_number:[{required:!0,validator:I,trigger:"blur"}]})),A=(a,e,i)=>{l.delivery_type=="express"&&e===""?i(new Error(o("companyPlaceholder"))):i()},I=(a,e,i)=>{l.delivery_type=="express"&&e===""?i(new Error(o("expressNumberPlaceholder"))):i()},O=(a,e)=>!(a.status==2||a.delivery_status=="delivery_finish"),E=p([]),T=()=>{let a=[];l.delivery_type&&l.delivery_type=="virtual"?h.value.forEach((e,i)=>{e.goods_type=="virtual"&&a.push(e)}):l.delivery_type&&l.delivery_type!="virtual"&&h.value.forEach((e,i)=>{e.goods_type!="virtual"&&a.push(e)}),E.value=M(a)},G=a=>{l.order_goods_ids=M([]);for(const e in a)l.order_goods_ids.push(a[e].order_goods_id)},$=async a=>{if(!(u.value||!a)){if(l.order_goods_ids.length<=0){te({message:o("orderGoodsPlaceholder"),type:"warning"});return}await a.validate(async e=>{e&&(u.value=!0,ge(l).then(V=>{u.value=!1,_.value=!1,q("complete"),F()}).catch(V=>{u.value=!1,_.value=!1,F()}))})}},j=async(a=null)=>{if(u.value=!0,a){l.order_id=a.order_id,l.delivery_type="",h.value=a.order_goods,E.value=a.order_goods,b.value=!1,await be({delivery_type:a.delivery_type}).then(e=>{x.value=e.data;for(const i in e.data){l.delivery_type=i;break}T()});for(let e=0;e<a.order_goods.length;e++)if(a.order_goods[e].goods_type=="virtual"){b.value=!0;break}b.value==!0&&Object.assign(x.value,{virtual:o("virtualDelivery")})}u.value=!1},F=()=>{l.order_id=0,l.delivery_type="",l.express_company_id="",l.express_number="",l.order_goods_ids=[]};return U({showDialog:_,setFormData:j}),(a,e)=>{const i=oe,V=re,z=se,D=ne,H=ie,K=de,W=pe,X=ue,c=_e,Y=me,P=ce,J=ye,Q=ve;return d(),m(J,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),title:n(o)("delivery"),width:"700px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:r(()=>[v("span",ke,[s(P,{onClick:e[3]||(e[3]=t=>_.value=!1)},{default:r(()=>[k(y(n(o)("cancel")),1)]),_:1}),s(P,{type:"primary",loading:u.value,onClick:e[4]||(e[4]=t=>$(N.value))},{default:r(()=>[k(y(n(o)("confirm")),1)]),_:1},8,["loading"])])]),default:r(()=>[ae((d(),f("div",null,[C.value?(d(),m(i,{key:0,type:"warning",closable:!1,class:"!mb-[10px]"},{default:r(()=>[he,Ee]),_:1})):g("",!0),s(X,{model:l,"label-width":"100px",ref_key:"formRef",ref:N,rules:n(L),class:"page-form mb-[30px]"},{default:r(()=>[s(D,{label:n(o)("deliveryType"),prop:"delivery_type"},{default:r(()=>[s(z,{modelValue:l.delivery_type,"onUpdate:modelValue":e[0]||(e[0]=t=>l.delivery_type=t),onChange:T},{default:r(()=>[(d(!0),f(R,null,S(x.value,(t,B)=>(d(),m(V,{label:B,key:B},{default:r(()=>[k(y(t),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l.delivery_type=="express"?(d(),m(D,{key:0,label:n(o)("company"),prop:"express_company_id"},{default:r(()=>[s(K,{modelValue:l.express_company_id,"onUpdate:modelValue":e[1]||(e[1]=t=>l.express_company_id=t),placeholder:n(o)("companyPlaceholder"),class:"input-width"},{default:r(()=>[(d(!0),f(R,null,S(w.value,t=>(d(),m(H,{key:t.index,label:t.company_name,value:t.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):g("",!0),l.delivery_type=="express"?(d(),m(D,{key:1,label:n(o)("expressNumber"),prop:"express_number"},{default:r(()=>[s(W,{modelValue:l.express_number,"onUpdate:modelValue":e[2]||(e[2]=t=>l.express_number=t),modelModifiers:{trim:!0},clearable:"",placeholder:n(o)("expressNumberPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):g("",!0)]),_:1},8,["model","rules"]),s(Y,{data:E.value,size:"large",onSelectionChange:G},{default:r(()=>[s(c,{type:"selection",width:"55",selectable:O}),s(c,{prop:"goods_name",label:n(o)("goodsName"),"min-width":"200"},{default:r(({row:t})=>[v("div",Ve,[v("span",null,y(t.goods_name),1),t.sku_name?(d(),f("span",De,y(t.sku_name),1)):g("",!0)])]),_:1},8,["label"]),s(c,{prop:"num",label:n(o)("num"),"min-width":"80"},null,8,["label"]),s(c,{prop:"status_name",label:n(o)("refundStatusName"),"min-width":"80"},null,8,["label"]),s(c,{prop:"delivery_status_name",label:n(o)("deliveryStatusName"),"min-width":"80",align:"right"},null,8,["label"])]),_:1},8,["data"])])),[[Q,u.value]])]),_:1},8,["modelValue","title"])}}});export{Ye as _};
