import{d as K,r as v,n as W,l as X,q as a,a2 as Y,h as u,s as _,w as r,a as d,e as o,br as L,i as g,t as x,u as s,R as z,c as w,F as k,T as D,B as U,K as H,L as J,ac as Q,aD as Z,au as ee,av as le,E as te,M as ae,X as oe,Y as re}from"./index-99f00cf3.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import se from"./index-015c0c3e.js";import"./el-form-item-4ed993c7.js";import{g as de,c as ie,e as ne,f as ue,h as me}from"./addon-73351360.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-2e54ab99.js";import"./attachment-6fc096d0.js";import"./index.vue_vue_type_script_setup_true_lang-a59c79e6.js";/* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-bde8c802.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-49ab6f2c.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./sortable.esm-be94e56d.js";const pe=d("div",{class:"text-gray-500 text-xs ml-2"}," 默认不限制，选择将会只给当前等级会员发送消息 ",-1),ce=d("div",{class:"text-gray-500 text-xs ml-2"}," 消息模板的ID，短信填写短信厂商申请的模板ID，微信公众号填写类目模板ID ",-1),_e=d("div",{class:"text-red text-xs"}," '{}'内的变量为申请模板变量，请按照模板变量的格式填写,各平台申请可能会有所不同,申请模板时候自行调整即 ",-1),ge=d("div",{class:"text-gray-500 text-xs"}," 如：顾客您好{product}已到货,您可前往{url}下单抢占名额;在下面需添加字段'product'和'url'和对应的值 ",-1),fe={class:""},ve={class:"flex items-center mt-[5px]"},be={class:"flex items-center mt-[5px]"},ye=d("span",{class:"ml-[10px] mr-4"},[g("字段 "),d("span",{class:"text-red-500"},"*")],-1),Ve={class:"flex items-center mt-[5px] ml-[8px]"},he=d("span",{class:"ml-[10px] mr-4"},[g("内容 "),d("span",{class:"text-red-500"},"*")],-1),xe={class:"ml-8"},we={class:"dialog-footer"},il=K({__name:"addon-edit",emits:["complete"],setup(ke,{expose:C,emit:A}){const q=v([]);(async()=>{q.value=await(await ie({})).data})();const I=v();de().then(n=>{n.data&&(I.value=n.data)});const F=()=>{Array.isArray(e.value)||(e.value=[]),e.value.push({field:"",value:"商品上新"})},R=n=>{e.value.splice(n,1)};let p=v(!1);const c=v(!1),P={id:"",name:"",desc:"",image:"",is_main:"",type:"",config_id:"",value:[],is_go_url:"",url:"",page:"",template_id:"",sms_content:"",level_id:"-1"},e=W({...P}),E=v(),B=X(()=>({name:[{required:!0,message:a("namePlaceholder"),trigger:"blur"}],desc:[{required:!0,message:a("descPlaceholder"),trigger:"blur"}],image:[{required:!0,message:a("imagePlaceholder"),trigger:"blur"}],sms_content:[{required:!0,message:"请配置短信模板内容",trigger:"blur"}],template_id:[{required:!0,message:"请配置模板ID",trigger:"blur"}],is_main:[{required:!0,message:a("isMainPlaceholder"),trigger:"blur"}],type:[{required:!0,message:a("typePlaceholder"),trigger:"blur"}],config_id:[{required:!0,message:a("configIdPlaceholder"),trigger:"blur"}],value:[{required:!0,message:a("valuePlaceholder"),trigger:"blur"}],is_go_url:[{required:!0,message:a("isGoUrlPlaceholder"),trigger:"blur"}],url:[{required:!0,message:a("urlPlaceholder"),trigger:"blur"}],page:[{required:!0,message:a("pagePlaceholder"),trigger:"blur"}]})),N=async n=>{if(c.value||!n)return;let t=e.id?ne:ue;await n.validate(async i=>{i&&(c.value=!0,t(e).then(V=>{c.value=!1,p.value=!1,A("complete")}).catch(V=>{c.value=!1}))})};return C({showDialog:p,setFormData:async(n=null)=>{if(Object.assign(e,P),c.value=!0,n){const t=await(await me(n.id)).data;t&&Object.keys(e).forEach(i=>{t[i]!=null&&(e[i]=t[i])})}c.value=!1}}),(n,t)=>{const i=H,m=J,V=se,h=Q,T=Z,M=ee,O=le,b=te,S=Y("block"),$=ae,j=oe,G=re;return u(),_(j,{modelValue:s(p),"onUpdate:modelValue":t[11]||(t[11]=l=>L(p)?p.value=l:p=l),title:e.id?s(a)("updateAddon"):s(a)("addAddon"),width:"50%",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:r(()=>[d("span",we,[o(b,{onClick:t[9]||(t[9]=l=>L(p)?p.value=!1:p=!1)},{default:r(()=>[g(x(s(a)("cancel")),1)]),_:1}),o(b,{type:"primary",loading:c.value,onClick:t[10]||(t[10]=l=>N(E.value))},{default:r(()=>[g(x(s(a)("confirm")),1)]),_:1},8,["loading"])])]),default:r(()=>[z((u(),_($,{model:e,"label-width":"120px",ref_key:"formRef",ref:E,rules:s(B),class:"page-form"},{default:r(()=>[o(m,{label:s(a)("name"),prop:"name"},{default:r(()=>[o(i,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.name=l),clearable:"",placeholder:s(a)("namePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:s(a)("desc"),prop:"desc"},{default:r(()=>[o(i,{modelValue:e.desc,"onUpdate:modelValue":t[1]||(t[1]=l=>e.desc=l),clearable:"",placeholder:s(a)("descPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:s(a)("image")},{default:r(()=>[o(V,{modelValue:e.image,"onUpdate:modelValue":t[2]||(t[2]=l=>e.image=l)},null,8,["modelValue"])]),_:1},8,["label"]),o(m,{label:"会员等级",prop:"level_id"},{default:r(()=>[o(T,{class:"input-width",modelValue:e.level_id,"onUpdate:modelValue":t[3]||(t[3]=l=>e.level_id=l),clearable:"",placeholder:"不限制"},{default:r(()=>[o(h,{label:"不限制",value:"-1"}),o(h,{label:"默认等级",value:"0"}),(u(!0),w(k,null,D(q.value,(l,f)=>(u(),_(h,{key:f,label:l.level_name,value:l.level_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),pe]),_:1}),o(m,{label:s(a)("type"),prop:"type"},{default:r(()=>[o(O,{modelValue:e.type,"onUpdate:modelValue":t[4]||(t[4]=l=>e.type=l),placeholder:"请选择类型"},{default:r(()=>[(u(!0),w(k,null,D(I.value,(l,f)=>(u(),_(M,{key:l.name,label:f},{default:r(()=>[g(x(l.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(m,{label:"模板ID",prop:"template_id"},{default:r(()=>[o(i,{modelValue:e.template_id,"onUpdate:modelValue":t[5]||(t[5]=l=>e.template_id=l),clearable:"",placeholder:"请填入模板ID",class:"input-width"},null,8,["modelValue"]),ce]),_:1}),e.type=="sms"?(u(),_(m,{key:0,label:"短信内容",prop:"sms_content"},{default:r(()=>[o(i,{type:"textarea",modelValue:e.sms_content,"onUpdate:modelValue":t[6]||(t[6]=l=>e.sms_content=l),placeholder:"顾客您好{product}已到货,您可前往{url}下单抢占名额",style:{width:"360px"}},null,8,["modelValue"]),_e,ge]),_:1})):U("",!0),e.type=="wechat"||e.type=="sms"?(u(),_(m,{key:1,prop:"value"},{default:r(()=>[d("div",fe,[o(b,{onClick:t[7]||(t[7]=l=>F()),type:"primary"},{default:r(()=>[g("添加变量内容")]),_:1}),(u(!0),w(k,null,D(e.value,(l,f)=>(u(),_(S,{key:f},{default:r(()=>[d("div",ve,[d("div",be,[ye,o(i,{style:{width:"120px"},modelValue:l.field,"onUpdate:modelValue":y=>l.field=y,placeholder:"thing8",class:"w-[120px]"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Ve,[he,o(i,{mini:"0",style:{width:"140px"},modelValue:l.value,"onUpdate:modelValue":y=>l.value=y,placeholder:"对应值",class:"w-[120px]"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",xe,[o(b,{plain:"",onClick:y=>R(f),type:"info"},{default:r(()=>[g("删除")]),_:2},1032,["onClick"])])])]),_:2},1024))),128))])]),_:1})):U("",!0),e.type=="wechat"?(u(),_(m,{key:2,label:s(a)("url"),prop:"url"},{default:r(()=>[o(i,{modelValue:e.url,"onUpdate:modelValue":t[8]||(t[8]=l=>e.url=l),clearable:"",placeholder:s(a)("urlPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):U("",!0)]),_:1},8,["model","rules"])),[[G,c.value]])]),_:1},8,["modelValue","title"])}}});export{il as default};
