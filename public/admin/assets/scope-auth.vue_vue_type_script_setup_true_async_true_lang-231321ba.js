import{d as P,r as p,Q as H,ao as Q,n as X,l as Y,q as s,h as b,s as C,w as c,a as V,e as n,i as x,t as D,u as o,R as F,c as z,F as G,T as J,a0 as W,ap as Z,a$ as ee,ab as te,aC as le,L as ae,av as oe,E as se,aw as ce,V as ne,M as re,X as ie,Y as de}from"./index-37fee5a0.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                     *//* empty css                *//* empty css                    *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                  */import{g as ue,a as pe,b as me,s as fe}from"./data_scope-def182a5.js";const _e={class:"flex items-center justify-between w-11/12"},ve={class:"dialog-footer"},Be=P({__name:"scope-auth",emits:["complete"],setup(he,{expose:O,emit:R}){const m=p(!1),i=p(!1),g=p(!0);let E="";const f=p([]);ue().then(t=>{f.value=t.data});const _=p(!1),d=p(null);H(_,()=>{_.value?d.value.setCheckedNodes(Q(f.value)):d.value.setCheckedNodes([])});const j=Z(t=>{l.dept_ids=d.value.getCheckedKeys()}),A=()=>{g.value?(k(f.value),g.value=!1):(L(f.value),g.value=!0)},L=t=>{Object.keys(t).forEach(e=>{d.value.store.nodesMap[t[e].dept_id].expanded=!0,t[e].children&&t[e].children.length>0&&k(t[e].children)})},k=t=>{Object.keys(t).forEach(e=>{d.value.store.nodesMap[t[e].dept_id].expanded=!1,t[e].children&&t[e].children.length>0&&k(t[e].children)})},y={role_id:0,data_scope:"1",check_strictly:!1,dept_ids:[]},l=X({...y}),S=p(),T=p([]);(async()=>{T.value=await(await pe()).data})();const B=Y(()=>({data_scope:[{required:!0,message:s("ruleTypePlaceholder"),trigger:"blur"}]})),N=async t=>{if(i.value||!t)return;const e=fe;await t.validate(async r=>{if(r){i.value=!0;const u=Object.assign({},l);u.dept_ids=u.dept_ids.concat(d.value.getHalfCheckedKeys()),e(u).then(v=>{i.value=!1,m.value=!1,R("complete")}).catch(()=>{i.value=!1})}})};return O({showDialog:m,setFormData:async(t=null)=>{if(i.value=!0,_.value=!1,y.role_id=t.role_id,Object.assign(l,y),t){E=s("setDataScope");const e=await(await me(t.role_id)).data;Object.keys(l).forEach(r=>{if(e[r]!=null)if(r=="dept_ids"){const u=e.dept_ids.split(","),v=[];Object.keys(u).forEach(h=>{ee(()=>{d.value.setChecked(u[h],!0,!1)})}),l[r]=v}else l[r]=e[r]}),l.check_strictly=!!l.check_strictly}i.value=!1}}),(t,e)=>{const r=te,u=le,v=ae,h=oe,w=se,U=ce,$=ne,I=re,M=ie,q=de;return b(),C(M,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=a=>m.value=a),title:o(E),width:"500px","destroy-on-close":!0},{footer:c(()=>[V("span",ve,[n(w,{onClick:e[4]||(e[4]=a=>m.value=!1)},{default:c(()=>[x(D(o(s)("cancel")),1)]),_:1}),n(w,{type:"primary",loading:i.value,onClick:e[5]||(e[5]=a=>N(S.value))},{default:c(()=>[x(D(o(s)("confirm")),1)]),_:1},8,["loading"])])]),default:c(()=>[F((b(),C(I,{model:l,"label-width":"90px",ref_key:"formRef",ref:S,rules:o(B),class:"page-form"},{default:c(()=>[n(v,{label:o(s)("ruleType"),prop:"data_scope"},{default:c(()=>[n(u,{modelValue:l.data_scope,"onUpdate:modelValue":e[0]||(e[0]=a=>l.data_scope=a),clearable:"",class:"input-item",placeholder:o(s)("ruleTypePlaceholder")},{default:c(()=>[(b(!0),z(G,null,J(T.value,(a,K)=>(b(),C(r,{label:a,value:K},null,8,["label","value"]))),256))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),F(n(v,{label:o(s)("deptList"),prop:"dept_ids"},{default:c(()=>[V("div",_e,[V("div",null,[n(h,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a),label:o(s)("selectAll")},null,8,["modelValue","label"]),n(h,{modelValue:l.check_strictly,"onUpdate:modelValue":e[2]||(e[2]=a=>l.check_strictly=a),label:o(s)("checkStrictly")},null,8,["modelValue","label"])]),n(w,{link:"",type:"primary",onClick:e[3]||(e[3]=a=>A())},{default:c(()=>[x(D(o(s)("foldText")),1)]),_:1})]),n($,{height:"35vh",class:"w-full"},{default:c(()=>[n(U,{data:f.value,props:{label:"dept_name",value:"dept_id"},"default-checked-keys":l.dept_ids,"check-strictly":l.check_strictly,"show-checkbox":"","default-expand-all":"",onCheckChange:o(j),"node-key":"dept_id",ref_key:"treeRef",ref:d},null,8,["data","default-checked-keys","check-strictly","onCheckChange"])]),_:1})]),_:1},8,["label"]),[[W,l.data_scope==2]])]),_:1},8,["model","rules"])),[[q,i.value]])]),_:1},8,["modelValue","title"])}}});export{Be as _};
