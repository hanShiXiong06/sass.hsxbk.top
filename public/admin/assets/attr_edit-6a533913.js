import{d as he,x as ge,f as ye,r as f,n as B,l as Q,q as e,h as m,c as g,a as p,u as t,t as i,e as o,w as r,s as D,i as v,B as R,R as S,F as q,T as W,v as Ve,c1 as j,a0 as be,bu as L,a4 as xe,ao as we,U as z,aM as ke,E as Ae,aN as Ne,ab as Ce,K as Ee,ac as Te,a6 as Be,L as De,M as Me,X as Ue,aa as Pe,aB as Re,Y as Se}from"./index-f7a01263.js";/* empty css                   *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css               */import{i as $e,e as Ie,j as F}from"./goods-d18d2d10.js";const Oe={class:"main-container"},qe={class:"detail-head"},je=p("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),Le={class:"ml-[1px]"},ze=p("span",{class:"adorn"},"|",-1),Fe={class:"right"},Ge={class:"ml-[10px]"},Je={class:"ml-[10px]"},Ke={key:0},Xe={key:1},Ye={key:2},He={key:1},Qe={class:"dialog-footer"},We={class:"dialog-footer"},Vt=he({__name:"attr_edit",setup(Ze){const M=ge(),Z=ye(),ee=M.meta.title;M.query.attr_id=M.query.attr_id||0;const U=f(M.query.attr_id),u=B({}),te=f(30);let w=B({loading:!0,data:[]});const C=()=>{$e(U.value).then(d=>{Object.assign(u,d.data),u.attr_value_format?u.attr_value_format=JSON.parse(u.attr_value_format):u.attr_value_format=[],w.data=L(u.attr_value_format),w.data.sort((l,c)=>c.sort-l.sort),w.loading=!1})};C();const E=f(!1),k=f(!1),G=f(),h=B({attr_id:0,attr_name:"",sort:0}),ae=Q(()=>({attr_name:[{required:!0,message:e("attrNamePlaceholder"),trigger:"blur"}]})),le=d=>{h.attr_id=u.attr_id,h.attr_name=u.attr_name,h.sort=u.sort,E.value=!0},oe=async d=>{k.value||!d||await d.validate(async l=>{l&&(k.value=!0,Ie(h).then(c=>{k.value=!1,E.value=!1,C()}).catch(c=>{k.value=!1}))})},re=d=>{xe.confirm(e("goodsAttrDeleteTips"),e("warning"),{confirmButtonText:e("confirm"),cancelButtonText:e("cancel"),type:"warning"}).then(()=>{if(y.value)return;y.value=!0,u.attr_value_format.splice(d,1);let l={attr_id:U.value,attr_value_format:JSON.stringify(u.attr_value_format)};F(l).then(c=>{y.value=!1,C()}).catch(c=>{y.value=!1})})},A=f(!1),N=f(!1),J=f(),$=f(""),s=B({attr_value_id:0,attr_value_name:"",type:"radio",sort:0,child:[]}),ne=B([{label:"单选",value:"radio"},{label:"多选",value:"checkbox"},{label:"输入",value:"text"}]),K=()=>Math.floor(new Date().getSeconds())+Math.floor(new Date().getMilliseconds()),se=()=>{s.attr_value_id=u.attr_value_format.length+K(),s.attr_value_name="",s.type="radio",s.sort=0,s.child=[],A.value=!0,$.value=e("addShopGoodsAttr"),P.value=-1},ue=we((d,l)=>{if(isNaN(d)||!/^\d{0,10}$/.test(d)){z({type:"warning",message:`${e("sortTips")}`});return}for(let n=0;n<u.attr_value_format.length;n++)if(u.attr_value_format[n].attr_value_id==l.attr_value_id){u.attr_value_format[n].sort=d;break}let c={attr_id:U.value,attr_value_format:JSON.stringify(u.attr_value_format)};F(c).then(n=>{C()}).catch(n=>{})}),ie=()=>{s.child.push({id:s.child.length+K(),name:"",sort:0})},de=(d,l)=>{$.value=e("updateShopGoodsAttr"),P.value=d.attr_value_id,Object.assign(s,L(d)),A.value=!0},me=Q(()=>({attr_value_name:[{required:!0,message:e("attrValueNamePlaceholder"),trigger:"blur"}]})),P=f(-1),y=f(!1),pe=async d=>{N.value||!d||await d.validate(async l=>{if(l){if(s.type!="text"){if(s.child.length==0){z({type:"warning",message:`${e("attrValueNamePlaceholder")}`});return}for(let n=0;n<s.child.length;n++)if(s.child[n].name==""){z({type:"warning",message:`${e("attrValueNamePlaceholder")}`});break}}if(y.value)return;if(y.value=!0,s.child.sort((n,I)=>I.sort-n.sort),N.value=!0,P.value==-1)u.attr_value_format.push(s);else for(let n=0;n<u.attr_value_format.length;n++)if(u.attr_value_format[n].attr_value_id==P.value){u.attr_value_format[n]=L(s);break}let c={attr_id:U.value,attr_value_format:JSON.stringify(u.attr_value_format)};F(c).then(n=>{N.value=!1,A.value=!1,y.value=!1,C()}).catch(n=>{N.value=!1,y.value=!1})}})},ce=(d,l)=>{s.child.splice(l,1)};return(d,l)=>{const c=ke,n=Ae,I=Ne,V=Ce,x=Ee,X=Te,_e=Be,T=De,Y=Me,H=Ue,fe=Pe,ve=Re,O=Se;return m(),g("div",Oe,[p("div",qe,[p("div",{class:"left",onClick:l[0]||(l[0]=a=>t(Z).push("/shop/goods/attr"))},[je,p("span",Le,i(t(e)("returnToPreviousPage")),1)]),ze,p("span",Fe,i(t(ee)),1)]),o(_e,{class:"box-card !border-none",shadow:"never"},{default:r(()=>[Object.keys(u).length?(m(),D(I,{key:0,gutter:20,class:"text-[14px]"},{default:r(()=>[o(c,{span:8},{default:r(()=>[p("label",null,i(t(e)("attrName"))+"：",1),p("span",Ge,i(u.attr_name),1)]),_:1}),o(c,{span:6},{default:r(()=>[p("label",null,i(t(e)("sort"))+"：",1),p("span",Je,i(u.sort),1)]),_:1}),o(c,{span:6},{default:r(()=>[o(n,{type:"primary",link:"",onClick:le},{default:r(()=>[v(i(t(e)("edit")),1)]),_:1})]),_:1})]),_:1})):R("",!0),o(n,{type:"primary",onClick:se,class:"my-[15px]"},{default:r(()=>[v(i(t(e)("addShopGoodsAttr")),1)]),_:1}),S((m(),D(X,{data:t(w).data,size:"large"},{empty:r(()=>[p("span",null,i(t(w).loading?"":t(e)("emptyData")),1)]),default:r(()=>[o(V,{prop:"attr_value_name",label:t(e)("attrValueName"),"min-width":"200","show-overflow-tooltip":!0},null,8,["label"]),o(V,{prop:"type",label:t(e)("attrValueType"),"min-width":"100","show-overflow-tooltip":!0},{default:r(({row:a})=>[a.type=="radio"?(m(),g("span",Ke,i(t(e)("attrValueTypeRadio")),1)):a.type=="checkbox"?(m(),g("span",Xe,i(t(e)("attrValueTypeCheckbox")),1)):R("",!0),a.type=="text"?(m(),g("span",Ye,i(t(e)("attrValueTypeText")),1)):R("",!0)]),_:1},8,["label"]),o(V,{prop:"child",label:t(e)("attrValueChild"),"min-width":"320","show-overflow-tooltip":!0},{default:r(({row:a})=>[a.type!="text"?(m(!0),g(q,{key:0},W(a.child,(_,b)=>(m(),g("span",{class:Ve({"mr-[5px]":b+1!=a.child.length})},i(_.name),3))),256)):(m(),g("span",He,"-"))]),_:1},8,["label"]),o(V,{prop:"sort",label:t(e)("sort"),"min-width":"120",sortable:"custom"},{default:r(({row:a,$index:_})=>[o(x,{modelValue:a.sort,"onUpdate:modelValue":b=>a.sort=b,modelModifiers:{trim:!0},class:"w-[70px]",maxlength:"10",onInput:b=>t(ue)(b,a)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1},8,["label"]),o(V,{label:t(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:r(({row:a,$index:_})=>[o(n,{type:"primary",link:"",onClick:b=>de(a,_)},{default:r(()=>[v(i(t(e)("edit")),1)]),_:2},1032,["onClick"]),o(n,{type:"primary",link:"",onClick:b=>re(_)},{default:r(()=>[v(i(t(e)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[O,t(w).loading]])]),_:1}),o(H,{modelValue:E.value,"onUpdate:modelValue":l[6]||(l[6]=a=>E.value=a),title:t(e)("updateShopGoodsAttr"),width:"500px","destroy-on-close":!0},{footer:r(()=>[p("span",Qe,[o(n,{onClick:l[4]||(l[4]=a=>E.value=!1)},{default:r(()=>[v(i(t(e)("cancel")),1)]),_:1}),o(n,{type:"primary",loading:k.value,onClick:l[5]||(l[5]=a=>oe(G.value))},{default:r(()=>[v(i(t(e)("confirm")),1)]),_:1},8,["loading"])])]),default:r(()=>[S((m(),D(Y,{model:h,"label-width":"120px",ref_key:"formRef",ref:G,rules:t(ae),class:"page-form"},{default:r(()=>[o(T,{label:t(e)("attrName"),prop:"attr_name"},{default:r(()=>[o(x,{modelValue:h.attr_name,"onUpdate:modelValue":l[1]||(l[1]=a=>h.attr_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:t(e)("attrNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(T,{label:t(e)("sort")},{default:r(()=>[o(x,{modelValue:h.sort,"onUpdate:modelValue":l[2]||(l[2]=a=>h.sort=a),modelModifiers:{trim:!0},maxlength:"6","show-word-limit":"",clearable:"",placeholder:t(e)("sortPlaceholder"),class:"input-width",onKeyup:l[3]||(l[3]=a=>t(j)(a))},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[O,k.value]])]),_:1},8,["modelValue","title"]),o(H,{modelValue:A.value,"onUpdate:modelValue":l[14]||(l[14]=a=>A.value=a),title:$.value,width:"700px","destroy-on-close":!0},{footer:r(()=>[p("span",We,[o(n,{onClick:l[12]||(l[12]=a=>A.value=!1)},{default:r(()=>[v(i(t(e)("cancel")),1)]),_:1}),o(n,{type:"primary",loading:N.value,onClick:l[13]||(l[13]=a=>pe(J.value))},{default:r(()=>[v(i(t(e)("confirm")),1)]),_:1},8,["loading"])])]),default:r(()=>[S((m(),D(Y,{model:s,"label-width":"120px",ref_key:"formAttrValueRef",ref:J,rules:t(me),class:"page-form"},{default:r(()=>[o(T,{label:t(e)("attrValueName"),prop:"attr_value_name"},{default:r(()=>[o(x,{modelValue:s.attr_value_name,"onUpdate:modelValue":l[7]||(l[7]=a=>s.attr_value_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:t(e)("attrValueNamePlaceholder"),class:"input-width",maxlength:"20","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(T,{label:t(e)("attrValueType")},{default:r(()=>[o(ve,{modelValue:s.type,"onUpdate:modelValue":l[8]||(l[8]=a=>s.type=a),class:"!w-[150px]",disabled:d.actionAttrValueIndex>-1},{default:r(()=>[(m(!0),g(q,null,W(ne,a=>(m(),D(fe,{label:a.label,value:a.value},null,8,["label","value"]))),256))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),o(T,{label:t(e)("sort")},{default:r(()=>[o(x,{modelValue:s.sort,"onUpdate:modelValue":l[9]||(l[9]=a=>s.sort=a),modelModifiers:{trim:!0},maxlength:"6","show-word-limit":"",clearable:"",placeholder:t(e)("sortPlaceholder"),class:"!w-[150px]",onKeyup:l[10]||(l[10]=a=>t(j)(a))},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s.type!="text"?(m(),g(q,{key:0},[o(X,{data:s.child,size:"large"},{empty:r(()=>[p("span",null,i(s.child.length==0?t(e)("emptyData"):""),1)]),default:r(()=>[o(V,{prop:"name",label:t(e)("attrValueName"),"min-width":"200"},{default:r(({row:a})=>[o(x,{modelValue:a.name,"onUpdate:modelValue":_=>a.name=_,modelModifiers:{trim:!0},class:"input-width",maxlength:"20",placeholder:t(e)("attrValueNamePlaceholder"),clearable:"","show-word-limit":""},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),o(V,{prop:"name",label:t(e)("sort"),"min-width":"120"},{default:r(({row:a})=>[o(x,{modelValue:a.sort,"onUpdate:modelValue":_=>a.sort=_,modelModifiers:{trim:!0},class:"!w-[150px]",maxlength:"6",placeholder:t(e)("sortPlaceholder"),clearable:"","show-word-limit":"",onKeyup:l[11]||(l[11]=_=>t(j)(_))},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),o(V,{label:t(e)("operation"),fixed:"right",align:"right","min-width":"60"},{default:r(({row:a,$index:_})=>[o(n,{type:"primary",link:"",onClick:b=>ce(a,_)},{default:r(()=>[v(i(t(e)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),S(o(n,{type:"primary",plain:"",onClick:ie,class:"my-[10px]"},{default:r(()=>[v(i(t(e)("addAttrValue")),1)]),_:1},512),[[be,s.child.length<te.value]])],64)):R("",!0)]),_:1},8,["model","rules"])),[[O,N.value]])]),_:1},8,["modelValue","title"])])}}});export{Vt as default};
