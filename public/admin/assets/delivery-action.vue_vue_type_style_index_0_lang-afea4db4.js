import{d as oe,r as _,n as re,l as se,q as o,h as d,s as v,w as r,a as g,e as i,i as x,t as f,u as n,R as ie,c as p,B as w,F as E,T as P,A as ne,a3 as C,U as de,aW as _e,au as ue,av as pe,L as ce,ac as me,aD as ye,K as ve,M as fe,ad as ge,ae as he,E as be,X as xe,Y as we}from"./index-99f00cf3.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                *//* empty css                 *//* empty css                  *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                       *//* empty css                 *//* empty css                 */import{j as Ee}from"./delivery-8329da8a.js";import{i as Ve,j as De}from"./order-b4e82541.js";import{l as Se}from"./weapp-3dcfdbcd.js";import{a as ke,i as Te,p as Pe}from"./electronic_sheet-55bf5788.js";import{l as Ce,g as Ne}from"./lodop-ed3e665c.js";const Fe=g("p",null,"您已开通微信小程序发货信息管理服务，平台会将发货信息以消息的形式推送给购买的微信用户。",-1),Ie=g("p",null,"注意：每个订单只能更新一次发货信息，请谨慎操作！",-1),Re={class:"flex cursor-pointer"},Le={class:"flex items-center min-w-[50px] mr-[10px]"},Ue=["src"],Ae={key:1,class:"w-[50px] h-[50px]",src:"",alt:""},Be={class:"flex flex-col"},Me={class:"multi-hidden text-[14px]"},We={key:0,class:"text-[#999] text-[12px]"},qe={class:"dialog-footer"},yl=oe({__name:"delivery-action",emits:["complete"],setup(Oe,{expose:W,emit:q}){const h=_(!1),c=_(!1),N=_([]),V=_(!1),D=_([]),F=_(!1);Ee({}).then(t=>{N.value=t.data}),Se().then(t=>{F.value=t.data.is_trade_managed}),ke().then(t=>{t.data&&Ce(t.data)});const I=_([]),S=_([]);Te({status:1}).then(t=>{t.data&&(I.value=t.data)});const O=t=>{S.value=[],l.electronic_sheet_id="",I.value.forEach(e=>{e.express_company_id==t&&S.value.push(C(e))})},k=_([]),l=re({...{order_id:0,delivery_type:"",delivery_way:"manual_write",express_company_id:"",express_number:"",electronic_sheet_id:"",order_goods_ids:[]}}),R=_(),j=se(()=>({delivery_type:[{required:!0,message:o("deliveryTypePlaceholder"),trigger:"blur"}],express_company_id:[{required:!0,validator:G,trigger:"blur"}],express_number:[{required:!0,validator:H,trigger:"blur"}],electronic_sheet_id:[{required:!0,validator:$,trigger:"blur"}]})),G=(t,e,s)=>{l.delivery_type=="express"&&e===""?s(new Error(o("companyPlaceholder"))):s()},H=(t,e,s)=>{l.delivery_type=="express"&&l.delivery_way=="manual_write"&&e===""?s(new Error(o("expressNumberPlaceholder"))):s()},$=(t,e,s)=>{l.delivery_type=="express"&&l.delivery_way=="electronic_sheet"&&e===""?s(new Error(o("electronicSheetTemplatePlaceholder"))):s()},z=(t,e)=>!(t.status==2||t.delivery_status=="delivery_finish"||t.status==3),T=_([]),L=()=>{let t=[];l.delivery_type&&l.delivery_type=="virtual"?k.value.forEach((e,s)=>{e.goods_type=="virtual"&&t.push(e)}):l.delivery_type&&l.delivery_type!="virtual"&&k.value.forEach((e,s)=>{e.goods_type!="virtual"&&t.push(e)}),T.value=C(t)},K=t=>{l.order_goods_ids=C([]);for(const e in t)l.order_goods_ids.push(t[e].order_goods_id)},X=async t=>{if(!(c.value||!t)){if(l.order_goods_ids.length<=0){de({message:o("orderGoodsPlaceholder"),type:"warning"});return}await t.validate(async e=>{e&&(c.value=!0,Ve(l).then(u=>{l.delivery_type=="express"&&l.delivery_way=="electronic_sheet"&&Q(),c.value=!1,h.value=!1,q("complete"),J()}).catch(u=>{}))})}},Y=async(t=null)=>{if(c.value=!0,t){l.order_id=t.order_id,l.delivery_type="",l.delivery_way="manual_write",k.value=t.order_goods,T.value=t.order_goods,V.value=!1,await De({delivery_type:t.delivery_type}).then(e=>{D.value=e.data;for(const s in e.data){l.delivery_type=s;break}L()});for(let e=0;e<t.order_goods.length;e++)if(t.order_goods[e].goods_type=="virtual"){V.value=!0;break}V.value&&Object.assign(D.value,{virtual:o("virtualDelivery")})}c.value=!1},J=()=>{l.order_id=0,l.delivery_type="",l.express_company_id="",l.electronic_sheet_id="",l.express_number="",l.order_goods_ids=[]},Q=()=>{let t=Ne();t&&Pe({print_type:"multiple",order_id:l.order_id,electronic_sheet_id:l.electronic_sheet_id,order_goods_ids:l.order_goods_ids}).then(e=>{if(e.data){let s=e.data,u=!1;t.PRINT_INIT("打印电子面单");for(let m=0;m<s.length;m++)if(s[m].success){let y=s[m].print_template;t.ADD_PRINT_HTM(0,0,"100%","100%",y),t.NewPage(),u=!0}u&&t.PREVIEW()}})};return W({showDialog:h,setFormData:Y}),(t,e)=>{const s=_e,u=ue,m=pe,y=ce,U=me,A=ye,Z=ve,ee=fe,b=ge,le=he,B=be,te=xe,ae=we;return d(),v(te,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),title:n(o)("delivery"),width:"700px",class:"diy-dialog-wrap","destroy-on-close":!0},{footer:r(()=>[g("span",qe,[i(B,{onClick:e[5]||(e[5]=a=>h.value=!1)},{default:r(()=>[x(f(n(o)("cancel")),1)]),_:1}),i(B,{type:"primary",loading:c.value,onClick:e[6]||(e[6]=a=>X(R.value))},{default:r(()=>[x(f(n(o)("confirm")),1)]),_:1},8,["loading"])])]),default:r(()=>[ie((d(),p("div",null,[F.value?(d(),v(s,{key:0,type:"warning",closable:!1,class:"!mb-[10px]"},{default:r(()=>[Fe,Ie]),_:1})):w("",!0),i(ee,{model:l,"label-width":"100px",ref_key:"formRef",ref:R,rules:n(j),class:"page-form mb-[30px]"},{default:r(()=>[i(y,{label:n(o)("deliveryType"),prop:"delivery_type"},{default:r(()=>[i(m,{modelValue:l.delivery_type,"onUpdate:modelValue":e[0]||(e[0]=a=>l.delivery_type=a),onChange:L},{default:r(()=>[(d(!0),p(E,null,P(D.value,(a,M)=>(d(),v(u,{label:M,key:M},{default:r(()=>[x(f(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l.delivery_type=="express"?(d(),p(E,{key:0},[i(y,{label:n(o)("deliveryWay")},{default:r(()=>[i(m,{modelValue:l.delivery_way,"onUpdate:modelValue":e[1]||(e[1]=a=>l.delivery_way=a)},{default:r(()=>[i(u,{label:"manual_write"},{default:r(()=>[x(f(n(o)("manualWriteWay")),1)]),_:1}),i(u,{label:"electronic_sheet"},{default:r(()=>[x(f(n(o)("electronicSheetWay")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(y,{label:n(o)("company"),prop:"express_company_id"},{default:r(()=>[i(A,{modelValue:l.express_company_id,"onUpdate:modelValue":e[2]||(e[2]=a=>l.express_company_id=a),placeholder:n(o)("companyPlaceholder"),class:"input-width",onChange:O},{default:r(()=>[(d(!0),p(E,null,P(N.value,a=>(d(),v(U,{key:a.index,label:a.company_name,value:a.company_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l.delivery_way=="manual_write"?(d(),v(y,{key:0,label:n(o)("expressNumber"),prop:"express_number"},{default:r(()=>[i(Z,{modelValue:l.express_number,"onUpdate:modelValue":e[3]||(e[3]=a=>l.express_number=a),modelModifiers:{trim:!0},clearable:"",placeholder:n(o)("expressNumberPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0),l.delivery_way=="electronic_sheet"?(d(),v(y,{key:1,label:n(o)("electronicSheetTemplate"),prop:"electronic_sheet_id"},{default:r(()=>[i(A,{modelValue:l.electronic_sheet_id,"onUpdate:modelValue":e[4]||(e[4]=a=>l.electronic_sheet_id=a),placeholder:n(o)("electronicSheetTemplatePlaceholder"),clearable:"",class:"input-width"},{default:r(()=>[(d(!0),p(E,null,P(S.value,a=>(d(),v(U,{key:a.id,label:a.template_name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):w("",!0)],64)):w("",!0)]),_:1},8,["model","rules"]),i(le,{data:T.value,size:"large",onSelectionChange:K,"max-height":"400px"},{default:r(()=>[i(b,{type:"selection",width:"55",selectable:z}),i(b,{prop:"goods_name",label:n(o)("goodsName"),"min-width":"200"},{default:r(({row:a})=>[g("div",Re,[g("div",Le,[a.goods_image?(d(),p("img",{key:0,class:"w-[50px] h-[50px]",src:n(ne)(a.goods_image),alt:""},null,8,Ue)):(d(),p("img",Ae))]),g("div",Be,[g("span",Me,f(a.goods_name),1),a.sku_name?(d(),p("span",We,f(a.sku_name),1)):w("",!0)])])]),_:1},8,["label"]),i(b,{prop:"num",label:n(o)("num"),"min-width":"80"},null,8,["label"]),i(b,{prop:"status_name",label:n(o)("refundStatusName"),"min-width":"80"},null,8,["label"]),i(b,{prop:"delivery_status_name",label:n(o)("deliveryStatusName"),"min-width":"80",align:"right"},null,8,["label"])]),_:1},8,["data"])])),[[ae,c.value]])]),_:1},8,["modelValue","title"])}}});export{yl as _};
