import{d as W,x as X,f as Y,n as P,r as v,l as H,q as a,h as C,c as J,e as l,w as n,a as g,t as m,u as s,i as u,R as A,s as $,b_ as O,a5 as Q,ap as Z,U as ee,E as te,K as ae,L as oe,M as le,a7 as re,ac as ne,ad as se,W as ie,X as de,Y as me}from"./index-2a89d409.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                  */import{d as pe,e as ue,f as ce,h as fe,m as _e}from"./goods-60ec1a36.js";const ge={class:"main-container"},he={class:"flex justify-between items-center"},ve={class:"text-lg"},be={class:"mt-[10px]"},ye={class:"mt-[16px] flex justify-end"},xe={class:"dialog-footer"},Ie=W({__name:"attr",setup(Ce){const B=X(),U=Y(),D=B.meta.title,r=P({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{attr_name:"",order:"",sort:""}}),k=v(),c=v(!1),f=v(!1),y=v(""),i=P({attr_id:0,attr_name:"",sort:0}),V=v(),R=H(()=>({attr_name:[{required:!0,message:a("attrNamePlaceholder"),trigger:"blur"}]})),S=o=>{let e="";o.order=="ascending"?e="asc":o.order=="descending"&&(e="desc"),e&&(r.searchParam.order=o.prop,r.searchParam.sort=e),p()},p=(o=1)=>{r.loading=!0,r.page=o,pe({page:r.page,limit:r.limit,...r.searchParam}).then(e=>{r.loading=!1,r.data=e.data.data,r.total=e.data.total}).catch(()=>{r.loading=!1})};p();const T=()=>{i.attr_id=0,i.attr_name="",i.sort=0,y.value=a("addShopGoodsAttr"),c.value=!0},z=o=>{i.attr_id=o.attr_id,i.attr_name=o.attr_name,i.sort=o.sort,y.value=a("updateShopGoodsAttr"),c.value=!0},F=async o=>{if(f.value||!o)return;const e=i.attr_id?ue:ce;await o.validate(async d=>{d&&(f.value=!0,e(i).then(_=>{f.value=!1,c.value=!1,p()}).catch(_=>{f.value=!1}))})},L=o=>{U.push("/shop/goods/attr_edit?attr_id="+o.attr_id)},M=o=>{Q.confirm(a("goodsAttrDeleteTips"),a("warning"),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{fe(o).then(()=>{p()}).catch(()=>{})})},G=Z((o,e)=>{if(isNaN(o)||!/^\d{0,8}$/.test(o)){ee({type:"warning",message:`${a("sortTips")}`});return}o>99999999&&(e.sort=99999999),_e({attr_id:e.attr_id,sort:o}).then(d=>{})}),j=o=>{o&&(o.resetFields(),p())};return(o,e)=>{const d=te,_=ae,b=oe,w=le,E=re,x=ne,I=se,q=ie,K=de,N=me;return C(),J("div",ge,[l(E,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[g("div",he,[g("span",ve,m(s(D)),1),l(d,{type:"primary",onClick:T},{default:n(()=>[u(m(s(a)("addShopGoodsAttr")),1)]),_:1})]),l(E,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:n(()=>[l(w,{inline:!0,model:r.searchParam,ref_key:"searchFormRef",ref:k},{default:n(()=>[l(b,{label:s(a)("attrName"),prop:"attr_name"},{default:n(()=>[l(_,{modelValue:r.searchParam.attr_name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.searchParam.attr_name=t),placeholder:s(a)("attrNamePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(b,null,{default:n(()=>[l(d,{type:"primary",onClick:e[1]||(e[1]=t=>p())},{default:n(()=>[u(m(s(a)("search")),1)]),_:1}),l(d,{onClick:e[2]||(e[2]=t=>j(k.value))},{default:n(()=>[u(m(s(a)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),g("div",be,[A((C(),$(I,{data:r.data,size:"large",onSortChange:S},{empty:n(()=>[g("span",null,m(r.loading?"":s(a)("emptyData")),1)]),default:n(()=>[l(x,{prop:"attr_name",label:s(a)("attrName"),"min-width":"320","show-overflow-tooltip":!0},null,8,["label"]),l(x,{prop:"sort",label:s(a)("sort"),"min-width":"120",sortable:"custom"},{default:n(({row:t})=>[l(_,{modelValue:t.sort,"onUpdate:modelValue":h=>t.sort=h,class:"!w-[100px]",maxlength:"8",onBlur:h=>s(G)(t.sort,t)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1},8,["label"]),l(x,{label:s(a)("operation"),fixed:"right",align:"right","min-width":"120"},{default:n(({row:t})=>[l(d,{type:"primary",link:"",onClick:h=>L(t)},{default:n(()=>[u(m(s(a)("manage")),1)]),_:2},1032,["onClick"]),l(d,{type:"primary",link:"",onClick:h=>z(t)},{default:n(()=>[u(m(s(a)("edit")),1)]),_:2},1032,["onClick"]),l(d,{type:"primary",link:"",onClick:h=>M(t.attr_id)},{default:n(()=>[u(m(s(a)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[N,r.loading]]),g("div",ye,[l(q,{"current-page":r.page,"onUpdate:current-page":e[3]||(e[3]=t=>r.page=t),"page-size":r.limit,"onUpdate:page-size":e[4]||(e[4]=t=>r.limit=t),layout:"total, sizes, prev, pager, next, jumper",total:r.total,onSizeChange:e[5]||(e[5]=t=>p()),onCurrentChange:p},null,8,["current-page","page-size","total"])])])]),_:1}),l(K,{modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=t=>c.value=t),title:y.value,width:"500px","destroy-on-close":!0},{footer:n(()=>[g("span",xe,[l(d,{onClick:e[9]||(e[9]=t=>c.value=!1)},{default:n(()=>[u(m(s(a)("cancel")),1)]),_:1}),l(d,{type:"primary",loading:f.value,onClick:e[10]||(e[10]=t=>F(V.value))},{default:n(()=>[u(m(s(a)("confirm")),1)]),_:1},8,["loading"])])]),default:n(()=>[A((C(),$(w,{model:i,"label-width":"120px",ref_key:"formRef",ref:V,rules:s(R),class:"page-form"},{default:n(()=>[l(b,{label:s(a)("attrName"),prop:"attr_name"},{default:n(()=>[l(_,{modelValue:i.attr_name,"onUpdate:modelValue":e[6]||(e[6]=t=>i.attr_name=t),modelModifiers:{trim:!0},clearable:"",placeholder:s(a)("attrNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(b,{label:s(a)("sort")},{default:n(()=>[l(_,{modelValue:i.sort,"onUpdate:modelValue":e[7]||(e[7]=t=>i.sort=t),modelModifiers:{trim:!0},maxlength:"6","show-word-limit":"",clearable:"",placeholder:s(a)("sortPlaceholder"),class:"input-width",onKeyup:e[8]||(e[8]=t=>s(O)(t))},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[N,f.value]])]),_:1},8,["modelValue","title"])])}}});export{Ie as default};
