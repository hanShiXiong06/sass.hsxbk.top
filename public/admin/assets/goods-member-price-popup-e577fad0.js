import{d as se,r as g,n as T,h as c,c as y,e as s,w as o,a as V,i as v,t as u,u as a,q as n,B as S,s as x,R as X,F as R,T as z,ca as Y,br as Q,aH as W,U as M,as as ne,at as ie,L as de,ab as re,ac as ue,au as _e,E as ce,K as me,M as fe,X as pe,Y as ve}from"./index-f7a01263.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                    *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                     *//* empty css                        *//* empty css               *//* empty css                       *//* empty css                 */import{y as be,z as ge}from"./goods-d18d2d10.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";const he={key:0,class:"text-[12px] text-[#999] leading-[20px]"},ke={key:1,class:"text-[12px] text-[#999] leading-[20px]"},ye={class:"mb-[10px] flex items-center"},Ve={class:"dialog-footer"},Ee={class:"dialog-footer"},Ce=se({__name:"goods-member-price-popup",emits:["load"],setup(Pe,{expose:Z,emit:I}){const G=g(),p=T({member_discount:""}),$=T({}),h=g(!1),E=g(""),i=T({loading:!0,data:[],member_level:[]}),A=()=>{i.loading=!0,ge({goods_id:$.goods_id}).then(r=>{i.loading=!1,i.data=r.data,i.data.forEach((e,l,_)=>{e.sku_name||(_[l].sku_name=$.goods_name),i.member_level.forEach((d,m)=>{if(!e.member_price)_[l][`level_${d.level_id}`]=parseFloat(e.price).toFixed(2);else if(e.member_price){let f=JSON.parse(e.member_price);f[`level_${d.level_id}`]?_[l][`level_${d.level_id}`]=parseFloat(f[`level_${d.level_id}`]).toFixed(2):_[l][`level_${d.level_id}`]=parseFloat(e.price).toFixed(2)}})})}).catch(()=>{i.loading=!1})};let w=g([]);const ee=(r,e)=>{Object.assign($,r),i.member_level=[],Object.assign(i.member_level,e),p.member_discount=r.member_discount,w.value=W(e),w.value.forEach((l,_,d)=>{!l.level_benefits||l.level_benefits==null?d[_].level_benefits={discount:{discount:"原价"}}:l.level_benefits&&l.level_benefits!=null&&!l.level_benefits.discount?d[_].level_benefits.discount={discount:"原价"}:l.level_benefits&&l.level_benefits!=null&&l.level_benefits.discount&&!l.level_benefits.discount.discount?d[_].level_benefits.discount.discount="原价":d[_].level_benefits.discount.discount+="折"}),A(),h.value=!0},F=g(),D=g(!1),le=r=>{D.value=!1,G.value.toggleAllSelection()},k=g([]),N=r=>{k.value=W(r),F.value=!1,k.value.length>0&&k.value.length<i.data.length?D.value=!0:D.value=!1,k.value.length==i.data.length&&(F.value=!0)};let j=g("");const oe=r=>{if(!k.value.length)return M({message:"请选择要操作的商品",type:"warning"}),!1;j.value=r,b.value=!0};let b=g(!1);const ae=()=>{if(!E.value)return M.error("请输入会员价"),!1;let r=k.value.map(e=>e.sku_id);i.data.forEach((e,l,_)=>{r.indexOf(e.sku_id)>-1&&(_[l][`level_${j.value}`]=parseFloat(E.value).toFixed(2))}),E.value="",b.value=!1};let U=!1;const te=()=>{let r=[],e=!0;if(p.member_discount=="fixed_price"&&(i.data.forEach((l,_,d)=>{let m={};m.sku_id=l.sku_id,m.member_price={},i.member_level.forEach((f,O)=>{e&&(m.member_price[`level_${f.level_id}`]=l[`level_${f.level_id}`],parseFloat(l[`level_${f.level_id}`])<=0&&(e=!1,M.error(`[${l.sku_name}][${f.level_name}]的指定价格不能小于等于零`)),parseFloat(l[`level_${f.level_id}`])>parseFloat(l.price)&&(e=!1,M.error(`[${l.sku_name}][${f.level_name}]的指定价格不能大于商品原价`)))}),r.push(m)}),!e)||U)return!1;U=!0,be({goods_id:$.goods_id,member_discount:p.member_discount,sku_list:r}).then(l=>{U=!1,I("load"),h.value=!1})};return Z({showDialog:h,show:ee}),(r,e)=>{const l=ne,_=ie,d=de,m=re,f=ue,O=_e,C=ce,H=me,K=fe,q=pe,J=ve;return c(),y("div",null,[s(q,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=t=>h.value=t),title:a(n)("editMemberPricePopupTitle"),width:"1100px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:o(()=>[V("span",Ee,[s(C,{onClick:e[7]||(e[7]=t=>h.value=!1)},{default:o(()=>[v(u(a(n)("cancel")),1)]),_:1}),s(C,{type:"primary",onClick:te},{default:o(()=>[v(u(a(n)("confirm")),1)]),_:1})])]),default:o(()=>[s(K,{model:p,"label-width":"120px",class:"page-form"},{default:o(()=>[s(d,{label:a(n)("memberDiscount")},{default:o(()=>[V("div",null,[s(_,{modelValue:p.member_discount,"onUpdate:modelValue":e[0]||(e[0]=t=>p.member_discount=t)},{default:o(()=>[s(l,{label:""},{default:o(()=>[v(u(a(n)("nonparticipation")),1)]),_:1}),s(l,{label:"discount"},{default:o(()=>[v(u(a(n)("discount")),1)]),_:1}),s(l,{label:"fixed_price"},{default:o(()=>[v(u(a(n)("fixedPrice")),1)]),_:1})]),_:1},8,["modelValue"]),p.member_discount=="discount"?(c(),y("div",he,u(a(n)("discountHint")),1)):S("",!0),p.member_discount=="fixed_price"?(c(),y("div",ke,u(a(n)("fixedPriceHint")),1)):S("",!0)])]),_:1},8,["label"]),p.member_discount=="discount"&&a(w).length?(c(),x(d,{key:0},{default:o(()=>[X((c(),x(f,{data:[{}],size:"large","max-height":"450",onSelectionChange:N},{empty:o(()=>[V("span",null,u(i.loading?"":a(n)("emptyData")),1)]),default:o(()=>[s(m,{fixed:"",prop:"sku_name",label:a(n)("memberLevel"),width:"150"},{default:o(()=>[v(u(a(n)("memberEnjoyDiscount")),1)]),_:1},8,["label"]),(c(!0),y(R,null,z(a(w),(t,P)=>(c(),x(m,{key:P,label:t.level_name},{default:o(({row:L})=>[v(u(t.level_benefits.discount.discount),1)]),_:2},1032,["label"]))),128))]),_:1})),[[J,i.loading]])]),_:1})):S("",!0),p.member_discount=="fixed_price"?(c(),x(d,{key:1},{default:o(()=>[V("div",ye,[s(O,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=t=>F.value=t),onChange:le,size:"large",class:"px-[14px]",indeterminate:D.value},null,8,["modelValue","indeterminate"]),(c(!0),y(R,null,z(i.member_level,(t,P)=>(c(),x(C,{key:P,size:"small",onClick:L=>oe(t.level_id)},{default:o(()=>[v(u(t.level_name),1)]),_:2},1032,["onClick"]))),128))]),X((c(),x(f,{data:i.data,size:"large","max-height":"450",onSelectionChange:N,ref_key:"goodsListTableRef",ref:G},{empty:o(()=>[V("span",null,u(i.loading?"":a(n)("emptyData")),1)]),default:o(()=>[s(m,{type:"selection",width:"55"}),s(m,{fixed:"",prop:"sku_name",label:a(n)("goodsSku"),width:"150"},null,8,["label"]),s(m,{fixed:"",prop:"price",label:a(n)("skuPrice"),width:"120"},null,8,["label"]),(c(!0),y(R,null,z(i.member_level,(t,P)=>(c(),x(m,{key:P,label:t.level_name,width:"190"},{default:o(({row:L})=>[s(H,{modelValue:L[`level_${t.level_id}`],"onUpdate:modelValue":B=>L[`level_${t.level_id}`]=B,modelModifiers:{trim:!0},maxlength:"8",clearable:"",class:"w-full",onKeyup:e[2]||(e[2]=B=>a(Y)(B))},{append:o(()=>[v(u(a(n)("yuanUnit")),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["data"])),[[J,i.loading]])]),_:1})):S("",!0)]),_:1},8,["model"]),s(q,{modelValue:a(b),"onUpdate:modelValue":e[6]||(e[6]=t=>Q(b)?b.value=t:b=t),title:a(n)("editMemberPrice"),width:"600px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:o(()=>[V("span",Ve,[s(C,{onClick:e[5]||(e[5]=t=>Q(b)?b.value=!1:b=!1)},{default:o(()=>[v(u(a(n)("cancel")),1)]),_:1}),s(C,{type:"primary",onClick:ae},{default:o(()=>[v(u(a(n)("confirm")),1)]),_:1})])]),default:o(()=>[s(K,{model:p,"label-width":"120px",class:"page-form"},{default:o(()=>[s(d,{label:a(n)("memberPrice"),prop:"member_price"},{default:o(()=>[s(H,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=t=>E.value=t),modelModifiers:{trim:!0},placeholder:a(n)("memberPricePlaceholder"),maxlength:"8",clearable:"",onKeyup:e[4]||(e[4]=t=>a(Y)(t))},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["modelValue","title"])])}}});const qe=xe(Ce,[["__scopeId","data-v-9ffbfd1f"]]);export{qe as default};
