import{d as U,r as _,x as $,f as q,n as y,l as z,a2 as L,h as m,c as w,R as O,s as v,w as t,e as a,a as h,i as u,F as J,T as M,t as V,u as E,q as W,B as Y,A as j,U as R,aW as H,a7 as K,E as P,au as Q,av as X,L as Z,M as ee,Y as oe}from"./index-99f00cf3.js";/* empty css                   *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                       *//* empty css                 *//* empty css                  *//* empty css                *//* empty css                 */import{c as te,g as ae,a as se,i as le,b as re}from"./goods-815f62be.js";import{_ as ne}from"./index.vue_vue_type_style_index_0_lang-64c643f1.js";/* empty css                    *//* empty css                 */const ie={class:"main-container"},de={class:"flex"},ce={class:"v-[320px]"},ue={class:"flex"},Ae=U({__name:"import",setup(me){const b=_(!1);(()=>{let o="00",e="-1";localStorage.getItem("admin.userinfo")&&(o=JSON.parse(localStorage.getItem("admin.userinfo")).uid),localStorage.getItem("site.userinfo")&&(e=JSON.parse(localStorage.getItem("site.userinfo")).uid),o===e&&(b.value=!0)})();const S=$(),f=q();S.meta.title,_();const s=_(!1),g=_(),A=()=>{const o=document.createElement("a");o.href=j("addon/goods_export/file/goods.xlsx"),o.target="_blank",o.download="goods.xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o)},x=y([]);(async()=>{await te(),F(),ae().then(o=>{const e=o.data;if(e)for(const l in e)x.push(e[l])})})();const k=y([]),F=()=>{se().then(o=>{const e=o.data;if(e){const l=[];e.forEach(i=>{const d=[];i.child_list&&i.child_list.forEach(c=>{d.push({value:c.category_id,label:c.category_name})}),l.push({value:i.category_id,label:i.category_name,children:d})}),k.splice(0,k.length,...l)}})},B=z(()=>({file_url:[{required:!0,message:"请上传文件",trigger:"blur"}],goods_category:[{required:!0,message:"商品分类必须选择",trigger:"blur"}]})),n=y({...{file_url:"",stock:999,goods_category:"",goods_type:"real",islocal:"0",status:"0"}}),I=async o=>{s.value||!o||await o.validate(async e=>{if(e){s.value=!0;const l=n;console.log(l),le(l).then(i=>{s.value=!1,R({message:"正在奋力导入，请稍后进入商品列表查看",type:"success"})}).catch(()=>{s.value=!1,f.push("/site_spdr/shop/goods/import_do")})}})},N=async o=>{s.value||!o||await o.validate(async e=>{if(e){s.value=!0;const l=n;console.log(l),re(l).then(i=>{s.value=!1,R({message:"队列导入中，请稍后刷新页面查看",type:"success"}),f.push("/site_spdr/shop/goods/import_do")}).catch(()=>{s.value=!1,f.push("/site_spdr/shop/goods/import_do")})}})};return(o,e)=>{const l=H,i=K,d=P,c=Q,T=L("block"),C=X,p=Z,D=ee,G=oe;return m(),w("div",ie,[O((m(),v(D,{"element-loading-text":"正在导入数据......",model:n,"label-width":"140px",ref_key:"formRef",ref:g,rules:E(B),class:"page-form"},{default:t(()=>[a(i,{class:"box-card !border-none",shadow:"never"},{default:t(()=>[a(i,{class:"!border-none",shadow:"never",style:{width:"640px"}},{default:t(()=>[a(l,{type:"info",title:"说明:请按照模板格式导入xlsx文件，格式不正确会导入失败,暂未适配多规格,如要和其他平台数据进行批量导入，请适配正常格式才能执行成功。本操作需要确保队列正常运行。上传文件为临时文件，不长时存储，单次导入不超过50条，如需单次更多条数导入请联系管理员导入",closable:!1,"show-icon":""})]),_:1}),h("div",de,[a(d,{loading:s.value,class:"mb-6 ml-6",type:"primary",plain:"",onClick:e[0]||(e[0]=r=>A())},{default:t(()=>[u(" 下载模板 ")]),_:1},8,["loading"])]),a(p,{label:"商品类型"},{default:t(()=>[a(C,{modelValue:n.goods_type,"onUpdate:modelValue":e[1]||(e[1]=r=>n.goods_type=r)},{default:t(()=>[(m(!0),w(J,null,M(x,r=>(m(),v(T,{key:r.type},{default:t(()=>[a(c,{border:"",label:r.type,size:"large",style:{"margin-right":"10px"}},{default:t(()=>[u(V(r.name),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"上传文件",prop:"file_url"},{default:t(()=>[h("div",ce,[a(ne,{modelValue:n.file_url,"onUpdate:modelValue":e[2]||(e[2]=r=>n.file_url=r),api:"sys/document/applet"},null,8,["modelValue"])])]),_:1}),a(p,{label:"上架产品"},{default:t(()=>[a(C,{modelValue:n.status,"onUpdate:modelValue":e[3]||(e[3]=r=>n.status=r)},{default:t(()=>[a(c,{label:"0",size:"large",style:{"margin-right":"10px"}},{default:t(()=>[u("仓库中")]),_:1}),a(c,{label:"1",size:"large",style:{"margin-right":"10px"}},{default:t(()=>[u("立即上架")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"",prop:""},{default:t(()=>[h("div",ue,[a(d,{type:"primary",loading:s.value,onClick:e[4]||(e[4]=r=>I(g.value))},{default:t(()=>[u(V(E(W)("confirm")),1)]),_:1},8,["loading"]),b.value?(m(),v(d,{key:0,type:"primary",loading:s.value,onClick:e[5]||(e[5]=r=>N(g.value))},{default:t(()=>[u("管理员操作导入")]),_:1},8,["loading"])):Y("",!0)])]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[G,s.value]])])}}});export{Ae as default};
