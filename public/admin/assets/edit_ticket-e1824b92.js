import{d as te,x as le,f as oe,r as x,n as F,l as z,q as o,h as p,c as _,a as u,u as l,t as r,e as a,w as s,c8 as j,b_ as ae,i as b,B as y,v as se,R as ie,s as P,ax as re,ay as de,K as ne,L as ue,at as ce,au as pe,M as me,a7 as _e,E as fe,d1 as be,bO as ve,X as ge,Y as xe}from"./index-5a756a51.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                    *//* empty css                    *//* empty css                *//* empty css                */import{_ as ye}from"./index.vue_vue_type_script_setup_true_lang-05cc8415.js";/* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                    */import{P as ke,Q as he,R as Ve,S as we,T as Pe}from"./tourism-df1c9cc5.js";import"./index.vue_vue_type_style_index_0_lang-c0b4b1fc.js";import"./attachment-a9811edd.js";import"./index.vue_vue_type_script_setup_true_lang-cb419dfd.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    */import"./el-dropdown-item-4ed993c7.js";import"./index.vue_vue_type_script_setup_true_lang-477c25f7.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-75313763.js";import"./_plugin-vue_export-helper-c27b6911.js";const De={class:"main-container"},Ce={class:"detail-head"},Te=u("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),Ee={class:"ml-[1px]"},Re=u("span",{class:"adorn"},"|",-1),Ue={key:0,class:"right"},Ne={key:1,class:"right"},Ie={key:0},Se={key:0,class:"text-[12px] text-[#999] leading-[20px]"},Ye={key:1,class:"text-[12px] text-[#999] leading-[20px]"},Be={class:"fixed-footer-wrap"},Me={class:"fixed-footer"},$e={key:1},qe=["onClick"],Fe={key:0},ze={class:"text-right text-gray-400 text-[14px] mt-[5px]"},je={class:"text-right text-gray-400 text-[12px] mt-[5px]"},Ke={key:1},Ae=u("p",{class:"text-right text-gray-400 text-[14px] mt-[5px]"},"0.00￥",-1),Le=u("p",{class:"text-right text-gray-400 text-[12px] mt-[5px]"},"0/0",-1),Oe=[Ae,Le],He={key:1,class:"w-full h-full"},Ge={class:"text-gray-400"},Qe={key:0},Xe={class:"text-right text-gray-400 text-[14px] mt-[5px]"},Ze={class:"text-right text-gray-400 text-[12px] mt-[5px]"},Je={key:1},We=u("p",{class:"text-right text-gray-400 text-[14px] mt-[5px]"},"0.00￥",-1),et=u("p",{class:"text-right text-gray-400 text-[12px] mt-[5px]"},"0/0",-1),tt=[We,et],lt={class:"dialog-footer"},At=te({__name:"edit_ticket",setup(ot){const U=le(),K=oe(),D=parseInt(U.query.id),N=parseInt(U.query.scenic_id),k=x(!1),h=x("first"),A=(n,e)=>{},L=n=>{const e=parseInt(new Date().getTime()/1e3)+"",c=parseInt(new Date(n.day).getTime()/1e3)+"";return e-60*60*24<c},V=x(!1),O=n=>{d.start_date=n.day,d.is_set=1,d.price="",d.end_date="",d.member_price=1,V.value=!0,m.value[n.day]&&(d.price=m.value[n.day].price,d.member_price=m.value[n.day].member_price)},d=F({is_set:1,start_date:"",end_date:"",member_price:1,price:""}),I={goods_id:0,goods_name:"",buy_content:"",goods_content:"",price:"",is_vip:0,stock:"",scenic_id:0,member_discount:"",buy_info:""},m=x([]),S=(n=0)=>{Pe({goods_id:n}).then(e=>{m.value=e.data})},i=F({...I});D&&(async(n=0)=>{Object.assign(i,I);const e=await(await ke(n)).data;Object.keys(i).forEach(c=>{e[c]!=null&&(i[c]=e[c])}),i.goods_id=n,S(n)})(D);const Y=x(),H=z(()=>({goods_name:[{required:!0,message:o("ticketNamePlaceholder"),trigger:"blur"}],price:[{required:!0,message:o("tickePricePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(n,e,c)=>{parseFloat(e)>9999999999e-2?c(new Error(o("pricePlaceholder3"))):c()}}],stock:[{required:!0,message:o("ticketStockPlaceholder"),trigger:"blur"}]})),G=async n=>{k.value||!n||await n.validate(async e=>{if(e){k.value=!0,i.scenic_id=N;const c=i;(i.goods_id?he:Ve)(c).then(v=>{v.code>=0&&i.goods_id==0?(i.goods_id=v.data.id,h.value="second"):history.back(),k.value=!1}).catch(()=>{k.value=!1})}})},C=x(!1),B=x(),Q=z(()=>({price:[{required:!0,message:o("saleArrPricePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(n,e,c)=>{e<=0?c(new Error(o("saleArrPriceNotZeroTips"))):parseFloat(e)>9999999999e-2?c(new Error(o("pricePlaceholder3"))):c()}}]})),X=async n=>{C.value||!n||await n.validate(async e=>{e&&(C.value=!0,d.goods_id=i.goods_id,we(d).then(c=>{S(i.goods_id),V.value=!1,C.value=!1}))})},Z=()=>{history.back()};return(n,e)=>{const c=re,T=de,v=ne,f=ue,g=ce,E=pe,M=ye,$=me,R=_e,w=fe,J=be,q=ve,W=ge,ee=xe;return p(),_("div",De,[u("div",Ce,[u("div",{class:"left",onClick:e[0]||(e[0]=t=>l(K).push(`/tourism/product/scenic/ticket?id=${l(N)}`))},[Te,u("span",Ee,r(l(o)("returnToPreviousPage")),1)]),Re,l(D)?(p(),_("span",Ue,r(l(o)("editTicket")),1)):(p(),_("span",Ne,r(l(o)("addTicket")),1))]),a(R,{class:"box-card !border-none",shadow:"never"},{default:s(()=>[a(T,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),class:"demo-tabs",onTabClick:A},{default:s(()=>[a(c,{label:l(o)("basicData"),name:"first"},null,8,["label"]),a(c,{label:l(o)("ticketPriceCalendar"),name:"second",disabled:!i.goods_id},null,8,["label","disabled"])]),_:1},8,["modelValue"]),h.value=="first"?(p(),_("div",Ie,[a(R,{class:"box-card !border-none",shadow:"never"},{default:s(()=>[a($,{model:i,"label-width":"180px",ref_key:"formRef",ref:Y,rules:l(H),class:"page-form"},{default:s(()=>[a(f,{label:l(o)("ticketName"),prop:"goods_name"},{default:s(()=>[a(v,{modelValue:i.goods_name,"onUpdate:modelValue":e[2]||(e[2]=t=>i.goods_name=t),modelModifiers:{trim:!0},clearable:"",placeholder:l(o)("ticketNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(f,{label:l(o)("tickePrice"),prop:"price"},{default:s(()=>[a(v,{modelValue:i.price,"onUpdate:modelValue":e[3]||(e[3]=t=>i.price=t),modelModifiers:{trim:!0},clearable:"",placeholder:l(o)("tickePricePlaceholder"),class:"input-width",onKeyup:e[4]||(e[4]=t=>l(j)(t)),onBlur:e[5]||(e[5]=t=>i.price=t.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(f,{label:l(o)("ticketStock"),prop:"stock"},{default:s(()=>[a(v,{modelValue:i.stock,"onUpdate:modelValue":e[6]||(e[6]=t=>i.stock=t),modelModifiers:{trim:!0},clearable:"",placeholder:l(o)("ticketStockPlaceholder"),class:"input-width",onKeyup:e[7]||(e[7]=t=>l(ae)(t)),onBlur:e[8]||(e[8]=t=>i.stock=t.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(f,{label:l(o)("memberDiscount")},{default:s(()=>[u("div",null,[a(E,{modelValue:i.member_discount,"onUpdate:modelValue":e[9]||(e[9]=t=>i.member_discount=t)},{default:s(()=>[a(g,{label:""},{default:s(()=>[b(r(l(o)("nonparticipation")),1)]),_:1}),a(g,{label:"discount"},{default:s(()=>[b(r(l(o)("discount")),1)]),_:1}),a(g,{label:"fixed_discount"},{default:s(()=>[b(r(l(o)("fixedDiscount")),1)]),_:1})]),_:1},8,["modelValue"]),i.member_discount=="discount"?(p(),_("div",Se,r(l(o)("discountHint")),1)):y("",!0),i.member_discount=="fixed_discount"?(p(),_("div",Ye,r(l(o)("fixedDiscountHint")),1)):y("",!0)])]),_:1},8,["label"]),a(f,{label:l(o)("ticketIllustrate")},{default:s(()=>[a(M,{modelValue:i.goods_content,"onUpdate:modelValue":e[10]||(e[10]=t=>i.goods_content=t)},null,8,["modelValue"])]),_:1},8,["label"]),a(f,{label:l(o)("buyDesc")},{default:s(()=>[a(M,{modelValue:i.buy_info,"onUpdate:modelValue":e[11]||(e[11]=t=>i.buy_info=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1}),u("div",Be,[u("div",Me,[a(w,{type:"primary",onClick:e[12]||(e[12]=t=>G(Y.value))},{default:s(()=>[b(r(l(o)("save")),1)]),_:1}),a(w,{onClick:e[13]||(e[13]=t=>Z())},{default:s(()=>[b(r(l(o)("returnToPreviousPage")),1)]),_:1})])])])):y("",!0),h.value=="second"?(p(),_("div",$e,[a(R,{class:"box-card !border-none",shadow:"never"},{default:s(()=>[a(J,null,{"date-cell":s(({data:t})=>[L(t)==!0?(p(),_("div",{key:0,class:se(["w-full h-full",t.isSelected?"is-selected":""]),onClick:st=>O(t)},[u("p",null,r(t.day.split("-").slice(1).join("-")),1),m.value&&m.value[t.day]?(p(),_("div",Fe,[u("p",ze,r(m.value[t.day].price)+"￥",1),u("p",je,r(m.value[t.day].sell_num)+"/"+r(m.value[t.day].stock_all),1)])):(p(),_("div",Ke,Oe))],10,qe)):(p(),_("div",He,[u("p",Ge,r(t.day.split("-").slice(1).join("-")),1),m.value&&m.value[t.day]?(p(),_("div",Qe,[u("p",Xe,r(m.value[t.day].price)+"￥",1),u("p",Ze,r(m.value[t.day].sell_num)+"/"+r(m.value[t.day].stock_all),1)])):(p(),_("div",Je,tt))]))]),_:1})]),_:1})])):y("",!0)]),_:1}),a(W,{modelValue:V.value,"onUpdate:modelValue":e[22]||(e[22]=t=>V.value=t),title:l(o)("editPrice"),width:"400px","destroy-on-close":!0},{footer:s(()=>[u("span",lt,[a(w,{onClick:e[20]||(e[20]=t=>V.value=!1)},{default:s(()=>[b(r(l(o)("cancel")),1)]),_:1}),a(w,{type:"primary",onClick:e[21]||(e[21]=t=>X(B.value))},{default:s(()=>[b(r(l(o)("confirm")),1)]),_:1})])]),default:s(()=>[ie((p(),P($,{model:d,"label-width":"90px",ref_key:"formRulesRef",ref:B,rules:l(Q),class:"page-form"},{default:s(()=>[a(f,{label:l(o)("daySetting"),class:"items-center"},{default:s(()=>[a(E,{modelValue:d.is_set,"onUpdate:modelValue":e[14]||(e[14]=t=>d.is_set=t),class:"ml-4 input-width"},{default:s(()=>[a(g,{label:1,size:"large"},{default:s(()=>[b(r(d.start_date),1)]),_:1}),a(g,{label:2,size:"large"},{default:s(()=>[b(r(l(o)("dateRange")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),d.is_set==2?(p(),P(f,{key:0,label:l(o)("startDate"),class:"input-width"},{default:s(()=>[a(q,{type:"date",modelValue:d.start_date,"onUpdate:modelValue":e[15]||(e[15]=t=>d.start_date=t),placeholder:l(o)("startDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):y("",!0),d.is_set==2?(p(),P(f,{key:1,label:l(o)("endDate"),class:"input-width"},{default:s(()=>[a(q,{type:"date",modelValue:d.end_date,"onUpdate:modelValue":e[16]||(e[16]=t=>d.end_date=t),placeholder:l(o)("endDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):y("",!0),a(f,{label:l(o)("tickePrice"),prop:"price",class:"input-width"},{default:s(()=>[a(v,{modelValue:d.price,"onUpdate:modelValue":e[17]||(e[17]=t=>d.price=t),clearable:"",placeholder:l(o)("tickePricePlaceholder"),onKeyup:e[18]||(e[18]=t=>l(j)(t)),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i.member_discount!=""?(p(),P(f,{key:2,label:l(o)("memberPrice"),prop:"member_price",class:"items-center"},{default:s(()=>[a(E,{modelValue:d.member_price,"onUpdate:modelValue":e[19]||(e[19]=t=>d.member_price=t),class:"ml-4 input-width"},{default:s(()=>[a(g,{label:1,size:"large"},{default:s(()=>[b(r(l(o)("involved")),1)]),_:1}),a(g,{label:0,size:"large"},{default:s(()=>[b(r(l(o)("noInvolved")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])):y("",!0)]),_:1},8,["model","rules"])),[[ee,k.value]])]),_:1},8,["modelValue","title"])])}}});export{At as default};
