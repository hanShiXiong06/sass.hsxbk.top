import{d as xe,r as E,l as ee,n as G,a2 as be,h as f,c as x,a as d,b as Ce,e as _,w as h,i as A,t as g,u as r,q as u,R as T,a0 as H,F as q,T as J,s as O,B as N,v as se,A as oe,aI as $,a3 as K,a$ as Se,U as W,E as Pe,ab as Le,aC as Ve,L as Ee,K as Ae,bF as we,M as Ge,av as Ie,J as Te,W as Oe,X as Ne,Y as $e,p as Ue,g as je}from"./index-6f32d09b.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    *//* empty css                *//* empty css                          *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  */import{_ as U}from"./goods_default-995568ac.js";import{g as Fe,b as Be,c as ze,d as Me}from"./goods-8f7103ad.js";import{_ as Re}from"./_plugin-vue_export-helper-c27b6911.js";const C=w=>(Ue("data-v-23a05568"),w=w(),je(),w),He={class:"inline-block ml-[10px] text-[14px]"},qe={class:"text-primary mx-[2px]"},Je={class:"table w-[100%]"},Ke={class:"table-head flex items-center bg-[#f5f7f9] py-[8px]"},We=C(()=>d("div",{class:"w-[3%]"},null,-1)),Xe={class:"w-[7%]"},Ye=C(()=>d("div",{class:"w-[50%]"},"商品信息",-1)),De=C(()=>d("div",{class:"w-[20%]"},"商品价格",-1)),Qe=C(()=>d("div",{class:"w-[20%]"},"库存",-1)),Ze={class:"table-body h-[350px] overflow-y-auto"},es={class:"flex items-center border-solid border-[#e5e7eb] py-[8px] border-b-[1px]"},ss={key:0,class:"w-[3%]"},os=["onClick"],ls={class:"w-[7%]"},ts={class:"flex items-center cursor-pointer w-[50%]"},as={class:"min-w-[60px] h-[60px] flex items-center justify-center"},ds=C(()=>d("div",{class:"image-slot"},[d("img",{class:"w-[60px] h-[60px]",src:U})],-1)),ns={key:1,class:"w-[60px] h-[60px]",src:U,fit:"contain"},is={class:"ml-2"},cs=["title"],rs={class:"text-primary text-[12px]"},ps={class:"w-[20%]"},us={class:"w-[20%]"},_s=C(()=>d("div",{class:"w-[6%]"},null,-1)),gs={class:"w-[4%]"},ms={class:"flex items-center cursor-pointer w-[50%]"},hs={class:"min-w-[60px] h-[60px] flex items-center justify-center"},fs=C(()=>d("div",{class:"image-slot"},[d("img",{class:"w-[60px] h-[60px]",src:U})],-1)),vs={key:1,class:"w-[60px] h-[60px]",src:U,fit:"contain"},ks={class:"ml-2"},ys=["title"],xs={class:"text-primary text-[12px]"},bs={class:"w-[20%] flex"},Cs={class:"w-[20%] flex"},Ss={key:0,class:"h-[60px] flex items-center justify-center border-solid border-[#e5e7eb] py-[12px] border-b-[1px]"},Ps={class:"mt-[16px] flex"},Ls={class:"flex items-center flex-1"},Vs={class:"layui-table-bottom-left-container mr-[10px]"},Es={class:"text-primary mx-[2px]"},As={class:"dialog-footer"},ws=xe({__name:"goods-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0},mode:{type:String,default:"spu"},way:{type:String,default:""}},emits:["update:modelValue","goodsSelect"],setup(w,{expose:le,emit:X}){const p=w;let c=p.mode=="sku"?"sku_":"goods_";const S=E(!1),P=E(!1),y=ee({get(){return p.modelValue},set(l){X("update:modelValue",l)}}),L=E(!1),n=G({}),m=G([]),b=ee(()=>Object.keys(n).length),o=G({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{keyword:"",goods_category:[],select_type:"all",goods_ids:"",verify_goods_ids:"",verify_sku_ids:"",goods_type:""}}),Y=E(),te=l=>{V()},j=G([]),D=G([]);(()=>{Fe().then(l=>{const e=l.data;if(e){const s=[];e.forEach(a=>{const i=[];a.child_list&&a.child_list.forEach(v=>{i.push({value:v.category_id,label:v.category_name})}),s.push({value:a.category_id,label:a.category_name,children:i})}),j.splice(0,j.length,...s)}}),Be().then(l=>{const e=l.data;if(e)for(const s in e)D.push(e[s])})})(),E(),E([]);const ae=l=>{l.isShow=!l.isShow},de=l=>{S.value=!1,o.data.forEach((e,s)=>{e.secondLevelCheckAll=l,e.skuList.forEach((a,i)=>{a.threeLevelCheckAll=l})}),o.data.length?o.data.forEach(e=>{p.mode=="spu"?(n[c+e.goods_id]=e,m.push(e.goods_id)):e.skuList.forEach(s=>{m.push(s.sku_id),n[c+s.sku_id]=$(s),n[c+s.sku_id].goods_name=e.goods_name,n[c+s.sku_id].goods_type_name=e.goods_type_name,n[c+s.sku_id].goods_type=e.goods_type})}):o.data.forEach(e=>{p.mode=="spu"?(m.splice(m.indexOf(e.goods_id),1),delete n[c+e.goods_id]):e.skuList.forEach(s=>{m.splice(m.indexOf(s.sku_id),1),delete n[c+e.sku_id]})})},ne=(l,e)=>{if(e.skuList.forEach((s,a)=>{s.threeLevelCheckAll=l}),F(),p.mode=="spu"?l?(m.push(e.goods_id),n[c+e.goods_id]=$(e)):(m.splice(m.indexOf(e.goods_id),1),delete n[c+e.goods_id]):l?e.skuList.forEach((s,a)=>{m.push(s.sku_id),n[c+s.sku_id]=$(s),n[c+s.sku_id].goods_name=e.goods_name,n[c+s.sku_id].goods_type_name=e.goods_type_name,n[c+s.sku_id].goods_type=e.goods_type}):e.skuList.forEach((s,a)=>{m.splice(m.indexOf(s.sku_id),1),delete n[c+s.sku_id]}),p.max&&p.max>0&&Object.keys(n).length>0&&Object.keys(n).length>p.max){let s=Object.keys(n).length;s=s-p.max,K(m).forEach((i,v,z)=>{if(v<s){let I=m.indexOf(i);delete n[c+m[I]],m.splice(I,1)}}),B()}},ie=(l,e,s)=>{let a=0;e.skuList.forEach((v,z)=>{v.threeLevelCheckAll&&a++}),a>0&&a!=e.skuList.length?(e.secondLevelCheckAll=!1,e.isSecondLevelIndeterminate=!0):a==e.skuList.length?(e.isSecondLevelIndeterminate=!1,e.secondLevelCheckAll=!0):(e.isSecondLevelIndeterminate=!1,e.secondLevelCheckAll=!1),F();let i=$(s);l?(m.push(i.sku_id),i.goods_name=e.goods_name,i.goods_type_name=e.goods_type_name,i.goods_type=e.goods_type,n[c+i.sku_id]=i):(m.splice(m.indexOf(i.sku_id),1),delete n[c+i.sku_id])},F=()=>{let l=0;o.data.forEach((e,s)=>{e.secondLevelCheckAll&&l++}),l>0&&l!=o.data.length?(P.value=!1,S.value=!0):l==o.data.length?(S.value=!1,P.value=!0):(S.value=!1,P.value=!1)},V=(l=1,e=null)=>{S.value=!1,P.value=!1,o.loading=!0,o.page=l;const s=K(o.searchParam);if(s.select_type=="selected"){const a=[];for(let i in n)a.push(parseInt(i.replace(c,"")));s[c+"ids"]=a}else s[c+"ids"]="";ze({page:o.page,limit:o.limit,...s}).then(a=>{o.loading=!1,o.data=a.data.data,o.total=a.data.total,o.data.forEach(i=>{i.isShow=!1,i.isSecondLevelIndeterminate=!1,i.secondLevelCheckAll=!1}),p.mode=="sku"&&o.data.forEach(i=>{i.skuList.length&&i.skuList.forEach(v=>{v.threeLevelCheckAll=!1,v.goods_type=i.goods_type})}),B()}).catch(()=>{o.loading=!1})},B=()=>{Se(()=>{if(p.mode=="spu")for(let l=0;l<o.data.length;l++)o.data[l].secondLevelCheckAll=!1,n[c+o.data[l].goods_id]&&(o.data[l].secondLevelCheckAll=!0);else{let l=!0;for(let e=0;e<o.data.length;e++)o.data[e].secondLevelCheckAll=!1,l=!0,o.data[e].isSecondLevelIndeterminate=!1,o.data[e].skuList.forEach((s,a)=>{s.threeLevelCheckAll=!1,n[c+s.sku_id]?(o.data[e].isSecondLevelIndeterminate=!0,s.threeLevelCheckAll=!0):l=!1}),l&&(o.data[e].isSecondLevelIndeterminate=!1,o.data[e].secondLevelCheckAll=!0)}F()})},ce=l=>{l&&(l.resetFields(),V())},re=()=>{for(let l in n)delete n[l];c=p.mode=="sku"?"sku_":"goods_",p.mode=="sku"?o.searchParam.verify_sku_ids=y.value:o.searchParam.verify_goods_ids=y.value,pe(),V(1,l=>{y.value&&(y.value.splice(0,y.value.length,...l),y.value.forEach(e=>{n[c+e]||(n[c+e]={})}))}),L.value=!0},pe=()=>{const l=K(o.searchParam);Me({...l}).then(e=>{const s=e.data;if(p.mode=="sku")for(let a=0;a<s.length;a++)s[a].skuList.forEach(i=>{y.value.indexOf(i.sku_id)!=-1&&(i.goods_name=s[a].goods_name,i.goods_type_name=s[a].goods_type_name,i.goods_type=s[a].goods_type,n[c+i.sku_id]=i)});else for(let a=0;a<s.length;a++)y.value.indexOf(s[a].goods_id)!=-1&&(n[c+s[a].goods_id]=s[a])})},ue=()=>{for(let l in n)delete n[l];B()},_e=()=>{if(p.min&&b.value<p.min){W({type:"warning",message:`${u("goodsSelectPopupGoodsMinTip")}${p.min}${u("goodsSelectPopupPiece")}`});return}if(p.max&&p.max>0&&b.value&&b.value>p.max){W({type:"warning",message:`${u("goodsSelectPopupGoodsMaxTip")}${p.max}${u("goodsSelectPopupPiece")}`});return}if(p.way=="single"){let e=0,s=0;for(let a in n)n[a].goods_type=="virtual"?s++:n[a].goods_type=="real"&&e++;if(e!=Object.keys(n).length&&s!=Object.keys(n).length){W({type:"warning",message:`${u("wayPlaceholder")}`});return}}let l=[];for(let e in n)l.push(parseInt(e.replace(c,"")));y.value.splice(0,y.value.length,...l),X("goodsSelect",n),ge(),L.value=!1},ge=()=>{o.searchParam.keyword="",o.searchParam.goods_category=[],o.searchParam.select_type="all",o.searchParam.goods_ids="",o.searchParam.verify_goods_ids="",o.searchParam.verify_sku_ids="",o.searchParam.goods_type=""};return le({showDialog:L,selectGoods:n,selectGoodsNum:b}),(l,e)=>{const s=Pe,a=Le,i=Ve,v=Ee,z=Ae,I=we,me=Ge,M=Ie,Q=Te,he=be("block"),fe=Oe,ve=Ne,ke=$e;return f(),x("div",null,[d("div",{onClick:re},[Ce(l.$slots,"default",{},()=>[_(s,null,{default:h(()=>[A(g(r(u)("goodsSelectPopupSelectGoodsButton")),1)]),_:1}),T(d("div",He,[d("span",null,g(r(u)("goodsSelectPopupSelect")),1),d("span",qe,g(r(y).length),1),d("span",null,g(r(u)("goodsSelectPopupPiece")),1)],512),[[H,r(y).length]])],!0)]),_(ve,{modelValue:L.value,"onUpdate:modelValue":e[11]||(e[11]=t=>L.value=t),title:r(u)("goodsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:h(()=>[d("span",As,[_(s,{onClick:e[10]||(e[10]=t=>L.value=!1)},{default:h(()=>[A(g(r(u)("cancel")),1)]),_:1}),_(s,{type:"primary",onClick:_e},{default:h(()=>[A(g(r(u)("confirm")),1)]),_:1})])]),default:h(()=>[_(me,{inline:!0,model:o.searchParam,ref_key:"searchFormRef",ref:Y},{default:h(()=>[_(v,{prop:"select_type",class:"form-item-wrap"},{default:h(()=>[_(i,{modelValue:o.searchParam.select_type,"onUpdate:modelValue":e[0]||(e[0]=t=>o.searchParam.select_type=t),onChange:te},{default:h(()=>[_(a,{label:r(u)("goodsSelectPopupAllGoods"),value:"all"},null,8,["label"]),_(a,{label:r(u)("goodsSelectPopupSelectedGoods"),value:"selected"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),_(v,{label:r(u)("goodsSelectPopupGoodsName"),prop:"keyword",class:"form-item-wrap"},{default:h(()=>[_(z,{modelValue:o.searchParam.keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>o.searchParam.keyword=t),placeholder:r(u)("goodsSelectPopupGoodsNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),_(v,{label:r(u)("goodsSelectPopupGoodsCategory"),prop:"goods_category",class:"form-item-wrap"},{default:h(()=>[_(I,{modelValue:o.searchParam.goods_category,"onUpdate:modelValue":e[2]||(e[2]=t=>o.searchParam.goods_category=t),options:j,placeholder:r(u)("goodsSelectPopupGoodsCategoryPlaceholder"),clearable:"",props:{value:"value",label:"label",emitPath:!1}},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),_(v,{label:r(u)("goodsSelectPopupGoodsType"),prop:"goods_type",class:"form-item-wrap"},{default:h(()=>[_(i,{modelValue:o.searchParam.goods_type,"onUpdate:modelValue":e[3]||(e[3]=t=>o.searchParam.goods_type=t),placeholder:r(u)("goodsSelectPopupGoodsTypePlaceholder"),clearable:""},{default:h(()=>[(f(!0),x(q,null,J(D,t=>(f(),O(a,{key:t.type,label:t.name,value:t.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),_(v,{class:"form-item-wrap"},{default:h(()=>[_(s,{type:"primary",onClick:e[4]||(e[4]=t=>V())},{default:h(()=>[A(g(r(u)("search")),1)]),_:1}),_(s,{onClick:e[5]||(e[5]=t=>ce(Y.value))},{default:h(()=>[A(g(r(u)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),T((f(),x("div",Je,[d("div",Ke,[We,d("div",Xe,[_(M,{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=t=>P.value=t),indeterminate:S.value,onChange:de},null,8,["modelValue","indeterminate"])]),Ye,De,Qe]),d("div",Ze,[(f(!0),x(q,null,J(o.data,(t,ye)=>(f(),x("div",{key:ye,class:"flex flex-col"},[d("div",es,[p.mode=="spu"?(f(),x("div",ss)):N("",!0),p.mode=="sku"?(f(),x("div",{key:1,class:se(["w-[3%] cursor-pointer text-center !text-[10px]",{"iconfont iconxiangyoujiantou":t.skuList.length,"arrow-show":t.isShow}]),onClick:k=>ae(t)},null,10,os)):N("",!0),d("div",ls,[_(M,{modelValue:t.secondLevelCheckAll,"onUpdate:modelValue":k=>t.secondLevelCheckAll=k,indeterminate:t.isSecondLevelIndeterminate,onChange:k=>ne(k,t)},null,8,["modelValue","onUpdate:modelValue","indeterminate","onChange"])]),d("div",ts,[d("div",as,[t.goods_cover_thumb_small?(f(),O(Q,{key:0,class:"w-[60px] h-[60px]",src:r(oe)(t.goods_cover_thumb_small),fit:"contain"},{error:h(()=>[ds]),_:2},1032,["src"])):(f(),x("img",ns))]),d("div",is,[d("span",{title:t.goods_name,class:"multi-hidden leading-[1.4]"},g(t.goods_name),9,cs),d("span",rs,g(t.goods_type_name),1)])]),d("div",ps,"￥"+g(t.goodsSku.price),1),d("div",us,g(t.stock),1)]),p.mode=="sku"?(f(),O(he,{key:0},{default:h(()=>[(f(!0),x(q,null,J(t.skuList,(k,Z)=>(f(),x("div",{key:Z,class:se(["flex items-center py-[8px] border-solid border-transparent border-b-[1px]",{hidden:!t.isShow,"border-[#e5e7eb]":Z==t.skuList.length-1}])},[_s,d("div",gs,[_(M,{modelValue:k.threeLevelCheckAll,"onUpdate:modelValue":R=>k.threeLevelCheckAll=R,onChange:R=>ie(R,t,k)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),d("div",ms,[d("div",hs,[k.sku_image?(f(),O(Q,{key:0,class:"w-[60px] h-[60px]",src:r(oe)(k.sku_image),fit:"contain"},{error:h(()=>[fs]),_:2},1032,["src"])):(f(),x("img",vs))]),d("div",ks,[d("span",{title:k.sku_name||t.goods_name,class:"multi-hidden leading-[1.4]"},g(k.sku_name||t.goods_name),9,ys),d("span",xs,g(t.goods_type_name),1)])]),d("div",bs,"￥"+g(k.price),1),d("div",Cs,g(k.stock),1)],2))),128))]),_:2},1024)):N("",!0)]))),128)),!o.data.length&&!o.loading?(f(),x("div",Ss," 暂无数据 ")):N("",!0)])])),[[ke,o.loading]]),d("div",Ps,[d("div",Ls,[T(d("div",Vs,[d("span",null,g(r(u)("goodsSelectPopupBeforeTip")),1),d("span",Es,g(r(b)),1),d("span",null,g(r(u)("goodsSelectPopupAfterTip")),1)],512),[[H,r(b)]]),T(_(s,{type:"primary",link:"",onClick:ue},{default:h(()=>[A(g(r(u)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[H,r(b)]])]),_(fe,{"current-page":o.page,"onUpdate:current-page":e[7]||(e[7]=t=>o.page=t),"page-size":o.limit,"onUpdate:page-size":e[8]||(e[8]=t=>o.limit=t),layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:e[9]||(e[9]=t=>V()),onCurrentChange:V},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const eo=Re(ws,[["__scopeId","data-v-23a05568"]]);export{eo as default};
