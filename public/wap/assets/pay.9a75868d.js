import{d as e,aS as a,bX as t,r as l,bE as r,a as s,g as p,h as o,o as n,c as d,w as u,Y as i,b as y,y as c,z as m,u as v,x as _,Z as x,I as f,K as g,J as h,l as b,f as S,H as k,i as w,a2 as C,E as I}from"./index-d8a8f699.js";import{_ as T}from"./u-image.e646392b.js";import{_ as j}from"./u-icon.5ba98c98.js";import{_ as E}from"./u-popup.0d48946e.js";import{p as P,g as R}from"./pay.974edcbe.js";import{_ as H}from"./_plugin-vue_export-helper.1b428a4d.js";const O=H(e({__name:"pay",emits:["close"],setup(e,{expose:H,emit:O}){a()&&t.init();const z=l(!1),U=l(!1),X=l(null),Z=l(""),$=()=>{var e,l;uni.$u.test.isEmpty(Z.value)?k({title:_("pay.notHavePayType"),icon:"none"}):U.value||(U.value=!0,P({trade_type:null==(e=X.value)?void 0:e.trade_type,trade_id:null==(l=X.value)?void 0:l.trade_id,type:Z.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,p,o,n,d;switch(Z.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{J()},cancel:()=>{U.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=X.value)?void 0:l.trade_type,trade_id:null==(r=X.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(p=X.value)?void 0:p.trade_type,trade_id:null==(o=X.value)?void 0:o.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(n=X.value)?void 0:n.trade_type,trade_id:null==(d=X.value)?void 0:d.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo",success(){}});J()}})).catch((()=>{U.value=!1})))};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const A=l(!1),J=()=>{var e,a;s({url:"/app/pages/pay/result",param:{trade_type:null==(e=X.value)?void 0:e.trade_type,trade_id:null==(a=X.value)?void 0:a.trade_id},mode:"redirectTo"})},K=()=>{uni.removeStorageSync("paymenting"),z.value=!1,O("close")};return H({open:(e,a,t="")=>{A.value||(A.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t)),R(e,a).then((e=>{let{data:a}=e;X.value=a,uni.$u.test.isEmpty(a)?k({title:_("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(Z.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",z.value=!0,A.value=!1):J()})).catch((()=>{A.value=!1})))}}),(e,a)=>{const t=w,l=p(o("u-image"),T),r=p(o("u-icon"),j),s=C,k=I,P=p(o("u-popup"),E);return n(),d(P,{show:z.value,round:10,onClose:K,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:u((()=>[X.value?(n(),d(t,{key:0,class:"flex flex-col h-[75vh]",onTouchmove:a[0]||(a[0]=i((()=>{}),["prevent","stop"]))},{default:u((()=>[y(t,{class:"head"},{default:u((()=>[y(t,{class:"text-center py-[26rpx]"},{default:u((()=>[c(m(v(_)("pay.payTitle")),1)])),_:1}),y(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx]"},{default:u((()=>[y(t,{class:"text-base mr-[4rpx]"},{default:u((()=>[c(m(v(_)("currency")),1)])),_:1}),c(" "+m(v(x)(X.value.money)),1)])),_:1})])),_:1}),y(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:u((()=>[y(t,{class:"flex text-sm px-[30rpx] py-[20rpx]"},{default:u((()=>[y(t,{class:"text-gray-500"},{default:u((()=>[c(m(v(_)("pay.orderInfo")),1)])),_:1}),y(t,{class:"text-right flex-1 pl-[30rpx] using-hidden"},{default:u((()=>[c(m(X.value.body),1)])),_:1})])),_:1}),y(t,{class:"mx-[30rpx] py-[10rpx] px-[30rpx] bg-white rounded-md bg-page"},{default:u((()=>[X.value.pay_type_list.length?(n(!0),f(g,{key:0},h(X.value.pay_type_list,((e,a)=>(n(),d(t,{class:"pay-item py-[18rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>Z.value=e.key},{default:u((()=>[y(l,{src:v(b)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),y(t,{class:"flex-1 px-[20rpx] text-sm font-bold"},{default:u((()=>[c(m(e.name),1)])),_:2},1024),e.key==Z.value?(n(),d(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):S("v-if",!0)])),_:2},1032,["onClick"])))),128)):(n(),d(t,{key:1,class:"py-[20rpx] text-center text-sm text-gray-subtitle"},{default:u((()=>[c(m(v(_)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),y(t,{class:"p-[30rpx]"},{default:u((()=>[y(k,{class:"primary-btn-bg h-[80rpx] rounded-[50rpx] leading-[80rpx] text-[28rpx] text-[#fff]","hover-class":"none",loading:U.value,onClick:$},{default:u((()=>[c(m(v(_)("pay.confirmPay")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):S("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-878b0b70"]]);export{O as _};
