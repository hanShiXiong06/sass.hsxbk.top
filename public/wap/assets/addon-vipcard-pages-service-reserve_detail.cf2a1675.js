import{o as e,c as t,w as i,b as a,f as l,P as s,Q as r,a7 as n,R as o,n as d,y as c,z as u,D as m,i as h,a6 as f,C as p,d as v,r as b,p as _,J as x,s as g,l as y,b8 as A,q as D,b9 as T,x as $,u as k,bV as w,a as C,B as Q,a5 as B,g as S,h as E,E as j,F as I,t as M}from"./index-7bf68536.js";import{_ as F}from"./u-picker.17389cd6.js";import{_ as V}from"./u-button.359d7329.js";import{_ as z}from"./pay.d2e850e8.js";import{_ as R}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{i as O,j as P,d as U,r as q,e as H,s as N}from"./vipcard.fb0aea23.js";import{_ as Y}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.b37701e7.js";import"./u-popup.be4bfacd.js";import"./u-transition.cdf87992.js";import"./u-icon.0c1c54c7.js";import"./u-safe-bottom.908eeae4.js";import"./u-image.e46f68ef.js";import"./pay.2db06871.js";import"./u-loading-page.566c330a.js";function J(e){return e<10?`0${e}`:e}function K(){const e=new Date,t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),l=t+"-"+J(i)+"-"+J(a),s=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return{date:l,time:J(s)+":"+J(r)+":"+J(n)}}function L(e,t){const i=new Date(e),a=i.getFullYear(),l=i.getMonth()+1,s=i.getDate(),r=i.getDay(),n=i.getHours(),o=i.getMinutes();return{allDate:`${a}/${J(l)}/${J(s)}`,date:`${J(a)}-${J(l)}-${J(s)}`,day:`星期${["日","一","二","三","四","五","六"][r]}`,hour:J(n)+":"+J(o)+(t?"":":00")}}const G=Y({name:"times",model:{prop:"showPop",event:"change"},props:{isQuantum:{type:Boolean,default:!1},isBtnAction:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1},isSection:{type:Boolean,default:!1},disableText:{type:String,default:"已约满"},undisableText:{type:String,default:"可预约"},timeInterval:{type:Number,default:1},selectedTabColor:{type:String,default:"#FB4B5C"},selectedItemColor:{type:String,default:"#FB4B5C"},selectedBorderColor:{type:String,default:"#FB4B5C"},beginTime:{type:String,default:"09:00:00"},endTime:{type:String,default:"19:00:00"},appointTime:{type:Array,default:()=>[]},disableTimeSlot:{type:Array,default:()=>[]}},watch:{appointTime:{handler(e){e&&e.length&&this.initOnload()}},disableTimeSlot:{handler(e){e&&e.length&&this.initOnload()}}},data:()=>({orderDateTime:"暂无选择",orderTimeArr:{},dateArr:[],timeArr:[],nowDate:"",dateActive:0,timeActive:0,timeQuanBeginIndex:0,selectDate:"",timeQuanBegin:"",timeQuanEnd:""}),created(e){this.selectDate=this.nowDate=K().date,this.initOnload()},methods:{initOnload(){this.dateArr=function(){const e=[],t=(new Date).getTime();let i=864e5,a={0:"今天",1:"明天",2:"后天"};for(let l=0;l<7;l++)e.push({date:L(t+i*l).date,timeStamp:t+i*l,week:a[l]?a[l]:L(t+i*l).day});return e}(),this.timeArr=function(e="10:00:00",t="21:00:00",i=1,a=!1){const l=[],s=L(Date.now()).allDate,r=`${s} ${t}`,n=new Date(`${s} ${e}`).getTime(),o=new Date(r).getTime(),d=36e5*i,c=(o-n)/d,u=c%2==0?c:c-1;let m=0;for(let h=n;h<=o;h+=d)if(a?(m++,l.push({begin:L(h,a).hour,end:L(h+d,a).hour,disable:!1})):l.push({time:L(h).hour,disable:!1}),a&&m>=u)return l;return l}(this.beginTime,this.endTime,this.timeInterval,this.isQuantum),this.timeQuanBegin=this.timeQuanEnd="";let e=!0;this.timeArr.forEach(((t,i)=>{if(this.isQuantum){const e=`${this.selectDate} ${t.begin}:00`,i=`${this.selectDate} ${t.end}:00`;for(let a of this.disableTimeSlot){const[l="",s=""]=a;l&&s&&l<=e&&i<=s&&(t.disable=!0)}if(this.selectDate==this.nowDate&&K().time>`${t.begin}:00`&&(t.disable=!0),this.orderTimeArr[this.selectDate])for(let a of this.orderTimeArr[this.selectDate])a[0].split(" ")[1]===`${t.begin}:00`&&a[1].split(" ")[1]===`${t.end}:00`&&(t.isActive=!0)}else{this.selectDate==this.nowDate&&K().time>t.time&&(t.disable=!0),this.appointTime.forEach((e=>{let[i,a]=e.split(" ");i==this.selectDate&&t.time==a&&(t.disable=!0)}));const i=`${this.selectDate} ${t.time}`;for(let e of this.disableTimeSlot){const[a="",l=""]=e;a&&l&&a<=i&&i<=l&&(t.disable=!0)}t.disable||(e=!1),this.isSection&&(t.isInclude=!1),this.isMultiple&&(this.orderTimeArr[this.selectDate]||[]).includes(t.time)&&(t.isActive=!0)}})),this.orderDateTime=e?"暂无选择":this.selectDate,this.timeActive=-1;for(let t=0,i=this.timeArr.length;t<i;t++)if(!this.timeArr[t].disable)return this.orderDateTime=`${this.selectDate} ${this.timeArr[t].time}`,void(this.timeActive=t)},selectDateEvent(e,t){this.dateActive=e,this.selectDate=t.date,this.initOnload()},selectTimeEvent(e,t){if(this.isQuantum)return this.handleSelectQuantum(e,t);t.disable||(this.isMultiple?(t.isActive=!t.isActive,this.timeArr=this.timeArr.slice(),this.orderTimeArr[this.selectDate]=this.timeArr.reduce(((e,t)=>(t.isActive&&e.push(t.time),e)),[])):(this.timeActive=e,this.orderDateTime=`${this.selectDate} ${t.time}`))},handleSection(e,t){if(!t.disable)if(this.timeQuanBegin)if(this.timeQuanEnd||!this.timeQuanBegin)this.timeQuanBegin&&this.timeQuanEnd&&(this.timeArr.forEach((e=>{e.isInclude=!1})),i.call(this));else{let a=!1,l=this.timeQuanBeginIndex,s=e;l>s&&([l,s]=[s,l]);for(let e=l+1;e<s;e++)if(this.timeArr[e].disable)return a=!0,void i.call(this);if(!a)for(let e=l+1;e<s;e++)this.timeArr[e].isInclude=!0;this.timeQuanEnd=t.time}else i.call(this);function i(){this.timeQuanBeginIndex=e,this.timeQuanBegin=t.time,this.timeQuanEnd=""}},handleSelectQuantum(e,t){t.disable||(this.isMultiple?(t.isActive=!t.isActive,this.timeArr=this.timeArr.slice(),this.orderTimeArr[this.selectDate]=this.timeArr.reduce(((e,t)=>{const i=`${this.selectDate} ${t.begin}:00`,a=`${this.selectDate} ${t.end}:00`;return t.isActive&&e.push([i,a]),e}),[])):(this.timeActive=e,this.orderDateTime={begin:`${this.selectDate} ${t.begin}:00`,end:`${this.selectDate} ${t.end}:00`}))},handleChange(){this.timeQuanBegin>this.timeQuanEnd&&([this.timeQuanBegin,this.timeQuanEnd]=[this.timeQuanEnd,this.timeQuanBegin])},handleSubmit(){if(this.isSection)return this.handleChange(),void this.$emit("change",{beginTime:`${this.selectDate} ${this.timeQuanBegin}`,endTime:`${this.selectDate} ${this.timeQuanEnd}`});if(this.isMultiple){if(this.isQuantum)return void this.$emit("change",this.orderTimeArr);let e=[];for(let t in this.orderTimeArr)this.orderTimeArr[t].forEach((i=>{e.push(`${t} ${i}`)}));this.$emit("change",e)}else this.$emit("change",this.orderDateTime)}}},[["render",function(v,b,_,x,g,y){const A=m,D=h,T=f,$=p;return e(),t(D,{class:"content"},{default:i((()=>[a(D,{class:"container"},{default:i((()=>[l(" 日期列表 "),a(T,{class:"scroll-view_H b-t b-b","scroll-x":""},{default:i((()=>[(e(!0),s(r,null,n(g.dateArr,((t,l)=>(e(),s("div",{key:l,class:o(["flex-box",{borderb:l==g.dateActive}]),onClick:e=>y.selectDateEvent(l,t),style:d({borderColor:_.selectedBorderColor})},[a(D,{class:"date-box",style:d({color:l==g.dateActive?_.selectedTabColor:"#333"})},{default:i((()=>[a(A,{class:"fontw"},{default:i((()=>[c(u(t.week),1)])),_:2},1024),a(A,{class:"text-xs"},{default:i((()=>[c(u(t.date),1)])),_:2},1024)])),_:2},1032,["style"])],14,["onClick"])))),128))])),_:1}),l(" 时间选项 "),!_.isSection||_.isQuantum?(e(),t(D,{key:0,class:"time-box"},{default:i((()=>[(e(!0),s(r,null,n(g.timeArr,((l,s)=>(e(),t(D,{key:s,class:"item"},{default:i((()=>[a(D,{class:o(["item-box",{disable:l.disable,active:_.isMultiple?l.isActive:s==g.timeActive}]),style:d({color:_.isMultiple?l.isActive?_.selectedItemColor:"#333":s==g.timeActive?_.selectedItemColor:"#333",borderColor:_.isMultiple?l.isActive:s==g.timeActive?_.selectedBorderColor:""}),onClick:e=>y.selectTimeEvent(s,l)},{default:i((()=>[_.isQuantum?(e(),t(A,{key:0},{default:i((()=>[c(u(l.begin)+"~"+u(l.end),1)])),_:2},1024)):(e(),t(A,{key:1},{default:i((()=>[c(u(l.time),1)])),_:2},1024)),a(A,{class:"all"},{default:i((()=>[c(u(l.disable?_.disableText:_.undisableText),1)])),_:2},1024)])),_:2},1032,["class","style","onClick"])])),_:2},1024)))),128))])),_:1})):(e(),s(r,{key:1},[l(" 预约时间段 "),a(D,{class:"time-box"},{default:i((()=>[(e(!0),s(r,null,n(g.timeArr,((l,s)=>(e(),t(D,{key:s,class:"item"},{default:i((()=>[a(D,{class:o(["item-box",{disable:l.disable||l.isInclude,active:l.time==g.timeQuanBegin||l.time==g.timeQuanEnd}]),style:d({color:l.time==g.timeQuanBegin||l.time==g.timeQuanEnd?_.selectedItemColor:"#333"}),onClick:e=>y.handleSection(s,l)},{default:i((()=>[a(A,null,{default:i((()=>[c(u(l.time),1)])),_:2},1024),a(A,{class:"all"},{default:i((()=>[c(u(l.disable?_.disableText:_.undisableText),1)])),_:2},1024)])),_:2},1032,["class","style","onClick"])])),_:2},1024)))),128))])),_:1})],2112))])),_:1}),_.isBtnAction?(e(),t(D,{key:0,class:"bottom"},{default:i((()=>[_.isMultiple||_.isSection||_.isQuantum?l("v-if",!0):(e(),t(D,{key:0,class:"show-time"},{default:i((()=>[c(" 预约时间："+u(g.orderDateTime),1)])),_:1})),a($,{"form-type":"submit",type:"default",size:"mini",class:"submit-btn",onClick:y.handleSubmit},{default:i((()=>[c(" 确认预约 ")])),_:1},8,["onClick"])])),_:1})):l("v-if",!0)])),_:1})}],["__scopeId","data-v-8b3cd6a5"]]),W=Y(v({__name:"reserve_detail",setup(s){const r=e=>{Y.value.reserve_date=e};let n=b([]),o=b(!0),f=b([[]]),p=b(!1),v=b(null),Y=b({member_id:"",reserve_name:"",reserve_date:"",goods_id:"",remark:"",technician_id:"",technician_name:"",mobile:""});_((e=>{o.value=!0,Y.value.goods_id=e.id,O(e.id).then((e=>{n.value=e.data,x({title:n.value.goods_name}),o.value=!1})),g()&&K.getMemberInfo(),P().then((e=>{e.data.length&&e.data.forEach(((e,t)=>{let i={};i.label=e.name,i.id=e.id,f.value[0].push(i)}))}))}));const J=e=>{Y.value.technician_id=e.value[0].id,Y.value.technician_name=e.value[0].label,p.value=!1},K=y(),{query:L}=A(location.href);L.code&&D()&&T({code:L.code}).then((e=>{K.getMemberInfo()}));const W=b(null);let X=0;const Z=e=>{Y.value.member_id=K.info.member_id,Y.value.reserve_name=K.info.nickname,v.value.handleSubmit(),(uni.$u.test.isEmpty(Y.value.mobile)?(M({title:I("mobilePlaceholder"),icon:"none"}),0):uni.$u.test.mobile(Y.value.mobile)||(M({title:I("correctMobilePlaceholder"),icon:"none"}),0))&&q(Y.value).then((e=>{var t;n.value.is_reserve_pay?(X=e.data.reserve_id,null==(t=W.value)||t.open(e.data.trade_type,e.data.trade_id,`/addon/vipcard/pages/order/detail?order_id=${e.data.trade_id}`)):(uni.setStorageSync("reserveReturn",encodeURIComponent(`/addon/vipcard/pages/order/my_reserved_detail?id=${e.data.reserve_id}`)),C({url:"/addon/vipcard/pages/reserve/result",mode:"redirectTo"}))}))},ee=()=>{C({url:"/addon/vipcard/pages/order/my_reserved_detail",param:{id:X},mode:"redirectTo"})},te=b(0);$((()=>{g()&&setTimeout((function(){ie()}),700)}));const ie=()=>{U({goods_id:Y.value.goods_id,type:"vipcard"}).then((e=>{e.data&&(te.value=e.data.id),e.data||(te.value=0)}))},ae=()=>{g()&&(te.value>0?H(te.value).then((()=>{ie()})):N({goods_id:Y.value.goods_id,type:"vipcard"}).then((()=>{ie()})))};return(s,b)=>{const _=Q,x=h,g=m,y=B,A=S(E("u-picker"),F),D=S(E("u-button"),V),T=S(E("pay"),z),$=S(E("loading-page"),R);return e(),t(x,{style:d(s.themeColor())},{default:i((()=>[k(o)?l("v-if",!0):(e(),t(x,{key:0,class:"bg-[#F6F8FA] min-h-screen overflow-hidden"},{default:i((()=>[a(x,{class:"outline-border"},{default:i((()=>[a(_,{class:"w-[240rpx] h-[180rpx] rounded mr-3",src:k(j)(k(n).cover_thumb_mid),mode:"aspectFill"},null,8,["src"]),a(x,{class:"flex flex-col py-1 flex-1"},{default:i((()=>[a(x,{class:"font-bold multi-hidden"},{default:i((()=>[c(u(k(n).goods_name),1)])),_:1}),k(n).keywords?(e(),t(x,{key:0,class:"text-xs text-[var(--text-color-light6)]"},{default:i((()=>[c(u(k(n).keywords),1)])),_:1})):l("v-if",!0),a(x,{class:"mt-auto font-bold text-[#FF3223]"},{default:i((()=>[c("￥"+u(k(n).price),1)])),_:1})])),_:1})])),_:1}),l(" 预约技师 "),a(x,{class:"outline-border flex-justify"},{default:i((()=>[a(x,{class:"flex-align"},{default:i((()=>[a(g,{class:"nc-iconfont nc-icon-qiuzhirenyuanV6xx1 text-[28rpx] text-[#4D4D4D] font-bold"}),a(y,{class:"uni-input text-sm ml-2",placeholder:k(I)("selectTechnician"),disabled:"true",modelValue:k(Y).technician_name,"onUpdate:modelValue":b[0]||(b[0]=e=>k(Y).technician_name=e)},null,8,["placeholder","modelValue"])])),_:1}),a(x,{class:"flex-align text-[#63676D]",onClick:b[1]||(b[1]=e=>w(p)?p.value=!0:p=!0)},{default:i((()=>[a(g,{class:"text-sm"},{default:i((()=>[c(u(k(I)("pleaseChoose")),1)])),_:1}),a(g,{class:"text-[26rpx] nc-iconfont nc-icon-youV6xx"})])),_:1})])),_:1}),a(A,{show:k(p),columns:k(f),keyName:"label",onConfirm:J,onCancel:b[2]||(b[2]=e=>w(p)?p.value=!1:p=!1)},null,8,["show","columns"]),l(" 预约时间 "),a(x,{class:"outline-border flex-col"},{default:i((()=>[a(x,{class:"flex-justify !w-full"},{default:i((()=>[a(x,{class:"flex-align"},{default:i((()=>[a(g,{class:"text-[28rpx] text-[#4D4D4D] font-bold nc-iconfont nc-icon-a-shijianV6xx-36"}),a(g,{class:"text-sm ml-2"},{default:i((()=>[c(u(k(I)("reserveTime")),1)])),_:1})])),_:1})])),_:1}),a(x,{class:"mt-2"},{default:i((()=>[a(G,{selectedItemColor:"var(--primary-color)",selectedTabColor:"var(--primary-color)",selectedBorderColor:"var(--primary-color)",onChange:r,ref_key:"prettyTimesRef",ref:v,isMultiple:!1},null,512)])),_:1})])),_:1}),l(" 手机号 "),a(x,{class:"outline-border flex-justify"},{default:i((()=>[a(g,{class:"text-sm"},{default:i((()=>[c(u(k(I)("mobile")),1)])),_:1}),a(x,{class:"flex-align text-[#63676D]"},{default:i((()=>[a(y,{class:"uni-input text-sm ml-2 text-right",type:"number",placeholder:k(I)("mobilePlaceholder"),modelValue:k(Y).mobile,"onUpdate:modelValue":b[3]||(b[3]=e=>k(Y).mobile=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1}),l(" 备注 "),a(x,{class:"outline-border flex-justify"},{default:i((()=>[a(g,{class:"text-sm"},{default:i((()=>[c(u(k(I)("remark")),1)])),_:1}),a(x,{class:"flex-align text-[#63676D]"},{default:i((()=>[a(y,{class:"uni-input text-sm ml-2 text-right",placeholder:k(I)("fillRemark"),modelValue:k(Y).remark,"onUpdate:modelValue":b[4]||(b[4]=e=>k(Y).remark=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1}),a(x,{class:"h-[84rpx] tab-bar-placeholder w-screen"}),a(x,{class:"flex justify-between bg-white px-3 tab-bar fixed z-10 bottom-0 left-0 right-0"},{default:i((()=>[a(x,{class:"flex items-center"},{default:i((()=>[a(x,{class:"flex flex-col items-center mr-[44rpx]",onClick:b[5]||(b[5]=e=>k(C)({url:"/addon/vipcard/pages/index",mode:"reLaunch"}))},{default:i((()=>[a(_,{class:"w-[44rpx] h-[44rpx]",src:k(j)("addon/vipcard/vipcard/service/index.png"),mode:"aspectFill"},null,8,["src"]),a(g,{class:"text-xs whitespace-nowrap text-[#454545] mt-1"},{default:i((()=>[c(u(k(I)("index")),1)])),_:1})])),_:1}),a(x,{class:"flex flex-col items-center mr-[44rpx]"},{default:i((()=>[a(_,{class:"w-[44rpx] h-[44rpx]",src:k(j)("addon/vipcard/vipcard/service/service.png"),mode:"aspectFill"},null,8,["src"]),a(g,{class:"text-xs whitespace-nowrap text-[#454545] mt-1"},{default:i((()=>[c(u(k(I)("service")),1)])),_:1})])),_:1}),a(x,{class:"flex flex-col items-center mr-[44rpx]",onClick:ae},{default:i((()=>[te.value>0?(e(),t(_,{key:0,class:"w-[44rpx] h-[44rpx]",src:k(j)("addon/vipcard/vipcard/service/select_collect.png"),mode:"aspectFill"},null,8,["src"])):(e(),t(_,{key:1,class:"w-[44rpx] h-[44rpx]",src:k(j)("addon/vipcard/vipcard/service/collect.png"),mode:"aspectFill"},null,8,["src"])),a(g,{class:"text-xs whitespace-nowrap text-[#454545] mt-1"},{default:i((()=>[c(u(k(I)("collect")),1)])),_:1})])),_:1})])),_:1}),a(D,{text:k(n).is_reserve?k(I)("reserve"):k(I)("buy"),class:"flex-1 !rounded-3xl !m-1",type:"primary",size:"16",onClick:b[6]||(b[6]=e=>Z(k(n)))},null,8,["text"])])),_:1}),a(T,{ref_key:"payRef",ref:W,onClose:ee},null,512)])),_:1})),a($,{loading:k(o)},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-808442bc"]]);export{W as default};
