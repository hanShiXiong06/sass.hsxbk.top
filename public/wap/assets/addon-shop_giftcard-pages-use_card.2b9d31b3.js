import{d as e,l as t,r as a,p as r,F as l,K as s,s as d,H as o,x as c,o as i,c as u,w as n,P as p,b as f,u as x,R as _,y as g,z as m,f as v,Q as b,a7 as y,n as h,a as k,B as w,D as j,C as F,i as T,g as C,h as S,E as z,A as G}from"./index-7bf68536.js";import{_ as A}from"./u-parse.525658f5.js";import{_ as E}from"./uni-popup.3d2f7726.js";import{_ as O}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{h as B,u as D,i as R}from"./card.83abd190.js";import{_ as V}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-page.566c330a.js";import"./u-loading-icon.b37701e7.js";import"./u-transition.cdf87992.js";const I=V(e({__name:"use_card",setup(e){const V=t(),I=a({}),L=a(!0),P=a(!1);r((e=>{if(e.card_id){if(!d())return o().setLoginBack({url:"/addon/shop_giftcard/pages/use_card",param:{card_id:e.card_id}}),!1;H(e.card_id)}else{let e={url:"/addon/shop_giftcard/pages/index",title:l("notCard"),mode:"reLaunch"};s(e)}})),c((()=>{Object.keys(I.value).length&&H(I.value.card_id)}));const H=e=>{L.value=!0,B(e).then((e=>{I.value=e.data,L.value=!1})).catch((()=>{L.value=!1}))},K=()=>{k({url:"/addon/shop_giftcard/pages/my_card_list",mode:"redirectTo"})},M=e=>{let t="";return t="balance"==e.giftcard.card_right_type?"addon/shop_giftcard/diy/index/value_card.jpg":"addon/shop_giftcard/diy/index/redemption_card.jpg",t},Q=a(),U=e=>{if("use"==e)if("goods"==I.value.giftcard.card_right_type)if("all"==I.value.giftcard.card_goods_type&&"all"==I.value.giftcard.delivery_way){if(P.value)return;let e={card_id:I.value.card_id,sku_data:[]};e.sku_data=I.value.cardGoods.map((e=>({sku_id:e.sku_id,num:e.total_num-e.use_num}))),P.value=!0,D(e).then((e=>{P.value=!1,e.data&&uni.setStorage({key:"orderCreateData",data:e.data,success:()=>{k({url:"/addon/shop/pages/order/payment"})}})})).catch((()=>{P.value=!1}))}else k({url:"/addon/shop_giftcard/pages/use_goods_select",param:{card_id:I.value.card_id}});else R({card_id:I.value.card_id}).then((e=>{P.value=!1,e.data&&V.getMemberInfo((()=>{Q.value.open()}))})).catch((()=>{P.value=!1}));else uni.getStorageSync("give_id")&&uni.removeStorageSync("give_id"),k({url:"/addon/shop_giftcard/pages/give",param:{card_id:I.value.card_id}})},q=()=>{Q.value.close(),k({url:"/app/pages/member/balance"})},J=()=>{H(I.value.card_id),Q.value.close()};return(e,t)=>{const a=w,r=j,s=F,d=T,o=C(S("u-parse"),A),c=C(S("uni-popup"),E),B=C(S("loading-page"),O);return i(),u(d,{class:"bg-[#f8f8f8] min-h-[100vh]",style:h(e.themeColor())},{default:n((()=>[Object.keys(I.value).length?(i(),p(b,{key:0},[f(d,{class:"px-[var(--sidebar-m)] py-[var(--top-m)]"},{default:n((()=>[f(d,{class:"w-full h-[430rpx] relative"},{default:n((()=>[I.value.card_cover?(i(),u(a,{key:0,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:x(z)(I.value.card_cover||""),onError:t[0]||(t[0]=e=>I.value.card_cover=M(I.value)),mode:"aspectFill"},null,8,["src"])):(i(),u(a,{key:1,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:x(z)(M(I.value)),mode:"aspectFill"},null,8,["src"])),f(d,{class:"absolute bottom-[var(--pad-top-m)] left-0 right-0 flex justify-center"},{default:n((()=>[f(s,{class:_([{"!bg-[#EF000C]":"balance"==I.value.giftcard.card_right_type,"!bg-[#FF7700]":"goods"==I.value.giftcard.card_right_type},"h-[44rpx] font-500 text-[24rpx] !text-[#fff] m-0 rounded-[var(--rounded-big)] remove-border"])},{default:n((()=>[f(r,{class:_(["text-[20rpx] text-[24rpx] iconfont mr-[5rpx]",{iconchuzhikaV6mm:"balance"==I.value.giftcard.card_right_type,"iconduihuankaV6mm-1":"goods"==I.value.giftcard.card_right_type}])},null,8,["class"]),"balance"==I.value.giftcard.card_right_type?(i(),u(r,{key:0,class:"leading-[44rpx]"},{default:n((()=>[g(m(I.value.balance)+m(x(l)("yuan")),1)])),_:1})):v("v-if",!0),f(r,{class:"leading-[44rpx]"},{default:n((()=>[g(m(I.value.giftcard.card_right_type_name),1)])),_:1})])),_:1},8,["class"])])),_:1}),f(d,{class:"absolute top-[var(--pad-top-m)] left-0 right-0 flex justify-between px-[var(--pad-sidebar-m)]"},{default:n((()=>[f(d,{class:"h-[36rpx] leading-[36rpx] text-[26rpx] font-800 text-stroke"},{default:n((()=>[g(m(I.value.card_no),1)])),_:1})])),_:1})])),_:1}),f(d,{class:"text-[34rpx] font-500 leading-[48rpx] px-[var(--sidebar-m)] mt-[var(--top-m)] text-center"},{default:n((()=>[g(m(I.value.giftcard.card_name),1)])),_:1}),v(' <view class="mt-[var(--top-m)] card-template">\r\n\t\t\t\t\t<view class="card-template-item justify-between">\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-400">卡片类型</text>\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-400">{{detail.giftcard.card_right_type_name}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class="card-template-item justify-between">\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-400">卡片面值</text>\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-500">￥{{detail.balance}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view> '),"goods"==I.value.giftcard.card_right_type?(i(),u(d,{key:0,class:"mt-[var(--top-m)] card-template"},{default:n((()=>[f(d,{class:"flex items-center"},{default:n((()=>[f(r,{class:"title !mb-0"},{default:n((()=>[g(m(x(l)("convertibleGoods")),1)])),_:1}),"diy"==I.value.giftcard.card_goods_type?(i(),u(r,{key:0,class:"text-[24rpx] text-[var(--text-color-light9)] leading-[34rpx] ml-[10rpx]"},{default:n((()=>[g(m(x(l)("goodsTitleOne"))+m(I.value.total_num)+m(x(l)("goodsTitleOneAnd")),1)])),_:1})):(i(),u(r,{key:1,class:"text-[24rpx] text-[var(--text-color-light9)] leading-[34rpx] ml-[10rpx]"},{default:n((()=>[g(m(x(l)("goodsTitleTwo")),1)])),_:1}))])),_:1}),(i(!0),p(b,null,y(I.value.cardGoods,((e,t)=>(i(),u(d,{key:t,class:"mt-[var(--pad-top-m)] flex",onClick:G((t=>x(k)({url:"/addon/shop/pages/goods/detail",param:{sku_id:e.sku_id}})),["stop"])},{default:n((()=>[e.sku_image?(i(),u(a,{key:0,class:"w-[210rpx] h-[210rpx] rounded-[var(--rounded-mid)]",src:x(z)(e.sku_image),mode:"aspectFill",onError:t=>e.sku_image="static/resource/images/diy/shop_default.jpg"},null,8,["src","onError"])):(i(),u(a,{key:1,class:"w-[210rpx] h-[210rpx] rounded-[var(--rounded-mid)]",src:x(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])),f(d,{class:"ml-[20rpx] flex-1 flex flex-col justify-between"},{default:n((()=>[f(d,{class:"w-full"},{default:n((()=>[f(d,{class:"max-w-[432rpx] text-[28rpx] leading-[40rpx] font-400 truncate text-[#303133]"},{default:n((()=>[g(m(e.goods_name),1)])),_:2},1024),f(d,{class:"mt-[15rpx] flex items-center justify-between"},{default:n((()=>[f(d,{class:"text-[24rpx] text-[var(--text-color-light6)] font-400 truncate leading-[34rpx] w-[432rpx]"},{default:n((()=>[g(m(e.sku_name),1)])),_:2},1024)])),_:2},1024),"all"==I.value.giftcard.card_goods_type?(i(),u(d,{key:0,class:"mt-[20rpx] text-[24rpx] text-[var(--text-color-light6)] font-400 truncate leading-[34rpx] max-w-[432rpx]"},{default:n((()=>[g(m(x(l)("cardGoodsTypeAllTips"))+m(e.total_num)+m(x(l)("cardGoodsTypeAllTipsAnd"))+m(e.use_num)+m(x(l)("unit")),1)])),_:2},1024)):v("v-if",!0)])),_:2},1024),f(d,{class:"flex items-center justify-between"},{default:n((()=>[f(d,{class:"text-[var(--price-text-color)] flex items-baseline"},{default:n((()=>[f(r,{class:"text-[22rpx] price-font"},{default:n((()=>[g("￥")])),_:1}),f(r,{class:"text-[36rpx] font-500 price-font"},{default:n((()=>[g(m(parseFloat(e.price).toFixed(2).split(".")[0]),1)])),_:2},1024),f(r,{class:"text-[22rpx] font-500 price-font"},{default:n((()=>[g("."+m(parseFloat(e.price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),"all"==I.value.giftcard.card_goods_type?(i(),u(d,{key:0,class:"font-400 text-[28rpx] text-[#303133]"},{default:n((()=>[f(r,null,{default:n((()=>[g("x")])),_:1}),f(r,null,{default:n((()=>[g(m(e.total_num),1)])),_:2},1024)])),_:2},1024)):v("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):v("v-if",!0),I.value.giftcard.instruction?(i(),u(d,{key:1,class:"mt-[var(--top-m)] card-template"},{default:n((()=>[f(d,{class:"title"},{default:n((()=>[g(m(x(l)("instruction")),1)])),_:1}),f(d,{class:"u-content"},{default:n((()=>[f(o,{content:I.value.giftcard.instruction,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):v("v-if",!0),I.value.giftcard.card_desc?(i(),u(d,{key:2,class:"mt-[var(--top-m)] card-template"},{default:n((()=>[f(d,{class:"title"},{default:n((()=>[g(m(x(l)("cardDesc")),1)])),_:1}),f(d,{class:"u-content"},{default:n((()=>[f(o,{content:I.value.giftcard.card_desc,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):v("v-if",!0)])),_:1}),f(d,{class:"tab-bar-placeholder"}),f(d,{class:"border-[0] border-t-[2rpx] border-solid border-[#f5f5f5] w-[100%] flex justify-between pl-[30rpx] pr-[20rpx] bg-[#fff] box-border fixed left-0 bottom-0 tab-bar z-1 items-center"},{default:n((()=>[f(d,{class:"flex items-center mr-[30rpx]"},{default:n((()=>[f(d,{class:"flex flex-col justify-center items-center",onClick:K},{default:n((()=>[f(d,{class:"iconfont nc-icon-kabao text-[36rpx]"}),f(r,{class:"text-[20rpx] mt-[10rpx]"},{default:n((()=>[g(m(x(l)("cardBag")),1)])),_:1})])),_:1})])),_:1}),f(d,{class:"flex-1 flex items-center"},{default:n((()=>["to_use"==I.value.status&&I.value.giftcard.is_give?(i(),u(s,{key:0,class:"w-[300rpx] !h-[70rpx] font-500 text-[26rpx] !text-[var(--primary-color)] !m-0 !mr-[16rpx] leading-[66rpx] border-[var(--primary-color)] border-solid border-[2rpx] rounded-full !bg-[#fff]",onClick:t[1]||(t[1]=e=>U("give"))},{default:n((()=>[g(m(x(l)("giftToFriends")),1)])),_:1})):v("v-if",!0),"to_use"==I.value.status||"can_use"==I.value.status?(i(),u(s,{key:1,class:_(["flex-1 min-w-[300rpx] !h-[70rpx] font-500 text-[26rpx] !text-[#fff] primary-btn-bg !m-0 leading-[70rpx] rounded-full remove-border",{"opacity-40":P.value}]),onClick:t[2]||(t[2]=e=>U("use"))},{default:n((()=>[g(m(x(l)("canUse")),1)])),_:1},8,["class"])):v("v-if",!0),"used"==I.value.status?(i(),u(s,{key:2,class:"w-full h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] !bg-[var(--text-color-light9)] m-0 rounded-full opacity-40 remove-border"},{default:n((()=>[g(m(x(l)("used")),1)])),_:1})):v("v-if",!0),"invalid"==I.value.status?(i(),u(s,{key:3,class:"w-full h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] !bg-[var(--text-color-light9)] m-0 rounded-full opacity-40 remove-border"},{default:n((()=>[g(m(x(l)("invalid")),1)])),_:1})):v("v-if",!0)])),_:1})])),_:1}),f(c,{ref_key:"popupRef",ref:Q,type:"center","is-mask-click":!1},{default:n((()=>[f(d,{class:"bg-[#fff] w-[530rpx] min-h-[504rpx] rounded-[var(--rounded-big)] box-border p-[32rpx] relative",style:h({"background-image":"url("+x(z)("addon/shop_giftcard/popup_bg.png")+")",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"top"})},{default:n((()=>[f(a,{class:"w-[327rpx] h-[327rpx] rounded-[var(--rounded-mid)] absolute left-[50%] top-[-163.5rpx] transform -translate-x-1/2 z-10",src:x(z)("addon/shop_giftcard/popup_top_balance.png"),mode:"aspectFill"},null,8,["src"]),f(d,{class:"text-[40rpx] leading-[56rpx] font-bold text-center pt-[174rpx]"},{default:n((()=>[g(m(x(l)("popupTipsOne")),1)])),_:1}),f(d,{class:"text-[24rpx] leading-[34rpx] text-center mt-[30rpx]"},{default:n((()=>[g(m(I.value.balance)+m(x(l)("popupTipsTwo")),1)])),_:1}),f(s,{class:"w-[370rpx] h-[80rpx] font-500 text-[26rpx] leading-[80rpx] !text-[#fff] primary-btn-bg m-0 !mx-auto rounded-[40rpx] remove-border mt-[90rpx]",onClick:q},{default:n((()=>[g(m(x(l)("gouToSee")),1)])),_:1}),f(d,{class:"nc-iconfont nc-icon-cuohaoV6xx text-[57rpx] text-[#fff] absolute left-[50%] bottom-[-117rpx] transform -translate-x-1/2 z-10",onClick:J})])),_:1},8,["style"])])),_:1},512)],64)):v("v-if",!0),f(B,{loading:L.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-8f1ef970"]]);export{I as default};
