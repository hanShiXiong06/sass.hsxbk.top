import{d as e,l as t,j as o,r as s,x as l,_ as a,F as r,o as u,c as d,w as i,u as n,b as c,y as p,z as x,P as m,a7 as f,Q as g,f as _,R as b,n as v,H as k,t as h,a as y,B as w,i as j,C as S,D as F,g as C,h as V,a6 as E,E as z,A as $,s as B,ah as I,a5 as U}from"./index-7bf68536.js";import{_ as D}from"./u--image.b3bf1d5c.js";import{_ as T}from"./u-number-box.30c0ab2e.js";import{_ as A}from"./u-swipe-action-item.22285616.js";import{_ as N}from"./u-swipe-action.4d9d59b1.js";import{_ as R}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{_ as H}from"./tabbar.e049672c.js";import{u as L,g as M}from"./cart.6bce9836.js";import{b as P}from"./bind-mobile.37d1c6df.js";import{u as G}from"./useGoods.e187513d.js";import{_ as J}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.e46f68ef.js";import"./u-icon.0c1c54c7.js";import"./u-transition.cdf87992.js";import"./u-loading-page.566c330a.js";import"./u-loading-icon.b37701e7.js";import"./u-badge.d8d91719.js";import"./u-tabbar.d98653fa.js";import"./u-safe-bottom.908eeae4.js";import"./cloneDeep.77735539.js";import"./u-form.78a4f7c2.js";import"./u-line.463a2a45.js";import"./sms-code.vue_vue_type_script_setup_true_lang.eace8f61.js";import"./u-input.09a5cedd.js";import"./u-modal.b47eb877.js";import"./u-popup.be4bfacd.js";import"./u-checkbox-group.b2a485bf.js";const K=J(e({__name:"cart",setup(e){const J=G(),K=t(),O=o((()=>K.info)),Q=s(!0),W=s(!1),X=s("0.00"),Y=s([]),Z=s([]),q=s(!1),ee=s(!0),te=L(),oe=()=>{M({}).then((({data:e})=>{Y.value=[],Z.value=[],Q.value=!1,e.forEach((e=>{e.checked=!1,e.goodsSku&&(e.goods.status&&0==e.goods.delete_time&&e.goodsSku.stock?(e.num>e.goodsSku.stock&&(e.num=e.goodsSku.stock),Y.value.push(e)):Z.value.push(e))})),de(),ee.value&&(ee.value=!1)})).catch((e=>{401==e.code&&(Y.value=[],Z.value=[],Q.value=!1)}))};l((()=>{oe(),te.getList()}));const se=o((()=>{let e=0;return Y.value.forEach((t=>{t.checked&&(e+=1)})),e}));a((()=>Y.value),(()=>{let e=0;Y.value.forEach((t=>{if(t.checked&&t.goodsSku){let o=0;o=t.goods.member_discount&&B()&&t.goodsSku.member_price!=t.goodsSku.price?t.goodsSku.member_price:t.goodsSku.price,e+=parseFloat(o)*t.num}})),X.value=e}),{deep:!0});const le=()=>{k().setLoginBack({url:"/addon/shop/pages/goods/cart"})},ae=e=>{let t={min:1,max:e.goodsSku.stock||1};if(e.goods.is_limit&&e.goods.max_buy){let o=0;o=e.goods.max_buy,o>e.goods.stock?t.max=e.stock:o<=e.goods.stock&&(t.max=o)}return e.goods.min_buy>0&&(t.min=e.goods.min_buy),t},re=s([{text:r("delete"),style:{backgroundColor:"#EF000C",width:"100rpx",height:"100%",borderRadius:"10rpx"}}]),ue=s(),de=()=>{const e=Y.value.length!=se.value;Y.value.forEach((t=>{t.checked=e}))},ie=s(null);s(uni.getStorageSync("isbindmobile"));const ne=()=>{if(uni.getStorageSync("isbindmobile"))return ie.value.open(),!1;if(!se.value)return void h({title:"还没有选择商品",icon:"none"});const e=[];Y.value.forEach((t=>{t.checked&&e.push(t.id)})),uni.setStorage({key:"orderCreateData",data:{cart_ids:e},success(){y({url:"/addon/shop/pages/order/payment"})}})},ce=()=>{if(!se.value)return void h({title:"还没有选择商品",icon:"none"});if(W.value)return;W.value=!0;const e=[];Y.value.forEach((t=>{t.checked&&e.push(t.id)})),te.delete(e,(()=>{oe(),W.value=!1}))},pe=()=>{if(W.value)return;W.value=!0;const e=Z.value.map((e=>e.id));te.delete(e,(()=>{oe(),W.value=!1})),Z.value=[]},xe=e=>{let t="0.00";return t=e.goods.member_discount&&B()&&e.goodsSku.member_price!=e.goodsSku.price&&e.goodsSku.member_price?e.goodsSku.member_price:e.goodsSku.price,t};return(e,t)=>{const o=w,s=j,l=S,a=F,r=C(V("u--image"),D),k=U,B=C(V("u-number-box"),T),L=C(V("u-swipe-action-item"),A),M=C(V("u-swipe-action"),N),G=E,K=C(V("loading-page"),R),ee=C(V("tabbar"),H);return u(),d(s,{style:v(e.themeColor())},{default:i((()=>[Q.value?_("v-if",!0):(u(),d(s,{key:0,class:"bg-page h-screen overflow-hidden flex flex-col"},{default:i((()=>[n(O)?Y.value.length||Z.value.length?(u(),d(s,{key:2,class:"flex-1 h-0"},{default:i((()=>[c(G,{class:"scroll-height","scroll-y":!0},{default:i((()=>[c(s,{class:"py-[var(--top-m)] sidebar-margin"},{default:i((()=>[Y.value.length?(u(),d(s,{key:0,class:"bg-[#fff] pb-[10rpx] box-border rounded-[var(--rounded-big)]"},{default:i((()=>[c(s,{class:"flex mx-[var(--rounded-big)] pt-[var(--pad-top-m)] justify-between items-center box-border font-400 text-[24rpx] mb-[24rpx] leading-[30rpx]"},{default:i((()=>[c(s,{class:"flex items-baseline text-[24rpx] text-[#333]"},{default:i((()=>[c(a,null,{default:i((()=>[p("共")])),_:1}),c(a,{class:"text-[32rpx] mx-[2rpx] text-[var(--price-text-color)]"},{default:i((()=>[p(x(Y.value.length),1)])),_:1}),c(a,null,{default:i((()=>[p("种商品")])),_:1})])),_:1}),c(a,{onClick:t[1]||(t[1]=e=>q.value=!q.value),class:"text-[var(--text-color-light6)] text-[24rpx]"},{default:i((()=>[p(x(q.value?"完成":"管理"),1)])),_:1})])),_:1}),c(M,{ref_key:"swipeActive",ref:ue},{default:i((()=>[(u(!0),m(g,null,f(Y.value,((e,l)=>(u(),m(g,null,[e.goodsSku?(u(),d(s,{key:0,class:"py-[20rpx] overflow-hidden w-full"},{default:i((()=>[c(L,{options:re.value,onClick:t=>((e,t)=>{W.value||(W.value=!0,te.delete(t.id,(()=>{Y.value.splice(e,1),I((()=>{ue.value&&ue.value.closeOther()})),W.value=!1})))})(l,e)},{default:i((()=>[c(s,{class:"flex px-[var(--pad-sidebar-m)]",onClick:$((t=>e.checked=!e.checked),["stop"])},{default:i((()=>[c(s,{class:"self-center w-[58rpx] h-[60rpx] flex items-center"},{default:i((()=>[c(a,{class:b(["iconfont text-color text-[34rpx] w-[34rpx] h-[34rpx] rounded-[17rpx] overflow-hidden shrink-0",{iconxuanze1:e.checked,"bg-[#F5F5F5]":!e.checked}])},null,8,["class"])])),_:2},1024),c(s,{class:"w-[200rpx] h-[200rpx] flex items-center justify-center rounded-[var(--goods-rounded-big)] overflow-hidden"},{default:i((()=>[c(r,{radius:"var(--goods-rounded-big)",width:"200rpx",height:"200rpx",onClick:t=>{y({url:"/addon/shop/pages/goods/detail",param:{goods_id:e.goods_id}})},src:n(z)(e.goodsSku.sku_image_thumb_mid||""),model:"aspectFill"},{error:i((()=>[c(o,{class:"w-[200rpx] h-[200rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:n(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["onClick","src"])])),_:2},1024),c(s,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:i((()=>[c(s,{class:"w-[100%] flex flex-col items-baseline"},{default:i((()=>[c(s,{class:"text-[#333] text-[28rpx] max-h-[80rpx] leading-[40rpx] multi-hidden font-400"},{default:i((()=>[p(x(e.goods.goods_name),1)])),_:2},1024),e.goodsSku&&e.goodsSku.sku_spec_format?(u(),d(s,{key:0,class:"box-border max-w-[376rpx] mt-[10rpx] px-[14rpx] h-[36rpx] leading-[36rpx] truncate text-[var(--text-color-light6)] bg-[#F5F5F5] text-[22rpx] rounded-[20rpx]"},{default:i((()=>[p(x(e.goodsSku.sku_spec_format),1)])),_:2},1024)):_("v-if",!0)])),_:2},1024),e.goods&&e.goods.goods_label_name&&e.goods.goods_label_name.length?(u(),d(s,{key:0,class:"flex flex-wrap mb-[auto]"},{default:i((()=>[(u(!0),m(g,null,f(e.goods.goods_label_name,((e,t)=>(u(),m(g,null,["icon"==e.style_type&&e.icon?(u(),d(o,{key:0,class:"img-tag",src:n(z)(e.icon),mode:"heightFix",onError:t=>n(J).error(e,"icon")},null,8,["src","onError"])):"diy"!=e.style_type&&e.icon?_("v-if",!0):(u(),d(s,{key:1,class:"base-tag",style:v(n(J).baseTagStyle(e))},{default:i((()=>[p(x(e.label_name),1)])),_:2},1032,["style"]))],64)))),256))])),_:2},1024)):_("v-if",!0),c(s,{class:"flex justify-between items-end self-end mt-[10rpx] w-[100%]"},{default:i((()=>[c(s,{class:"text-[var(--price-text-color)] price-font truncate max-w-[200rpx]"},{default:i((()=>[c(a,{class:"text-[24rpx] font-500"},{default:i((()=>[p("￥")])),_:1}),c(a,{class:"text-[40rpx] font-500"},{default:i((()=>[p(x(parseFloat(xe(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),c(a,{class:"text-[24rpx] font-500"},{default:i((()=>[p("."+x(parseFloat(xe(e)).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),c(B,{modelValue:e.num,"onUpdate:modelValue":t=>e.num=t,min:ae(e).min,max:ae(e).max,integer:"",step:1,"input-width":"68rpx","input-height":"52rpx","button-size":"52rpx",disabledInput:"",onChange:e=>((e,t)=>{uni.$u.debounce((e=>{const o=Y.value[t];te.increase({id:o.id,goods_id:o.goods_id,sku_id:o.sku_id,stock:o.goodsSku.stock,sale_price:o.goodsSku.sale_price,num:o.num},0)}),500)})(0,l)},{minus:i((()=>[c(s,{class:"relative w-[26rpx] h-[26rpx]",onClick:t=>(e=>{if(e.goods.is_limit&&e.goods.min_buy){let t=`该商品起购${e.goods.min_buy}件`;e.num<=e.goods.min_buy&&h({title:t,icon:"none"})}})(e)},{default:i((()=>[c(a,{class:b([{"text-[var(--text-color-light9)]":e.num===ae(e).min,"text-[#303133]":e.num!==ae(e).min},"text-[24rpx] absolute flex items-center justify-center -left-[10rpx] -bottom-[10rpx] -right-[10rpx] -top-[10rpx] font-500 nc-iconfont nc-icon-jianV6xx"])},null,8,["class"])])),_:2},1032,["onClick"])])),input:i((()=>[c(k,{class:"text-[#303133] text-[28rpx] mx-[14rpx] w-[80rpx] h-[44rpx] bg-[var(--temp-bg)] leading-[44rpx] text-center rounded-[6rpx]",type:"number",onInput:t=>{return o=e,void setTimeout((()=>{(!o.num||o.num<=ae(o).min)&&(o.num=ae(o).min),o.num>=ae(o).max&&(o.num=ae(o).max),uni.$u.debounce((e=>{te.increase({id:o.id,goods_id:o.goods_id,sku_id:o.sku_id,stock:o.goodsSku.stock,sale_price:o.goodsSku.sale_price,num:Number(o.num)},0)}),500)}),0);var o},onBlur:e=>((e,t)=>{setTimeout((()=>{const e=Y.value[t];(!e.num||e.num<=ae(e).min)&&(e.num=ae(e).min),e.num>=ae(e).max&&(e.num=ae(e).max),uni.$u.debounce((t=>{te.increase({id:e.id,goods_id:e.goods_id,sku_id:e.sku_id,stock:e.goodsSku.stock,sale_price:e.goodsSku.sale_price,num:Number(e.num)},0)}),500)}),0)})(0,l),onClick:t[2]||(t[2]=$((()=>{}),["stop"])),modelValue:e.num,"onUpdate:modelValue":t=>e.num=t},null,8,["onInput","onBlur","modelValue","onUpdate:modelValue"])])),plus:i((()=>[c(s,{class:"relative w-[26rpx] h-[26rpx]",onClick:t=>(e=>{if(e.goods.is_limit){let t=`该商品单次限购${e.goods.max_buy}件`;1!=e.goods.limit_type&&(t=`该商品每人限购${e.goods.max_buy}件`),e.num>=e.goods.max_buy&&h({title:t,icon:"none"})}})(e)},{default:i((()=>[c(a,{class:b([{"text-[var(--text-color-light9)]":e.num===ae(e).max," text-[#303133]":e.num!==ae(e).max},"text-[24rpx] absolute flex items-center justify-center -left-[10rpx] -bottom-[10rpx] -right-[10rpx] -top-[10rpx] font-500 nc-iconfont nc-icon-jiahaoV6xx"])},null,8,["class"])])),_:2},1032,["onClick"])])),_:2},1032,["modelValue","onUpdate:modelValue","min","max","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["options","onClick"])])),_:2},1024)):_("v-if",!0)],64)))),256))])),_:1},512)])),_:1})):_("v-if",!0),Z.value.length?(u(),d(s,{key:1,class:"bg-[#fff] pb-[10rpx] box-border rounded-[var(--rounded-big)] mt-[var(--top-m)]"},{default:i((()=>[c(s,{class:"flex mx-[var(--pad-sidebar-m)] pt-[var(--pad-top-m)] justify-between items-center box-border font-400 text-[#303133] text-[24rpx] mb-[24rpx] leading-[30rpx]"},{default:i((()=>[c(s,{class:"flex items-center text-[24rpx] text-[#333]"},{default:i((()=>[c(a,null,{default:i((()=>[p("共")])),_:1}),c(a,{class:"text-[28rpx] text-[var(--price-text-color)]"},{default:i((()=>[p(x(Z.value.length),1)])),_:1}),c(a,null,{default:i((()=>[p("件失效商品")])),_:1})])),_:1}),c(a,{class:"text-[var(--text-color-light6)] text-[24rpx]",onClick:pe},{default:i((()=>[p("清空")])),_:1})])),_:1}),(u(!0),m(g,null,f(Z.value,((e,t)=>(u(),d(s,{class:"py-[20rpx] overflow-hidden"},{default:i((()=>[c(s,{class:"flex px-[var(--pad-sidebar-m)]"},{default:i((()=>[c(a,{class:"self-center iconfont iconxuanze1 text-[34rpx] mr-[32rpx] text-[#F5F5F5] rounded-[50%] overflow-hidden shrink-0"}),c(s,{class:"relative w-[200rpx] h-[200rpx] rounded-[var(--goods-rounded-big)] overflow-hidden"},{default:i((()=>[c(r,{radius:"var(--goods-rounded-big)",width:"200rpx",height:"200rpx",src:n(z)(e.goodsSku.sku_image_thumb_mid),model:"aspectFill"},{error:i((()=>[c(o,{class:"w-[200rpx] h-[200rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:n(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),0==e.goodsSku.stock?(u(),d(s,{key:0,class:"absolute left-0 top-0 w-[200rpx] h-[200rpx] leading-[200rpx] text-center",style:{"background-color":"rgba(0,0,0,0.3)"}},{default:i((()=>[c(a,{class:"text-[#fff] text-[28rpx]"},{default:i((()=>[p("已售罄")])),_:1})])),_:1})):_("v-if",!0),0!=e.goodsSku.stock?(u(),d(s,{key:1,class:"absolute left-0 top-0 w-[200rpx] h-[200rpx] leading-[200rpx] text-center",style:{"background-color":"rgba(0,0,0,0.3)"}},{default:i((()=>[c(a,{class:"text-[#fff] text-[28rpx]"},{default:i((()=>[p("已失效")])),_:1})])),_:1})):_("v-if",!0)])),_:2},1024),c(s,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:i((()=>[c(s,{class:"w-[100%] flex flex-col items-baseline"},{default:i((()=>[c(s,{class:"text-[#333] text-[28rpx] max-h-[80rpx] leading-[40rpx] font-400 multi-hidden"},{default:i((()=>[p(x(e.goods.goods_name),1)])),_:2},1024),e.goodsSku&&e.goodsSku.sku_spec_format?(u(),d(s,{key:0,class:"box-border max-w-[376rpx] mt-[10rpx] px-[14rpx] h-[36rpx] leading-[36rpx] truncate text-[var(--text-color-light6)] bg-[#F5F5F5] text-[22rpx] rounded-[20rpx]"},{default:i((()=>[p(x(e.goodsSku.sku_spec_format),1)])),_:2},1024)):_("v-if",!0)])),_:2},1024),c(s,{class:"flex justify-between items-end self-end w-[100%]"},{default:i((()=>[c(s,{class:"text-[var(--price-text-color)] price-font"},{default:i((()=>[c(a,{class:"text-[24rpx] font-500"},{default:i((()=>[p("￥")])),_:1}),c(a,{class:"text-[36rpx] font-500"},{default:i((()=>[p(x(parseFloat(xe(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),c(a,{class:"text-[24rpx] font-500"},{default:i((()=>[p("."+x(parseFloat(xe(e)).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})):_("v-if",!0)])),_:1})])),_:1})])),_:1})):(u(),d(s,{key:1,class:"empty-page"},{default:i((()=>[c(o,{class:"img",src:n(z)("addon/shop/cart-empty.png"),model:"aspectFit"},null,8,["src"]),c(s,{class:"desc"},{default:i((()=>[p("赶紧去逛逛, 购买心仪的商品吧")])),_:1}),c(l,{shape:"circle",plain:"true",class:"btn",onClick:t[0]||(t[0]=e=>n(y)({url:"/addon/shop/pages/goods/list"}))},{default:i((()=>[p("去逛逛")])),_:1})])),_:1})):(u(),d(s,{key:0,class:"empty-page"},{default:i((()=>[c(o,{class:"img",src:n(z)("static/resource/images/system/login.png"),model:"aspectFit"},null,8,["src"]),c(s,{class:"desc"},{default:i((()=>[p("暂未登录")])),_:1}),c(l,{shape:"circle",plain:"true",class:"btn",onClick:le},{default:i((()=>[p("去登录")])),_:1})])),_:1}))])),_:1})),Y.value.length?(u(),d(s,{key:1,class:"flex h-[96rpx] items-center bg-[#fff] fixed left-0 right-0 bottom-[50px] pl-[30rpx] pr-[20rpx] box-solid mb-ios justify-between"},{default:i((()=>[c(s,{class:"flex items-center",onClick:de},{default:i((()=>[c(a,{class:b(["self-center iconfont text-color text-[34rpx] mr-[10rpx] w-[34rpx] h-[34rpx] rounded-[17rpx] overflow-hidden shrink-0",Y.value.length==n(se)?"iconxuanze1":"bg-[#F5F5F5]"])},null,8,["class"]),c(a,{class:"font-400 text-[#303133] text-[26rpx]"},{default:i((()=>[p("全选")])),_:1})])),_:1}),c(s,{class:"flex items-center"},{default:i((()=>[q.value?(u(),d(s,{key:1,class:"flex-1 flex items-center justify-end"},{default:i((()=>[c(l,{class:"w-[180rpx] h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] m-0 rounded-full primary-btn-bg remove-border",onClick:ce},{default:i((()=>[p("删除")])),_:1})])),_:1})):(u(),d(s,{key:0,class:"flex-1 flex items-center justify-between"},{default:i((()=>[c(s,{class:"flex items-center mr-[20rpx] text-[var(--price-text-color)] leading-[45rpx]"},{default:i((()=>[c(s,{class:"font-400 text-[#303133] text-[28rpx]"},{default:i((()=>[p("合计：")])),_:1}),c(a,{class:"text-[var(--price-text-color)] price-font text-[32rpx] font-bold"},{default:i((()=>[p(" ￥"+x(parseFloat(X.value).toFixed(2)),1)])),_:1})])),_:1}),c(l,{class:"w-[180rpx] h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] m-0 rounded-full primary-btn-bg remove-border",onClick:ne},{default:i((()=>[p("结算")])),_:1})])),_:1}))])),_:1})])),_:1})):_("v-if",!0),c(K,{loading:Q.value},null,8,["loading"]),c(ee),_(" 强制绑定手机号 "),c(P,{ref_key:"bindMobileRef",ref:ie},null,512)])),_:1},8,["style"])}}}),[["__scopeId","data-v-e0afcb10"]]);export{K as default};
