import{r as e,F as a,j as t,bN as o,bO as c,d as n,N as l,g as s,bP as r,h as i,Q as u,aM as d,o as m,U as h,b as p,w as f,y as g,z as v,u as y,W as x,V as C,t as b,i as _,B as w}from"./index-71c7df08.js";function V(a){const t=e("");return{image:t,refresh:async()=>{try{const e=await c();a.captcha_key=e.data.captcha_key,a.captcha_code="",t.value=e.data.img.replace(/\r\n/g,"")}catch(e){}}}}const k=n({__name:"sms-code",props:{mobile:String,type:String,isAgree:{type:Boolean,default:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(c,{emit:n}){const k=c,G=t({get:()=>k.modelValue,set(e){n("update:modelValue",e)}}),T=e(null),P=function(c){const n=e(a("getSmsCode")),l="X"+a("smsCodeChangeText"),s=t((()=>!c.value||c.value.canGetCode));return{tips:n,seconds:90,canGetCode:s,send:async e=>{if(!s.value)return;c.value.start();let a=!1;return await o(e).then((e=>{1==e.code?a=e.data.key:(c.value.reset(),a=!1)})).catch((e=>{a=!1,c.value.reset()})),a},codeChange:e=>{n.value=e},changeText:l}}(T),S=e(!1),A=l({mobile:"",captcha_code:"",captcha_key:"",type:k.type}),E=V(A),$=async()=>{if(T.value.canGetCode){if(A.mobile=k.mobile,!k.isAgree)return void b({title:a("isAgreeTips"),icon:"none"});if(uni.$u.test.isEmpty(A.mobile))return void b({title:a("mobilePlaceholder"),icon:"none"});if(!uni.$u.test.mobile(A.mobile))return void b({title:a("mobileError"),icon:"none"});await E.refresh(),S.value=!0}},j=async()=>{if(uni.$u.test.isEmpty(A.captcha_code))return void b({title:a("captchaPlaceholder"),icon:"none"});const e=await P.send(A);e?(G.value=e,S.value=!1):!1===e&&E.refresh()};return(e,t)=>{const o=_,c=s(i("u-code"),r),n=s(i("u-input"),u),l=w,b=s(i("u-modal"),d);return m(),h(C,null,[p(o,{class:x(["text-[26rpx]",{"text-primary":y(P).canGetCode.value,"text-gray-300":!y(P).canGetCode.value}]),onClick:$},{default:f((()=>[g(v(y(P).tips.value),1)])),_:1},8,["class"]),p(c,{seconds:y(P).seconds,"change-text":y(P).changeText,ref_key:"smsRef",ref:T,onChange:y(P).codeChange},null,8,["seconds","change-text","onChange"]),p(b,{show:S.value,title:y(a)("captchaTitle"),"confirm-text":y(a)("confirm"),"cancel-text":y(a)("cancel"),"show-cancel-button":!0,onCancel:t[2]||(t[2]=e=>S.value=!1),onConfirm:j,confirmColor:"var(--primary-color)"},{default:f((()=>[p(o,{class:"flex mt-[20rpx]"},{default:f((()=>[p(n,{placeholder:y(a)("captchaPlaceholder"),border:"surround",modelValue:A.captcha_code,"onUpdate:modelValue":t[0]||(t[0]=e=>A.captcha_code=e)},null,8,["placeholder","modelValue"]),p(l,{src:y(E).image.value,class:"h-[76rpx] ml-[20rpx]",mode:"heightFix",onClick:t[1]||(t[1]=e=>y(E).refresh())},null,8,["src"])])),_:1})])),_:1},8,["show","title","confirm-text","cancel-text"])],64)}}});export{k as _,V as u};
