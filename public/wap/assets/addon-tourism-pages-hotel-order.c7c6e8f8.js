import{d as e,r as t,p as l,j as a,o,c as s,w as n,b as u,y as r,z as i,I as c,J as f,u as d,K as m,f as x,bw as p,n as _,aK as v,H as b,a as y,V as g,D as h,i as j,g as C,h as k,a2 as w,Q as V,l as F,L as S}from"./index-d8a8f699.js";import{_ as $}from"./u-form.11d92cf8.js";import{_ as z}from"./u--input.25f77eb2.js";import{_ as D}from"./u--form.0211e157.js";import{_ as I}from"./u-picker.664c7c28.js";import{_ as A}from"./u-popup.0d48946e.js";import{_ as U}from"./pay.9a75868d.js";import{_ as B}from"./u-button.aa0eb212.js";import{_ as E}from"./u-parse.8b113dfe.js";import{_ as J}from"./u-empty.41eb000a.js";import{_ as K}from"./u-loading-page.c740ef13.js";import{n as O,o as H,p as N}from"./tourism.93d35d7c.js";import{_ as Q}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.5ba98c98.js";import"./u-line.d86b0940.js";import"./u-input.9468a367.js";import"./u-loading-icon.6808ae8c.js";import"./u-transition.db07fff7.js";import"./u-safe-bottom.a4431b09.js";import"./u-image.e646392b.js";import"./pay.974edcbe.js";const W=Q(e({__name:"order",setup(e){const Q=t(null),W=t(!0),X=t(""),Z=t(uni.getStorageSync("hotelCreateData")||{}),q=t(null),L=t(!1),P=l((()=>{const e=[];for(let t=1;t<=q.value.goods_info.stock;t++)e.push({label:`${t}间`,id:t});return[e]})),R=t(!1);let T=t(!1);a((()=>{O(Z.value).then((({data:e})=>{W.value=!1,q.value=e,ee()})).catch((e=>{X.value=e.msg,W.value=!1}))}));const Y=t(!1),G=()=>{if(M()){if(Y.value)return;Y.value=!0;const e=uni.$u.deepClone(v(Z.value));e.buyer_info=JSON.stringify(e.buyer_info),H(e).then((({data:e})=>{var t;null==(t=Q.value)||t.open(e.trade_type,e.trade_id,`/addon/tourism/pages/order/detail?order_id=${e.trade_id}`),Y.value=!1})).catch((e=>{Y.value=!1,b({title:e.msg,icon:"none"})}))}},M=()=>{let e=!0;for(let l=0;l<Z.value.buyer_info.length;l++){const t=Z.value.buyer_info[l];if(uni.$u.test.isEmpty(t.name)){e=!1,b({title:"请输入"+(l?`房间${l+1}的`:"")+"入住人姓名",icon:"none"});break}}if(!e)return!1;let t=Z.value.buyer_info.map((e=>e.name));if(new Set(t).size!==t.length)return b({title:"入住人姓名不能重复",icon:"none"}),!1;if(uni.$u.test.isEmpty(Z.value.mobile))return b({title:"请输入手机号",icon:"none"}),!1;return!!/^1[3-9]\d{9}$/.test(Z.value.mobile)||(b({title:"请输入正确的手机号",icon:"none"}),!1)},ee=()=>{var e,t;Z.value.buyer_info=[{name:""}],Z.value.mobile="",q.value.start_time=le(null==(e=q.value)?void 0:e.start_time),q.value.end_time=le(null==(t=q.value)?void 0:t.end_time)},te=l((()=>q.value?q.value.goods_info.goods_attribute.split(","):[])),le=e=>{const t=new Date(e);return uni.$u.timeFormat(t,"mm月dd日 ")+["周日","周一","周二","周三","周四","周五","周六"][t.getDay()]},ae=e=>{Z.value.num=e.value[0].id,L.value=!1;for(let t=0;t<Z.value.num;t++)null==Z.value.buyer_info[t]&&(Z.value.buyer_info[t]={name:""});Z.value.buyer_info.length>Z.value.num&&Z.value.buyer_info.splice(Z.value.num,Z.value.buyer_info.length-Z.value.num),W.value=!0,N(Z.value).then((({data:e})=>{var t,l;q.value=e,q.value.start_time=le(null==(t=q.value)?void 0:t.start_time),q.value.end_time=le(null==(l=q.value)?void 0:l.end_time),W.value=!1})).catch((e=>{W.value=!1,b({title:e.msg,icon:"none"})}))},oe=()=>{y({url:"/addon/tourism/pages/order/list",mode:"redirectTo"})};let se=t({});const ne=()=>{se.value=q.value.goods_info,T.value=!0},ue=()=>{g()};return(e,t)=>{const l=h,a=j,v=C(k("u-form-item"),$),b=C(k("u--input"),z),y=C(k("u--form"),D),g=C(k("u-picker"),I),O=w,H=C(k("u-popup"),A),N=C(k("pay"),U),M=C(k("u-button"),B),ee=V,le=C(k("u-parse"),E),re=C(k("u-empty"),J),ie=C(k("u-loading-page"),K);return o(),s(a,{style:_(e.themeColor())},{default:n((()=>[q.value?(o(),s(a,{key:0,class:"bg-[#f7f7f7] min-h-screen overflow-hidden"},{default:n((()=>[u(a,{class:"chunk-wrap pb-2 pt-2"},{default:n((()=>[u(a,{class:"chunk-head h-[88rpx]"},{default:n((()=>[u(l,null,{default:n((()=>[r(i(q.value.goods_info.goods_name),1)])),_:1}),u(a,{class:"text-[#797C8D] text-xs",onClick:ne},{default:n((()=>[u(l,{class:"!font-normal"},{default:n((()=>[r("房型详情")])),_:1}),u(l,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1}),u(a,{class:"text-[26rpx] text-[#19293F] font-bold mt-3"},{default:n((()=>[r(i(q.value.start_time)+" - "+i(q.value.end_time)+" 共"+i(q.value.days)+"晚",1)])),_:1}),u(a,{class:"house-type"},{default:n((()=>[(o(!0),c(m,null,f(d(te),(e=>(o(),s(l,{class:"house-type-item"},{default:n((()=>[r(i(e),1)])),_:2},1024)))),256))])),_:1}),u(a,{class:"border-0 border-t border-solid border-[#F2F2F2] mt-2 h-[80rpx] flex items-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-fengefuV6xx text-[#D1D7E0]"}),u(l,{class:"text-xs"},{default:n((()=>[r("入住时间：14:00以后 离店时间：12:00以前")])),_:1})])),_:1})])),_:1}),u(a,{class:"chunk-wrap"},{default:n((()=>[u(a,{class:"chunk-head"},{default:n((()=>[u(l,null,{default:n((()=>[r("入住信息")])),_:1})])),_:1}),u(a,{class:"py-2"},{default:n((()=>[u(y,{labelPosition:"left",ref:"form1",labelWidth:"90",labelStyle:{color:"#A3A3A3",fontSize:"14px"}},{default:n((()=>[u(v,{label:"房间数",prop:"userInfo.name",borderBottom:"",onClick:t[0]||(t[0]=e=>L.value=!0)},{default:n((()=>[u(a,{class:"border-style relative"},{default:n((()=>[u(a,null,{default:n((()=>[r(i(Z.value.num)+"间",1)])),_:1}),u(a,{class:"text-xs text-[#797C8D] absolute select-room"},{default:n((()=>[u(l,null,{default:n((()=>[r("选择")])),_:1}),u(l,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1})])),_:1}),(o(!0),c(m,null,f(Z.value.num,(e=>(o(),s(v,{label:Z.value.num>1?"房间"+e:"入住人",prop:"userInfo.name",borderBottom:""},{default:n((()=>[u(a,{class:"border-style"},{default:n((()=>[u(b,{border:"none",placeholder:"每间需要1位入住人姓名",placeholderClass:"text-sm",modelValue:Z.value.buyer_info[e-1].name,"onUpdate:modelValue":t=>Z.value.buyer_info[e-1].name=t},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["label"])))),256)),u(v,{label:"手机号",prop:"userInfo.name",borderBottom:""},{default:n((()=>[u(a,{class:"border-style !border-0"},{default:n((()=>[u(b,{border:"none",placeholder:"用于接收预订信息",placeholderClass:"text-sm",modelValue:Z.value.mobile,"onUpdate:modelValue":t[1]||(t[1]=e=>Z.value.mobile=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},512)])),_:1})])),_:1}),u(g,{show:L.value,columns:d(P),keyName:"label",closeOnClickOverlay:!0,onCancel:t[2]||(t[2]=e=>L.value=!1),onConfirm:ae,immediateChange:!0},null,8,["show","columns"]),u(H,{show:R.value,onClose:t[4]||(t[4]=e=>R.value=!1)},{default:n((()=>[u(a,{class:"text-base font-bold flex justify-center items-center h-[96rpx] px-[26rpx] bg-[#fff] relative"},{default:n((()=>[u(l,{class:"text-[30rpx]"},{default:n((()=>[r("费用明细")])),_:1}),u(l,{class:"nc-iconfont nc-icon-guanbiV6xx text-[#666] absolute text-[32rpx] right-[26rpx]",onClick:t[3]||(t[3]=e=>R.value=!1)})])),_:1}),u(O,{"scroll-y":"true",class:"max-h-[40vh]"},{default:n((()=>[u(a,{class:"flex px-[30rpx] mt-[20rpx]"},{default:n((()=>[u(a,{class:"font-bold"},{default:n((()=>[r("总价")])),_:1}),u(a,{class:"text-right flex-1 font-bold price-font"},{default:n((()=>[u(l,{class:"text-sm font-normal"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"text-[38rpx]"},{default:n((()=>{var e;return[r(i(null==(e=q.value.order_money)?void 0:e.toFixed(2)),1)]})),_:1})])),_:1})])),_:1}),(o(!0),c(m,null,f(q.value.order_items,((e,t)=>(o(),s(a,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:n((()=>[u(a,null,{default:n((()=>[r(i(e.year)+"-"+i(e.month)+"-"+i(e.day),1)])),_:2},1024),u(a,{class:"text-right flex-1"},{default:n((()=>[u(l,{class:"text-xs price-font"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"price-font"},{default:n((()=>[r(i(e.price),1)])),_:2},1024),u(l,{class:"mx-[10rpx]"},{default:n((()=>[r("x")])),_:1}),u(l,null,{default:n((()=>[r(i(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256)),u(a,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:n((()=>[u(a,null,{default:n((()=>[r(i(Z.value.end_time)+" 离店日",1)])),_:1}),u(a,{class:"text-right flex-1"})])),_:1})])),_:1}),u(a,{class:"h-[150rpx]"})])),_:1},8,["show"]),u(N,{ref_key:"payRef",ref:Q,onClose:oe},null,512),u(a,{class:"h-[148rpx] w-screen"}),u(a,{class:"bg-white p-3 fixed bottom-0 left-0 right-0 flex items-center justify-between z-10 shadow"},{default:n((()=>[u(a,{class:"text-[#FA6400] text-xs"},{default:n((()=>[u(l,null,{default:n((()=>[r("总价")])),_:1}),u(l,{class:"ml-[2rpx] price-font"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"text-[38rpx] price-font"},{default:n((()=>{var e;return[r(i(null==(e=q.value.order_money)?void 0:e.toFixed(2)),1)]})),_:1})])),_:1}),u(a,{class:"ml-auto mr-2",onClick:t[5]||(t[5]=e=>R.value=!R.value)},{default:n((()=>[u(l,{class:"text-[#686868] text-xs mr-1"},{default:n((()=>[r("明细")])),_:1}),u(l,{class:"nc-iconfont nc-icon-shangV6xx-1 text-[#C2C2C2] text-xs font-bold"})])),_:1}),u(M,{text:"提交订单",color:"var(--primary-color)",shape:"circle",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"278rpx"},type:"primary",size:"16",loading:Y.value,onClick:G},null,8,["loading"])])),_:1}),x(" 酒店房型详情 "),u(H,{show:d(T),mode:"bottom",round:10,onClose:t[7]||(t[7]=e=>p(T)?T.value=!1:T=!1)},{default:n((()=>[u(a,{class:"flex flex-col rounded-t-3xl bg-[#f8f8f8] overflow-hidden relative z-10"},{default:n((()=>[u(a,{class:"text-base font-bold flex justify-between items-center h-[96rpx] px-[26rpx] bg-[#fff]"},{default:n((()=>[u(l,{class:"text-[30rpx]"},{default:n((()=>[r(i(d(se).goods_name),1)])),_:1}),u(l,{class:"nc-iconfont nc-icon-guanbiV6xx text-[32rpx] text-[#666]",onClick:t[6]||(t[6]=e=>p(T)?T.value=!1:T=!1)})])),_:1}),u(O,{class:"max-h-[60vh]","scroll-y":!0},{default:n((()=>[u(ee,{src:d(F)(d(se).goods_cover),class:"w-[750rpx] h-[218]",mode:"aspectFill"},null,8,["src"]),u(a,{class:"px-4 bg-[#fff]"},{default:n((()=>[u(a,{class:"flex justify-between border-0 border-b-1 border-[#F2F2F2] border-solid px-1 py-4"},{default:n((()=>[u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-chuangV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_bed||"双人床"),1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-loucengV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_floor||"1层"),1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-fangziV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_area||0)+"㎡",1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-jiamengV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_stay||1)+"人",1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-liebiaoV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).stock||0)+"间",1)])),_:1})])),_:1})])),_:1}),d(se).goods_attribute?(o(),s(a,{key:0,class:"flex items-center my-4"},{default:n((()=>[u(l,{class:"mr-2 text-sm"},{default:n((()=>[r("房间设施")])),_:1}),u(a,null,{default:n((()=>[(o(!0),c(m,null,f(d(se).goods_attribute.split(","),((e,t)=>{var a,u;return o(),s(l,{class:S(["mr-1 text-sm",{"class-select":t<(null==(u=null==(a=d(se).goods_attribute)?void 0:a.split(","))?void 0:u.length)-1}])},{default:n((()=>[r(i(e),1)])),_:2},1032,["class"])})),256))])),_:1})])),_:1})):x("v-if",!0)])),_:1}),u(a,{class:"mt-2 px-3 bg-[#fff]"},{default:n((()=>[u(a,{class:"border-0 border-b-1 border-[#F2F2F2] border-solid py-3 text-[30rpx] font-bold"},{default:n((()=>[r(" 房型详情 ")])),_:1}),u(a,{class:"py-3 px-1 scheduling-content"},{default:n((()=>[d(se).goods_content?(o(),s(le,{key:0,content:d(se).goods_content,tagStyle:{img:"vertical-align: top;"}},null,8,["content"])):(o(),s(a,{key:1},{default:n((()=>[r("暂无房型详情")])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})):x("v-if",!0),X.value?(o(),s(a,{key:1,class:"w-screen h-screen flex flex-col justify-center items-center"},{default:n((()=>[u(re,{icon:d(F)("static/resource/images/order_empty.png"),text:X.value},null,8,["icon","text"]),u(a,{class:"w-[240rpx] mt-[40rpx]"},{default:n((()=>[u(M,{type:"primary",text:"返回上一页",shape:"circle",onClick:ue})])),_:1})])),_:1})):x("v-if",!0),u(ie,{loading:W.value,"loading-text":"","bg-color":"none",loadingColor:"var(--primary-color)",iconSize:"35"},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-207291bd"]]);export{W as default};
