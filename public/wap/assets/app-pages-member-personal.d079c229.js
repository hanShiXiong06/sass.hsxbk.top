import{P as e,Q as t,R as a,ap as i,I as n,aq as l,ar as o,as as r,g as u,h as s,o as m,E as d,c,w as h,b as p,f,G as y,i as x,d as k,l as g,m as v,p as C,r as b,u as V,x as I,y as _,n as w,t as M,at as D,au as P,a3 as H,V as $,av as O,a as j}from"./index-e6ce9fbf.js";import{_ as B}from"./u-avatar.d1f888c3.js";import{_ as T}from"./u-upload.e506a2d8.js";import{_ as Y}from"./u-cell.058e8a2e.js";import{_ as S}from"./u-button.7a41d301.js";import{_ as N,a as A}from"./u-action-sheet.8ee5e368.js";import{_ as F}from"./u-modal.a2c072b7.js";import{_ as R}from"./u-input.b98e66b2.js";import{_ as U}from"./u-picker.d770b4a0.js";import{d as z}from"./index.a605aec4.js";import{_ as E}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.c5d9cd81.js";import"./u-text.9aefeac5.js";import"./u-loading-icon.39fd4711.js";/* empty css                                                                 */import"./u-line.ebbd60c6.js";import"./u-popup.b16d6e1d.js";import"./u-transition.6919b33f.js";import"./u-safe-bottom.1ba5bfba.js";const q=E({name:"datetime-picker",mixins:[t,a,{props:{hasInput:{type:Boolean,default:()=>!1},placeholder:{type:String,default:()=>"请选择"},format:{type:String,default:()=>""},show:{type:Boolean,default:()=>e.datetimePicker.show},popupMode:{type:String,default:()=>e.picker.popupMode},showToolbar:{type:Boolean,default:()=>e.datetimePicker.showToolbar},modelValue:{type:[String,Number],default:()=>e.datetimePicker.value},title:{type:String,default:()=>e.datetimePicker.title},mode:{type:String,default:()=>e.datetimePicker.mode},maxDate:{type:Number,default:()=>e.datetimePicker.maxDate},minDate:{type:Number,default:()=>e.datetimePicker.minDate},minHour:{type:Number,default:()=>e.datetimePicker.minHour},maxHour:{type:Number,default:()=>e.datetimePicker.maxHour},minMinute:{type:Number,default:()=>e.datetimePicker.minMinute},maxMinute:{type:Number,default:()=>e.datetimePicker.maxMinute},filter:{type:[Function,null],default:()=>e.datetimePicker.filter},formatter:{type:[Function,null],default:()=>e.datetimePicker.formatter},loading:{type:Boolean,default:()=>e.datetimePicker.loading},itemHeight:{type:[String,Number],default:()=>e.datetimePicker.itemHeight},cancelText:{type:String,default:()=>e.datetimePicker.cancelText},confirmText:{type:String,default:()=>e.datetimePicker.confirmText},cancelColor:{type:String,default:()=>e.datetimePicker.cancelColor},confirmColor:{type:String,default:()=>e.datetimePicker.confirmColor},visibleItemCount:{type:[String,Number],default:()=>e.datetimePicker.visibleItemCount},closeOnClickOverlay:{type:Boolean,default:()=>e.datetimePicker.closeOnClickOverlay},defaultIndex:{type:Array,default:()=>e.datetimePicker.defaultIndex}}}],data:()=>({inputValue:"",showByClickInput:!1,columns:[],innerDefaultIndex:[],innerFormatter:(e,t)=>t}),watch:{show(e,t){e&&this.updateColumnValue(this.innerValue)},modelValue(e){this.init()},propsChange(){this.init()}},computed:{propsChange(){return[this.mode,this.maxDate,this.minDate,this.minHour,this.maxHour,this.minMinute,this.maxMinute,this.filter]}},mounted(){this.init()},emits:["close","cancel","confirm","change","update:modelValue"],methods:{getInputValue(e){if(""!=e&&e&&null!=e)if("time"==this.mode)this.inputValue=e;else if(this.format)this.inputValue=z(e).format(this.format);else{let t="";switch(this.mode){case"date":t="YYYY-MM-DD";break;case"year-month":t="YYYY-MM";break;case"datetime":t="YYYY-MM-DD HH:mm";break;case"time":t="HH:mm"}this.inputValue=z(e).format(t)}else this.inputValue=""},init(){this.innerValue=this.correctValue(this.modelValue),this.updateColumnValue(this.innerValue),this.getInputValue(this.innerValue)},setFormatter(e){this.innerFormatter=e},close(){this.closeOnClickOverlay&&this.$emit("close")},cancel(){this.hasInput&&(this.showByClickInput=!1),this.$emit("cancel")},confirm(){this.$emit("update:modelValue",this.innerValue),this.hasInput&&(this.getInputValue(this.innerValue),this.showByClickInput=!1),this.$emit("confirm",{value:this.innerValue,mode:this.mode})},intercept(e,t){let a=e.match(/\d+/g);return a.length>1?0:t&&4==a[0].length?a[0]:a[0].length>2?0:a[0]},change(e){const{indexs:t,values:a}=e;let i="";if("time"===this.mode)i=`${this.intercept(a[0][t[0]])}:${this.intercept(a[1][t[1]])}`;else{const e=parseInt(this.intercept(a[0][t[0]],"year")),n=parseInt(this.intercept(a[1][t[1]]));let l=parseInt(a[2]?this.intercept(a[2][t[2]]):1),o=0,r=0;const u=z(`${e}-${n}`).daysInMonth();"year-month"===this.mode&&(l=1),l=Math.min(u,l),"datetime"===this.mode&&(o=parseInt(this.intercept(a[3][t[3]])),r=parseInt(this.intercept(a[4][t[4]]))),i=Number(new Date(e,n-1,l,o,r))}i=this.correctValue(i),this.innerValue=i,this.updateColumnValue(i),this.$emit("change",{value:i,mode:this.mode})},updateColumnValue(e){this.innerValue=e,this.updateColumns(),setTimeout((()=>{this.updateIndexs(e)}),0)},updateIndexs(e){let t=[];const a=this.formatter||this.innerFormatter;if("time"===this.mode){const i=e.split(":");t=[a("hour",i[0]),a("minute",i[1])]}else t=[a("year",`${z(e).year()}`),a("month",i(z(e).month()+1))],"date"===this.mode&&t.push(a("day",i(z(e).date()))),"datetime"===this.mode&&t.push(a("day",i(z(e).date())),a("hour",i(z(e).hour())),a("minute",i(z(e).minute())));const n=this.columns.map(((e,a)=>Math.max(0,e.findIndex((e=>e===t[a])))));this.innerDefaultIndex=n},updateColumns(){const e=this.formatter||this.innerFormatter,t=this.getOriginColumns().map((t=>t.values.map((a=>e(t.type,a)))));this.columns=t},getOriginColumns(){return this.getRanges().map((({type:e,range:t})=>{let a=function(e,t){let a=-1;const i=Array(e<0?0:e);for(;++a<e;)i[a]=t(a);return i}(t[1]-t[0]+1,(a=>{let n=t[0]+a;return n="year"===e?`${n}`:i(n),n}));return this.filter&&(a=this.filter(e,a),(!a||a&&0==a.length)&&n({title:"日期filter结果不能为空",icon:"error",mask:!0})),{type:e,values:a}}))},generateArray:(e,t)=>Array.from(new Array(t+1).keys()).slice(e),correctValue(e){const t="time"!==this.mode;if(t&&!l.date(e)?e=this.minDate:t||e||(e=`${i(this.minHour)}:${i(this.minMinute)}`),t)return e=z(e).isBefore(z(this.minDate))?this.minDate:e,e=z(e).isAfter(z(this.maxDate))?this.maxDate:e;{if(-1===String(e).indexOf(":"))return o();let[t,a]=e.split(":");return t=i(r(this.minHour,this.maxHour,Number(t))),a=i(r(this.minMinute,this.maxMinute,Number(a))),`${t}:${a}`}},getRanges(){if("time"===this.mode)return[{type:"hour",range:[this.minHour,this.maxHour]},{type:"minute",range:[this.minMinute,this.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:a,maxHour:i,maxMinute:n}=this.getBoundary("max",this.innerValue),{minYear:l,minDate:o,minMonth:r,minHour:u,minMinute:s}=this.getBoundary("min",this.innerValue),m=[{type:"year",range:[l,e]},{type:"month",range:[r,a]},{type:"day",range:[o,t]},{type:"hour",range:[u,i]},{type:"minute",range:[s,n]}];return"date"===this.mode&&m.splice(3,2),"year-month"===this.mode&&m.splice(2,3),m},getBoundary(e,t){const a=new Date(t),i=new Date(this[`${e}Date`]),n=z(i).year();let l=1,o=1,r=0,u=0;return"max"===e&&(l=12,o=z(a).daysInMonth(),r=23,u=59),z(a).year()===n&&(l=z(i).month()+1,z(a).month()+1===l&&(o=z(i).date(),z(a).date()===o&&(r=z(i).hour(),z(a).hour()===r&&(u=z(i).minute())))),{[`${e}Year`]:n,[`${e}Month`]:l,[`${e}Date`]:o,[`${e}Hour`]:r,[`${e}Minute`]:u}}}},[["render",function(e,t,a,i,n,l){const o=u(s("u-input"),R),r=x,k=u(s("u-picker"),U);return m(),d(y,null,[e.hasInput?(m(),c(r,{key:0,class:"u-datetime-picker"},{default:h((()=>[p(o,{placeholder:e.placeholder,border:"surround",modelValue:n.inputValue,"onUpdate:modelValue":t[0]||(t[0]=e=>n.inputValue=e),onClick:t[1]||(t[1]=e=>n.showByClickInput=!n.showByClickInput)},null,8,["placeholder","modelValue"])])),_:1})):f("v-if",!0),p(k,{ref:"picker",show:e.show||e.hasInput&&n.showByClickInput,popupMode:e.popupMode,closeOnClickOverlay:e.closeOnClickOverlay,columns:n.columns,title:e.title,itemHeight:e.itemHeight,showToolbar:e.showToolbar,visibleItemCount:e.visibleItemCount,defaultIndex:n.innerDefaultIndex,cancelText:e.cancelText,confirmText:e.confirmText,cancelColor:e.cancelColor,confirmColor:e.confirmColor,onClose:l.close,onCancel:l.cancel,onConfirm:l.confirm,onChange:l.change},null,8,["show","popupMode","closeOnClickOverlay","columns","title","itemHeight","showToolbar","visibleItemCount","defaultIndex","cancelText","confirmText","cancelColor","confirmColor","onClose","onCancel","onConfirm","onChange"])],64)}],["__scopeId","data-v-f323a439"]]),G=E(k({__name:"personal",setup(e){const t=g(),a=v((()=>t.info)),i=C({modal:!1,value:a.nickname||""}),l=e=>{i.value=e.detail.value},o=()=>{uni.$u.test.isEmpty(i.value)?n({title:M("nicknamePlaceholder"),icon:"none"}):D({field:"nickname",value:i.value}).then((e=>{t.info.nickname=i.value,i.modal=!1}))},r=b(!1),d=v((()=>[{name:M("man"),value:1},{name:M("woman"),value:2}])),y=e=>{D({field:"sex",value:e.value}).then((a=>{t.info.sex_name=e.name}))},k=e=>{P({filePath:e.file.url,name:"file"}).then((e=>{D({field:"headimg",value:e.data.url}).then((()=>{t.info.headimg=e.data.url}))})).catch((()=>{}))},R=b(!1),U=e=>{D({field:"birthday",value:uni.$u.date(e.value,"yyyy-mm-dd")}).then((()=>{t.info.birthday=uni.$u.date(e.value||e.value+1,"yyyy-mm-dd"),R.value=!1}))};return(e,t)=>{const n=u(s("u-avatar"),B),g=x,v=u(s("u-upload"),T),C=u(s("u-cell"),Y),b=u(s("u-button"),S),D=u(s("u-cell-group"),N),P=H,z=u(s("u-modal"),F),E=u(s("u-action-sheet"),A),G=u(s("u-datetime-picker"),q);return V(a)?(m(),c(g,{key:0,class:"w-full h-screen bg-page personal-wrap",style:w(e.themeColor())},{default:h((()=>[p(g,{class:"flex flex-col items-center pt-[30rpx]"},{default:h((()=>[p(v,{onAfterRead:k,maxCount:1},{default:h((()=>[p(n,{src:V($)(V(a).headimg),size:"60",leftIcon:"none"},null,8,["src"]),p(g,{class:"text-primary text-sm mt-[10rpx]"},{default:h((()=>[I(_(V(M)("updateHeadimg")),1)])),_:1})])),_:1})])),_:1}),p(g,{class:"m-[30rpx] bg-white rounded-md overflow-hidden px-[20rpx] py-[10rpx]"},{default:h((()=>[p(D,{border:!1},{default:h((()=>[p(C,{title:V(M)("nickname"),"is-link":!0,value:V(a).nickname,onClick:t[0]||(t[0]=e=>i.modal=!0)},null,8,["title","value"]),p(C,{title:V(M)("sex"),"is-link":!0,value:V(a).sex_name||V(M)("unknown"),onClick:t[1]||(t[1]=e=>r.value=!0)},null,8,["title","value"]),p(C,{title:V(M)("mobile")},{value:h((()=>[V(a).mobile?(m(),c(g,{key:0,class:"mr-[10rpx]"},{default:h((()=>[I(_(V(O)(V(a).mobile)),1)])),_:1})):(m(),c(g,{key:1,onClick:t[2]||(t[2]=e=>V(j)({url:"/app/pages/auth/bind"}))},{default:h((()=>[p(b,{type:"primary",plain:!0,text:V(M)("bindMobile"),shape:"circle",size:"mini"},null,8,["text"])])),_:1}))])),_:1},8,["title"]),p(C,{title:V(M)("birthday"),"is-link":!0,value:V(a).birthday||V(M)("unknown"),onClick:t[3]||(t[3]=e=>R.value=!0)},null,8,["title","value"])])),_:1})])),_:1}),p(z,{show:i.modal,closeOnClickOverlay:!0,onClose:t[5]||(t[5]=e=>i.modal=!1),"show-cancel-button":!0,onCancel:t[6]||(t[6]=e=>i.modal=!1),title:V(M)("updateNickname")},{confirmButton:h((()=>[p(g,{class:"mt-[10rpx]"},{default:h((()=>[p(b,{type:"primary",text:V(M)("confirm"),shape:"circle",onClick:o},null,8,["text"])])),_:1})])),default:h((()=>[p(g,{class:"w-full mt-[20rpx] border-0 border-b border-gray-300 border-solid py-[20rpx]"},{default:h((()=>[p(P,{type:"nickname",modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value=e),placeholder:V(M)("nicknamePlaceholder"),onBlur:l},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["show","title"]),p(E,{actions:V(d),show:r.value,closeOnClickOverlay:!0,safeAreaInsetBottom:!0,onClose:t[7]||(t[7]=e=>r.value=!1),onSelect:y},null,8,["actions","show"]),p(G,{modelValue:V(a).birthday,"onUpdate:modelValue":t[8]||(t[8]=e=>V(a).birthday=e),show:R.value,mode:"date","confirm-text":V(M)("confirm"),maxDate:(new Date).valueOf(),minDate:0,"cancel-text":V(M)("cancel"),onCancel:t[9]||(t[9]=e=>R.value=!1),onConfirm:U},null,8,["modelValue","show","confirm-text","maxDate","cancel-text"])])),_:1},8,["style"])):f("v-if",!0)}}}),[["__scopeId","data-v-1cec442a"]]);export{G as default};
