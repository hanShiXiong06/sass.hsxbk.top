import{d as e,p as t,r,m as l,j as a,o,c as s,w as n,b as p,n as i,u as c,L as u,y as x,I as d,J as f,K as m,f as _,Y as b,a3 as v,a4 as g,af as h,b3 as y,i as k,D as F,a2 as w,g as C,h as j,l as T,z as S,a9 as z,b4 as D,C as I,a as E,E as R}from"./index-d8a8f699.js";import{_ as M}from"./u-popup.0d48946e.js";import{t as V}from"./topTabbar.a37f79d9.js";import{b as B,c as H,d as L}from"./coupon.181434da.js";import{b as U}from"./bind-mobile.63a8d6d0.js";import{M as N}from"./mescroll-body.f9302aea.js";import{M as P}from"./mescroll-empty.2fe85dec.js";import{u as Y}from"./useMescroll.26ccf5de.js";import{_ as A}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-transition.db07fff7.js";import"./u-icon.5ba98c98.js";import"./u-safe-bottom.a4431b09.js";import"./u-form.11d92cf8.js";import"./u-line.d86b0940.js";import"./sms-code.vue_vue_type_script_setup_true_lang.ce239318.js";import"./u-input.9468a367.js";import"./u-modal.3708081d.js";import"./u-loading-icon.6808ae8c.js";import"./u-checkbox-group.00090a01.js";import"./mescroll-i18n.49872024.js";const J=A(e({__name:"list",setup(e){const{mescrollInit:A,downCallback:J,getMescroll:K}=Y(g,v);let O={};V().setTopTabbarParam({title:"优惠券列表"}),t((()=>z(Number(O.height))+z(O.top)+z(8)+364+"rpx"));const W=t((()=>{let e="";return e=Object.keys(O).length?z(Number(O.height))+z(O.top)+z(8)+416+"rpx":"416rpx",e})),X=D();let Z=r();h((()=>{setTimeout((()=>{y().in(X).select(".coupon-header").boundingClientRect((e=>{Z.value=e.height+"px"})).exec()}))}));const $=t((()=>{let e="";return e="calc(100vh - 458rpx)","calc(100vh - 458rpx)"})),q=r([]),G=r(!0),Q=l(),ee=t((()=>Q.info)),te=e=>{G.value=!0;let t={page:e.num,limit:e.size,order:"all"===se.value?"":se.value,sort:"price"==se.value?ae.value:oe.value,type:pe.value||""};B(t).then((t=>{let r=t.data.data.map((e=>(-1!=e.sum_count&&e.receive_count===e.sum_count?e.btnType="collected":ee.value&&e.is_receive&&e.limit_count===e.member_receive_count?e.btnType="using":e.btnType="collecting",e)));1==e.num&&(q.value=[]),q.value=q.value.concat(r),e.endSuccess(r.length),G.value=!1})).catch((()=>{G.value=!1,e.endErr()}))},re=r(null),le=e=>{E({url:"/addon/shop/pages/coupon/detail",param:{coupon_id:e}})},ae=r(""),oe=r(""),se=r("all"),ne=r(0),pe=r(""),ie=r([]),ce=r(!1);a((()=>{H().then((e=>{ie.value.push({label:"全部",value:""}),ie.value=ie.value.concat(e.data)}))}));const ue=e=>{se.value=e,"all"==e&&(oe.value="",ae.value=""),"price"==e&&(oe.value="",ae.value?ae.value="asc"==ae.value?"desc":"asc":ae.value="asc"),"create_time"==e&&(ae.value="",oe.value?oe.value="asc"==oe.value?"desc":"asc":oe.value="asc"),"type"==e?(oe.value="asc",ae.value="asc",ce.value=!0):(ce.value=!1,q.value=[],K().resetUpScroll())};return(e,t)=>{const r=k,l=F,a=R,v=w,g=C(j("u-popup"),M);return o(),s(r,{class:"bg-[#F6F6F6] min-h-[100vh] overflow-hidden",style:i(e.themeColor())},{default:n((()=>[p(r,{class:"coupon-header fixed left-0 right-0 top-0 z-10080"},{default:n((()=>[p(r,{class:"h-[364rpx]",style:i({backgroundImage:"url("+c(T)("addon/shop/coupon/coupon_uniapp.png")+")",backgroundSize:"cover",backgroundPosition:"bottom",backgroundRepeat:"no-repeat"})},null,8,["style"]),p(r,{class:u(["-mt-[-36rpx] px-[var(--sidebar-m)] py-[24rpx] flex items-center justify-between leading-[40rpx] text-[28rpx] bg-[#F6F6F6] rounded-t-[26rpx] relative z-99999",{"!bg-[#fff]":ce.value}])},{default:n((()=>[p(l,{class:u({"text-primary ":"all"==se.value}),onClick:t[0]||(t[0]=e=>ue("all"))},{default:n((()=>[x("默认排序")])),_:1},8,["class"]),p(r,{class:u(["flex items-center",{"text-primary":"create_time"==se.value}]),onClick:t[1]||(t[1]=e=>ue("create_time"))},{default:n((()=>[p(l,{class:"mr-[4rpx]"},{default:n((()=>[x("最新")])),_:1}),"asc"==oe.value?(o(),s(l,{key:0,class:u(["text-[18rpx] text-[#626779] nc-iconfont nc-icon-a-xiangshangV6xx1",{"!text-primary":"create_time"==se.value}])},null,8,["class"])):(o(),s(l,{key:1,class:u(["text-[18rpx] text-[#626779] nc-iconfont nc-icon-a-xiangxiaV6xx1",{"!text-primary":"create_time"==se.value}])},null,8,["class"]))])),_:1},8,["class"]),p(r,{class:u(["flex items-center",{"text-primary":"price"==se.value}]),onClick:t[2]||(t[2]=e=>ue("price"))},{default:n((()=>[p(l,{class:"mr-[4rpx]"},{default:n((()=>[x("价格")])),_:1}),"asc"==ae.value?(o(),s(l,{key:0,class:u(["text-[18rpx] text-[#626779] nc-iconfont nc-icon-a-xiangshangV6xx1",{"!text-primary":"price"==se.value}])},null,8,["class"])):(o(),s(l,{key:1,class:u(["text-[18rpx] text-[#626779] nc-iconfont nc-icon-a-xiangxiaV6xx1",{"!text-primary":"price"==se.value}])},null,8,["class"]))])),_:1},8,["class"]),p(r,{class:u(["flex items-center",{"text-primary":"type"==se.value}]),onClick:t[3]||(t[3]=e=>ue("type"))},{default:n((()=>[p(r,{class:"w-[2rpx] h-[28rpx] bg-gradient-to-b from-[#333] to-[#fff] mr-[20rpx] flex-shrink-0"}),p(l,{class:"mr-[10rpx]"},{default:n((()=>[x("筛选")])),_:1}),p(l,{class:"nc-iconfont color-[#626779] nc-icon-shaixuanV6xx text-[28rpx]"})])),_:1},8,["class"])])),_:1},8,["class"])])),_:1}),p(N,{ref:"mescrollRef",onInit:c(A),down:{use:!1},height:"auto",onUp:te,top:c(W)},{default:n((()=>[p(r,{class:"py-[20rpx] sidebar-marign"},{default:n((()=>[(o(!0),d(m,null,f(q.value,((e,t)=>(o(),d(m,null,["collected"===e.btnType?(o(),s(r,{key:0,class:u(["flex items-center relative w-[100%] rounded-[20rpx] overflow-hidden bg-[#fff] py-[20rpx] background-size",{"mt-[20rpx]":t}]),style:i({backgroundImage:"url("+c(T)("addon/shop/coupon/coupn_loot.png")+")"}),onClick:t=>le(e.id)},{default:n((()=>[p(r,{class:"box-border flex-1 border-0 border-r-[1px] border-[#FFDCDC] border-dashed flex items-center"},{default:n((()=>[p(r,{class:"w-[164rpx] box-border flex justify-center"},{default:n((()=>[p(r,{class:"flex items-baseline text-[var(--price-text-color)]"},{default:n((()=>[p(l,{class:"text-[26rpx] leading-[34rpx] text-center font-400 price-font"},{default:n((()=>[x("￥")])),_:1}),p(l,{class:"text-[54rpx] font-500 text-left leading-[70rpx] max-w-[136rpx] truncate price-font"},{default:n((()=>[x(S(e.coupon_price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(r,{class:"flex-1 box-border ml-[10rpx]"},{default:n((()=>[p(r,{class:"text-[30rpx] leading-[42rpx] text-left font-500"},{default:n((()=>["0.00"===e.min_condition_money?(o(),s(l,{key:0},{default:n((()=>[x("无门槛")])),_:1})):(o(),s(l,{key:1},{default:n((()=>[x("满"+S(e.coupon_min_price)+"元可用",1)])),_:2},1024))])),_:2},1024),p(r,{class:"mt-[10rpx] text-left flex items-center"},{default:n((()=>[p(l,{class:"bg-[#FFEFF0] whitespace-nowrap text-[#EF000C] text-[20rpx] h-[28rpx] leading-[28rpx] px-[10rpx] rounded-[13rpx] mr-[10rpx] flex-shrink-0"},{default:n((()=>[x(S(e.type_name),1)])),_:2},1024),p(l,{class:"text-[22rpx] truncate max-w-[190rpx] leading-[30rpx] text-[#626779]"},{default:n((()=>[x(S(e.title),1)])),_:2},1024)])),_:2},1024),p(r,{class:"w-[100%] mt-[6rpx] text-[22rpx] leading-[30rpx] text-[#626779]"},{default:n((()=>[1==e.valid_type?(o(),s(l,{key:0},{default:n((()=>[x("领取之日起"+S(e.length||"")+"天内有效",1)])),_:2},1024)):(o(),s(l,{key:1},{default:n((()=>[x(" 有效期至"+S(e.valid_end_time?e.valid_end_time.slice(0,10):""),1)])),_:2},1024))])),_:2},1024)])),_:2},1024)])),_:2},1024),p(r,{class:"pr-[20rpx] pl-[34rpx]"},{default:n((()=>[p(a,{style:{width:"144rpx",height:"56rpx",color:"#fff",fontSize:"24rpx",lineHeight:"56rpx",padding:"0",backgroundColor:"#ee9ea2",border:"none",opacity:"1",borderRadius:"30rpx"},disabled:""},{default:n((()=>[x("已领完")])),_:1})])),_:1}),p(r,{class:"absolute top-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-br-[20rpx] rounded-bl-[20rpx] bg-[#F6F6F6]"}),p(r,{class:"absolute bottom-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-tr-[20rpx] rounded-tl-[20rpx] bg-[#F6F6F6]"})])),_:2},1032,["class","style","onClick"])):(o(),s(r,{key:1,class:u(["flex items-center relative w-[100%] rounded-[20rpx] overflow-hidden bg-[#fff] py-[20rpx] background-size",{"mt-[20rpx]":t}]),onClick:t=>le(e.id)},{default:n((()=>[p(r,{class:"relative box-border flex-1 border-0 border-r-[1px] border-[#FFDCDC] border-dashed flex items-center pl-[10rpx]"},{default:n((()=>[p(r,{class:"w-[164rpx] box-border flex justify-center"},{default:n((()=>[p(r,{class:"flex items-baseline text-[var(--price-text-color)]"},{default:n((()=>[p(l,{class:"text-[26rpx] leading-[34rpx] text-center font-400 price-font"},{default:n((()=>[x("￥")])),_:1}),p(l,{class:"text-[54rpx] font-500 text-left leading-[70rpx] max-w-[136rpx] truncate price-font"},{default:n((()=>[x(S(e.coupon_price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(r,{class:"flex-1 box-border ml-[10rpx]"},{default:n((()=>[p(r,{class:"text-[30rpx] leading-[42rpx] text-left font-500"},{default:n((()=>["0.00"===e.min_condition_money?(o(),s(l,{key:0},{default:n((()=>[x("无门槛")])),_:1})):(o(),s(l,{key:1},{default:n((()=>[x("满"+S(e.coupon_min_price)+"元可用",1)])),_:2},1024))])),_:2},1024),p(r,{class:"mt-[10rpx] text-left flex items-center"},{default:n((()=>[p(l,{class:"bg-[#FFEFF0] whitespace-nowrap text-[#EF000C] text-[20rpx] h-[28rpx] leading-[28rpx] px-[10rpx] rounded-[14rpx] mr-[10rpx] flex-shrink-0"},{default:n((()=>[x(S(e.type_name),1)])),_:2},1024),p(l,{class:"text-[22rpx] truncate max-w-[190rpx] leading-[30rpx] text-[#626779]"},{default:n((()=>[x(S(e.title),1)])),_:2},1024)])),_:2},1024),p(r,{class:"w-[100%] mt-[6rpx] text-[22rpx] leading-[30rpx] text-[#626779]"},{default:n((()=>[1==e.valid_type?(o(),s(l,{key:0},{default:n((()=>[x("领取之日起"),p(l,null,{default:n((()=>[x(S(e.length||""),1)])),_:2},1024),x("天内有效")])),_:2},1024)):(o(),s(l,{key:1},{default:n((()=>[x(" 有效期至"),p(l,null,{default:n((()=>[x(S(e.valid_end_time?e.valid_end_time.slice(0,10):""),1)])),_:2},1024)])),_:2},1024))])),_:2},1024)])),_:2},1024)])),_:2},1024),"collecting"===e.btnType?(o(),s(r,{key:0,onClick:b((r=>((e,t)=>ee.value?uni.getStorageSync("isbindmobile")?(re.value.open(),!1):void L({coupon_id:e,number:1,type:"receive"}).then((e=>{e.code>0&&(q.value[t].member_receive_count+=1,q.value[t].receive_count+=1,(q.value[t].member_receive_count==q.value[t].limit_count||-1!=q.value[t].sum_count&&q.value[t].receive_count===q.value[t].sum_count)&&(q.value[t].btnType="using"))})):(I().setLoginBack({url:"/addon/shop/pages/coupon/list"}),!1))(e.id,t)),["stop"]),class:"pr-[20rpx] pl-[34rpx]"},{default:n((()=>[p(a,{style:i({width:"144rpx",height:"56rpx",color:"#fff",fontSize:"24rpx",lineHeight:"56rpx",padding:"0",backgroundColor:"var(--primary-color)",border:"none",borderRadius:"30rpx"})},{default:n((()=>[x("立即领取")])),_:1},8,["style"])])),_:2},1032,["onClick"])):_("v-if",!0),"using"===e.btnType?(o(),s(r,{key:1,onClick:b((t=>{return r=e.id,void E({url:"/addon/shop/pages/goods/list",param:{coupon_id:r}});var r}),["stop"]),class:"pr-[20rpx] pl-[34rpx]"},{default:n((()=>[p(a,{style:i({width:"144rpx",height:"56rpx",color:"var(--primary-color)",fontSize:"24rpx",lineHeight:"52rpx",padding:"0",backgroundColor:"transparent",border:"2rpx solid var(--primary-color)",borderRadius:"30rpx"})},{default:n((()=>[x("去使用")])),_:1},8,["style"])])),_:2},1032,["onClick"])):_("v-if",!0),p(r,{class:"absolute top-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-br-[20rpx] rounded-bl-[20rpx] bg-[#F6F6F6]"}),p(r,{class:"absolute bottom-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-tr-[20rpx] rounded-tl-[20rpx] bg-[#F6F6F6]"})])),_:2},1032,["class","onClick"]))],64)))),256)),q.value.length||G.value?_("v-if",!0):(o(),s(r,{key:0,style:i({height:c($)}),class:"noData rounded-[20rpx] flex items-center justify-center"},{default:n((()=>[p(P,{option:{tip:"暂无优惠券"}})])),_:1},8,["style"]))])),_:1})])),_:1},8,["onInit","top"]),p(g,{show:ce.value,mode:"top",onClose:t[5]||(t[5]=e=>ce.value=!1),customStyle:{top:c(Z)},safeAreaInsetBottom:!1},{default:n((()=>[p(r,{onTouchmove:t[4]||(t[4]=b((()=>{}),["prevent","stop"]))},{default:n((()=>[p(v,{"scroll-x":!0,"scroll-with-animation":"","scroll-into-view":"id"+(ne.value?ne.value-1:0),class:"px-[var(--sidebar-m)] box-border bg-white rounded-b-[26rpx]"},{default:n((()=>[p(r,{class:"items-center flex py-[25rpx] border-0 border-t-[2rpx] border-solid border-[#F0F2F8]"},{default:n((()=>[(o(!0),d(m,null,f(ie.value,((e,t)=>(o(),s(l,{class:u(["flex-shrink-0 w-[120rpx] h-[50rpx] text-[26rpx] leading-[50rpx] text-center text-[#626779] bg-[#F8F9FD] rounded-[30rpx] border-box mr-[20rpx] border-[2rpx] border-solid border-[#F8F9FD]",{"!text-primary !border-primary !bg-[rgba(239,0,12,0.04)] font-500":e.value==pe.value}]),key:t,id:"id"+t,onClick:r=>((e,t)=>{ne.value=e,pe.value=t,q.value=[],K().resetUpScroll(),ce.value=!1})(t,e.value)},{default:n((()=>[x(S(e.label),1)])),_:2},1032,["class","id","onClick"])))),128))])),_:1})])),_:1},8,["scroll-into-view"])])),_:1})])),_:1},8,["show","customStyle"]),_(" 强制绑定手机号 "),p(U,{ref_key:"bindMobileRef",ref:re},null,512)])),_:1},8,["style"])}}}),[["__scopeId","data-v-6ef95931"]]);export{J as default};
