import{d as e,r as a,j as l,m as t,o as r,c as s,w as u,b as o,u as d,x as n,y as p,aN as i,n as c,f as x,E as m,F as f,G as _,au as v,I as h,a as y,g,h as b,C as j,i as w,a3 as V,b$ as k,a4 as C,V as P,t as S,$ as E}from"./index-656dc629.js";import{_ as I}from"./u-icon.286409fc.js";import{_ as M}from"./u--image.8451ef47.js";import{_ as R}from"./u-upload.92f8ee12.js";import{_ as U}from"./u-button.e2de732d.js";import{_ as F,a as L}from"./u-radio-group.acb332f8.js";import{_ as N}from"./u-popup.7e287da6.js";import{f as $,e as z,r as A}from"./order.7b3e1a9b.js";import{_ as B}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.38c45e12.js";import"./u-transition.825c0e35.js";import"./u-loading-icon.5e5c27a0.js";/* empty css                                                                 */import"./u-safe-bottom.d9fa806b.js";const D=B(e({__name:"apply",setup(e){var B;const D=a(null),G=a({}),T=a(0);let X=a(!1);const q=a({order_id:null==(B=D.value)?void 0:B.order_id,order_item_id:T.value,apply_money:"",reason:"",remark:"",voucher:[]}),H=a([]),J=a("");$().then((({data:e})=>{H.value=e,H.value&&H.value.length&&(J.value=H.value[0])})).catch(),l((e=>{T.value=e.order_item_id||0,q.value.order_item_id=T.value,q.value.order_id=e.order_id||0,z(e.order_id).then((({data:e})=>{D.value=e,D.value.item.forEach(((e,a)=>{T.value==e.order_item_id&&(G.value=e)})),q.value.apply_money=K.value})).catch((()=>{}))}));const K=t((()=>{let e=0;return e=G.value.item_money,E(e)})),O=t((e=>function(e){return""==e||0==e?"60rpx":17*String(e).length+"rpx"})),Q=t((()=>{if(q.value.voucher.length)return q.value.voucher.map((e=>({url:P(e)})))})),W=e=>{e.file.forEach((e=>{v({filePath:e.url,name:"file"}).then((e=>{q.value.voucher.length<9&&q.value.voucher.push(e.data.url)})).catch((()=>{}))}))},Y=e=>{q.value.voucher.splice(e.index,1)},Z=a(!1),ee=()=>{if(!q.value.reason)return h({title:"请选择退款原因",icon:"none"}),!1;if(Z.value)return;Z.value=!0;let e=q.value;e.voucher=e.voucher.toString(),A(e).then((e=>{Z.value=!1,setTimeout((()=>{y({url:"/addon/o2o/pages/order/detail",param:{order_id:q.value.order_id}})}),1e3)})).catch((()=>{Z.value=!1}))},ae=()=>{q.value.reason=J.value,X.value=!1};return(e,a)=>{const l=g(b("u-icon"),I),t=g(b("u--image"),M),v=j,h=w,y=V,E=g(b("u-upload"),R),$=k,z=g(b("u-button"),U),A=g(b("u-radio"),F),B=g(b("u-radio-group"),L),T=C,le=g(b("u-popup"),N);return D.value?(r(),s(h,{key:0,class:"bg-[#f8f8f8] min-h-screen overflow-hidden",style:c(e.themeColor())},{default:u((()=>[o(h,{class:"bg-page"},{default:u((()=>[o(h,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(h,{class:"flex py-[30rpx] border-0 !border-b !border-[#f5f5f5] border-solid"},{default:u((()=>[o(t,{width:"120rpx",height:"120rpx",src:d(P)(G.value.item_image),model:"aspectFill"},{error:u((()=>[o(l,{name:"photo",color:"#999",size:"50"})])),_:1},8,["src"]),o(h,{class:"flex flex-1 flex-col justify-between ml-[20rpx]"},{default:u((()=>[o(h,null,{default:u((()=>[o(v,{class:"text-[28rpx] text-item leading-[40rpx]"},{default:u((()=>[n(p(G.value.item_name),1)])),_:1})])),_:1}),o(h,{class:"text-[22rpx] mt-[14rpx]"},{default:u((()=>[o(v,{class:"text-[var(--primary-color)] rounded-[6rpx] py-[6rpx] bg-[var(--label-bg-color)] px-[10rpx]"},{default:u((()=>[n(p(G.value.item_type_name),1)])),_:1})])),_:1}),o(h,{class:"text-[28rpx] mt-[14rpx] flex justify-between"},{default:u((()=>[o(v,{class:"text-[var(--primary-color)] price-font"},{default:u((()=>[n("￥"+p(G.value.item_money),1)])),_:1}),o(v,{class:"text-[22rpx] ml-[20rpx]"},{default:u((()=>[n("x"+p(G.value.num),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(h,{class:"bg-page"},{default:u((()=>[o(h,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(h,{class:"py-[24rpx] flex justify-between items-center"},{default:u((()=>[o(h,{class:"text-sm"},{default:u((()=>[n(p(d(S)("refundReason")),1)])),_:1}),o(h,{class:"flex items-center",onClick:a[0]||(a[0]=e=>i(X)?X.value=!0:X=!0)},{default:u((()=>[o(h,{class:"flex-1 text-right"},{default:u((()=>[o(h,{class:"text-xs text-gray-subtitle truncate w-[460rpx]"},{default:u((()=>[n(p(q.value.reason||d(S)("placeholder")),1)])),_:1})])),_:1}),o(v,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#666]"})])),_:1})])),_:1})])),_:1}),o(h,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(h,{class:"py-[24rpx] flex items-center"},{default:u((()=>[o(h,{class:"text-sm"},{default:u((()=>[n(p(d(S)("refundMoney")),1)])),_:1}),o(h,{class:"flex-1 text-right"},{default:u((()=>[o(h,{class:"flex justify-end items-center"},{default:u((()=>[o(v,{class:"font-bold text-sm leading-none"},{default:u((()=>[n("￥")])),_:1}),o(y,{type:"number",modelValue:q.value.apply_money,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.apply_money=e),modelModifiers:{number:!0},class:"font-bold text-sm leading-none",style:c({width:d(O)(q.value.apply_money)})},null,8,["modelValue","style"])])),_:1}),o(h,{class:"text-xs text-gray-subtitle mt-[10rpx]"},{default:u((()=>[n(p(d(S)("moreInputMoney"))+p(d(K)),1)])),_:1})])),_:1})])),_:1})])),_:1}),o(h,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(h,{class:"py-[24rpx]"},{default:u((()=>[o(h,{class:"text-sm"},{default:u((()=>[n(p(d(S)("uploadProof")),1),o(v,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:u((()=>[n(p(d(S)("optional")),1)])),_:1})])),_:1}),o(h,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx]"},{default:u((()=>[o(E,{fileList:d(Q),onAfterRead:W,onDelete:Y,multiple:"",maxCount:9},{default:u((()=>[o(h,{class:"flex items-center justify-center w-[140rpx] h-[140rpx] border-[2rpx] border-dashed border-[#ebebec] text-center text-[#888]"},{default:u((()=>[o(h,{class:"nc-iconfont nc-icon-xiangjiV6xx text-[50rpx]"})])),_:1})])),_:1},8,["fileList"])])),_:1})])),_:1})])),_:1}),o(h,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(h,{class:"py-[24rpx]"},{default:u((()=>[o(h,{class:"text-sm"},{default:u((()=>[n(p(d(S)("description")),1),o(v,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:u((()=>[n(p(d(S)("optional")),1)])),_:1})])),_:1}),o(h,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx] h-[300rpx] relative"},{default:u((()=>[o($,{modelValue:q.value.remark,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value.remark=e),placeholder:d(S)("descriptionPlaceholder"),"placeholder-class":"text-sm",maxlength:100,class:"w-full h-full"},null,8,["modelValue","placeholder"]),o(h,{class:"absolute bottom-[20rpx] right-[20rpx] text-[24rpx] text-[#808080]"},{default:u((()=>[n(p(Number(q.value.remark.length)>=100?100:q.value.remark.length)+"/100",1)])),_:1})])),_:1})])),_:1})])),_:1}),o(h,{class:"mt-[40rpx] m-[24rpx]"},{default:u((()=>[o(z,{type:"primary",shape:"circle",text:d(S)("submit"),onClick:ee,loading:Z.value},null,8,["text","loading"])])),_:1}),x(" 退款原因 "),o(le,{show:d(X)},{default:u((()=>[o(h,{class:"px-[30rpx] pb-[30rpx]"},{default:u((()=>[o(h,{class:"flex items-center h-[90rpx] justify-between"},{default:u((()=>[o(v,null,{default:u((()=>[n(p(d(S)("refundReason")),1)])),_:1}),o(v,{class:"nc-iconfont nc-icon-guanbiV6xx text-[32rpx]",onClick:a[3]||(a[3]=e=>i(X)?X.value=!1:X=!1)})])),_:1}),o(T,{"scroll-y":"true",class:"h-[450rpx] mt-[20rpx]"},{default:u((()=>[o(B,{modelValue:J.value,"onUpdate:modelValue":a[4]||(a[4]=e=>J.value=e),placement:"column",activeColor:"var(--primary-color)"},{default:u((()=>[(r(!0),m(_,null,f(H.value,((e,a)=>(r(),s(A,{customStyle:{marginBottom:"8px"},key:a,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(z,{type:"primary",text:d(S)("confirm"),class:"mt-[40rpx]",shape:"circle",onClick:ae},null,8,["text"])])),_:1})])),_:1},8,["show"])])),_:1})])),_:1},8,["style"])):x("v-if",!0)}}}),[["__scopeId","data-v-b9d19f5f"]]);export{D as default};
