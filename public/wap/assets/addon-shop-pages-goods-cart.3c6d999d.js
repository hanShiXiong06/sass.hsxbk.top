import{d as e,l as t,j as s,r as l,x as a,a4 as o,F as r,o as d,c as u,w as n,u as c,b as i,y as p,z as x,U as f,ad as m,V as g,f as _,W as v,n as h,H as k,t as b,a as y,B as S,i as w,C as F,D as C,g as j,h as V,ac as E,E as I,A as z,s as U,an as B,bl as D,ab as A,bY as J,aJ as L,c8 as P,_ as T}from"./index-71c7df08.js";import{_ as $}from"./loading-page.vue_vue_type_script_setup_true_lang.c7dc2256.js";import{_ as H}from"./tabbar.a37cc2d9.js";import{u as K,g as M}from"./cart.9b3f86c4.js";import{b as N}from"./bind-mobile.b7e673b6.js";import"./cloneDeep.77735539.js";import"./sms-code.vue_vue_type_script_setup_true_lang.e09e1c1f.js";/* empty css                                                                    */const O=T(e({__name:"cart",setup(e){const T=t(),O=s((()=>T.info)),R=l(!0),W=l(!1),Y=l("0.00"),q=l([]),G=l([]),Q=l(!1),X=l(!0),Z=K(),ee=()=>{M({}).then((({data:e})=>{q.value=[],G.value=[],R.value=!1,e.forEach((e=>{e.checked=!1,e.goodsSku&&(e.goods.status&&0==e.goods.delete_time&&e.goodsSku.stock?(e.num>e.goodsSku.stock&&(e.num=e.goodsSku.stock),q.value.push(e)):G.value.push(e))})),re(),X.value&&(X.value=!1)})).catch((e=>{401==e.code&&(q.value=[],G.value=[],R.value=!1)}))};a((()=>{ee(),Z.getList()}));const te=s((()=>{let e=0;return q.value.forEach((t=>{t.checked&&(e+=1)})),e}));o((()=>q.value),(()=>{let e=0;q.value.forEach((t=>{if(t.checked&&t.goodsSku){let s=0;s=t.goods.is_discount&&t.goodsSku.sale_price!=t.goodsSku.price?t.goodsSku.sale_price:t.goods.member_discount&&U()&&t.goodsSku.member_price!=t.goodsSku.price?t.goodsSku.member_price:t.goodsSku.price,e+=parseFloat(s)*t.num}})),Y.value=e.toFixed(2)}),{deep:!0});const se=()=>{k().setLoginBack({url:"/addon/shop/pages/goods/cart"})},le=e=>({min:1,max:e.goodsSku.stock||1}),ae=l([{text:r("delete"),style:{backgroundColor:"#EF000C"}}]),oe=l(),re=()=>{const e=q.value.length!=te.value;q.value.forEach((t=>{t.checked=e}))},de=l(null);l(uni.getStorageSync("isbindmobile"));const ue=()=>{if(uni.getStorageSync("isbindmobile"))return de.value.open(),!1;if(!te.value)return void b({title:"还没有选择商品",icon:"none"});const e=[];q.value.forEach((t=>{t.checked&&e.push(t.id)})),uni.setStorage({key:"orderCreateData",data:{cart_ids:e},success(){y({url:"/addon/shop/pages/order/payment"})}})},ne=()=>{if(!te.value)return void b({title:"还没有选择商品",icon:"none"});if(W.value)return;W.value=!0;const e=[];q.value.forEach((t=>{t.checked&&e.push(t.id)})),Z.delete(e,(()=>{ee(),W.value=!1}))},ce=()=>{if(W.value)return;W.value=!0;const e=G.value.map((e=>e.id));Z.delete(e,(()=>{ee(),W.value=!1})),G.value=[]},ie=e=>{let t="";return t=e.goods.is_discount&&e.goodsSku.sale_price!=e.goodsSku.price?"discount_price":e.goods.member_discount&&U()&&e.goodsSku.member_price!=e.goodsSku.price?"member_price":"",t},pe=e=>{let t="0.00";return t=e.goods.is_discount&&e.goodsSku.sale_price!=e.goodsSku.price?e.goodsSku.sale_price?e.goodsSku.sale_price:e.goodsSku.price:e.goods.member_discount&&U()&&e.goodsSku.member_price!=e.goodsSku.price&&e.goodsSku.member_price?e.goodsSku.member_price:e.goodsSku.price,t};return(e,t)=>{const s=S,l=w,a=F,o=C,r=j(V("u--image"),D),k=A,b=j(V("u-number-box"),J),U=j(V("u-swipe-action-item"),L),T=j(V("u-swipe-action"),P),K=E,M=j(V("loading-page"),$),X=j(V("tabbar"),H);return d(),u(l,{style:h(e.themeColor())},{default:n((()=>[R.value?_("v-if",!0):(d(),u(l,{key:0,class:"bg-page h-screen overflow-hidden flex flex-col"},{default:n((()=>[c(O)?q.value.length||G.value.length?(d(),u(l,{key:2,class:"flex-1 h-0"},{default:n((()=>[i(K,{class:"scroll-height box-border","scroll-y":!0},{default:n((()=>[i(l,{class:"py-[var(--top-m)] sidebar-margin"},{default:n((()=>[q.value.length?(d(),u(l,{key:0,class:"bg-[#fff] pb-[10rpx] box-border rounded-[var(--rounded-big)]"},{default:n((()=>[i(l,{class:"flex mx-[var(--rounded-big)] pt-[var(--pad-top-m)] justify-between items-center box-border font-400 text-[24rpx] mb-[24rpx] leading-[30rpx]"},{default:n((()=>[i(l,{class:"flex items-baseline text-[24rpx] text-[#333]"},{default:n((()=>[i(o,null,{default:n((()=>[p("共")])),_:1}),i(o,{class:"text-[32rpx] mx-[2rpx] text-[var(--price-text-color)]"},{default:n((()=>[p(x(q.value.length),1)])),_:1}),i(o,null,{default:n((()=>[p("件商品")])),_:1})])),_:1}),i(o,{onClick:t[1]||(t[1]=e=>Q.value=!Q.value),class:"text-[var(--text-color-light6)] text-[24rpx]"},{default:n((()=>[p(x(Q.value?"完成":"管理"),1)])),_:1})])),_:1}),i(T,{ref_key:"swipeActive",ref:oe},{default:n((()=>[(d(!0),f(g,null,m(q.value,((e,a)=>(d(),f(g,null,[e.goodsSku?(d(),u(l,{key:0,class:"py-[20rpx] overflow-hidden w-full"},{default:n((()=>[i(U,{options:ae.value,onClick:t=>((e,t)=>{W.value||(W.value=!0,Z.delete(t.id,(()=>{q.value.splice(e,1),B((()=>{oe.value&&oe.value.closeOther()})),W.value=!1})))})(a,e)},{default:n((()=>[i(l,{class:"flex px-[var(--pad-sidebar-m)]",onClick:z((t=>e.checked=!e.checked),["stop"])},{default:n((()=>[i(l,{class:"self-center w-[58rpx] h-[60rpx] flex items-center"},{default:n((()=>[i(o,{class:v(["iconfont text-color text-[34rpx] w-[34rpx] h-[34rpx] rounded-[17rpx] overflow-hidden shrink-0",{iconxuanze1:e.checked,"bg-[#F5F5F5]":!e.checked}])},null,8,["class"])])),_:2},1024),i(r,{radius:"var(--goods-rounded-big)",width:"200rpx",height:"200rpx",onClick:t=>{y({url:"/addon/shop/pages/goods/detail",param:{goods_id:e.goods_id}})},src:c(I)(e.goodsSku.sku_image_thumb_mid||""),model:"aspectFill"},{error:n((()=>[i(s,{class:"w-[200rpx] h-[200rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:c(I)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["onClick","src"]),i(l,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:n((()=>[i(l,{class:"w-[100%] flex flex-col items-baseline"},{default:n((()=>[i(l,{class:"text-[#333] text-[28rpx] max-h-[80rpx] leading-[40rpx] multi-hidden font-400"},{default:n((()=>[p(x(e.goods.goods_name),1)])),_:2},1024),e.goodsSku&&e.goodsSku.sku_spec_format?(d(),u(l,{key:0,class:"box-border max-w-[376rpx] mt-[10rpx] px-[14rpx] h-[36rpx] leading-[36rpx] truncate text-[var(--text-color-light6)] bg-[#F5F5F5] text-[22rpx] rounded-[20rpx]"},{default:n((()=>[p(x(e.goodsSku.sku_spec_format),1)])),_:2},1024)):_("v-if",!0)])),_:2},1024),i(l,{class:"flex justify-between items-end self-end w-[100%]"},{default:n((()=>[i(l,{class:"flex items-end text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:n((()=>[i(l,{class:"text-[var(--price-text-color)] price-font"},{default:n((()=>[i(o,{class:"text-[24rpx] font-500"},{default:n((()=>[p("￥")])),_:1}),i(o,{class:"text-[40rpx] font-500"},{default:n((()=>[p(x(parseFloat(pe(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),i(o,{class:"text-[24rpx] font-500"},{default:n((()=>[p("."+x(parseFloat(pe(e)).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==ie(e)?(d(),u(s,{key:0,class:"h-[24rpx] ml-[6rpx]",src:c(I)("addon/shop/VIP.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0),"discount_price"==ie(e)?(d(),u(s,{key:1,class:"h-[24rpx] ml-[6rpx]",src:c(I)("addon/shop/discount.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0)])),_:2},1024)])),_:2},1024),i(b,{modelValue:e.num,"onUpdate:modelValue":t=>e.num=t,min:le(e).min,max:le(e).max,integer:"",step:1,"input-width":"68rpx","input-height":"52rpx","button-size":"52rpx",disabledInput:"",onChange:e=>((e,t)=>{uni.$u.debounce((e=>{const s=q.value[t];Z.increase({id:s.id,goods_id:s.goods_id,sku_id:s.sku_id,stock:s.goodsSku.stock,sale_price:s.goodsSku.sale_price,num:s.num},0)}),500)})(0,a)},{minus:n((()=>[i(o,{class:v([{"text-[var(--text-color-light9)]":e.num===le(e).min,"text-[#303133]":e.num!==le(e).min},"text-[24rpx] font-500 nc-iconfont nc-icon-jianV6xx"])},null,8,["class"])])),input:n((()=>[i(k,{class:"text-[#303133] text-[28rpx] mx-[10rpx] w-[80rpx] h-[44rpx] bg-[var(--temp-bg)] leading-[44rpx] text-center rounded-[6rpx]",type:"number",onInput:t=>{return s=e,void setTimeout((()=>{s.num>=le(s).max&&(s.num=le(s).max)}),0);var s},onBlur:e=>((e,t)=>{setTimeout((()=>{const e=q.value[t];(!e.num||e.num<=0)&&(e.num=1),e.num>=le(e).max&&(e.num=le(e).max),uni.$u.debounce((t=>{Z.increase({id:e.id,goods_id:e.goods_id,sku_id:e.sku_id,stock:e.goodsSku.stock,sale_price:e.goodsSku.sale_price,num:Number(e.num)},0)}),500)}),0)})(0,a),onClick:t[2]||(t[2]=z((()=>{}),["stop"])),modelValue:e.num,"onUpdate:modelValue":t=>e.num=t},null,8,["onInput","onBlur","modelValue","onUpdate:modelValue"])])),plus:n((()=>[i(o,{class:v([{"text-[var(--text-color-light9)]":e.num===le(e).max," text-[#303133]":e.num!==le(e).max},"text-[24rpx] font-500 nc-iconfont nc-icon-jiahaoV6xx"])},null,8,["class"])])),_:2},1032,["modelValue","onUpdate:modelValue","min","max","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["options","onClick"])])),_:2},1024)):_("v-if",!0)],64)))),256))])),_:1},512)])),_:1})):_("v-if",!0),G.value.length?(d(),u(l,{key:1,class:"bg-[#fff] pb-[10rpx] box-border rounded-[var(--rounded-big)] mt-[var(--top-m)]"},{default:n((()=>[i(l,{class:"flex mx-[var(--pad-sidebar-m)] pt-[var(--pad-top-m)] justify-between items-center box-border font-400 text-[#303133] text-[24rpx] mb-[24rpx] leading-[30rpx]"},{default:n((()=>[i(l,{class:"flex items-center text-[24rpx] text-[#333]"},{default:n((()=>[i(o,null,{default:n((()=>[p("共")])),_:1}),i(o,{class:"text-[28rpx] text-[var(--price-text-color)]"},{default:n((()=>[p(x(G.value.length),1)])),_:1}),i(o,null,{default:n((()=>[p("件失效商品")])),_:1})])),_:1}),i(o,{class:"text-[var(--text-color-light6)] text-[24rpx]",onClick:ce},{default:n((()=>[p("清空")])),_:1})])),_:1}),(d(!0),f(g,null,m(G.value,((e,t)=>(d(),u(l,{class:"py-[20rpx] overflow-hidden"},{default:n((()=>[i(l,{class:"flex px-[var(--pad-sidebar-m)]"},{default:n((()=>[i(o,{class:"self-center iconfont iconxuanze1 text-[34rpx] mr-[32rpx] text-[#F5F5F5] rounded-[50%] overflow-hidden shrink-0"}),i(l,{class:"relative w-[200rpx] h-[200rpx] rounded-[var(--goods-rounded-big)] overflow-hidden"},{default:n((()=>[i(r,{radius:"var(--goods-rounded-big)",width:"200rpx",height:"200rpx",src:c(I)(e.goodsSku.sku_image_thumb_mid),model:"aspectFill"},{error:n((()=>[i(s,{class:"w-[200rpx] h-[200rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:c(I)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),0==e.goodsSku.stock?(d(),u(l,{key:0,class:"absolute left-0 top-0 w-[200rpx] h-[200rpx] leading-[200rpx] text-center",style:{"background-color":"rgba(0,0,0,0.3)"}},{default:n((()=>[i(o,{class:"text-[#fff] text-[28rpx]"},{default:n((()=>[p("已售罄")])),_:1})])),_:1})):_("v-if",!0),0!=e.goodsSku.stock?(d(),u(l,{key:1,class:"absolute left-0 top-0 w-[200rpx] h-[200rpx] leading-[200rpx] text-center",style:{"background-color":"rgba(0,0,0,0.3)"}},{default:n((()=>[i(o,{class:"text-[#fff] text-[28rpx]"},{default:n((()=>[p("已失效")])),_:1})])),_:1})):_("v-if",!0)])),_:2},1024),i(l,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:n((()=>[i(l,{class:"w-[100%] flex flex-col items-baseline"},{default:n((()=>[i(l,{class:"text-[#333] text-[28rpx] max-h-[80rpx] leading-[40rpx] font-400 multi-hidden"},{default:n((()=>[p(x(e.goods.goods_name),1)])),_:2},1024),e.goodsSku&&e.goodsSku.sku_spec_format?(d(),u(l,{key:0,class:"box-border max-w-[376rpx] mt-[10rpx] px-[14rpx] h-[36rpx] leading-[36rpx] truncate text-[var(--text-color-light6)] bg-[#F5F5F5] text-[22rpx] rounded-[20rpx]"},{default:n((()=>[p(x(e.goodsSku.sku_spec_format),1)])),_:2},1024)):_("v-if",!0)])),_:2},1024),i(l,{class:"flex justify-between items-end self-end w-[100%]"},{default:n((()=>[i(l,{class:"flex items-end text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:n((()=>[i(l,{class:"text-[var(--price-text-color)] price-font"},{default:n((()=>[i(o,{class:"text-[24rpx] font-500"},{default:n((()=>[p("￥")])),_:1}),i(o,{class:"text-[36rpx] font-500"},{default:n((()=>[p(x(parseFloat(pe(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),i(o,{class:"text-[24rpx] font-500"},{default:n((()=>[p("."+x(parseFloat(pe(e)).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==ie(e)?(d(),u(s,{key:0,class:"h-[24rpx] ml-[6rpx]",src:c(I)("addon/shop/VIP.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0),"discount_price"==ie(e)?(d(),u(s,{key:1,class:"h-[24rpx] ml-[6rpx]",src:c(I)("addon/shop/discount.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})):_("v-if",!0)])),_:1})])),_:1})])),_:1})):(d(),u(l,{key:1,class:"empty-page"},{default:n((()=>[i(s,{class:"img",src:c(I)("addon/shop/cart-empty.png"),model:"aspectFit"},null,8,["src"]),i(l,{class:"desc"},{default:n((()=>[p("赶紧去逛逛, 购买心仪的商品吧")])),_:1}),i(a,{shape:"circle",plain:"true",class:"btn",onClick:t[0]||(t[0]=e=>c(y)({url:"/addon/shop/pages/goods/list"}))},{default:n((()=>[p("去逛逛")])),_:1})])),_:1})):(d(),u(l,{key:0,class:"empty-page"},{default:n((()=>[i(s,{class:"img",src:c(I)("static/resource/images/system/login.png"),model:"aspectFit"},null,8,["src"]),i(l,{class:"desc"},{default:n((()=>[p("暂未登录")])),_:1}),i(a,{shape:"circle",plain:"true",class:"btn",onClick:se},{default:n((()=>[p("去登录")])),_:1})])),_:1}))])),_:1})),q.value.length?(d(),u(l,{key:1,class:"flex h-[96rpx] items-center bg-[#fff] fixed left-0 right-0 bottom-[50px] pl-[30rpx] pr-[20rpx] box-solid mb-ios justify-between"},{default:n((()=>[i(l,{class:"flex items-center",onClick:re},{default:n((()=>[i(o,{class:v(["self-center iconfont text-color text-[34rpx] mr-[10rpx] w-[34rpx] h-[34rpx] rounded-[17rpx] overflow-hidden shrink-0",q.value.length==c(te)?"iconxuanze1":"bg-[#F5F5F5]"])},null,8,["class"]),i(o,{class:"font-400 text-[#303133] text-[26rpx]"},{default:n((()=>[p("全选")])),_:1})])),_:1}),i(l,{class:"flex items-center"},{default:n((()=>[Q.value?(d(),u(l,{key:1,class:"flex-1 flex items-center justify-end"},{default:n((()=>[i(a,{class:"w-[180rpx] h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] m-0 rounded-full primary-btn-bg remove-border",onClick:ne},{default:n((()=>[p("删除")])),_:1})])),_:1})):(d(),u(l,{key:0,class:"flex-1 flex items-center justify-between"},{default:n((()=>[i(l,{class:"flex items-center mr-[20rpx] text-[var(--price-text-color)] leading-[45rpx]"},{default:n((()=>[i(l,{class:"font-400 text-[#303133] text-[28rpx]"},{default:n((()=>[p("合计：")])),_:1}),i(o,{class:"text-[var(--price-text-color)] price-font text-[32rpx] font-bold"},{default:n((()=>[p(" ￥"+x(parseFloat(Y.value)),1)])),_:1})])),_:1}),i(a,{class:"w-[180rpx] h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] m-0 rounded-full primary-btn-bg remove-border",onClick:ue},{default:n((()=>[p("结算")])),_:1})])),_:1}))])),_:1})])),_:1})):_("v-if",!0),i(M,{loading:R.value},null,8,["loading"]),i(X),_(" 强制绑定手机号 "),i(N,{ref_key:"bindMobileRef",ref:de},null,512)])),_:1},8,["style"])}}}),[["__scopeId","data-v-973fe9e8"]]);export{O as default};
