import{d as e,r as a,j as l,_ as r,g as t,h as i,o as d,c as o,w as u,b as s,y as n,z as p,u as m,F as v,t as c,i as g,D as _,l as f,Z as x,p as b,K as h,s as y,H as k,ah as j,x as w,P as V,R as S,f as I,Q as P,a7 as C,n as F,B as U,C as N,c2 as z,E as B}from"./index-7bf68536.js";import{_ as O}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{_ as T}from"./u-input.09a5cedd.js";import{_ as A,a as E}from"./u-form.78a4f7c2.js";import{_ as M}from"./uni-popup.3d2f7726.js";import{d as R,e as q}from"./card.83abd190.js";import{s as D}from"./share-poster.5efeffe7.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-page.566c330a.js";import"./u-loading-icon.b37701e7.js";import"./u-transition.cdf87992.js";import"./u-icon.0c1c54c7.js";import"./u-line.463a2a45.js";import"./u-popup.be4bfacd.js";import"./u-safe-bottom.908eeae4.js";/* empty css                                                                     */const H=e({__name:"give-popup",props:{modelValue:{type:Boolean,default:!1},maxNum:{type:Number,default:0}},emits:["update:modelValue","success"],setup(e,{emit:f}){const x=e,b=a(),h=a({give_num:"",limit_num:""}),y=l({get:()=>x.modelValue,set(e){f("update:modelValue",e)}}),k=l((()=>x.maxNum));r((()=>y.value),(e=>{e?(b.value.open(),h.value={give_num:"",limit_num:""}):b.value.close()}));const j=l((()=>({give_num:{type:"string",required:!0,message:v("giveNumPlaceholderOne"),trigger:["blur","change"]},limit_num:{type:"string",required:!0,message:v("limitNumPlaceholder"),trigger:["blur","change"]}}))),w=()=>{""!==h.value.give_num&&null!==h.value.give_num&&(parseInt(h.value.give_num)<1&&(h.value.give_num=1),parseInt(h.value.give_num)>k.value&&(h.value.give_num=parseInt(k.value)),h.value.give_num=parseInt(h.value.give_num)+"")},V=()=>{""!==h.value.limit_num&&null!==h.value.limit_num&&(parseInt(h.value.limit_num)<1&&(h.value.limit_num=1),parseInt(h.value.limit_num)>k.value&&(h.value.limit_num=parseInt(k.value)),h.value.limit_num=parseInt(h.value.limit_num)+"")},S=a(null),I=()=>{S.value.validate().then((()=>{parseInt(h.value.limit_num)>parseInt(h.value.give_num)?c({title:"每人最多可领数量不可大于本次赠送数量",icon:"none"}):f("success",h.value)}))};return(e,a)=>{const l=g,r=t(i("u-input"),T),c=t(i("u-form-item"),A),f=_,x=t(i("u-form"),E),P=t(i("uni-popup"),M);return d(),o(P,{ref_key:"givePopup",ref:b,type:"center","is-mask-click":!1},{default:u((()=>[s(l,{class:"bg-[#fff] w-[630rpx] min-h-[668rpx] rounded-[var(--rounded-big)] box-border p-[30rpx] relative"},{default:u((()=>[s(l,{class:"nc-iconfont nc-icon-guanbiV6xx absolute top-0 right-0 text-[30rpx] p-[30rpx]",onClick:a[0]||(a[0]=e=>y.value=!1)}),s(l,{class:"text-[36rpx] leading-[50rpx] font-500 text-center mb-[60rpx] mt-[30rpx]"},{default:u((()=>[n(p(m(v)("giveSetUp")),1)])),_:1}),s(x,{labelPosition:"left",labelWidth:"136rpx",labelStyle:{"font-size":"28rpx","font-weight":"400","line-height":"39rpx"},model:h.value,errorType:"toast",rules:m(j),ref_key:"formRef",ref:S},{default:u((()=>[s(l,{class:"h-[88rpx] flex w-full items-center px-[var(--pad-sidebar-m)] rounded-[var(--rounded-small)] box-border border-[2rpx] border-solid border-[#eee]"},{default:u((()=>[s(c,{label:m(v)("giveNum"),prop:"give_num","border-bottom":!1},{default:u((()=>[s(r,{modelValue:h.value.give_num,"onUpdate:modelValue":a[1]||(a[1]=e=>h.value.give_num=e),modelModifiers:{trim:!0},type:"number",border:"none",maxlength:"8",placeholder:m(v)("giveNumPlaceholder"),autocomplete:"off",class:"!bg-transparent",fontSize:"24rpx",inputAlign:"right",placeholderClass:"!text-[var(--text-color-light9)] text-[24rpx]",onBlur:w},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(l,{class:"text-[28rpx] font-500 ml-[16rpx]"},{default:u((()=>[n(p(m(v)("unit")),1)])),_:1})])),_:1}),s(l,{class:"!text-[var(--text-color-light6)] text-[24rpx] leading-[34rpx] font-400 mt-[10rpx] px-[var(--pad-sidebar-m)]"},{default:u((()=>[s(f,null,{default:u((()=>[n(p(m(v)("tipsAnd")),1)])),_:1}),s(f,{class:"text-[var(--primary-color)]"},{default:u((()=>[n(p(m(k)),1)])),_:1}),s(f,null,{default:u((()=>[n(p(m(v)("tipsEnd")),1)])),_:1})])),_:1}),s(l,{class:"mt-[30rpx] h-[88rpx] flex w-full items-center px-[var(--pad-sidebar-m)] rounded-[var(--rounded-small)] box-border border-[2rpx] border-solid border-[#eee]"},{default:u((()=>[s(c,{label:m(v)("limitNum"),prop:"limit_num","border-bottom":!1},{default:u((()=>[s(r,{modelValue:h.value.limit_num,"onUpdate:modelValue":a[2]||(a[2]=e=>h.value.limit_num=e),modelModifiers:{trim:!0},type:"number",border:"none",maxlength:"8",placeholder:m(v)("limitNumPlaceholder"),autocomplete:"off",class:"!bg-transparent",fontSize:"24rpx",inputAlign:"right",placeholderClass:"!text-[var(--text-color-light9)] text-[24rpx]",onBlur:V},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),s(l,{class:"text-[28rpx] font-500 ml-[16rpx]"},{default:u((()=>[n(p(m(v)("unit")),1)])),_:1})])),_:1})])),_:1},8,["model","rules"]),s(l,{class:"px-[30rpx] mt-[100rpx]"},{default:u((()=>[s(l,{class:"h-[88rpx] leading-[88rpx] text-center text-[#fff] rounded-[44rpx] primary-btn-bg text-[28rpx]",onClick:I},{default:u((()=>[n(p(m(v)("giveSave")),1)])),_:1})])),_:1})])),_:1})])),_:1},512)}}}),K=L(e({__name:"give",setup(e){const r=f(),T=l((()=>r.info)),A=a({}),E=a(!0),M=a(!1),L=a({card_id:"",blessing:"",blessing_id:"",give_id:"",card_bag_id:"",give_num:"",limit_num:""}),K=a(!1),Q=a(""),W=a(!1),{setShare:X}=x();a(null),b((e=>{if(e.card_id||e.card_bag_id){if(!y())return k().setLoginBack({url:"/addon/shop_giftcard/pages/give",param:{card_id:e.card_id,card_bag_id:e.card_bag_id}}),!1;j((()=>{})),L.value.card_id=e.card_id||"",L.value.card_bag_id=e.card_bag_id||"",L.value.give_id=uni.getStorageSync("give_id"),T.value?Z():r.getMemberInfo((()=>{Z()}))}else{let e={url:"/addon/shop_giftcard/pages/index",title:v("notCard"),mode:"reLaunch"};h(e)}})),w((()=>{Object.keys(A.value).length&&Z()}));const Z=(e=null)=>{E.value=!0,(L.value.card_bag_id?R:q)(L.value).then((a=>{if(a.data){A.value=a.data,uni.getStorageSync("give_id")||uni.setStorageSync("give_id",A.value.give_id),ie();let l="",r="/addon/shop_giftcard/pages/receive_info"+re.value,t=location.pathname,i=["/app/","/addon/"];for(let e=0;e<i.length;e++)-1!=t.indexOf(i[e])&&(t=t.substr(0,t.indexOf(i[e])));l=location.origin+t+r,setTimeout((()=>{let e={title:v("shareTitle"),desc:L.value.blessing,url:A.value.card_cover,link:l,path:r};X({wechat:{...e},weapp:{...e}})}),600),e&&e()}E.value=!1,M.value=!1})).catch((()=>{E.value=!1,M.value=!1}))},G=e=>{K.value=!e.id,e.id&&(Q.value=""),L.value.blessing=e.blessing,L.value.blessing_id=e.id},J=()=>{Q.value=Q.value.substr(0,20),L.value.blessing=Q.value.substr(0,20)},Y=()=>{M.value||(W.value=!0)},$=e=>{L.value=Object.assign(L.value,e),L.value.give_id=0,W.value=!1,Z()},ee=()=>{M.value||(L.value.blessing?(M.value=!0,Z((()=>{de()}))):c({title:v("blessingPlaceholder"),icon:"none"}))},ae=a(null),le=a("/addon/shop_giftcard/pages/receive_info"),re=a("");let te={};const ie=()=>{re.value="?give_id="+A.value.give_id,T.value&&T.value.member_id&&(re.value+="&mid="+T.value.member_id)},de=()=>{te.give_id=A.value.give_id,T.value&&T.value.member_id&&(te.member_id=T.value.member_id),ae.value.openShare()},oe=e=>{let a="";return a="balance"==e.giftcard.card_right_type?"addon/shop_giftcard/diy/index/value_card.jpg":"addon/shop_giftcard/diy/index/redemption_card.jpg",a};return(e,a)=>{const l=U,r=_,c=N,f=g,x=z,b=t(i("loading-page"),O);return d(),o(f,{class:"bg-[#f8f8f8] min-h-[100vh]",style:F(e.themeColor())},{default:u((()=>[Object.keys(A.value).length?(d(),V(P,{key:0},[s(f,{class:"px-[var(--sidebar-m)] py-[var(--top-m)]"},{default:u((()=>[s(f,{class:"w-full h-[430rpx] relative"},{default:u((()=>[A.value.card_cover?(d(),o(l,{key:0,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:m(B)(A.value.card_cover),onError:a[0]||(a[0]=e=>A.value.card_cover=oe(A.value)),mode:"aspectFill"},null,8,["src"])):(d(),o(l,{key:1,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:m(B)(oe(A.value)),mode:"aspectFill"},null,8,["src"])),s(f,{class:"absolute bottom-[var(--pad-top-m)] left-0 right-0 flex justify-center"},{default:u((()=>[s(c,{class:S([{"!bg-[#EF000C]":"balance"==A.value.giftcard.card_right_type,"!bg-[#FF7700]":"goods"==A.value.giftcard.card_right_type},"h-[44rpx] font-500 text-[24rpx] !text-[#fff] bg-[var(--primary-color)] m-0 rounded-[var(--rounded-big)] remove-border"])},{default:u((()=>[s(r,{class:S(["text-[20rpx] text-[24rpx] iconfont mr-[5rpx]",{iconchuzhikaV6mm:"balance"==A.value.giftcard.card_right_type,"iconduihuankaV6mm-1":"goods"==A.value.giftcard.card_right_type}])},null,8,["class"]),"balance"==A.value.giftcard.card_right_type?(d(),o(r,{key:0,class:"leading-[44rpx]"},{default:u((()=>[n(p(A.value.balance)+p(m(v)("yuan")),1)])),_:1})):I("v-if",!0),s(r,{class:"leading-[44rpx]"},{default:u((()=>[n(p(A.value.giftcard.card_right_type_name),1)])),_:1})])),_:1},8,["class"])])),_:1}),I(' <view v-if="!formData.card_bag_id"  class="flex justify-between w-full px-[var(--pad-sidebar-m)] left-0 bottom-[var(--pad-top-m)] absolute">\r\n\t\t\t\t\t\t<view class="h-[44rpx] leading-[44rpx] text-[26rpx]" style="text-stroke: 0.1rpx #FFFFFF;">{{detail.card_no}}</view>\r\n\t\t\t\t\t</view> ')])),_:1}),s(f,{class:"mt-[var(--top-m)] card-template"},{default:u((()=>[s(f,{class:"title"},{default:u((()=>[n(p(m(v)("blessing")),1)])),_:1}),A.value.giftcard.blessing_json?(d(),o(f,{key:0,class:"w-full flex flex-wrap gap-x-[var(--pad-sidebar-m)]"},{default:u((()=>[(d(!0),V(P,null,C(A.value.giftcard.blessing_json,(e=>(d(),o(f,{key:e.id,onClick:a=>G(e),class:S(["h-[60rpx] px-[30rpx] box-border text-[28rpx] leading-[56rpx] rounded-[30rpx] bg-[var(--temp-bg)] mb-[var(--pad-top-m)] box-border border-[2rpx] border-solid border-[var(--temp-bg)]",{"!border-[var(--primary-color)] !bg-[var(--primary-color-light)] !text-[var(--primary-color)]":e.id===L.value.blessing_id}])},{default:u((()=>[n(p(e.blessing),1)])),_:2},1032,["onClick","class"])))),128)),s(f,{onClick:a[1]||(a[1]=e=>G({id:"",blessing:""})),class:S(["h-[60rpx] px-[30rpx] box-border text-[28rpx] leading-[56rpx] rounded-[30rpx] bg-[var(--temp-bg)] mb-[var(--pad-top-m)] box-border border-[2rpx] border-solid border-[var(--temp-bg)]",{"!border-[var(--primary-color)] !bg-[var(--primary-color-light)] !text-[var(--primary-color)]":K.value}])},{default:u((()=>[n(p(m(v)("customBlessing")),1)])),_:1},8,["class"])])),_:1})):I("v-if",!0),K.value?(d(),o(f,{key:1,class:"h-[200rpx] bg-[var(--temp-bg)] rounded-[var(--rounded-big)] px-[var(--pad-sidebar-m)] py-[var(--pad-top-m)] box-border"},{default:u((()=>[s(x,{class:"leading-[1.5] h-[100%] w-[100%] text-[28rpx]",modelValue:Q.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Q.value=e),modelModifiers:{trim:!0},cols:"30",rows:"5",placeholder:m(v)("blessingPlaceholder"),"placeholder-class":"text-[28rpx] text-[var(--text-color-light9)]",maxlength:"20",onInput:J},null,8,["modelValue","placeholder"])])),_:1})):I("v-if",!0)])),_:1})])),_:1}),s(f,{class:S(["border-[0] border-t-[2rpx] border-solid border-[#f5f5f5] w-full tab-bar",{"h-[70rpx]":!L.value.card_bag_id,"h-[124rpx]":L.value.card_bag_id}])},{default:u((()=>[s(f,{class:"border-[0] border-t-[2rpx] border-solid border-[#f5f5f5] w-full px-[var(--pad-sidebar-m)] bg-[#fff] box-border fixed left-0 bottom-0 tab-bar z-1 items-center"},{default:u((()=>["to_use"==A.value.status&&A.value.giftcard.is_give?(d(),o(c,{key:0,class:S(["w-full !h-[70rpx] font-500 text-[26rpx] !text-[#fff] primary-btn-bg !m-0 leading-[70rpx] rounded-full remove-border",{"opacity-40":M.value}]),onClick:ee},{default:u((()=>[n(p(m(v)("giftToFriendsSave")),1)])),_:1},8,["class"])):I("v-if",!0),L.value.card_bag_id&&A.value.to_use_count?(d(),o(f,{key:1,class:"mt-[20rpx] text-[24rpx] text-center leading-[34rpx] !text-[var(--text-color-light9)]",onClick:Y},{default:u((()=>[n(p(m(v)("giveSetUp")),1)])),_:1})):I("v-if",!0)])),_:1})])),_:1},8,["class"]),s(D,{ref_key:"sharePosterRef",ref:ae,posterType:"shop_giftcard_give",posterId:A.value.giftcard.poster_id,copyUrl:le.value,posterParam:m(te),copyUrlParam:re.value},null,8,["posterId","copyUrl","posterParam","copyUrlParam"]),s(m(H),{modelValue:W.value,"onUpdate:modelValue":a[3]||(a[3]=e=>W.value=e),"max-num":A.value.to_use_count,onSuccess:$},null,8,["modelValue","max-num"])],64)):I("v-if",!0),s(b,{loading:E.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-dd34c444"]]);export{K as default};
