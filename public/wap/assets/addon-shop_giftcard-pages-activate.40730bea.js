import{d as e,F as a,r,j as t,p as l,O as o,o as s,c as d,w as p,b as n,n as u,u as i,y as c,z as f,f as m,R as b,a as x,i as g,g as _,h as v,C as h,B as y,E as k}from"./index-7bf68536.js";import{_ as w}from"./u-input.09a5cedd.js";import{_ as j,a as T}from"./u-form.78a4f7c2.js";import{_ as z}from"./u-parse.525658f5.js";import{_ as C}from"./uni-popup.3d2f7726.js";import{_ as P}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{c as V}from"./card.83abd190.js";import{c as S}from"./giftcard.66db0fe0.js";import{t as R}from"./topTabbar.f3f9eebd.js";import{_ as N}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.0c1c54c7.js";import"./u-line.463a2a45.js";import"./u-loading-page.566c330a.js";import"./u-loading-icon.b37701e7.js";import"./u-transition.cdf87992.js";const O=N(e({__name:"activate",setup(e){R().setTopTabbarParam({title:a("cardEncryptionActivation")});const N=r(!0),O=r({}),U=r(!0),q=r(!1),E=r({card_no:"",card_key:""}),F=t((()=>({backgroundImage:"url("+k(O.value.banner||"")+") ",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"bottom"})));l((()=>{M()})),o((()=>{setTimeout((()=>{N.value=!1}),800)}));const I=t((()=>({card_no:{type:"string",required:!0,message:a("cardNumberPlaceholder"),trigger:["blur","change"]},card_key:{type:"string",required:!0,message:a("passwordPlaceholder"),trigger:["blur","change"]}}))),M=()=>{U.value=!0,S().then((e=>{O.value=e.data,U.value=!1})).catch((()=>{U.value=!1}))},A=r(),B=r(null),G=()=>{q.value||B.value.validate().then((()=>{q.value=!0,V(E.value).then((e=>{e.data&&(A.value.open(),E.value.card_no="",E.value.card_key=""),q.value=!1})).catch((()=>{q.value=!1}))}))},K=()=>{A.value.close(),x({url:"/addon/shop_giftcard/pages/my_card_list",mode:"redirectTo"})},W=()=>{A.value.close()};return(e,r)=>{const t=g,l=_(v("u-input"),w),o=_(v("u-form-item"),j),x=_(v("u-form"),T),V=_(v("u-parse"),z),S=h,R=y,M=_(v("uni-popup"),C),X=_(v("loading-page"),P);return s(),d(t,{class:"bg-[#f8f8f8] min-h-[100vh] w-full",style:u(e.themeColor())},{default:p((()=>[Object.keys(O.value).length?(s(),d(t,{key:0,class:"w-full"},{default:p((()=>[n(t,{class:"pb-[384rpx]",style:u(i(F))},null,8,["style"]),n(t,{class:"card-template sidebar-margin mt-[-56rpx]"},{default:p((()=>[n(x,{labelPosition:"left",labelWidth:"136rpx",labelStyle:{"font-size":"28rpx","font-weight":"400","line-height":"39rpx"},model:E.value,errorType:"toast",rules:i(I),ref_key:"formRef",ref:B},{default:p((()=>[n(t,{class:"h-[88rpx] flex w-full items-center px-[var(--pad-sidebar-m)] rounded-[44rpx] box-border border-[2rpx] border-solid border-[#eee]"},{default:p((()=>[n(o,{label:i(a)("cardNo"),prop:"card_no","border-bottom":!1},{default:p((()=>[n(l,{modelValue:E.value.card_no,"onUpdate:modelValue":r[0]||(r[0]=e=>E.value.card_no=e),modelModifiers:{trim:!0},border:"none",maxlength:"40",placeholder:i(a)("cardNumberPlaceholder"),autocomplete:"off",class:"!bg-transparent",disabled:N.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])])),_:1},8,["label"])])),_:1}),n(t,{class:"mt-[30rpx] h-[88rpx] flex w-full items-center px-[var(--pad-sidebar-m)] rounded-[44rpx] box-border border-[2rpx] border-solid border-[#eee]"},{default:p((()=>[n(o,{label:i(a)("cardKey"),prop:"card_key","border-bottom":!1},{default:p((()=>[n(l,{modelValue:E.value.card_key,"onUpdate:modelValue":r[1]||(r[1]=e=>E.value.card_key=e),modelModifiers:{trim:!0},border:"none",type:"password",maxlength:"40",placeholder:i(a)("passwordPlaceholder"),autocomplete:"off",class:"!bg-transparent",disabled:N.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])])),_:1},8,["label"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),O.value.tips?(s(),d(t,{key:0,class:"card-template sidebar-margin mt-[var(--sidebar-m)]"},{default:p((()=>[n(t,{class:"title"},{default:p((()=>[c(f(i(a)("reminder")),1)])),_:1}),n(t,{class:"u-content"},{default:p((()=>[n(V,{content:O.value.tips,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):m("v-if",!0),n(t,{class:"w-full footer"},{default:p((()=>[n(t,{class:"py-[var(--top-m)] px-[var(--sidebar-m)] bg-[#f8f8f8] footer w-full fixed bottom-0 left-0 right-0 box-border"},{default:p((()=>[n(S,{"hover-class":"none",class:b(["primary-btn-bg text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500",{"opacity-40":q.value}]),onClick:G},{default:p((()=>[c(f(i(a)("activateCard")),1)])),_:1},8,["class"])])),_:1})])),_:1}),n(M,{ref_key:"popupRef",ref:A,type:"center","is-mask-click":!1},{default:p((()=>[n(t,{class:"bg-[#fff] w-[530rpx] min-h-[504rpx] rounded-[var(--rounded-big)] box-border p-[32rpx] relative",style:u({"background-image":"url("+i(k)("addon/shop_giftcard/popup_bg.png")+")",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"top"})},{default:p((()=>[n(R,{class:"w-[327rpx] h-[327rpx] rounded-[var(--rounded-mid)] absolute left-[50%] top-[-163.5rpx] transform -translate-x-1/2 z-10",src:i(k)("addon/shop_giftcard/popup_top.png"),mode:"aspectFill"},null,8,["src"]),n(t,{class:"text-[40rpx] leading-[56rpx] font-bold text-center pt-[174rpx]"},{default:p((()=>[c(f(i(a)("popupTipsOne")),1)])),_:1}),n(t,{class:"text-[24rpx] leading-[34rpx] text-center mt-[30rpx]"},{default:p((()=>[c(f(i(a)("popupTipsTwo")),1)])),_:1}),n(S,{class:"w-[370rpx] h-[80rpx] font-500 text-[26rpx] leading-[80rpx] !text-[#fff] primary-btn-bg m-0 !mx-auto rounded-[40rpx] remove-border mt-[90rpx]",onClick:K},{default:p((()=>[c(f(i(a)("gouToSee")),1)])),_:1}),n(t,{class:"nc-iconfont nc-icon-cuohaoV6xx text-[57rpx] text-[#fff] absolute left-[50%] bottom-[-117rpx] transform -translate-x-1/2 z-10",onClick:W})])),_:1},8,["style"])])),_:1},512)])),_:1})):m("v-if",!0),n(X,{loading:U.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-67e1c783"]]);export{O as default};
