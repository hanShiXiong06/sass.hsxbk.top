import{d as e,r as a,N as t,o as l,c as s,w as o,b as r,y as c,z as i,f as u,c1 as n,k as d,i as p,D as x,C as f,p as _,F as m,Q as v,A as g,O as h,a6 as y,P as b,u as k,ba as w,n as j,a7 as S,a8 as C,g as F,h as V,a5 as P,E as z,t as I,a as N,$ as U,bX as A,s as M,B as T}from"./index-9317da28.js";import{_ as E}from"./u-input.e030155a.js";import{_ as D}from"./u--image.5461b7b7.js";import{_ as O}from"./u-button.c3400270.js";import{_ as L}from"./u-popup.1f2ebcae.js";import{_ as Q}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as R}from"./tabbar.31005363.js";import{b as B,c as H,d as J}from"./goods.c916db1a.js";import{M as X}from"./mescroll-body.c2f6fcce.js";import{M as $}from"./mescroll-empty.82e9c349.js";import{u as q}from"./useMescroll.26ccf5de.js";import"./u-icon.5e775659.js";/* empty css                                                                */import"./u-image.74ac23f6.js";import"./u-transition.65be38eb.js";import"./u-loading-icon.aabe3d05.js";/* empty css                                                                       */import"./u-safe-bottom.3546c5bb.js";import"./u-badge.4fd7810d.js";import"./u-tabbar.c8394bc9.js";import"./mescroll-i18n.f3c5a2b0.js";const G=Q(e({__name:"wx-privacy-popup",emits:["agree","disagree"],setup(e,{expose:_,emit:m}){a(!1);const v=a(!1),g=a(null),h=new Set,y=new Set,b=a("用户隐私保护指引");t((()=>{try{wx.getPrivacySetting({success(e){b.value=e.privacyContractName}}),wx.onNeedPrivacyAuthorization&&wx.onNeedPrivacyAuthorization((e=>{"function"==typeof g.value&&g.value(e)})),g.value=e=>{h.add(e),C(),w(F)},y.add(F)}catch(e){}}));const k=()=>{wx.openPrivacyContract({success(e){},fail(e){}})},w=e=>{y.forEach((a=>{e!==a&&a()}))},j=()=>{h.forEach((e=>{e({event:"disagree"})})),h.clear(),F(),n({content:"未同意隐私协议，无法使用相关功能",confirmColor:d().themeColor["--primary-color"],success:()=>{m("disagree")}})},S=()=>{h.forEach((e=>{e({event:"agree",buttonId:"agree-btn"})})),h.clear(),F(),m("agree")},C=()=>{!1===v.value&&(v.value=!0)},F=()=>{!0===v.value&&(v.value=!1)};return _({proactive:()=>{wx.getPrivacySetting?wx.getPrivacySetting({success:e=>{e.needAuthorization?(C(),w(F)):m("agree")}}):m("agree")}}),(e,a)=>{const t=p,n=x,d=f;return v.value?(l(),s(t,{key:0},{default:o((()=>[r(t,{class:"privacy-mask"},{default:o((()=>[r(t,{class:"privacy-wrap"},{default:o((()=>[r(t,{class:"privacy-title"},{default:o((()=>[c("用户隐私保护提示")])),_:1}),r(t,{class:"privacy-desc"},{default:o((()=>[c(" 感谢您使用本小程序，在使用前您应当阅读并同意 "),r(n,{class:"privacy-link",onClick:k},{default:o((()=>[c(i(b.value),1)])),_:1}),c("， 当点击同意并继续时，即表示您已理解并同意该条款内容，该条款将对您产生法律约束力；如您不同意，将无法继续使用小程序相关功能。 ")])),_:1}),r(t,{class:"privacy-button-flex"},{default:o((()=>[r(d,{class:"privacy-button-btn bg-disagree",onClick:j},{default:o((()=>[c("不同意")])),_:1}),r(d,{id:"agree-btn",class:"privacy-button-btn bg-agree","open-type":"agreePrivacyAuthorization",onAgreeprivacyauthorization:S},{default:o((()=>[c("同意并继续")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):u("v-if",!0)}}}),[["__scopeId","data-v-56c14461"]]),K=Q(e({__name:"list",setup(e){const{mescrollInit:n,downCallback:d,getMescroll:f}=q(C,S),Q=a([]),K=a([]),W=a(""),Y=a(""),Z=a(null),ee=a(!1),ae=a(!1),te=a(""),le=a(""),se=a(""),oe=a(""),re=a("all");a(!1);let ce=a({start_price:"",end_price:""});const ie=a(!0);_((async e=>{Y.value=e.curr_goods_category||"",te.value=e.goods_name||"",W.value=e.coupon_id||"",await B().then((e=>{Q.value=Q.value.concat(e.data),de(Q.value[0].category_id)}))}));const ue=a({}),ne=e=>{ee.value=!1;let a={goods_category:pe.value,page:e.num||15,limit:e.size,keyword:te.value,coupon_id:W.value,order:"all"===re.value?"":re.value,sort:"price"==re.value?le.value:se.value,start_price:ce.value.start_price,end_price:ce.value.end_price,create_time:oe.value};H(a).then((a=>{let t=a.data.data;K.value=K.value.concat(t),e.endSuccess(t.length),ee.value=!0})).catch((()=>{ee.value=!0,e.endErr()}))},de=e=>{pe.value=e,K.value=[];const a=Q.value.findIndex((a=>a.category_id==e));Y.value=a},pe=a(""),xe=e=>{re.value=e,"all"==e&&(se.value="",le.value=""),"day"==e&&(pe.value="",oe.value=oe.value?"":(new Date).toLocaleDateString().split("/").join("-")),"price"==e&&(se.value="",le.value?le.value="asc"==le.value?"desc":"asc":le.value="asc"),"sale_num"==e&&(le.value="",se.value?se.value="asc"==se.value?"desc":"asc":se.value="asc"),"label"==e?(se.value="asc",le.value="asc",ae.value=!ae.value):(ae.value=!1,K.value=[],f().resetUpScroll())},fe=()=>{ie.value=!ie.value},_e=e=>{N({url:"/addon/phone_shop/pages/goods/detail",param:{goods_id:e},mode:"navigateTo"})},me=()=>{te.value="",Y.value="",pe.value="",W.value="",le.value="",se.value="",ce.value.start_price="",ce.value.end_price="",ae.value=!1,re.value="all",ie.value=!0,K.value=[],oe.value="",f().resetUpScroll()};t((()=>{setTimeout((()=>{f().optUp.textNoMore=m("end")}),500)}));const ve=e=>{let a="";return a=e.is_discount&&e.goodsSku.sale_price!=e.goodsSku.price?"discount_price":e.member_discount&&M()&&e.goodsSku.member_price!=e.goodsSku.price?"member_price":"",a},ge=e=>{let a="0.00";return a=e.is_discount&&e.goodsSku.sale_price!=e.goodsSku.price?e.goodsSku.sale_price?e.goodsSku.sale_price:e.goodsSku.price:e.member_discount&&M()&&e.goodsSku.member_price!=e.goodsSku.price&&e.goodsSku.member_price?e.goodsSku.member_price:e.goodsSku.price,parseFloat(a)};return(e,a)=>{const t=F(V("u-input"),E),d=x,f=p,_=P,m=T,S=F(V("u--image"),D),C=F(V("u-button"),O),M=F(V("u-popup"),L),B=F(V("wx-privacy-popup"),G),H=F(V("tabbar"),R);return l(),s(f,{class:"bg-gray-100 min-h-[100vh]",style:j(e.themeColor())},{default:o((()=>[r(f,{class:"fixed left-0 right-0 top-0 product-warp bg-[#fff] px-[30rpx]"},{default:o((()=>[r(f,{class:"py-[14rpx] flex items-center justify-between"},{default:o((()=>[r(f,{class:"flex-1 flex items-center h-[64rpx] bg-[#F6F8F8] rounded-[33rpx] px-[32rpx] mr-[30rpx]"},{default:o((()=>[r(t,{class:"flex-1",maxlength:"50",modelValue:te.value,"onUpdate:modelValue":a[0]||(a[0]=e=>te.value=e),onConfirm:a[1]||(a[1]=e=>xe("all")),placeholder:"请搜索您想要的商品(串号搜索前加#)",placeholderClass:"text-[#a5a6a6] text-[26rpx]",fontSize:"26rpx",clearable:"",border:"none"},null,8,["modelValue"]),r(d,{class:"nc-iconfont nc-icon-sousuo-duanV6xx1 text-[32rpx] ml-[18rpx] !text-[#999]",onClick:a[2]||(a[2]=e=>xe("all"))})])),_:1}),r(f,{class:v(["nc-iconfont text-[34rpx] text-[#666]",ie.value?"nc-icon-erweimaV6xx":"nc-icon-yingyongliebiaoV6xx"]),onClick:fe},null,8,["class"])])),_:1}),r(f,{class:"flex justify-between tems-center py-[22rpx] px-[20rpx]"},{default:o((()=>[r(f,{class:"flex items-center justify-between text-[24rpx] text-[#666] flex-1"},{default:o((()=>[u(" <text :class=\"{ 'text-[#303133] ': searchType == 'all' }\" @click=\"searchTypeFn('day')\">今日上新</text> "),r(f,{class:v(["flex items-center",{"text-[#303133]":"sale_num"==re.value}]),onClick:a[3]||(a[3]=e=>xe("day"))},{default:o((()=>[r(d,{class:"mr-[4rpx]"},{default:o((()=>[c("今日上新")])),_:1}),oe.value?(l(),s(d,{key:0,class:"text-[18rpx] text-[#666] nc-iconfont nc-icon-shanchu-yuangaizhiV6xx"})):u("v-if",!0),u(' <text v-else class="text-[18rpx] text-[#666] nc-iconfont nc-icon-a-xiangxiaV6xx1"></text> ')])),_:1},8,["class"]),r(f,{class:v(["flex items-center",{"text-[#303133]":"price"==re.value}]),onClick:a[4]||(a[4]=e=>xe("price"))},{default:o((()=>[r(d,{class:"mr-[4rpx]"},{default:o((()=>[c("价格")])),_:1}),"asc"==le.value?(l(),s(d,{key:0,class:"text-[18rpx] text-[#666] nc-iconfont nc-icon-a-xiangshangV6xx1"})):(l(),s(d,{key:1,class:"text-[18rpx] text-[#666] nc-iconfont nc-icon-a-xiangxiaV6xx1"}))])),_:1},8,["class"]),r(f,{class:v(["flex items-center",{"text-[#303133]":"label"==re.value}]),onClick:a[5]||(a[5]=e=>xe("label"))},{default:o((()=>[r(d,{class:"mr-[2rpx]"},{default:o((()=>[c("筛选")])),_:1}),r(d,{class:"nc-iconfont color-[#666] nc-icon-shaixuanV6xx text-[28rpx]"})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),r(M,{show:ae.value,mode:"top",onClose:a[9]||(a[9]=e=>ae.value=!1)},{default:o((()=>[r(f,{onTouchmove:a[8]||(a[8]=g((()=>{}),["prevent","stop"]))},{default:o((()=>[u(' <view class="text-sm font-bold px-[30rpx] mt-3">全部分类</view> '),r(f,{class:"tabs-box z-2 fixed left-0 bg-[#fff] bottom-[50px] top-20 pl-[10rpx] pt-[30rpx]"},{default:o((()=>[r(_,{"scroll-y":!0,class:"scroll-height bg-[#ddd]"},{default:o((()=>[r(f,{class:"bg-[#F4F6F8]"},{default:o((()=>[(l(!0),h(b,null,y(Q.value,((e,a)=>(l(),s(f,{class:v(["tab-item truncate",{"tab-item-active":Y.value==a,"rounded-br-[12rpx]":Y.value-1===a,"rounded-tr-[12rpx]":Y.value+1===a}]),key:e.category_id,onClick:a=>de(e.category_id)},{default:o((()=>[r(f,{class:"text-box px-[16rpx] truncate"},{default:o((()=>[c(i(e.category_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}),u("        价格区间筛选 "),r(f,{class:"flex justify-center flex-wrap pl-[200rpx] pb-[20rpx]"},{default:o((()=>[r(f,{class:"flex flex-wrap pl-[30rpx] pt-[30rpx] mr-3"},{default:o((()=>[r(t,{placeholder:"最低价格",border:"surround",class:"mr-3",prefixIconStyle:"font-size: 22px;color: #909399",modelValue:k(ce).start_price,"onUpdate:modelValue":a[6]||(a[6]=e=>k(ce).start_price=e)},null,8,["modelValue"]),c(" - "),r(t,{placeholder:"最高价格",border:"surround",class:"ml-3",modelValue:k(ce).end_price,"onUpdate:modelValue":a[7]||(a[7]=e=>k(ce).end_price=e)},null,8,["modelValue"])])),_:1}),r(_,{class:"h-[70vh]","scroll-y":!0},{default:o((()=>[r(f,{class:"bg-[#fff] grid grid-cols-3 gap-x-[50rpx] gap-y-[32rpx] py-[33rpx] px-[23rpx] rounded-[16rpx]"},{default:o((()=>{var e;return[(l(!0),h(b,null,y(null==(e=Q.value[Y.value])?void 0:e.child_list,((e,a)=>(l(),s(f,{key:e.category_id,class:v(["text-center flex flex-col items-center pt-[8rpx] rounded",{"bg-[#f4f6f8]":pe.value==e.category_id}]),onClick:a=>{return t=e.category_id,pe.value==t?pe.value=Q.value[Y.value-1].category_id||"":pe.value=t,void(K.value=[]);var t}},{default:o((()=>[r(S,{radius:"12rpx",width:"60rpx",height:"60rpx",src:k(z)(e.image?e.image:""),model:"aspectFill"},{error:o((()=>[r(m,{class:"rounded-[12rpx] overflow-hidden w-[60rpx] h-[60rpx]",src:k(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),r(f,{class:"text-[24rpx] text-center mt-[12rpx] leading-[34rpx]"},{default:o((()=>[c(i(e.category_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1}),r(f,{class:"flex flex-wrap justify-end pl-[30rpx] p-[30rpx]"},{default:o((()=>[w("div",{class:"flex"},[r(C,{type:"success",plain:!0,class:"mr-3",text:"重置",onClick:me}),r(C,{type:"primary",onClick:xe,text:"搜索"})])])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),r(X,{ref_key:"mescrollRef",ref:Z,top:"160rpx",bottom:"50px",onInit:k(n),down:{use:!1},onUp:ne},{default:o((()=>[K.value.length?(l(),s(f,{key:0,class:v(["sidebar-marign",ie.value?"":"flex justify-between flex-wrap"])},{default:o((()=>[(l(!0),h(b,null,y(K.value,((e,a)=>(l(),h(b,null,[ie.value?(l(),s(f,{key:0,class:v(["bg-white flex p-[20rpx] rounded-[16rpx] overflow-hidden mt-[20rpx]",{"mb-[20rpx]":a+1==K.value.length}]),onClick:a=>_e(e.goods_id)},{default:o((()=>[r(S,{class:"rounded-[10rpx] overflow-hidden",width:"190rpx",height:"190rpx",src:k(z)(e.goods_cover_thumb_mid?e.goods_cover_thumb_mid:""),model:"aspectFill"},{error:o((()=>[r(m,{class:"w-[190rpx] h-[190rpx] rounded-[10rpx] overflow-hidden",src:k(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),r(f,{class:"flex-1 flex flex-col ml-[20rpx] py-[6rpx]"},{default:o((()=>[r(f,{class:"text-[28rpx] text-[#303133] leading-[40rpx] multi-hidden mb-[10rpx]"},{default:o((()=>[c(i(e.goods_name),1)])),_:2},1024),e.sub_title?(l(),s(f,{key:0,class:"text-[16rpx] text-[#303133] leading-[40rpx] multi-hidden mb-[10rpx]"},{default:o((()=>[c(i(e.sub_title),1)])),_:2},1024)):u("v-if",!0),e.goodsSku.sku_no?(l(),s(f,{key:1,class:"text-[16rpx] text-[#303133] leading-[40rpx] multi-hidden mb-[10rpx]"},{default:o((()=>[c(" sn: "+i(e.goodsSku.sku_no),1)])),_:2},1024)):u("v-if",!0),r(f,{class:"mt-auto flex justify-between items-baseline"},{default:o((()=>[r(f,{class:"text-[var(--price-text-color)] price-font flex items-baseline"},{default:o((()=>[r(d,{class:"text-[26rpx] font-500"},{default:o((()=>[c("￥")])),_:1}),r(d,{class:"text-[36rpx] font-500"},{default:o((()=>[c(i(ge(e).toFixed(2).split(".")[0]),1)])),_:2},1024),r(d,{class:"text-[24rpx] font-500"},{default:o((()=>[c("."+i(ge(e).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==ve(e)?(l(),s(m,{key:0,class:"h-[24rpx] w-[72rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/VIP.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0),"discount_price"==ve(e)?(l(),s(m,{key:1,class:"h-[24rpx] w-[72rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/discount.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0)])),_:2},1024),r(d,{class:"text-[22rpx] text-[#999]"},{default:o((()=>[c("库存:"+i(e.goodsSku.stock)+i(e.unit)+" | 已售:"+i(e.sale_num)+i(e.unit),1)])),_:2},1024),r(d,{onClick:g((a=>{return t=e.goods_id,void J({goods_id:t}).then((e=>{if(!e.data.goods||"[]"===JSON.stringify(e.data))return I({title:"找不到该商品",icon:"none"}),setTimeout((()=>{N({url:"/addon/phone_shop/pages/index",mode:"reLaunch"})}),600),!1;ue.value=U(e.data),ue.value.goods.goods_image.indexOf(",")>-1?ue.value.goods.goods_image=ue.value.goods.goods_image.split(","):ue.value.goods.goods_image=[ue.value.goods.goods_image],downloadMultipleImages(ue.value.goods.goods_image).then((e=>{if(e){let e=ue.value.sku_no?"#"+ue.value.sku_no+" ":"";A({data:ue.value.goods.goods_name+" "+ue.value.goods.sub_title+" "+e,success(){I({title:"图片下载及复制文案成功",icon:"none"})}})}else I({title:"下载失败",icon:"none"})}))}));var t}),["stop"]),class:"nc-iconfont nc-icon-fenxiangV6xx"},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])):(l(),s(f,{key:1,class:"goods-item-style-two flex flex-col bg-[#fff] box-border rounded-[12rpx] overflow-hidden mt-[20rpx]",onClick:a=>_e(e.goods_id)},{default:o((()=>[r(S,{width:"100%",height:"350rpx",src:k(z)(e.goods_cover_thumb_mid?e.goods_cover_thumb_mid:""),model:"aspectFill"},{error:o((()=>[r(m,{class:"w-[100%] h-[350rpx]",src:k(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),r(f,{class:"px-[16rpx] flex-1 pt-[16rpx] pb-[20rpx] flex flex-col justify-between"},{default:o((()=>[r(f,{class:"text-[#303133] leading-[40rpx] text-[28rpx] multi-hidden"},{default:o((()=>[c(i(e.goods_name),1)])),_:2},1024),r(f,{class:"text-[#303133] leading-[40rpx] text-[20rpx] multi-hidden"},{default:o((()=>[c(i(e.sub_title),1)])),_:2},1024),r(f,{class:"flex justify-between flex-wrap items-baseline mt-[16rpx]"},{default:o((()=>[r(f,{class:"text-[var(--price-text-color)] price-font flex items-baseline"},{default:o((()=>[u('\t\t\t\t\t\t\t\t\t\t<text class="text-[20rpx]  mr-[4rpx]">￥</text>'),u('\t\t\t\t\t\t\t\t\t\t<text class="text-[36rpx] font-500">{{ item.goodsSku.price }}</text>'),r(d,{class:"text-[26rpx] font-500"},{default:o((()=>[c("￥")])),_:1}),r(d,{class:"text-[36rpx] font-500"},{default:o((()=>[c(i(ge(e).toFixed(2).split(".")[0]),1)])),_:2},1024),r(d,{class:"text-[24rpx] font-500"},{default:o((()=>[c("."+i(ge(e).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==ve(e)?(l(),s(m,{key:0,class:"h-[24rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/VIP.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0),"discount_price"==ve(e)?(l(),s(m,{key:1,class:"h-[24rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/discount.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0)])),_:2},1024),r(d,{class:"text-[22rpx] text-[#999]"},{default:o((()=>[c(" 库存"+i(e.goodsSku.stock)+i(e.unit),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"]))],64)))),256))])),_:1},8,["class"])):u("v-if",!0),!K.value.length&&ee.value?(l(),s(f,{key:1,class:"mx-[30rpx] mt-[20rpx] bg-[#fff] rounded-[16rpx] noData flex items-center justify-center"},{default:o((()=>[r($,{option:{tip:"暂无商品"}})])),_:1})):u("v-if",!0)])),_:1},8,["onInit"]),u(" 小程序隐私协议 "),r(B,{ref:"wxPrivacyPopupRef"},null,512),r(H)])),_:1},8,["style"])}}}),[["__scopeId","data-v-fd8273c2"]]);export{K as default};
