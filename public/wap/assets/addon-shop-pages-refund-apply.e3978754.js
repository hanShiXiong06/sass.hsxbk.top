import{d as e,r as l,j as a,$ as t,m as s,o as r,c as u,w as o,b as d,u as n,x as p,y as i,f as c,aN as m,n as x,_ as f,E as _,F as v,G as y,au as g,I as h,a as b,g as j,h as w,i as k,C as V,a4 as C,ai as N,a3 as E,c0 as F,ag as S,V as U}from"./index-e6ce9fbf.js";import{_ as B}from"./u-icon.c5d9cd81.js";import{_ as I}from"./u--image.2a363e1d.js";import{_ as L}from"./u-upload.e506a2d8.js";import{_ as O}from"./u-button.7a41d301.js";import{_ as T,a as z}from"./u-radio-group.c54d66b4.js";import{_ as A}from"./u-popup.b16d6e1d.js";import{a as D}from"./order.22cff883.js";import{g as G,a as M,b as P}from"./refund.fceecc42.js";import{_ as R}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.c9386d77.js";import"./u-transition.6919b33f.js";import"./u-loading-icon.39fd4711.js";/* empty css                                                                 */import"./u-safe-bottom.1ba5bfba.js";const $=R(e({__name:"apply",setup(e){var R;const $=l(null),q=l({}),H=l(0),J=l(0);let K=l(!1);const Q=l({order_id:null==(R=$.value)?void 0:R.order_id,order_goods_id:H.value,refund_type:"",apply_money:"",reason:"",remark:"",voucher:[]});let W=l({});const X=l([]),Y=l("");G().then((({data:e})=>{X.value=e,X.value&&X.value.length&&(Y.value=X.value[0])})).catch(),a((e=>{H.value=e.order_goods_id||0,Q.value.order_goods_id=H.value,Q.value.order_id=e.order_id||0,D(e.order_id).then((({data:e})=>{$.value=e,$.value.order_goods.forEach(((e,l)=>{H.value==e.order_goods_id&&(q.value=e)})),Q.value.apply_money=t(W.value.refund_money)})).catch((()=>{})),M({order_goods_id:e.order_goods_id}).then((e=>{W.value=e.data}))}));const Z=s((e=>function(e){return""==e||0==e?"60rpx":17*String(e).length+"rpx"})),ee=e=>{Q.value.refund_type=e,J.value=1},le=s((()=>Q.value.voucher.map((e=>({url:U(e)}))))),ae=e=>{e.file.forEach((e=>{g({filePath:e.url,name:"file"}).then((e=>{Q.value.voucher.length<9&&Q.value.voucher.push(e.data.url)})).catch((()=>{}))}))},te=e=>{Q.value.voucher.splice(e.index,1)},se=l(!1),re=()=>Q.value.reason?Number(Q.value.apply_money).toFixed(2)<0?(h({title:"退款金额不能为0,保留两位小数",icon:"none"}),!1):Number(Q.value.apply_money)>Number(W.value.refund_money)?(h({title:"退款金额不能大于可退款总额",icon:"none"}),!1):void(se.value||(se.value=!0,P(Q.value).then((e=>{se.value=!1,setTimeout((()=>{b({url:"/addon/shop/pages/order/detail",param:{order_id:Q.value.order_id}})}),1e3)})).catch((()=>{se.value=!1})))):(h({title:"请选择退款原因",icon:"none"}),!1),ue=()=>{Q.value.reason=Y.value,K.value=!1},oe=e=>{Number(e.detail.value)>Number(W.value.refund_money)&&(h({title:"退款金额不能大于可退款总额",icon:"none"}),Q.value.apply_money=t(W.value.refund_money))};return(e,l)=>{const a=j(w("u-icon"),B),t=j(w("u--image"),I),s=k,g=V,h=C,b=N,D=E,G=j(w("u-upload"),L),M=F,P=j(w("u-button"),O),R=j(w("u-radio"),T),H=j(w("u-radio-group"),z),de=j(w("u-popup"),A),ne=S;return r(),u(s,{style:x(e.themeColor())},{default:o((()=>[$.value?(r(),u(ne,{key:0,"indicator-dots":!1,autoplay:!1,"disable-touch":!0,current:J.value,class:"h-screen",duration:300},{default:o((()=>[d(b,null,{default:o((()=>[d(h,{"scroll-y":"true",class:"bg-page h-screen"},{default:o((()=>[d(s,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(s,{class:"flex py-[30rpx] border-0 !border-b !border-[#f5f5f5] border-solid"},{default:o((()=>[d(t,{radius:"10rpx",width:"120rpx",height:"120rpx",src:n(U)(q.value.sku_image),model:"aspectFill"},{error:o((()=>[d(a,{name:"photo",color:"#999",size:"50"})])),_:1},8,["src"]),d(s,{class:"flex flex-1 w-0 flex-col justify-between ml-[20rpx]"},{default:o((()=>[d(s,null,{default:o((()=>[d(s,{class:"text-ellipsis text-[#303133] text-sm leading-normal"},{default:o((()=>[p(i(q.value.goods_name),1)])),_:1}),d(s,{class:"mt-[10rpx] text-[26rpx] leading-[1.3] text-gray-subtitle"},{default:o((()=>[p(i(q.value.sku_name),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),d(s,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(s,{class:"py-[24rpx] flex items-center",onClick:l[0]||(l[0]=e=>ee(1))},{default:o((()=>[d(s,{class:"flex-1"},{default:o((()=>[d(s,{class:"text-sm"},{default:o((()=>[p("仅退款")])),_:1}),d(s,{class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:o((()=>[p("未收到货，或与商家协商一致不用退货只退款")])),_:1})])),_:1}),d(g,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1}),"real"!=q.value.goods_type||q.value.delivery_status&&"wait_delivery"==q.value.delivery_status?c("v-if",!0):(r(),u(s,{key:0,class:"py-[24rpx] flex items-center border-0 !border-t !border-[#f5f5f5] border-solid",onClick:l[1]||(l[1]=e=>ee(2))},{default:o((()=>[d(s,{class:"flex-1"},{default:o((()=>[d(s,{class:"text-sm"},{default:o((()=>[p("退货退款")])),_:1}),d(s,{class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:o((()=>[p("已收到货，需退还收到的货物")])),_:1})])),_:1}),d(g,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1}))])),_:1})])),_:1})])),_:1}),d(b,null,{default:o((()=>[d(h,{"scroll-y":"true",class:"bg-page h-screen"},{default:o((()=>[d(s,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(s,{class:"py-[24rpx] flex justify-between items-center"},{default:o((()=>[d(s,{class:"text-sm"},{default:o((()=>[p("退款原因")])),_:1}),d(s,{class:"flex items-center",onClick:l[2]||(l[2]=e=>m(K)?K.value=!0:K=!0)},{default:o((()=>[d(s,{class:"flex-1 text-right"},{default:o((()=>[d(s,{class:"text-xs text-gray-subtitle truncate w-[460rpx]"},{default:o((()=>[p(i(Q.value.reason||"请选择"),1)])),_:1})])),_:1}),d(g,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1})])),_:1})])),_:1}),d(s,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(s,{class:"py-[24rpx] flex items-center"},{default:o((()=>[d(s,{class:"text-sm"},{default:o((()=>[p("退款金额")])),_:1}),d(s,{class:"flex-1 text-right"},{default:o((()=>[d(s,{class:"flex justify-end items-center"},{default:o((()=>[d(g,{class:"font-bold text-sm leading-none"},{default:o((()=>[p("￥")])),_:1}),d(D,{type:"number",modelValue:Q.value.apply_money,"onUpdate:modelValue":l[3]||(l[3]=e=>Q.value.apply_money=e),modelModifiers:{number:!0},class:"font-bold text-sm leading-none",style:x({width:n(Z)(Q.value.apply_money)}),onBlur:oe},null,8,["modelValue","style"])])),_:1}),d(s,{class:"text-xs text-gray-subtitle mt-[10rpx]"},{default:o((()=>[d(g,null,{default:o((()=>[p("最多可输入金额￥"+i(n(W).refund_money),1)])),_:1}),1===n(W).is_refund_delivery&&Number(n(W).refund_delivery_money)>0?(r(),u(g,{key:0,class:"ml-[10rpx]"},{default:o((()=>[p("(包含运费￥"+i(n(W).refund_delivery_money)+")",1)])),_:1})):c("v-if",!0)])),_:1})])),_:1})])),_:1})])),_:1}),d(s,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(s,{class:"py-[24rpx]"},{default:o((()=>[d(s,{class:"text-sm"},{default:o((()=>[p("上传凭证"),d(g,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:o((()=>[p("选填")])),_:1})])),_:1}),d(s,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx]"},{default:o((()=>[d(G,{fileList:n(le),onAfterRead:ae,onDelete:te,multiple:"",maxCount:9},null,8,["fileList"])])),_:1})])),_:1})])),_:1}),d(s,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(s,{class:"py-[24rpx]"},{default:o((()=>[d(s,{class:"text-sm"},{default:o((()=>[p("补充描述"),d(g,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:o((()=>[p("选填")])),_:1})])),_:1}),d(s,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx] h-[200rpx]"},{default:o((()=>[d(M,{modelValue:Q.value.remark,"onUpdate:modelValue":l[4]||(l[4]=e=>Q.value.remark=e),cols:"30",rows:"5",placeholder:"补充描述,有助于更好的处理售后问题","placeholder-class":"text-sm"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),d(s,{class:"mt-[40rpx] m-[24rpx]"},{default:o((()=>[d(P,{type:"primary",shape:"circle",text:"提交",onClick:re,loading:se.value},null,8,["loading"])])),_:1}),c(" 退款原因 "),d(de,{show:n(K),onClose:e.close,onOpen:e.open},{default:o((()=>[d(s,{class:"px-[30rpx] pb-[30rpx]",onTouchmove:l[7]||(l[7]=f((()=>{}),["prevent","stop"]))},{default:o((()=>[d(s,{class:"flex items-center h-[90rpx] justify-between"},{default:o((()=>[d(g,null,{default:o((()=>[p("退款原因")])),_:1}),d(g,{class:"nc-iconfont nc-icon-guanbiV6xx",onClick:l[5]||(l[5]=e=>m(K)?K.value=!1:K=!1)})])),_:1}),d(h,{"scroll-y":"true",class:"h-[450rpx] mt-[20rpx]"},{default:o((()=>[d(H,{modelValue:Y.value,"onUpdate:modelValue":l[6]||(l[6]=e=>Y.value=e),placement:"column"},{default:o((()=>[(r(!0),_(y,null,v(X.value,((e,l)=>(r(),u(R,{activeColor:"var(--primary-color)",customStyle:{marginBottom:"8px"},key:l,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(P,{type:"primary",text:"确定",class:"mt-[40rpx]",shape:"circle",onClick:ue})])),_:1})])),_:1},8,["show","onClose","onOpen"])])),_:1})])),_:1})])),_:1},8,["current"])):c("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-0753008c"]]);export{$ as default};
