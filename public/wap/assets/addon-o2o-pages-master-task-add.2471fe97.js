import{d as e,j as a,o as l,c as r,w as t,P as o,a7 as u,u as s,Q as i,b as m,y as d,z as n,f as p,t as c,av as f,g as _,h as x,i as g,R as v,E as h,A as b,D as y,r as j,p as V,L as w,n as C,a as k,F as S}from"./index-7bf68536.js";import{_ as I}from"./u-input.09a5cedd.js";import{_ as A,a as E}from"./u-form.78a4f7c2.js";import{_ as F}from"./u-button.359d7329.js";import{_ as P}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{e as q,h as R}from"./o2o.b941d7a5.js";import{_ as U}from"./u-icon.0c1c54c7.js";import{_ as z}from"./u--image.b3bf1d5c.js";import{_ as D}from"./u-upload.ab11cc5c.js";import{f as N}from"./cloneDeep.77735539.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.463a2a45.js";import"./u-loading-icon.b37701e7.js";import"./u-loading-page.566c330a.js";import"./u-transition.cdf87992.js";import"./u-image.e46f68ef.js";/* empty css                                                                 */const M=e({__name:"upload-img",props:{modelValue:{type:String||Array},maxCount:{type:Number,default:9},multiple:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:j}){const V=e,w=a({get:()=>V.modelValue,set(e){j("update:modelValue",e)}}),C=a((()=>V.maxCount)),k=e=>{V.multiple?e.file.forEach((e=>{S({file:e})})):S(e)},S=e=>{var a;if((null==(a=w.value)?void 0:a.length)>=C.value)return c({title:`最多允许上传${C.value}张图片`,icon:"none"}),!1;f({filePath:e.file.url,name:"file"}).then((e=>{var a;(null==(a=w.value)?void 0:a.length)<C.value&&w.value.push(e.data.url)})).catch((()=>{}))};return(e,a)=>{const c=_(x("u-icon"),U),f=_(x("u--image"),z),j=y,S=g,I=_(x("u-upload"),D);return l(),r(S,{class:"flex flex-wrap"},{default:t((()=>[(l(!0),o(i,null,u(s(w),((e,a)=>(l(),r(S,{class:v(["mb-[18rpx] relative",(a+1)%3==0?"":"mr-[18rpx]"])},{default:t((()=>[m(f,{class:"rounded-[10rpx] overflow-hidden",width:"168rpx",height:"168rpx",src:s(h)(e||""),model:"aspectFill"},{error:t((()=>[m(c,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["src"]),m(j,{class:"nc-iconfont nc-icon-guanbiV6xx text-[32rpx] absolute top-0 right-[0rpx] text-[#fff] bg-[#888] rounded-bl-[16rpx]",onClick:b((e=>(e=>{w.value.splice(e,1)})(a)),["stop"])},null,8,["onClick"])])),_:2},1032,["class"])))),256)),s(w).length<s(C)?(l(),r(S,{key:0,class:"w-[168rpx] h-[168rpx]"},{default:t((()=>[m(I,{onAfterRead:k,maxCount:s(C),multiple:V.multiple},{default:t((()=>[m(S,{class:"flex items-center justify-center w-[168rpx] h-[168rpx] border-[2rpx] border-dashed border-[#ebebec] text-center text-[#888]"},{default:t((()=>[m(S,null,{default:t((()=>[m(S,{class:"nc-iconfont nc-icon-xiangjiV6xx text-[50rpx]"}),m(S,{class:"text-[24rpx] mt-[10rpx]"},{default:t((()=>[d(n(s(w).length)+"/"+n(s(C)),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["maxCount","multiple"])])),_:1})):p("v-if",!0)])),_:1})}}}),B=L(e({__name:"add",setup(e){const a=j(!1),o=j({order_id:"",order_item_id:"",item_name:"",price:0,images:[],item_images:""});V((e=>{Object.keys(o.value).forEach((a=>{if(null!=e[a]&&(o.value[a]=e[a]),"images"==a){o.value[a]=[];let l=e.item_images?e.item_images:null;o.value[a]=l?e.item_images.split(","):[]}}))}));const u=j(null),i=w({item_name:[{required:!0,message:"请输入服务项目",trigger:"blur"}],price:[{required:!0,validator:(e,a,l)=>{""===a||null==a?l(new Error("请输入价格")):Number(a)<=0?l(new Error("价格需大于0")):l()},trigger:"blur"}]});return(e,p)=>{const c=g,f=_(x("u-input"),I),v=_(x("u-form-item"),A),h=y,b=_(x("u-button"),F),j=_(x("u-form"),E),V=_(x("loading-page"),P);return l(),r(c,{class:"bg-[#F5F6FA] min-h-screen overflow-hidden",style:C(e.themeColor())},{default:t((()=>[m(c,{class:"mx-[30rpx] my-[20rpx] bg-[#fff] rounded-[16rpx]"},{default:t((()=>[m(c,{class:"text-[34rpx] p-[36rpx] border"},{default:t((()=>[d(n(o.value.order_item_id?s(S)("editServiceItem"):s(S)("addServiceItem")),1)])),_:1}),m(j,{labelPosition:"left",model:o.value,errorType:"toast",rules:i,ref_key:"serviceRef",ref:u,labelWidth:100,class:"px-[30rpx]",labelStyle:{paddingLeft:"30rpx",fontSize:"28rpx"}},{default:t((()=>[m(v,{label:s(S)("serviceItem"),prop:"item_name",required:""},{default:t((()=>[m(f,{modelValue:o.value.item_name,"onUpdate:modelValue":p[0]||(p[0]=e=>o.value.item_name=e),modelModifiers:{trim:!0},border:"surround",clearable:"",placeholder:s(S)("serviceItemPlaceholder"),maxlength:"50"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),m(v,{label:s(S)("price"),prop:"price",required:""},{default:t((()=>[m(f,{modelValue:o.value.price,"onUpdate:modelValue":p[1]||(p[1]=e=>o.value.price=e),border:"surround",clearable:"",placeholder:s(S)("pricePlaceholder"),type:"digit",maxlength:"6"},{suffix:t((()=>[m(h,null,{default:t((()=>[d(n(s(S)("yuan")),1)])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),m(v,{label:s(S)("serviceImg"),prop:"images",class:"form-images"},{default:t((()=>[m(c,{class:"px-[30rpx]"},{default:t((()=>[m(M,{class:"mt-[20rpx]",modelValue:o.value.images,"onUpdate:modelValue":p[2]||(p[2]=e=>o.value.images=e),"max-count":6,multiple:!1},null,8,["modelValue"])])),_:1})])),_:1},8,["label"]),m(v,{class:"mt-[30rpx]"},{default:t((()=>[m(b,{text:s(S)("save"),onClick:p[3]||(p[3]=e=>(async()=>{u.value.validate().then((()=>{if(a.value)return;a.value=!0;const e=N(o.value);e.item_images=e.images.toString(),(o.value.order_item_id?q:R)(e).then((e=>{a.value=!1,k({url:"/addon/o2o/pages/master/task/detail",param:{order_id:o.value.order_id}})})).catch((()=>{a.value=!1}))}))})()),customStyle:{borderRadius:"38rpx",color:"#fff",margin:"30rpx 0",backgroundColor:"var(--primary-color)"}},null,8,["text","customStyle"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),m(V,{loading:a.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-9ffc4bf4"]]);export{B as default};
