import{d as e,r as a,p as l,a7 as t,j as r,o as s,c as o,w as d,b as u,u as n,y as i,z as p,f as c,A as x,U as v,ad as f,V as m,n as _,au as g,t as y,a as h,B as b,g as w,h as k,i as C,D as V,ac as j,am as D,c3 as N,C as A,ak as E,E as F,bl as S,ax as U,c4 as z,c5 as B,aA as I,_ as L}from"./index-71c7df08.js";import{a as P}from"./order.c5841498.js";import{g as T,a as M,b as R}from"./refund.155c76db.js";const W=L(e({__name:"apply",setup(e){var L;const W=a(null),Z=a({}),q=a(0),G=a(0),H=a(!1),J=a({order_id:null==(L=W.value)?void 0:L.order_id,order_goods_id:q.value,refund_type:"",apply_money:"",reason:"",remark:"",voucher:[]}),K=a({}),O=a([]),Q=a("");T().then((({data:e})=>{O.value=e,O.value&&O.value.length&&(Q.value=O.value[0])})),l((e=>{q.value=e.order_goods_id||0,J.value.order_goods_id=q.value,J.value.order_id=e.order_id||0,P(e.order_id).then((({data:e})=>{W.value=e,W.value.order_goods.forEach(((e,a)=>{q.value==e.order_goods_id&&(Z.value=e)})),J.value.apply_money=t(K.value.refund_money)})),M({order_goods_id:e.order_goods_id}).then((e=>{K.value=e.data}))})),r((e=>function(e){return""==e||0==e?"70rpx":17*String(e).length+"rpx"}));const X=e=>{J.value.refund_type=e,G.value=1},Y=r((()=>J.value.voucher.map((e=>({url:F(e)}))))),$=e=>{e.file.forEach((e=>{g({filePath:e.url,name:"file"}).then((e=>{J.value.voucher.length<9&&J.value.voucher.push(e.data.url)}))}))},ee=e=>{J.value.voucher.splice(e.index,1)},ae=a(!1),le=()=>J.value.reason?Number(J.value.apply_money).toFixed(2)<0?(y({title:"退款金额不能为0,保留两位小数",icon:"none"}),!1):Number(J.value.apply_money)>Number(K.value.refund_money)?(y({title:"退款金额不能大于可退款总额",icon:"none"}),!1):void(ae.value||(ae.value=!0,R(J.value).then((e=>{ae.value=!1,setTimeout((()=>{h({url:"/addon/shop/pages/order/detail",param:{order_id:J.value.order_id}})}),1e3)})).catch((()=>{ae.value=!1})))):(y({title:"请选择退款原因",icon:"none"}),!1),te=()=>{J.value.reason=Q.value,H.value=!1};return(e,a)=>{const l=b,t=w(k("u--image"),S),r=C,g=V,y=j,h=D,L=w(k("u-upload"),U),P=N,T=A,M=w(k("u-radio"),z),R=w(k("u-radio-group"),B),q=w(k("u-popup"),I),re=E;return s(),o(r,{style:_(e.themeColor())},{default:d((()=>[W.value?(s(),o(re,{key:0,"indicator-dots":!1,autoplay:!1,"disable-touch":!0,current:G.value,class:"h-screen",duration:300},{default:d((()=>[u(h,null,{default:d((()=>[u(y,{"scroll-y":"true",class:"bg-page min-h-screen overflow-hidden"},{default:d((()=>[u(r,{class:"m-[var(--top-m)] sidebar-margin px-[var(--pad-sidebar-m)] py-[var(--pad-top-m)] rounded-[var(--rounded-big)] bg-white"},{default:d((()=>[u(r,{class:"flex"},{default:d((()=>[u(r,{class:"w-[120rpx] h-[120rpx] flex items-center justify-center"},{default:d((()=>[u(t,{radius:"var(--goods-rounded-small)",width:"120rpx",height:"120rpx",src:n(F)(Z.value.sku_image.split(",")[0]),model:"aspectFill"},{error:d((()=>[u(l,{class:"w-[120rpx] h-[120rpx] rounded-[var(--goods-rounded-small)] overflow-hidden",src:n(F)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:1},8,["radius","src"])])),_:1}),u(r,{class:"flex-1 w-0 ml-[20rpx]"},{default:d((()=>[u(r,{class:"text-ellipsis text-[28rpx] leading-normal truncate"},{default:d((()=>[i(p(Z.value.goods_name),1)])),_:1}),Z.value.sku_name?(s(),o(r,{key:0,class:"mt-[6rpx] text-[24rpx] leading-[1.3] text-[var(--text-color-light9)] truncate"},{default:d((()=>[i(p(Z.value.sku_name),1)])),_:1})):c("v-if",!0)])),_:1})])),_:1})])),_:1}),u(r,{class:"my-[var(--top-m)] sidebar-margin px-[var(--pad-sidebar-m)] rounded-[var(--rounded-big)] bg-white"},{default:d((()=>[u(r,{class:"py-[var(--pad-top-m)] flex items-center",onClick:a[0]||(a[0]=e=>X(1))},{default:d((()=>[u(r,{class:"flex-1"},{default:d((()=>[u(r,{class:"text-[30rpx]"},{default:d((()=>[i("仅退款")])),_:1}),"real"==Z.value.goods_type?(s(),o(r,{key:0,class:"text-[24rpx] mt-[20rpx] text-[var(--text-color-light9)]"},{default:d((()=>[i("未收到货，或与商家协商一致不用退货只退款")])),_:1})):"virtual"==Z.value.goods_type?(s(),o(r,{key:1,class:"text-[24rpx] mt-[20rpx] text-[var(--text-color-light9)]"},{default:d((()=>[i("与商家协商一致不用退货只退款")])),_:1})):c("v-if",!0)])),_:1}),u(g,{class:"nc-iconfont nc-icon-youV6xx text-[28rpx] text-[var(--text-color-light9)]"})])),_:1}),"real"!=Z.value.goods_type||Z.value.delivery_status&&"wait_delivery"==Z.value.delivery_status?c("v-if",!0):(s(),o(r,{key:0,class:"py-[var(--pad-top-m)] flex items-center border-0 !border-t !border-[#f5f5f5] border-solid",onClick:a[1]||(a[1]=e=>X(2))},{default:d((()=>[u(r,{class:"flex-1"},{default:d((()=>[u(r,{class:"text-[30rpx]"},{default:d((()=>[i("退货退款")])),_:1}),u(r,{class:"text-[24rpx] mt-[20rpx] text-[var(--text-color-light9)]"},{default:d((()=>[i("已收到货，需退还收到的货物")])),_:1})])),_:1}),u(g,{class:"nc-iconfont nc-icon-youV6xx text-[28rpx] text-[var(--text-color-light9)]"})])),_:1}))])),_:1})])),_:1})])),_:1}),u(h,null,{default:d((()=>[u(y,{"scroll-y":"true",class:"bg-page min-h-screen overflow-hidden"},{default:d((()=>[u(r,{class:"my-[var(--top-m)] sidebar-margin px-[var(--pad-sidebar-m)] rounded-[var(--rounded-big)] bg-white"},{default:d((()=>[u(r,{class:"py-[var(--pad-top-m)] flex justify-between items-center"},{default:d((()=>[u(r,{class:"text-[28rpx]"},{default:d((()=>[i("退款原因")])),_:1}),u(r,{class:"flex ml-[auto] items-center h-[30rpx]",onClick:a[2]||(a[2]=e=>H.value=!0)},{default:d((()=>[u(g,{class:"text-[26rpx] text-[var(--text-color-light9)] truncate max-w-[460rpx]"},{default:d((()=>[i(p(J.value.reason||"请选择"),1)])),_:1}),u(g,{class:"nc-iconfont nc-icon-youV6xx pt-[4rpx] text-[24rpx] text-[var(--text-color-light9)]"})])),_:1})])),_:1})])),_:1}),u(r,{class:"my-[var(--top-m)] sidebar-margin px-[var(--pad-sidebar-m)] rounded-[var(--rounded-big)] bg-white"},{default:d((()=>[u(r,{class:"py-[var(--pad-top-m)]"},{default:d((()=>[u(r,{class:"flex items-center justify-between"},{default:d((()=>[u(r,{class:"text-[28rpx] font-500"},{default:d((()=>[i("退款金额")])),_:1}),u(r,{class:"flex justify-end items-center text-[var(--price-text-color)] price-font"},{default:d((()=>[u(g,{class:"font-500 text-[36rpx] leading-none"},{default:d((()=>[i("￥")])),_:1}),c(' <input type="digit" v-model.number="formData.apply_money" class="font-500 text-[36rpx] leading-none" :style="{ width: inputWidth(formData.apply_money) }" @blur="handleInput"> '),u(g,{class:"font-500 text-[36rpx] leading-none"},{default:d((()=>[i(p(J.value.apply_money),1)])),_:1})])),_:1})])),_:1}),u(r,{class:"text-right text-[24rpx] text-[var(--text-color-light9)] mt-[10rpx]"},{default:d((()=>[c(" <text>最多可退￥{{ refundMoney.refund_money }}</text> "),1===K.value.is_refund_delivery&&Number(K.value.refund_delivery_money)>0?(s(),o(g,{key:0,class:"ml-[10rpx]"},{default:d((()=>[i("(包含运费￥"+p(K.value.refund_delivery_money)+")",1)])),_:1})):c("v-if",!0)])),_:1})])),_:1})])),_:1}),u(r,{class:"my-[var(--top-m)] sidebar-margin px-[var(--pad-sidebar-m)] rounded-[var(--rounded-big)] bg-white"},{default:d((()=>[u(r,{class:"pt-[var(--pad-top-m)] pb-[14rpx]"},{default:d((()=>[u(r,{class:"text-[28rpx] flex items-center"},{default:d((()=>[u(g,{class:"font-500"},{default:d((()=>[i("上传凭证")])),_:1}),u(g,{class:"text-[24rpx] text-[var(--text-color-light9)] ml-[10rpx]"},{default:d((()=>[i("选填")])),_:1})])),_:1}),u(r,{class:"mt-[30rpx]"},{default:d((()=>[u(L,{fileList:n(Y),onAfterRead:$,onDelete:ee,multiple:"",maxCount:9},null,8,["fileList"])])),_:1})])),_:1})])),_:1}),u(r,{class:"my-[var(--top-m)] sidebar-margin px-[var(--pad-sidebar-m)] rounded-[var(--rounded-big)] bg-white"},{default:d((()=>[u(r,{class:"py-[var(--pad-top-m)]"},{default:d((()=>[u(r,{class:"text-[28rpx] flex items-center"},{default:d((()=>[u(g,{class:"font-500"},{default:d((()=>[i("补充描述")])),_:1}),u(g,{class:"text-[24rpx] text-[var(--text-color-light9)] ml-[10rpx]"},{default:d((()=>[i("选填")])),_:1})])),_:1}),u(r,{class:"mt-[30rpx] h-[200rpx]"},{default:d((()=>[u(P,{class:"leading-[1.5] h-[100%] w-[100%] text-[28rpx]",modelValue:J.value.remark,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.remark=e),cols:"30",rows:"5",placeholder:"补充描述,有助于更好的处理售后问题","placeholder-class":"text-[26rpx] text-[var(--text-color-light9)]"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),u(r,{class:"w-full"},{default:d((()=>[u(r,{class:"py-[var(--top-m)] px-[var(--sidebar-m)] box-border"},{default:d((()=>[u(T,{class:"primary-btn-bg !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500",loading:ae.value,onClick:le},{default:d((()=>[i("提交")])),_:1},8,["loading"])])),_:1})])),_:1}),c(" 退款原因 "),u(q,{show:H.value,onClose:a[6]||(a[6]=e=>H.value=!1)},{default:d((()=>[u(r,{class:"popup-common",onTouchmove:a[5]||(a[5]=x((()=>{}),["prevent","stop"]))},{default:d((()=>[u(r,{class:"title"},{default:d((()=>[i("退款原因")])),_:1}),u(y,{"scroll-y":"true",class:"h-[450rpx] px-[30rpx] box-border"},{default:d((()=>[u(R,{modelValue:Q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>Q.value=e),placement:"column",iconPlacement:"right"},{default:d((()=>[(s(!0),v(m,null,f(O.value,((e,a)=>(s(),o(M,{activeColor:"var(--primary-color)",labelSize:"30rpx",labelColor:"#333",customStyle:{marginBottom:"34rpx"},key:a,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(r,{class:"btn-wrap"},{default:d((()=>[u(T,{class:"primary-btn-bg btn",onClick:te},{default:d((()=>[i("确定")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})])),_:1})])),_:1},8,["current"])):c("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-150bee2a"]]);export{W as default};
