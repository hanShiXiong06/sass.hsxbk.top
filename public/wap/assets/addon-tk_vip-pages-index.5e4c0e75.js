import{bt as e,c3 as l,d as a,l as t,r as s,x as r,s as u,j as i,ad as v,a0 as o,o as n,P as c,b as f,w as d,f as p,u as x,c as _,Q as m,a7 as g,n as y,y as b,z as h,i as k,B as w,ae as F,a6 as j,D as C,g as $,h as z,E as D,R as E,a as S,af as T,ag as X}from"./index-7bf68536.js";import{_ as I,a as A}from"./u-checkbox-group.b2a485bf.js";import{_ as M}from"./u-safe-bottom.908eeae4.js";import{_ as P}from"./pay.d2e850e8.js";import{c as R}from"./order.03dfa5e5.js";import{t as B}from"./topTabbar.f3f9eebd.js";import{_ as N}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.0c1c54c7.js";import"./u-image.e46f68ef.js";import"./u-transition.cdf87992.js";import"./u-popup.be4bfacd.js";import"./pay.2db06871.js";function O(e){return new Date(e).getTime()}async function Q(e,a,t){l({title:"操作提示",content:e,confirmColor:"#3569EA",cancelColor:"#646464",success:function(e){e.confirm?a(t):e.cancel&&uni.$u.toast("取消了本次操作")}})}const Y=N(a({__name:"index",setup(l){const a=t(),N=s(!1),Y=e=>{const l=new Date(e);return`${l.getFullYear()}-${(l.getMonth()+1).toString().padStart(2,"0")}-${l.getDate().toString().padStart(2,"0")}`},Z=s([]),q=s([]),G=s(0),H=s(0),J=s(),K=()=>{e.get("tk_vip/vip/levelinfo").then((e=>{J.value=e.data}))};B().setTopTabbarParam({title:"会员等级"}),r((()=>{u()&&(le(),ee(),K())}));const L=i((()=>a.info)),U=s(""),V=s(""),W=s(""),ee=()=>{N.value=!0,e.get("tk_vip/member/level").then((e=>{Z.value=e.data||[];let l=!0;L.value&&Z.value&&Z.value.length&&Z.value.forEach(((e,a)=>{e.level_id==L.value.member_level&&(l=!1,G.value=a,H.value=G.value,pe(a))})),l&&pe(0),Z.value&&Z.value.length>=5?(U.value="width:115rpx;",V.value="max-width:115rpx;",W.value="width:460rpx;transform: translateX(-235rpx);"):Z.value&&4==Z.value.length?(U.value="width:144rpx;",V.value="max-width:144rpx;",W.value="width:436rpx;transform: translateX(-218rpx);"):Z.value&&3==Z.value.length?(U.value="width:192rpx;",V.value="max-width:192rpx;",W.value="width:388rpx;transform: translateX(-194rpx);"):Z.value&&2==Z.value.length?(U.value="width:289rpx;",V.value="max-width:289rpx;",W.value="width:289rpx;transform: translateX(-144rpx);"):(V.value="max-width:578rpx;",U.value="width:100%;"),N.value=!1})).catch((()=>{N.value=!1}))},le=()=>{v().then((e=>{q.value=e.data}))},ae=e=>{G.value=e.detail.current,H.value=G.value,pe(e.detail.current)},te=s(!1),se=s(null),re=s(!1),ue=()=>{te.value=!te.value},ie=async e=>{if(J.value.level_id!=de.value.level_id||0!=J.value.over_time)if(te.value){if("add"==e&&"fixed"==ne.value.over_type){if(Y(J.value.over_time)==Y(ne.value.over_time))return void uni.$u.toast("请等待商家更新新的周期时间")}"add"==e&&Q("付款成功后续费会立即生效，确定续费？",ve,""),"create"==e&&Q("购买后新的权益周期将会立即生效，确定本次操作？",ve,"")}else uni.$u.toast("请先阅读并同意协议");else uni.$u.toast("已获取永久权限,不需升级")},ve=async()=>{let e=await R({level_id:de.value.level_id,sku_info:ne.value,level_index:H.value,sku_index:ce.value});se.value&&se.value.open&&await se.value.open(e.data.trade_type,e.data.trade_id,"/addon/tk_vip/pages/list")},oe=s(),ne=s(),ce=s(0),fe=e=>{ce.value=e,ne.value=oe.value[e]},de=s({}),pe=e=>{let l=o(Z.value[e]);if(oe.value=l.level_benefits.tk_vip_fee.fee_info,fe(0),l&&l.level_benefits&&(l.benefits_arr=[],Object.values(l.level_benefits).forEach(((e,a,t)=>{e.content&&l.benefits_arr.push(e.content)}))),l&&l.level_gifts){l.gifts_arr=[];for(let e in l.level_gifts)l.level_gifts[e].content&&(l.level_gifts[e].content.forEach(((l,a,t)=>{t[a].type=e})),l.gifts_arr=l.gifts_arr.concat(l.level_gifts[e].content))}de.value=l},xe=i((()=>!(Z.value[H.value].level_id==J.value.level_id&&0==J.value.over_time&&J.value.level_id>0)));return(e,l)=>{const a=k,t=w,s=T,r=X,u=F,i=j,v=C,o=$(z("u-checkbox"),I),R=$(z("u-checkbox-group"),A),B=$(z("u-safe-bottom"),M),Q=$(z("pay"),P);return n(),c(m,null,[f(a,{style:y(e.themeColor()),class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden"},{default:d((()=>[p(' <loading-page :loading="loading && memberInfo"></loading-page> '),!N.value&&x(L)&&Z.value&&Z.value.length?(n(),_(a,{key:0,class:"min-h-[100vh] overflow-hidden flex flex-col",style:y({backgroundColor:de.value.level_style.bg_color})},{default:d((()=>[f(a,null,{default:d((()=>[f(a,{class:"pt-[40rpx] mb-[40rpx]"},{default:d((()=>[p(" 轮播图 "),f(a,{class:"relative"},{default:d((()=>[f(u,{class:"swiper ns-indicator-dots relative",style:{height:"300rpx"},onChange:ae,current:G.value,"previous-margin":"30rpx","next-margin":"30rpx"},{default:d((()=>[(n(!0),c(m,null,g(Z.value,((e,l)=>(n(),_(r,{class:"swiper-item",key:e.id},{default:d((()=>[f(a,{class:"h-[300rpx] relative"},{default:d((()=>[x(L).member_level==e.level_id&&G.value==l?(n(),_(a,{key:0,class:"text-[24rpx] absolute top-0 left-0 z-10 h-[66rpx] !bg-contain w-[150rpx] flex pt-[12rpx] pl-[16rpx] box-border",style:y({background:"url("+x(D)(de.value.level_tag)+") no-repeat",color:de.value.level_style.level_color})},{default:d((()=>[b(" 当前等级 ")])),_:1},8,["style"])):p("v-if",!0),f(a,{class:E(["absolute top-0 left-0 right-0 bottom-0 z-20 px-[30rpx] pt-[68rpx] box-border",{"px-[50rpx]":G.value!=l}])},{default:d((()=>[f(a,{class:"flex items-center leading-[50rpx] mb-[90rpx]"},{default:d((()=>[f(t,{class:"h-[32rpx] w-[34rpx] align-middle",src:x(D)(e.level_icon?e.level_icon:""),mode:"aspectFill"},null,8,["src"]),f(a,{class:"text-[36rpx] font-bold ml-[10rpx] max-w-[340rpx] truncate",style:y({color:de.value.level_style.level_color})},{default:d((()=>[b(h(e.level_name),1)])),_:2},1032,["style"])])),_:2},1024),f(a,{class:"flex items-baseline",style:y({color:de.value.level_style.level_color})},{default:d((()=>[f(a,{class:"text-[30rpx] font-500 leading-[38rpx]"},{default:d((()=>[b(" 会员编号:"+h(x(L).member_no),1)])),_:1})])),_:1},8,["style"]),J.value&&J.value.level_id>0?(n(),_(a,{key:0,class:"flex items-baseline",style:y({color:de.value.level_style.level_color})},{default:d((()=>[J.value&&J.value.level_id_name?(n(),_(a,{key:0,class:"text-[24rpx] font-500 leading-[38rpx]",style:y({color:de.value.level_style.level_color})},{default:d((()=>[b(" 等级:"+h(J.value.level_id_name),1)])),_:1},8,["style"])):p("v-if",!0),J.value&&x(O)(J.value.over_time)>Date.now()?(n(),_(a,{key:1,class:"text-[24rpx] font-500 leading-[38rpx] ml-2",style:y({color:de.value.level_style.level_color})},{default:d((()=>[b(h(J.value.over_time),1)])),_:1},8,["style"])):p("v-if",!0),J.value&&x(O)(J.value.over_time)<Date.now()&&x(O)(J.value.over_time)>0?(n(),_(a,{key:2,class:"text-[24rpx] font-500 leading-[38rpx] ml-2 text-red"},{default:d((()=>[b(" 已到期 ")])),_:1})):p("v-if",!0),J.value&&0==J.value.over_time?(n(),_(a,{key:3,class:"text-[24rpx] font-500 leading-[38rpx] ml-2",style:y({color:de.value.level_style.level_color})},{default:d((()=>[b(" 永久 ")])),_:1},8,["style"])):p("v-if",!0)])),_:1},8,["style"])):p("v-if",!0),f(a,{class:"flex justify-between items-center mt-[10rpx]"},{default:d((()=>[f(a,{class:"flex flex-col flex-1"},{default:d((()=>[f(a,null,{default:d((()=>[f(s,{percent:100,"border-radius":100,activeColor:de.value.level_style.level_color,backgroundColor:"#fff","stroke-width":"4"},null,8,["activeColor"])])),_:1})])),_:1})])),_:1})])),_:2},1032,["class"]),f(a,{class:"relatvie h-full w-full"},{default:d((()=>[f(t,{class:E(["h-full w-full",{"swiper-animation":G.value!=l}]),src:x(D)(e.level_bg),"show-menu-by-longpress":!0},null,8,["src","class"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["current"])])),_:1})])),_:1}),f(a,{class:"mb-[30rpx] relative"},{default:d((()=>[f(a,{class:"bg-[#fff] opacity-15 h-[2rpx] w-full absolute top-[15rpx]"}),f(a,{style:y(W.value),class:"bg-[#fff] opacity-60 h-[2rpx] absolute top-[15rpx] z-4 left-[50%]"},null,8,["style"]),f(a,{class:"mx-[86rpx]"},{default:d((()=>[f(i,{"scroll-x":!0,"scroll-with-animation":"","scroll-into-view":"id"+(H.value?H.value-1:0)},{default:d((()=>[f(a,{class:"flex flex-nowrap py-[10rpx]"},{default:d((()=>[(n(!0),c(m,null,g(Z.value,((e,l)=>(n(),_(a,{key:e.id,style:y(U.value),class:"flex-shrink-0 flex flex-col items-center justify-center",onClick:e=>(e=>{H.value=e,G.value=e,pe(e)})(l),id:"id"+l},{default:d((()=>[f(a,{class:E(["w-[14rpx] h-[14rpx] level-class",{"level-select":H.value==l}])},null,8,["class"]),f(a,{style:y(V.value),class:E(["text-[22rpx] text-[#aaa] mt-[16rpx] truncate",{"!text-[#fff]":H.value==l}])},{default:d((()=>[b(h(e.level_name),1)])),_:2},1032,["style","class"])])),_:2},1032,["style","onClick","id"])))),128))])),_:1})])),_:1},8,["scroll-into-view"])])),_:1})])),_:1}),f(a,{class:"flex mx-[var(--sidebar-m)] pt-[30rpx] pb-[46rpx] items-center flex-col level_benefits",style:y({backgroundImage:"url("+x(D)(de.value.member_bg)+")"})},{default:d((()=>[f(a,{class:"flex items-center justify-center"},{default:d((()=>[f(v,{class:"text-[#fff] text-[30rpx] font-500 leading-[44rpx]"},{default:d((()=>[b("会员权益")])),_:1})])),_:1}),f(a,{class:"flex flex-wrap w-[690rpx] mt-[40rpx] mb-8 justify-between"},{default:d((()=>[(n(!0),c(m,null,g(de.value.benefits_arr,((e,l)=>(n(),_(a,{class:"flex flex-col w-[25%] items-center",key:l},{default:d((()=>[f(t,{class:"h-[88rpx] w-[88rpx]",src:x(D)(e.icon),mode:"heightFix"},null,8,["src"]),f(v,{class:"text-[rgba(255,255,255,0.9)] mt-[16rpx] text-[24rpx] leading-[34rpx]"},{default:d((()=>[b(h(e.title),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},8,["style"])])),_:1}),de.value.gifts_arr&&de.value.gifts_arr.length?(n(),_(a,{key:0,class:"flex-1 rounded-t-[40rpx] px-[30rpx] pt-[var(--pad-top-m)] mt-[-36rpx] relative tab-bar",style:y({background:`linear-gradient( 180deg, ${de.value.level_style.gift} 0%, #FFFFFF 20%)`})},{default:d((()=>[p(" 升级礼包 "),f(a,{class:"mb-8"},{default:d((()=>[f(a,{class:"pb-[30rpx] flex items-center"},{default:d((()=>[f(v,{class:"text-[30rpx] text-[#333] font-500 leading-[44rpx]"},{default:d((()=>[b("升级礼包")])),_:1})])),_:1}),f(a,{class:"flex flex-wrap"},{default:d((()=>[(n(!0),c(m,null,g(de.value.gifts_arr,((e,l)=>(n(),_(a,{key:l,class:E(["mb-[20rpx]",{"mr-[21rpx]":(l+1)%3!=0}])},{default:d((()=>[f(a,{class:"relative box-border mb-[16rpx] w-[216rpx] h-[180rpx] !bg-contain",style:y({background:"url("+x(D)(e.background)+") no-repeat"})},null,8,["style"]),f(a,{class:"text-center font-500 text-[#333] text-[28rpx] truncate leading-[40rpx] max-w-[216rpx]"},{default:d((()=>[b(h(e.text),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1})])),_:1})])),_:1},8,["style"])):p("v-if",!0),p(" 购买sku展示 "),oe.value&&oe.value.length>0&&x(xe)?(n(),_(a,{key:1,class:"flex-1 rounded-t-[40rpx] px-[30rpx] pt-[var(--pad-top-m)] mt-[-36rpx] relative tab-bar",style:y({background:`linear-gradient( 180deg, ${de.value.level_style.gift} 0%, #FFFFFF 20%)`})},{default:d((()=>[f(a,{class:"pb-[20rpx] flex items-center"},{default:d((()=>[f(v,{class:"text-[30rpx] text-[#333] font-500 leading-[44rpx]"},{default:d((()=>[b("个性套餐")])),_:1})])),_:1}),f(a,{class:"grid grid-cols-3 p-2 md:grid-cols-3 gap-4 tk-card"},{default:d((()=>[(n(!0),c(m,null,g(oe.value,((e,l)=>(n(),_(a,{key:l,class:"relative bg-gray-100 rounded-lg hover:bg-orange-300",style:y({background:`linear-gradient( 180deg, ${de.value.level_style.gift} 0%, #FFFFFF 20%)`,border:ce.value==l?`2px solid ${de.value.level_style.progress[0]}`:""})},{default:d((()=>[f(a,{onClick:e=>fe(l),class:"p-1 text-center"},{default:d((()=>[f(a,{class:"tk-sltext text-gray-800 mt-1 font-bold"},{default:d((()=>[b(h(e.name),1)])),_:2},1024),f(a,{class:"price1 text-gray-900 mb-1",style:y({color:de.value.level_style.progress[0]})},{default:d((()=>[b(h(e.price),1)])),_:2},1032,["style"]),"fixed"==e.over_type?(n(),_(a,{key:0,class:"tk-sltext text-gray-400 mt-1 text-xs"},{default:d((()=>[b(h(Y(e.over_time)),1)])),_:2},1024)):(n(),_(a,{key:1,class:"tk-sltext text-gray-400 mt-1 text-xs"},{default:d((()=>[b(h(e.day>0?(e.price/e.day).toFixed(1):0)+"元/天 ",1)])),_:2},1024))])),_:2},1032,["onClick"])])),_:2},1032,["style"])))),128))])),_:1})])),_:1},8,["style"])):p("v-if",!0)])),_:1},8,["style"])):p("v-if",!0),N.value||Z.value&&Z.value.length?p("v-if",!0):(n(),_(a,{key:1,class:"empty-page"},{default:d((()=>[f(t,{class:"img",src:x(D)("static/resource/images/empty.png"),mode:"aspectFill"},null,8,["src"]),f(v,{class:"desc"},{default:d((()=>[b("暂无会员等级")])),_:1})])),_:1})),f(a,{class:"h-[240rpx]"}),ne.value&&x(xe)&&de.value.level_id>=J.value.level_id?(n(),_(a,{key:2,class:"b-tabbar safe-area-inset-bottom"},{default:d((()=>[f(a,{class:"flex justify-center items-start mt-[30rpx]"},{default:d((()=>[f(R,null,{default:d((()=>[f(o,{activeColor:"var(--primary-color)",checked:te.value,shape:"shape",size:"14",onChange:ue,customStyle:{marginTop:"4rpx"}},null,8,["checked"])])),_:1}),f(a,{class:"text-xs text-gray-400 flex flex-wrap"},{default:d((()=>[b(" 我已阅读并了解 "),f(a,{onClick:l[0]||(l[0]=e=>x(S)({url:"/app/pages/auth/agreement?key=tk_vip_service"}))},{default:d((()=>[f(v,{class:"text-primary"},{default:d((()=>[b("《付费会员协议》")])),_:1})])),_:1})])),_:1})])),_:1}),f(a,{class:"b-tabbar-back",style:y({backgroundColor:de.value.level_style.bg_color})},{default:d((()=>[f(a,{class:"fb items-center"},{default:d((()=>[f(a,{class:""},{default:d((()=>[f(a,{class:"flex items-center"},{default:d((()=>[f(a,{class:"price"},{default:d((()=>[b(h(ne.value.price),1)])),_:1}),f(a,{class:"text-white ml-2 mt-1"},{default:d((()=>[b(h(ne.value.name),1)])),_:1})])),_:1})])),_:1}),f(a),J.value&&de.value.level_id==J.value.level_id&&x(O)(J.value.over_time)>0?(n(),_(a,{key:0,class:"tt-bbut text-center leading-[70rpx] w-[200rpx] font-bold",onClick:l[1]||(l[1]=e=>ie("add"))},{default:d((()=>[b(" 立即续费 ")])),_:1})):p("v-if",!0),J.value&&de.value.level_id==J.value.level_id&&0==J.value.over_time?(n(),_(a,{key:1,class:"tt-bbut text-center leading-[70rpx] w-[200rpx] font-bold"},{default:d((()=>[b("永久会员 ")])),_:1})):p("v-if",!0),!J.value||de.value.level_id!=J.value.level_id||J.value.over_time>0?(n(),_(a,{key:2,class:"tt-bbut text-center leading-[70rpx] w-[200rpx] font-bold",onClick:l[2]||(l[2]=e=>ie("create"))},{default:d((()=>[b(" 立即购买 ")])),_:1})):p("v-if",!0)])),_:1})])),_:1},8,["style"]),f(B)])),_:1})):p("v-if",!0)])),_:1},8,["style"]),f(Q,{ref_key:"payRef",ref:se,onClose:l[3]||(l[3]=e=>re.value=!1)},null,512)],64)}}}),[["__scopeId","data-v-4342acd4"]]);export{Y as default};
