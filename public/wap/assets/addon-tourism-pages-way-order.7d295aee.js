import{d as e,r as t,p as l,j as a,o as s,c as r,w as n,b as o,y as u,z as i,u as d,f as c,U as x,ad as f,V as m,n as p,t as _,aV as v,a as y,Z as b,$ as h,i as g,D as w,g as k,h as C,ac as V,C as j,bY as F,M as $,aA as A,bm as S,R as D,ca as E,bX as U,a$ as B,_ as z}from"./index-71c7df08.js";import{_ as N}from"./pay.6aa36878.js";import{_ as R}from"./loading-page.vue_vue_type_script_setup_true_lang.c7dc2256.js";import{w as X,f as H,h as I,i as J}from"./tourism.86990a9a.js";import"./pay.4cfa8889.js";const L=z(e({__name:"order",setup(e){const z=e=>{T.value.num=e.value,G()},L=t(null),M=t(null),O=t(!0),P=t(""),T=t(uni.getStorageSync("wayCreateData")||{}),W=t(null),Y=t(!1),Z=t(!1),q=t("");l((()=>{X(T.value).then((({data:e})=>{O.value=!1,W.value=e,q.value=e.goods_info.buy_info,le()})).catch((e=>{P.value=e.msg,O.value=!1}))}));const G=()=>{O.value=!0,H(T.value).then((({data:e})=>{W.value=e,O.value=!1})).catch((e=>{O.value=!1,_({title:e.msg,icon:"none"})}))},K=t(!1),Q=()=>{if(te()){if(K.value)return;K.value=!0;const e=uni.$u.deepClone(v(T.value));e.buyer_info=JSON.stringify(e.buyer_info),I(e).then((({data:e})=>{var t;null==(t=M.value)||t.open(e.trade_type,e.trade_id,`/addon/tourism/pages/order/detail?order_id=${e.trade_id}`),K.value=!1})).catch((e=>{K.value=!1,_({title:e.msg,icon:"none"})}))}};let ee=t("0");J().then((e=>{ee.value=e.data.is_allow_refund}));const te=()=>{const e=T.value.buyer_info;if(uni.$u.test.isEmpty(e.name))return _({title:"请输入联系人姓名",icon:"none"}),!1;if(uni.$u.test.isEmpty(T.value.mobile))return _({title:"请输入手机号",icon:"none"}),!1;if(!/^1[3-9]\d{9}$/.test(T.value.mobile))return _({title:"请输入正确的手机号",icon:"none"}),!1;if(uni.$u.test.isEmpty(e.id_card))return _({title:"请输入身份证号",icon:"none"}),!1;return!!/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(e.id_card)||(_({title:"请输入正确的身份证号",icon:"none"}),!1)},le=()=>{var e;T.value.buyer_info={name:"",id_card:""},T.value.mobile="",W.value.reserve_time=ae(null==(e=W.value)?void 0:e.reserve_time)};a((()=>W.value?W.value.goods_info.goods_attribute.split(","):[]));const ae=e=>{const t=new Date(e);return uni.$u.timeFormat(t,"yyyy-mm-dd ")+["周日","周一","周二","周三","周四","周五","周六"][t.getDay()]},se=()=>{y({url:"/addon/tourism/pages/order/list",mode:"redirectTo"})},re=()=>{b().length>1?h({delta:1}):y({url:"/addon/tourism/pages/index",mode:"reLaunch"})};return(e,t)=>{const l=g,a=w,_=k(C("u-number-box"),F),v=k(C("u-parse"),$),y=V,b=k(C("u-popup"),A),h=k(C("u--input"),S),X=k(C("u-form-item"),D),H=k(C("u--form"),E),I=k(C("u-button"),U),J=k(C("pay"),N),G=k(C("u-empty"),B),te=j,le=k(C("loading-page"),R);return s(),r(l,{style:p(e.themeColor())},{default:n((()=>[W.value?(s(),r(l,{key:0,class:"bg-[#f7f7f7] min-h-screen overflow-hidden"},{default:n((()=>[o(l,{class:"chunk-wrap pb-2 pt-4"},{default:n((()=>[o(l,{class:"font-bold"},{default:n((()=>[u(i(W.value.goods_info.goods_name),1)])),_:1}),o(l,{class:"flex justify-between items-center mt-3"},{default:n((()=>[o(l,{class:"text-xs text-[#888]"},{default:n((()=>[o(a,{class:"text-[#FA6400] text-[26rpx]"},{default:n((()=>[u("￥")])),_:1}),o(a,{class:"text-[#FA6400] text-[38rpx]"},{default:n((()=>[u(i(W.value.order_items[0].price),1)])),_:1}),u(" /人起 ")])),_:1}),o(l,{class:"text-xs"},{default:n((()=>[u("出发日期："+i(T.value.reserve_time.split("/").join("-")),1)])),_:1})])),_:1}),o(l,{class:"flex justify-between items-center mt-3"},{default:n((()=>[o(a,{class:"text-sm"},{default:n((()=>[u("选择人数")])),_:1}),o(_,{modelValue:T.value.num,"onUpdate:modelValue":t[0]||(t[0]=e=>T.value.num=e),max:W.value.goods_info.stock,onChange:z},null,8,["modelValue","max"])])),_:1}),o(l,{class:"flex items-center justify-between mt-5 bg-[#FFF1E7] py-[16rpx] px-[18rpx] rounded-md"},{default:n((()=>[o(a,{class:"text-xs text-[#E02020]"},{default:n((()=>[u(i(Number(d(ee))?"随时可退":"购买后不可退款"),1)])),_:1}),o(l,{class:"flex items-center text-[#774C33] text-xs",onClick:t[1]||(t[1]=e=>Z.value=!0)},{default:n((()=>[o(a,null,{default:n((()=>[u("购买须知")])),_:1}),o(a,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1})])),_:1}),c(" 购买须知弹窗 "),o(b,{show:Z.value,onClose:t[2]||(t[2]=e=>Z.value=!1),closeable:!0},{default:n((()=>[o(l,{class:"text-center py-[30rpx] font-bold leading-none"},{default:n((()=>[o(a,null,{default:n((()=>[u("购买须知")])),_:1})])),_:1}),o(l,{class:"pt-[28rpx] pb-[40rpx] px-[28rpx]"},{default:n((()=>[o(y,{class:"max-h-[60vh]","scroll-y":!0},{default:n((()=>[q.value?(s(),r(v,{key:0,content:q.value,tagStyle:{img:"vertical-align: top;"}},null,8,["content"])):(s(),r(a,{key:1,class:"block px-5"},{default:n((()=>[u("暂无购买须知")])),_:1}))])),_:1})])),_:1})])),_:1},8,["show"]),o(l,{class:"chunk-wrap"},{default:n((()=>[o(l,{class:"chunk-head"},{default:n((()=>[o(a,null,{default:n((()=>[u("游客信息")])),_:1}),o(l,{class:"text-xs"},{default:n((()=>[u("需填写"),o(a,{class:"text-[#FF2F11]"},{default:n((()=>[u("1")])),_:1}),u("位，用于入园身份验证")])),_:1})])),_:1}),o(l,{class:"py-2"},{default:n((()=>[o(H,{labelPosition:"left",model:T.value,ref_key:"form",ref:L,labelWidth:"90",labelStyle:{color:"#A3A3A3",fontSize:"14px"}},{default:n((()=>[o(X,{label:"联系姓名",prop:"buyer_info.name",borderBottom:""},{default:n((()=>[o(l,{class:"border-style"},{default:n((()=>[o(h,{border:"none",placeholder:"请输入联系姓名",placeholderClass:"text-sm",modelValue:T.value.buyer_info.name,"onUpdate:modelValue":t[3]||(t[3]=e=>T.value.buyer_info.name=e)},null,8,["modelValue"])])),_:1})])),_:1}),o(X,{label:"手机号",prop:"mobile",borderBottom:""},{default:n((()=>[o(l,{class:"border-style"},{default:n((()=>[o(h,{border:"none",placeholder:"请输入手机号",placeholderClass:"text-sm",modelValue:T.value.mobile,"onUpdate:modelValue":t[4]||(t[4]=e=>T.value.mobile=e)},null,8,["modelValue"])])),_:1})])),_:1}),o(X,{label:"证件类型",borderBottom:""},{default:n((()=>[o(l,{class:"border-style"},{default:n((()=>[o(a,{class:"text-sm"},{default:n((()=>[u("身份证")])),_:1})])),_:1})])),_:1}),o(X,{label:"证件号",prop:"buyer_info.id_card",borderBottom:""},{default:n((()=>[o(l,{class:"border-style !border-0"},{default:n((()=>[o(h,{border:"none",placeholder:"请输入证件号",placeholderClass:"text-sm",modelValue:T.value.buyer_info.id_card,"onUpdate:modelValue":t[5]||(t[5]=e=>T.value.buyer_info.id_card=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1}),c(' <view class="chunk-wrap">\r\n                <view class="chunk-head">\r\n                    <text>支付方式</text>\r\n                </view>\r\n                <view class="flex justify-between items-center h-[80rpx]">\r\n                    <view class="flex items-center">\r\n                        <image class="w-[42rpx] h-[42rpx]" :src="img(\'addon/tourism/tourism/way/discount_coupon.png\')" mode="widthFix"></image>\r\n                        <text class="ml-1 text-xs">微信支付</text>\r\n                    </view>\r\n                    <u-radio :labelDisabled="true"></u-radio>\r\n                </view>\r\n            </view>\r\n\r\n            <view class="chunk-wrap">\r\n                <view class="chunk-head">\r\n                    <text>优惠信息</text>\r\n                </view>\r\n                <view class="flex justify-between items-center h-[80rpx]">\r\n                    <view class="flex items-center">\r\n                        <image class="w-[42rpx] h-[42rpx]" :src="img(\'addon/tourism/tourism/way/discount_coupon.png\')" mode="widthFix"></image>\r\n                        <text class="ml-1 text-xs">抵用券</text>\r\n                    </view>\r\n                    <text class="text-[var(--text-color-light9)] text-xs flex items-center">查看<text class="nc-iconfont nc-icon-youV6xx text-[26rpx]"></text></text>\r\n                </view>\r\n            </view> '),o(l,{class:"h-[148rpx] w-screen"}),o(l,{class:"bg-white p-3 fixed bottom-0 left-0 right-0 flex items-center justify-between"},{default:n((()=>[o(l,{class:"text-[#FA6400] text-xs"},{default:n((()=>[o(a,null,{default:n((()=>[u("总价")])),_:1}),o(a,{class:"ml-[2rpx]"},{default:n((()=>[u("￥")])),_:1}),o(a,{class:"text-[38rpx]"},{default:n((()=>[u(i(W.value.order_money.toFixed(2)),1)])),_:1})])),_:1}),o(l,{class:"ml-auto mr-2",onClick:t[6]||(t[6]=e=>Y.value=!Y.value)},{default:n((()=>[o(a,{class:"text-[#686868] text-xs mr-1"},{default:n((()=>[u("明细")])),_:1}),o(a,{class:"nc-iconfont nc-icon-shangV6xx-1 text-[#C2C2C2] text-xs font-bold"})])),_:1}),o(I,{text:"提交订单",color:"var(--primary-color)",shape:"circle",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"278rpx"},type:"primary",size:"16",loading:K.value,onClick:Q},null,8,["loading"])])),_:1}),o(b,{show:Y.value,onClose:t[7]||(t[7]=e=>Y.value=!1),closeable:!0},{default:n((()=>[o(l,{class:"text-center py-[30rpx] font-bold leading-none"},{default:n((()=>[o(a,null,{default:n((()=>[u("费用明细")])),_:1})])),_:1}),o(y,{"scroll-y":"true",class:"max-h-[40vh]"},{default:n((()=>[o(l,{class:"flex px-[30rpx] mt-[20rpx]"},{default:n((()=>[o(l,{class:"font-bold"},{default:n((()=>[u("总价")])),_:1}),o(l,{class:"text-right flex-1 font-bold"},{default:n((()=>[o(a,{class:"text-sm font-normal"},{default:n((()=>[u("￥")])),_:1}),o(a,{class:"text-[38rpx]"},{default:n((()=>[u(i(W.value.order_money.toFixed(2)),1)])),_:1})])),_:1})])),_:1}),(s(!0),x(m,null,f(W.value.order_items,((e,t)=>(s(),r(l,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:n((()=>[c(" <view>{{ item.year }}-{{ item.month }}-{{ item.day }}</view> "),o(l,null,{default:n((()=>[u(i(W.value.reserve_time)+" 出发",1)])),_:1}),o(l,{class:"text-right flex-1"},{default:n((()=>[o(a,{class:"text-xs"},{default:n((()=>[u("￥")])),_:1}),o(a,null,{default:n((()=>[u(i(null==e?void 0:e.price),1)])),_:2},1024),o(a,{class:"mx-[10rpx]"},{default:n((()=>[u("x")])),_:1}),o(a,null,{default:n((()=>[u(i(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256)),c(' <view class="flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle">\r\n                        <view>{{ paymentData.reserve_time }} 出发</view>\r\n                        <view class="text-right flex-1"></view>\r\n                    </view> ')])),_:1}),o(l,{class:"h-[150rpx]"})])),_:1},8,["show"])])),_:1})):c("v-if",!0),o(J,{ref_key:"payRef",ref:M,onClose:se},null,512),P.value?(s(),r(l,{key:1,class:"w-screen h-screen flex flex-col justify-center items-center"},{default:n((()=>[o(G,{icon:e.img("static/resource/images/order_empty.png"),text:P.value},null,8,["icon","text"]),o(l,{class:"w-[240rpx] mt-[40rpx]"},{default:n((()=>[o(te,{class:"bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:re},{default:n((()=>[u("返回上一页")])),_:1})])),_:1})])),_:1})):c("v-if",!0),o(le,{loading:O.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-6c6f5c6c"]]);export{L as default};
