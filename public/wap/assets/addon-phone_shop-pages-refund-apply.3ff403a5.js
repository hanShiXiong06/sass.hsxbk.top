import{d as e,r as a,p as l,a7 as t,j as r,o as s,c as u,w as d,b as o,u as n,y as i,z as x,f as p,n as c,A as f,U as m,ad as _,V as v,au as y,t as g,a as b,B as h,g as w,h as k,i as V,D as C,ac as j,am as N,ab as U,c3 as A,C as B,ak as E,E as F,bl as L,ax as D,c4 as P,c5 as S,aA as T,_ as z}from"./index-71c7df08.js";import{a as I}from"./order.fd75567a.js";import{g as M,a as R,b as q}from"./refund.1e0a5e60.js";const G=z(e({__name:"apply",setup(e){var z;const G=a(null),H=a({}),J=a(0),K=a(0),O=a(!1),Q=a({order_id:null==(z=G.value)?void 0:z.order_id,order_goods_id:J.value,refund_type:"",apply_money:"",reason:"",remark:"",voucher:[]}),W=a({}),X=a([]),Y=a("");M().then((({data:e})=>{X.value=e,X.value&&X.value.length&&(Y.value=X.value[0])})),l((e=>{J.value=e.order_goods_id||0,Q.value.order_goods_id=J.value,Q.value.order_id=e.order_id||0,I(e.order_id).then((({data:e})=>{G.value=e,G.value.order_goods.forEach(((e,a)=>{J.value==e.order_goods_id&&(H.value=e)})),Q.value.apply_money=t(W.value.refund_money)})),R({order_goods_id:e.order_goods_id}).then((e=>{W.value=e.data}))}));const Z=r((e=>function(e){return""==e||0==e?"70rpx":18*String(e).length+"rpx"})),$=e=>{Q.value.refund_type=e,K.value=1},ee=r((()=>Q.value.voucher.map((e=>({url:F(e)}))))),ae=e=>{e.file.forEach((e=>{y({filePath:e.url,name:"file"}).then((e=>{Q.value.voucher.length<9&&Q.value.voucher.push(e.data.url)}))}))},le=e=>{Q.value.voucher.splice(e.index,1)},te=a(!1),re=()=>Q.value.reason?Number(Q.value.apply_money).toFixed(2)<0?(g({title:"退款金额不能为0,保留两位小数",icon:"none"}),!1):Number(Q.value.apply_money)>Number(W.value.refund_money)?(g({title:"退款金额不能大于可退款总额",icon:"none"}),!1):void(te.value||(te.value=!0,q(Q.value).then((e=>{te.value=!1,setTimeout((()=>{b({url:"/addon/phone_shop/pages/order/detail",param:{order_id:Q.value.order_id}})}),1e3)})).catch((()=>{te.value=!1})))):(g({title:"请选择退款原因",icon:"none"}),!1),se=()=>{Q.value.reason=Y.value,O.value=!1},ue=e=>{Number(e.detail.value)>Number(W.value.refund_money)&&g({title:"退款金额不能大于可退款总额",icon:"none"})};return(e,a)=>{const l=h,t=w(k("u--image"),L),r=V,y=C,g=j,b=N,z=U,I=w(k("u-upload"),D),M=A,R=B,q=w(k("u-radio"),P),J=w(k("u-radio-group"),S),de=w(k("u-popup"),T),oe=E;return s(),u(r,{style:c(e.themeColor())},{default:d((()=>[G.value?(s(),u(oe,{key:0,"indicator-dots":!1,autoplay:!1,"disable-touch":!0,current:K.value,class:"h-screen",duration:300},{default:d((()=>[o(b,null,{default:d((()=>[o(g,{"scroll-y":"true",class:"bg-page h-screen"},{default:d((()=>[o(r,{class:"my-[24rpx] sidebar-marign px-[24rpx] rounded-md bg-white"},{default:d((()=>[o(r,{class:"flex py-[30rpx] border-0 !border-b !border-[#f5f5f5] border-solid"},{default:d((()=>[o(r,{class:"w-[120rpx] h-[120rpx] flex items-center justify-center"},{default:d((()=>[o(t,{radius:"10rpx",width:"120rpx",height:"120rpx",src:n(F)(H.value.sku_image),model:"aspectFill"},{error:d((()=>[o(l,{class:"w-[120rpx] h-[120rpx] rounded-[10rpx] overflow-hidden",src:n(F)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:1},8,["src"])])),_:1}),o(r,{class:"flex flex-1 w-0 flex-col justify-between ml-[20rpx]"},{default:d((()=>[o(r,null,{default:d((()=>[o(r,{class:"text-ellipsis text-[#303133] text-sm leading-normal"},{default:d((()=>[i(x(H.value.goods_name),1)])),_:1}),o(r,{class:"mt-[10rpx] text-[26rpx] leading-[1.3] text-gray-subtitle"},{default:d((()=>[i(x(H.value.sku_name),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(r,{class:"my-[24rpx] sidebar-marign px-[24rpx] rounded-md bg-white"},{default:d((()=>[o(r,{class:"py-[24rpx] flex items-center",onClick:a[0]||(a[0]=e=>$(1))},{default:d((()=>[o(r,{class:"flex-1"},{default:d((()=>[o(r,{class:"text-sm"},{default:d((()=>[i("仅退款")])),_:1}),"real"==H.value.goods_type?(s(),u(r,{key:0,class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:d((()=>[i(" 未收到货，或与商家协商一致不用退货只退款")])),_:1})):"virtual"==H.value.goods_type?(s(),u(r,{key:1,class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:d((()=>[i(" 与商家协商一致不用退货只退款")])),_:1})):p("v-if",!0)])),_:1}),o(y,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1}),"real"!=H.value.goods_type||H.value.delivery_status&&"wait_delivery"==H.value.delivery_status?p("v-if",!0):(s(),u(r,{key:0,class:"py-[24rpx] flex items-center border-0 !border-t !border-[#f5f5f5] border-solid",onClick:a[1]||(a[1]=e=>$(2))},{default:d((()=>[o(r,{class:"flex-1"},{default:d((()=>[o(r,{class:"text-sm"},{default:d((()=>[i("退货退款")])),_:1}),o(r,{class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:d((()=>[i("已收到货，需退还收到的货物")])),_:1})])),_:1}),o(y,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1}))])),_:1})])),_:1})])),_:1}),o(b,null,{default:d((()=>[o(g,{"scroll-y":"true",class:"bg-page h-screen"},{default:d((()=>[o(r,{class:"my-[24rpx] sidebar-marign px-[24rpx] rounded-md bg-white"},{default:d((()=>[o(r,{class:"py-[24rpx] flex justify-between items-center"},{default:d((()=>[o(r,{class:"text-sm"},{default:d((()=>[i("退款原因")])),_:1}),o(r,{class:"flex items-center",onClick:a[2]||(a[2]=e=>O.value=!0)},{default:d((()=>[o(r,{class:"flex-1 text-right"},{default:d((()=>[o(r,{class:"text-xs text-gray-subtitle truncate w-[460rpx]"},{default:d((()=>[i(x(Q.value.reason||"请选择"),1)])),_:1})])),_:1}),o(y,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1})])),_:1})])),_:1}),o(r,{class:"my-[24rpx] sidebar-marign px-[24rpx] rounded-md bg-white"},{default:d((()=>[o(r,{class:"py-[24rpx] flex items-center"},{default:d((()=>[o(r,{class:"text-sm"},{default:d((()=>[i("退款金额")])),_:1}),o(r,{class:"flex-1 text-right"},{default:d((()=>[o(r,{class:"flex justify-end items-center"},{default:d((()=>[o(y,{class:"font-bold text-sm leading-none"},{default:d((()=>[i("￥")])),_:1}),o(z,{type:"digit",modelValue:Q.value.apply_money,"onUpdate:modelValue":a[3]||(a[3]=e=>Q.value.apply_money=e),modelModifiers:{number:!0},class:"font-bold text-sm leading-none",style:c({width:n(Z)(Q.value.apply_money)}),onBlur:ue},null,8,["modelValue","style"])])),_:1}),o(r,{class:"text-xs text-gray-subtitle mt-[10rpx]"},{default:d((()=>[o(y,null,{default:d((()=>[i("最多可输入金额￥"+x(W.value.refund_money),1)])),_:1}),1===W.value.is_refund_delivery&&Number(W.value.refund_delivery_money)>0?(s(),u(y,{key:0,class:"ml-[10rpx]"},{default:d((()=>[i("(包含运费￥"+x(W.value.refund_delivery_money)+")",1)])),_:1})):p("v-if",!0)])),_:1})])),_:1})])),_:1})])),_:1}),o(r,{class:"my-[24rpx] sidebar-marign px-[24rpx] rounded-md bg-white"},{default:d((()=>[o(r,{class:"py-[24rpx]"},{default:d((()=>[o(r,{class:"text-sm"},{default:d((()=>[i("上传凭证"),o(y,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:d((()=>[i("选填")])),_:1})])),_:1}),o(r,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx]"},{default:d((()=>[o(I,{fileList:n(ee),onAfterRead:ae,onDelete:le,multiple:"",maxCount:9},null,8,["fileList"])])),_:1})])),_:1})])),_:1}),o(r,{class:"my-[24rpx] sidebar-marign px-[24rpx] rounded-md bg-white"},{default:d((()=>[o(r,{class:"py-[24rpx]"},{default:d((()=>[o(r,{class:"text-sm"},{default:d((()=>[i("补充描述"),o(y,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:d((()=>[i("选填")])),_:1})])),_:1}),o(r,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx] h-[200rpx]"},{default:d((()=>[o(M,{class:"h-[100%]",modelValue:Q.value.remark,"onUpdate:modelValue":a[4]||(a[4]=e=>Q.value.remark=e),cols:"30",rows:"5",placeholder:"补充描述,有助于更好的处理售后问题","placeholder-class":"text-sm"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),o(r,{class:"mt-[40rpx] my-[24rpx] sidebar-marign"},{default:d((()=>[o(R,{class:"bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",loading:te.value,onClick:re},{default:d((()=>[i("提交")])),_:1},8,["loading"])])),_:1}),p(" 退款原因 "),o(de,{show:O.value,onClose:a[7]||(a[7]=e=>O.value=!1),closeable:!0},{default:d((()=>[o(r,{class:"px-[30rpx] pb-[30rpx]",onTouchmove:a[6]||(a[6]=f((()=>{}),["prevent","stop"]))},{default:d((()=>[o(r,{class:"text-center p-[30rpx]"},{default:d((()=>[i("退款原因")])),_:1}),o(g,{"scroll-y":"true",class:"h-[450rpx] mt-[20rpx]"},{default:d((()=>[o(J,{modelValue:Y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>Y.value=e),placement:"column",iconPlacement:"right"},{default:d((()=>[(s(!0),m(v,null,_(X.value,((e,a)=>(s(),u(q,{activeColor:"var(--primary-color)",customStyle:{marginBottom:"30rpx"},key:a,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(R,{class:"mt-[40rpx] bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:se},{default:d((()=>[i("确定")])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})])),_:1})])),_:1},8,["current"])):p("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-9394a419"]]);export{G as default};
