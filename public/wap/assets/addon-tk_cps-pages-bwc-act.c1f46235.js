import{d as e,l as t,m as a,a8 as l,r as s,a5 as o,a9 as r,j as i,o as n,E as c,b as u,w as m,x as p,f as d,G as f,F as _,u as x,c as g,U as v,B as b,I as h,bb as y,bc as k,i as w,a4 as j,g as S,h as C,ab as F,H as A,y as L,V as I,ba as T,N as z,C as B}from"./index-e6ce9fbf.js";import{_ as D}from"./u-tag.267269e3.js";import{_ as E}from"./u-line-progress.ec723c6c.js";import{_ as M}from"./u-icon.c5d9cd81.js";import{_ as P}from"./u-loading-icon.39fd4711.js";import{_ as U}from"./tabbar.2cc8e58f.js";import{_ as G}from"./share-poster.88ccab8c.js";import"./mescroll-uni.8af333db.js";import"./mescroll-body.dc3de07c.js";import{u as H}from"./useMescroll.26ccf5de.js";import{M as N}from"./mescroll-empty.b423055b.js";import{c as J,g as K}from"./bwc.83a8b07d.js";import{t as R}from"./common.828da18f.js";import{_ as V}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-transition.6919b33f.js";import"./u-badge.7d0ca9d8.js";import"./u-tabbar.2615c204.js";import"./u-safe-bottom.1ba5bfba.js";import"./u-popup.b16d6e1d.js";import"./mescroll-uni-option.2f7b06f4.js";import"./mescroll-i18n.6025c811.js";/* empty css                                                                       */const Y=V(e({__name:"act",setup(e){H();const{setShare:V,onShareAppMessage:Y,onShareTimeline:$}=v(),q=t(),O=a((()=>q.info));l();let Q=s(null),W=s(""),X={};const Z=s(0);let ee=s([]),te=s(!1);const ae=s(4),le=s([{name:"所有活动",value:4},{name:"美团",value:2},{name:"饿了么",value:3}]),se=s(uni.getStorageSync("location"));V(),Y(),$();const oe=e=>{T({url:`/addon/tk_cps/pages/bwc/detail?planId=${e.planId}`})},re=s(1);s([]);const ie=()=>{ne(),te.value=!0;let e={page:re.value,mapLat:se.value.latitude||"39.908823",mapLon:se.value.longitude||"116.39747",planSource:ae.value};K(e).then((e=>{let t=e.data.data.merchantList;1==re.value?ee.value=t:ee.value=ee.value.concat(t),0==t.length&&(te.value=!1,h({title:"已经没有更多数据",icon:"none"}))})).catch((()=>{te.value=!1}))},ne=()=>{uni.getStorageSync("localtion")||k({type:"wgs84",success:function(e){se.value=e,uni.setStorageSync("localtion",se.value)}})};return o((()=>{re.value++,ie()})),r((()=>{O.value&&O.value.member_id&&(W.value+="?mid="+O.value.member_id)})),i((e=>{if(e.mid)uni.setStorageSync("pid",e.mid),J({pid:e.mid});else{let e=uni.getStorageSync("pid");e&&e>0&&J({pid:e})}ie()})),(e,t)=>{const a=w,l=j,s=z,o=B,r=S(C("u-tag"),D),i=S(C("u-line-progress"),E),v=S(C("u-icon"),M),k=S(C("up-loading-icon"),P),T=F,H=S(C("tabbar"),U),J=S(C("share-poster"),G);return n(),c(f,null,[u(a,{class:"flex items-center mb-[16rpx] mt-[32rpx] flex-right"},{default:m((()=>[u(a,{class:"ml-4 font-bold text-[36rpx]"},{default:m((()=>[p("全城霸王餐")])),_:1}),d(' <view @click="changeAddress()" class="ml-4 flex text-[#323130] text-sm">\r\n\t\t\t<view v-if="locationData" class="tk-sltext">{{locationData.name?locationData.name:\'点击切换位置\'}}\r\n\r\n\t\t\t</view>\r\n\t\t\t<view v-if="!locationData">点击选择位置</view>\r\n\t\t\t<view class="font-bold ml-2">></view>\r\n\t\t</view> '),u(a,{onClick:t[0]||(t[0]=e=>{y({success:e=>{se.value=e,uni.setStorageSync("localtion",se.value),ee.value=[],ie()},fail:e=>{e.errMsg&&e.errno&&(104==e.errno?h({title:"用户未授权隐私权限，选择位置失败",icon:"none"}):112==e.errno?h({title:"隐私协议中未声明，打开地图选择位置失败",icon:"none"}):h({title:e.errMsg,icon:"none"}))}})}),class:"ml-4 text-[#ffab45] text-xs"},{default:m((()=>[p(" 位置已缓存，点击切换位置 ")])),_:1})])),_:1}),u(a,{class:""},{default:m((()=>[u(l,{"scroll-x":"true",class:"scroll-Y box-border bg-white"},{default:m((()=>[u(a,{class:"flex whitespace-nowrap justify-around"},{default:m((()=>[(n(!0),c(f,null,_(le.value,((e,t)=>(n(),g(a,{class:A(["text-sm leading-[90rpx]",{"class-select":ae.value===e.value}]),onClick:t=>{return a=e.value,re.value=1,ae.value=a,ee.value=[],void ie();var a}},{default:m((()=>[p(L(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1})])),_:1})])),_:1}),(n(!0),c(f,null,_(x(ee),((e,t)=>(n(),g(a,{class:"tk-card"},{default:m((()=>[u(a,{class:"flex"},{default:m((()=>[u(s,{style:{width:"180rpx",height:"140rpx","background-color":"#eeeeee","border-radius":"8px"},src:e.logo,mode:"aspectFill"},null,8,["src"]),u(a,{class:"flex flex-col ml-2 w-[100%] justify-between",style:{}},{default:m((()=>[u(a,{class:"font-bold tk-sltext"},{default:m((()=>[p(L(e.name),1)])),_:2},1024),u(a,{class:"flex justify-between"},{default:m((()=>[u(a,{class:"flex items-center"},{default:m((()=>[u(s,{style:{width:"32rpx",height:"32rpx","background-color":"#eeeeee","border-radius":"8px"},src:e.platformLogo,mode:"aspectFill"},null,8,["src"]),u(a,{class:"text-xs mt-[4rpx] ml-2"},{default:m((()=>[p(L(e.platformName),1)])),_:2},1024)])),_:2},1024),u(a,{class:"text-xs"},{default:m((()=>[p(L(e.distance),1)])),_:2},1024)])),_:2},1024),u(a,{class:"flex justify-between"},{default:m((()=>[u(o,{class:"text-xs"},{default:m((()=>[p("共"+L(e.planList.length)+"个活动",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),(n(!0),c(f,null,_(e.planList,((e,t)=>(n(),g(a,{class:"",key:t},{default:m((()=>[u(a,{class:"flex items-center mt-2 mb-2"},{default:m((()=>[u(a,{class:"bg-slate-100 pl-2 pr-2 pt-1 pb-1 text-xs text-blue-100 rounded-lg"},{default:m((()=>[p("活动"+L(t+1),1)])),_:2},1024),u(a,{class:"text-xs"},{default:m((()=>[u(o,null,{default:m((()=>[p(L("0:0"==x(R)(e.startTime)?"00:00":x(R)(e.startTime))+"-",1)])),_:2},1024),u(o,null,{default:m((()=>[p(L(x(R)(e.endTime)),1)])),_:2},1024)])),_:2},1024),u(a,{class:"line-box"})])),_:2},1024),u(a,{onClick:t=>oe(e),class:"flex justify-between items-center"},{default:m((()=>[u(a,{class:"flex"},{default:m((()=>[u(a,{class:""},{default:m((()=>[u(r,{text:"最高返"+e.commission,bgColor:"#FA6400",borderColor:"#FE5A49",size:"mini"},null,8,["text"])])),_:2},1024),u(a,{class:"ml-2"},{default:m((()=>[1==e.planType?(n(),g(r,{key:0,text:"需要用餐评价",type:"success",plain:"",plainFill:"",size:"mini"})):(n(),g(r,{key:1,text:"无需评价",type:"error",plain:"",plainFill:"",size:"mini",color:"#FA6400"}))])),_:2},1024)])),_:2},1024),u(a,{class:"flex items-center"},{default:m((()=>[u(a,{class:"kucun"},{default:m((()=>[u(o,{class:"text-xs"},{default:m((()=>[p("还剩"+L(e.restStock)+"份",1)])),_:2},1024),u(i,{percentage:e.restStock/e.totalStock*100,activeColor:"#FFBA00",height:"5",showText:!1},null,8,["percentage"])])),_:2},1024),u(v,{name:"arrow-right",color:"#cccccc",size:"10"}),u(a,{class:"ml-2"},{default:m((()=>[e.restStock>0?(n(),g(r,{key:0,onClick:t=>oe(e),text:"去报名",bgColor:"#FA6400",borderColor:"#FE5A49"},null,8,["onClick"])):d("v-if",!0),0==e.restStock?(n(),g(r,{key:1,text:"已抢光",bgColor:"#6e6f6e",borderColor:"#ffffff"})):d("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:2},1024)))),256)),u(k,{class:"mt-4 mb-4",show:x(te),mode:"circle","inactive-color":"#FE5A49","timing-function":"linear"},null,8,["show"]),x(ee).length||0!=x(te)?d("v-if",!0):(n(),g(N,{key:0,option:{icon:x(I)("static/resource/images/empty.png")}},null,8,["option"])),u(T,{onClick:t[1]||(t[1]=e=>(()=>{if(!O.value){let e=uni.getStorageSync("pid");return e&&e>0?(b().setLoginBack({url:"/addon/tk_cps/pages/bwc/act?mid="+e}),!1):(b().setLoginBack({url:"/addon/tk_cps/pages/bwc/act"}),!1)}O.value&&O.value.member_id&&(X.member_id=O.value.member_id),Q.value.openShare()})()),class:"fixed bottom-48 right-4 z-50 rounded-full p-2 text-white hover:bg-blue-700"},{default:m((()=>[u(v,{name:"share",color:"#000000",size:"24"})])),_:1}),u(H,{addon:"tk_cps"}),u(J,{ref_key:"sharePosterRef",ref:Q,posterType:"tk_cps_bwc",posterId:Z.value,posterParam:x(X),copyUrlParam:x(W)},null,8,["posterId","posterParam","copyUrlParam"])],64)}}}),[["__scopeId","data-v-d889df0f"]]);export{Y as default};
