import{d as e,aR as a,bU as t,r as l,bD as r,a as s,g as p,h as o,o as n,c as u,w as d,_ as i,b as y,x as c,y as m,u as _,t as v,$ as x,E as f,G as g,F as h,V as b,f as S,I as k,i as w,a4 as j}from"./index-905183d4.js";import{_ as C}from"./u-image.44c969ef.js";import{_ as I}from"./u-icon.86a2aad0.js";import{_ as T}from"./u-button.d3798ecb.js";import{_ as R}from"./u-popup.e3f6594b.js";import{p as P,g as E}from"./pay.01186f9d.js";import{_ as O}from"./_plugin-vue_export-helper.1b428a4d.js";const U=O(e({__name:"pay",emits:["close"],setup(e,{expose:O,emit:U}){a()&&t.init();const $=l(!1),H=l(!1),z=l(null),A=l(""),D=()=>{var e,l;uni.$u.test.isEmpty(A.value)?k({title:v("pay.notHavePayType"),icon:"none"}):H.value||(H.value=!0,P({trade_type:null==(e=z.value)?void 0:e.trade_type,trade_id:null==(l=z.value)?void 0:l.trade_id,type:A.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,p,o,n,u;switch(A.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{F()},cancel:()=>{H.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=z.value)?void 0:l.trade_type,trade_id:null==(r=z.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(p=z.value)?void 0:p.trade_type,trade_id:null==(o=z.value)?void 0:o.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(n=z.value)?void 0:n.trade_type,trade_id:null==(u=z.value)?void 0:u.trade_id}),location.href=e.data.url);break;default:F()}})).catch((()=>{H.value=!1})))};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const F=()=>{var e,a;s({url:"/app/pages/pay/result",param:{trade_type:null==(e=z.value)?void 0:e.trade_type,trade_id:null==(a=z.value)?void 0:a.trade_id},mode:"redirectTo"})},G=()=>{uni.removeStorageSync("paymenting"),$.value=!1,U("close")};return O({open:(e,a,t="")=>{uni.setStorageSync("payReturn",encodeURIComponent(t)),E(e,a).then((e=>{let{data:a}=e;z.value=a,uni.$u.test.isEmpty(a)?k({title:v("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(A.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",$.value=!0):F()})).catch((()=>{}))}}),(e,a)=>{const t=w,l=p(o("u-image"),C),r=p(o("u-icon"),I),s=j,k=p(o("u-button"),T),P=p(o("u-popup"),R);return n(),u(P,{show:$.value,round:10,onClose:G,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:d((()=>[z.value?(n(),u(t,{key:0,class:"flex flex-col h-[75vh]",onTouchmove:a[0]||(a[0]=i((()=>{}),["prevent","stop"]))},{default:d((()=>[y(t,{class:"head"},{default:d((()=>[y(t,{class:"text-center py-[26rpx]"},{default:d((()=>[c(m(_(v)("pay.payTitle")),1)])),_:1}),y(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx]"},{default:d((()=>[y(t,{class:"text-base mr-[4rpx]"},{default:d((()=>[c(m(_(v)("currency")),1)])),_:1}),c(" "+m(_(x)(z.value.money)),1)])),_:1})])),_:1}),y(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:d((()=>[y(t,{class:"flex text-sm px-[30rpx] py-[20rpx]"},{default:d((()=>[y(t,{class:"text-gray-500"},{default:d((()=>[c(m(_(v)("pay.orderInfo")),1)])),_:1}),y(t,{class:"text-right flex-1 pl-[30rpx] using-hidden"},{default:d((()=>[c(m(z.value.body),1)])),_:1})])),_:1}),y(t,{class:"mx-[30rpx] py-[10rpx] px-[30rpx] bg-white rounded-md bg-page"},{default:d((()=>[z.value.pay_type_list.length?(n(!0),f(g,{key:0},h(z.value.pay_type_list,((e,a)=>(n(),u(t,{class:"pay-item py-[18rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>A.value=e.key},{default:d((()=>[y(l,{src:_(b)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),y(t,{class:"flex-1 px-[20rpx] text-sm font-bold"},{default:d((()=>[c(m(e.name),1)])),_:2},1024),e.key==A.value?(n(),u(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):S("v-if",!0)])),_:2},1032,["onClick"])))),128)):(n(),u(t,{key:1,class:"py-[20rpx] text-center text-sm text-gray-subtitle"},{default:d((()=>[c(m(_(v)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),y(t,{class:"p-[30rpx]"},{default:d((()=>[y(k,{type:"primary",loading:H.value,text:_(v)("pay.confirmPay"),shape:"circle",onClick:D},null,8,["loading","text"])])),_:1})])),_:1})):S("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-b30d6e1a"]]);export{U as _};
