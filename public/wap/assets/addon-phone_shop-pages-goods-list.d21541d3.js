import{d as e,r as a,O as t,o as l,c as s,w as o,b as r,y as c,z as i,f as u,c3 as n,k as p,i as d,D as x,C as f,p as m,F as v,R as _,A as g,P as h,a7 as y,Q as b,u as k,b7 as w,n as j,a8 as S,a9 as C,g as F,h as V,a6 as I,E as z,t as P,a as A,a0 as D,c4 as M,s as T,B as U}from"./index-7bf68536.js";import{_ as N}from"./u-input.09a5cedd.js";import{_ as E}from"./u--image.b3bf1d5c.js";import{_ as R}from"./u-button.359d7329.js";import{_ as O}from"./u-popup.be4bfacd.js";import{_ as J}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as L}from"./tabbar.e049672c.js";import{b as B,c as H,d as Q}from"./goods.501e5f32.js";import{M as X}from"./mescroll-body.b6d57b41.js";import{M as q}from"./mescroll-empty.fcefb74e.js";import{u as G}from"./useMescroll.26ccf5de.js";import"./u-icon.0c1c54c7.js";import"./u-image.e46f68ef.js";import"./u-transition.cdf87992.js";import"./u-loading-icon.b37701e7.js";import"./u-safe-bottom.908eeae4.js";import"./u-badge.d8d91719.js";import"./u-tabbar.d98653fa.js";import"./cloneDeep.77735539.js";import"./mescroll-i18n.14e7fe02.js";/* empty css                                                                       */const K=J(e({__name:"wx-privacy-popup",emits:["agree","disagree"],setup(e,{expose:m,emit:v}){a(!1);const _=a(!1),g=a(null),h=new Set,y=new Set,b=a("用户隐私保护指引");t((()=>{try{wx.getPrivacySetting({success(e){b.value=e.privacyContractName}}),wx.onNeedPrivacyAuthorization&&wx.onNeedPrivacyAuthorization((e=>{"function"==typeof g.value&&g.value(e)})),g.value=e=>{h.add(e),C(),w(F)},y.add(F)}catch(e){}}));const k=()=>{wx.openPrivacyContract({success(e){},fail(e){}})},w=e=>{y.forEach((a=>{e!==a&&a()}))},j=()=>{h.forEach((e=>{e({event:"disagree"})})),h.clear(),F(),n({content:"未同意隐私协议，无法使用相关功能",confirmColor:p().themeColor["--primary-color"],success:()=>{v("disagree")}})},S=()=>{h.forEach((e=>{e({event:"agree",buttonId:"agree-btn"})})),h.clear(),F(),v("agree")},C=()=>{!1===_.value&&(_.value=!0)},F=()=>{!0===_.value&&(_.value=!1)};return m({proactive:()=>{wx.getPrivacySetting?wx.getPrivacySetting({success:e=>{e.needAuthorization?(C(),w(F)):v("agree")}}):v("agree")}}),(e,a)=>{const t=d,n=x,p=f;return _.value?(l(),s(t,{key:0},{default:o((()=>[r(t,{class:"privacy-mask"},{default:o((()=>[r(t,{class:"privacy-wrap"},{default:o((()=>[r(t,{class:"privacy-title"},{default:o((()=>[c("用户隐私保护提示")])),_:1}),r(t,{class:"privacy-desc"},{default:o((()=>[c(" 感谢您使用本小程序，在使用前您应当阅读并同意 "),r(n,{class:"privacy-link",onClick:k},{default:o((()=>[c(i(b.value),1)])),_:1}),c("， 当点击同意并继续时，即表示您已理解并同意该条款内容，该条款将对您产生法律约束力；如您不同意，将无法继续使用小程序相关功能。 ")])),_:1}),r(t,{class:"privacy-button-flex"},{default:o((()=>[r(p,{class:"privacy-button-btn bg-disagree",onClick:j},{default:o((()=>[c("不同意")])),_:1}),r(p,{id:"agree-btn",class:"privacy-button-btn bg-agree","open-type":"agreePrivacyAuthorization",onAgreeprivacyauthorization:S},{default:o((()=>[c("同意并继续")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):u("v-if",!0)}}}),[["__scopeId","data-v-56c14461"]]),W=J(e({__name:"list",setup(e){const{mescrollInit:n,downCallback:p,getMescroll:f}=G(C,S),J=a([]),W=a([]),Y=a(""),Z=a(""),$=a(null),ee=a(!1),ae=a(!1),te=a(""),le=a(""),se=a(""),oe=a(""),re=a("all");a(!1);let ce=a({start_price:"",end_price:""});const ie=a(!0);m((async e=>{pe.value=e.curr_goods_category||"",te.value=e.goods_name||"",Y.value=e.coupon_id||"",e.create_time&&(oe.value=(new Date).getTime())}));const ue=a({}),ne=e=>{ee.value=!1;let a={goods_category:pe.value,page:e.num||15,limit:e.size,keyword:te.value,coupon_id:Y.value,order:"all"===re.value?"":re.value,sort:"price"==re.value?le.value:se.value,start_price:ce.value.start_price,end_price:ce.value.end_price,create_time:oe.value};B(a).then((a=>{let t=a.data.data;W.value=W.value.concat(t),e.endSuccess(t.length),ee.value=!0})).catch((()=>{ee.value=!0,e.endErr()}))},pe=a(""),de=async e=>{0==J.value.length&&await H().then((e=>{J.value.push({category_name:"全部",category_id:""}),J.value=J.value.concat(e.data)})),re.value=e,"all"==e&&(se.value="",le.value=""),"day"==e&&(pe.value="",oe.value=oe.value?"":(new Date).toLocaleDateString().split("/").join("-")),"price"==e&&(se.value="",le.value?le.value="asc"==le.value?"desc":"asc":le.value="asc"),"sale_num"==e&&(le.value="",se.value?se.value="asc"==se.value?"desc":"asc":se.value="asc"),"label"==e?(se.value="asc",le.value="asc",ae.value=!ae.value):(ae.value=!1,W.value=[],f().resetUpScroll())},xe=()=>{ie.value=!ie.value},fe=e=>{A({url:"/addon/phone_shop/pages/goods/detail",param:{goods_id:e},mode:"navigateTo"})},me=()=>{te.value="",Z.value="",pe.value="",Y.value="",le.value="",se.value="",ce.value.start_price="",ce.value.end_price="",ae.value=!1,re.value="all",ie.value=!0,W.value=[],oe.value="",f().resetUpScroll()};t((()=>{setTimeout((()=>{f().optUp.textNoMore=v("end")}),500)}));const ve=e=>{let a="";return a=e.is_discount&&e.goodsSku.sale_price!=e.goodsSku.price?"discount_price":e.member_discount&&T()&&e.goodsSku.member_price!=e.goodsSku.price?"member_price":"",a},_e=e=>{let a="0.00";return a=e.is_discount&&e.goodsSku.sale_price!=e.goodsSku.price?e.goodsSku.sale_price?e.goodsSku.sale_price:e.goodsSku.price:e.member_discount&&T()&&e.goodsSku.member_price!=e.goodsSku.price&&e.goodsSku.member_price?e.goodsSku.member_price:e.goodsSku.price,parseFloat(a)};return(e,a)=>{const t=F(V("u-input"),N),p=x,f=d,m=I,v=U,S=F(V("u--image"),E),C=F(V("u-button"),R),T=F(V("u-popup"),O),B=F(V("wx-privacy-popup"),K),H=F(V("tabbar"),L);return l(),s(f,{class:"bg-gray-100 min-h-[100vh]",style:j(e.themeColor())},{default:o((()=>[r(f,{class:"fixed left-0 right-0 top-0 product-warp bg-[#fff] px-[30rpx]"},{default:o((()=>[r(f,{class:"py-[14rpx] flex items-center justify-between"},{default:o((()=>[r(f,{class:"flex-1 flex items-center h-[64rpx] bg-[#F6F8F8] rounded-[33rpx] px-[32rpx] mr-[30rpx]"},{default:o((()=>[r(t,{class:"flex-1",maxlength:"50",modelValue:te.value,"onUpdate:modelValue":a[0]||(a[0]=e=>te.value=e),onConfirm:a[1]||(a[1]=e=>de("all")),placeholder:"请搜索您想要的商品(串号搜索前加#)",placeholderClass:"text-[#a5a6a6] text-[26rpx]",fontSize:"26rpx",clearable:"",border:"none"},null,8,["modelValue"]),r(p,{class:"nc-iconfont nc-icon-sousuo-duanV6xx1 text-[32rpx] ml-[18rpx] !text-[#999]",onClick:a[2]||(a[2]=e=>de("all"))})])),_:1}),r(f,{class:_(["nc-iconfont text-[34rpx] text-[#666]",ie.value?"nc-icon-erweimaV6xx":"nc-icon-yingyongliebiaoV6xx"]),onClick:xe},null,8,["class"])])),_:1}),r(f,{class:"flex justify-between tems-center py-[22rpx] px-[20rpx]"},{default:o((()=>[r(f,{class:"flex items-center justify-between text-[24rpx] text-[#666] flex-1"},{default:o((()=>[u(" <text :class=\"{ 'text-[#303133] ': searchType == 'all' }\" @click=\"searchTypeFn('day')\">今日上新</text> "),r(f,{class:_(["flex items-center",{"text-[#303133]":"sale_num"==re.value,active:oe.value}]),onClick:a[3]||(a[3]=e=>de("day"))},{default:o((()=>[r(p,{class:"mr-[4rpx]"},{default:o((()=>[c("今日上新")])),_:1}),oe.value?(l(),s(p,{key:0,class:"text-[18rpx] nc-iconfont nc-icon-shanchu-yuangaizhiV6xx"})):u("v-if",!0),u(' <text v-else class="text-[18rpx] text-[#666] nc-iconfont nc-icon-a-xiangxiaV6xx1"></text> ')])),_:1},8,["class"]),r(f,{class:_(["flex items-center",{"text-[#303133]":"price"==re.value}]),onClick:a[4]||(a[4]=e=>de("price"))},{default:o((()=>[r(p,{class:"mr-[4rpx]"},{default:o((()=>[c("价格")])),_:1}),"asc"==le.value?(l(),s(p,{key:0,class:"text-[18rpx] text-[#666] nc-iconfont nc-icon-a-xiangshangV6xx1"})):(l(),s(p,{key:1,class:"text-[18rpx] text-[#666] nc-iconfont nc-icon-a-xiangxiaV6xx1"}))])),_:1},8,["class"]),r(f,{class:_(["flex items-center",{"text-[#303133]":"label"==re.value}]),onClick:a[5]||(a[5]=e=>de("label"))},{default:o((()=>[r(p,{class:"mr-[2rpx]"},{default:o((()=>[c("筛选")])),_:1}),r(p,{class:"nc-iconfont color-[#666] nc-icon-shaixuanV6xx text-[28rpx]"})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),r(T,{show:ae.value,mode:"top",onClose:a[9]||(a[9]=e=>ae.value=!1)},{default:o((()=>[r(f,{onTouchmove:a[8]||(a[8]=g((()=>{}),["prevent","stop"]))},{default:o((()=>[u(' <view class="text-sm font-bold px-[30rpx] mt-3">全部分类</view> '),r(f,{class:"tabs-box z-2 fixed left-0 bg-[#fff] bottom-[50px] top-20 pl-[10rpx] pt-[30rpx]"},{default:o((()=>[r(m,{"scroll-y":!0,class:"scroll-height bg-[#ddd]"},{default:o((()=>[r(f,{class:"bg-[#F4F6F8]"},{default:o((()=>[(l(!0),h(b,null,y(J.value,((e,a)=>(l(),s(f,{class:_(["tab-item truncate",{"tab-item-active":Z.value==a,"rounded-br-[12rpx]":Z.value-1===a,"rounded-tr-[12rpx]":Z.value+1===a}]),key:e.category_id,onClick:a=>(e=>{pe.value=e,W.value=[];const a=J.value.findIndex((a=>a.category_id==e));Z.value=a})(e.category_id)},{default:o((()=>[r(f,{class:"text-box px-[16rpx] truncate"},{default:o((()=>[c(i(e.category_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}),u("        价格区间筛选 "),r(f,{class:"flex justify-center flex-wrap pl-[200rpx] pb-[20rpx]"},{default:o((()=>[r(f,{class:"flex flex-wrap pl-[30rpx] pt-[30rpx] mr-3"},{default:o((()=>[r(t,{placeholder:"最低价格",border:"surround",class:"mr-3",prefixIconStyle:"font-size: 22px;color: #909399",modelValue:k(ce).start_price,"onUpdate:modelValue":a[6]||(a[6]=e=>k(ce).start_price=e)},null,8,["modelValue"]),c(" - "),r(t,{placeholder:"最高价格",border:"surround",class:"ml-3",modelValue:k(ce).end_price,"onUpdate:modelValue":a[7]||(a[7]=e=>k(ce).end_price=e)},null,8,["modelValue"])])),_:1}),r(m,{class:"h-[70vh]","scroll-y":!0},{default:o((()=>[r(f,{class:"bg-[#fff] grid grid-cols-3 gap-x-[50rpx] gap-y-[32rpx] py-[33rpx] px-[23rpx] rounded-[16rpx]"},{default:o((()=>{var e;return[(l(!0),h(b,null,y(null==(e=J.value[Z.value])?void 0:e.child_list,((e,a)=>(l(),s(f,{key:e.category_id,class:_(["text-center flex flex-col items-center pt-[8rpx] rounded",{"bg-[#f4f6f8]":pe.value==e.category_id}]),onClick:a=>{return t=e.category_id,pe.value==t?pe.value=J.value[Z.value-1].category_id||"":pe.value=t,void(W.value=[]);var t}},{default:o((()=>[r(S,{radius:"12rpx",width:"60rpx",height:"60rpx",src:k(z)(e.image?e.image:""),model:"aspectFill"},{error:o((()=>[r(v,{class:"rounded-[12rpx] overflow-hidden w-[60rpx] h-[60rpx]",src:k(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),r(f,{class:"text-[24rpx] text-center mt-[12rpx] leading-[34rpx]"},{default:o((()=>[c(i(e.category_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1}),r(f,{class:"flex flex-wrap justify-end pl-[30rpx] p-[30rpx]"},{default:o((()=>[w("div",{class:"flex"},[r(C,{type:"success",plain:!0,class:"mr-3",text:"重置",onClick:me}),r(C,{type:"primary",onClick:de,text:"搜索"})])])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),r(X,{ref_key:"mescrollRef",ref:$,top:"160rpx",bottom:"50px",onInit:k(n),down:{use:!1},onUp:ne},{default:o((()=>[W.value.length?(l(),s(f,{key:0,class:_(["sidebar-marign",ie.value?"":"flex justify-between flex-wrap"])},{default:o((()=>[(l(!0),h(b,null,y(W.value,((e,a)=>(l(),h(b,null,[ie.value?(l(),s(f,{key:0,class:_(["bg-white flex p-[20rpx] rounded-[16rpx] overflow-hidden mt-[20rpx]",{"mb-[20rpx]":a+1==W.value.length}]),onClick:a=>fe(e.goods_id)},{default:o((()=>[r(S,{class:"rounded-[10rpx] overflow-hidden",width:"190rpx",height:"190rpx",src:k(z)(e.goods_cover_thumb_mid?e.goods_cover_thumb_mid:""),model:"aspectFill"},{error:o((()=>[r(v,{class:"w-[190rpx] h-[190rpx] rounded-[10rpx] overflow-hidden",src:k(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),r(f,{class:"flex-1 flex flex-col ml-[20rpx] py-[6rpx]"},{default:o((()=>[r(f,{class:"text-[28rpx] text-[#303133] leading-[40rpx] multi-hidden mb-[10rpx]"},{default:o((()=>[c(i(e.goods_name),1)])),_:2},1024),e.sub_title?(l(),s(f,{key:0,class:"text-[16rpx] text-[#303133] leading-[40rpx] multi-hidden mb-[10rpx]"},{default:o((()=>[c(i(e.sub_title),1)])),_:2},1024)):u("v-if",!0),e.goodsSku.sku_no?(l(),s(f,{key:1,class:"text-[16rpx] text-[#303133] leading-[40rpx] multi-hidden mb-[10rpx]"},{default:o((()=>[c(" sn: "+i(e.goodsSku.sku_no),1)])),_:2},1024)):u("v-if",!0),r(f,{class:"mt-auto flex justify-between items-baseline"},{default:o((()=>[r(f,{class:"text-[var(--price-text-color)] price-font flex items-baseline"},{default:o((()=>[r(p,{class:"text-[26rpx] font-500"},{default:o((()=>[c("￥")])),_:1}),r(p,{class:"text-[36rpx] font-500"},{default:o((()=>[c(i(_e(e).toFixed(2).split(".")[0]),1)])),_:2},1024),r(p,{class:"text-[24rpx] font-500"},{default:o((()=>[c("."+i(_e(e).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==ve(e)?(l(),s(v,{key:0,class:"h-[24rpx] w-[72rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/VIP.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0),"discount_price"==ve(e)?(l(),s(v,{key:1,class:"h-[24rpx] w-[72rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/discount.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0)])),_:2},1024),r(p,{class:"text-[22rpx] text-[#999]"},{default:o((()=>[c("库存:"+i(e.goodsSku.stock)+i(e.unit)+" | 已售:"+i(e.sale_num)+i(e.unit),1)])),_:2},1024),r(p,{onClick:g((a=>{return t=e.goods_id,void Q({goods_id:t}).then((e=>{if(!e.data.goods||"[]"===JSON.stringify(e.data))return P({title:"找不到该商品",icon:"none"}),setTimeout((()=>{A({url:"/addon/phone_shop/pages/index",mode:"reLaunch"})}),600),!1;ue.value=D(e.data),ue.value.goods.goods_image.indexOf(",")>-1?ue.value.goods.goods_image=ue.value.goods.goods_image.split(","):ue.value.goods.goods_image=[ue.value.goods.goods_image],downloadMultipleImages(ue.value.goods.goods_image).then((e=>{if(e){let e=ue.value.sku_no?"#"+ue.value.sku_no+" ":"";M({data:ue.value.goods.goods_name+" "+ue.value.goods.sub_title+" "+e+ue.value.goods.price,success(){P({title:"图片下载及复制文案成功",icon:"none"})}})}else P({title:"下载失败",icon:"none"})}))}));var t}),["stop"]),class:"nc-iconfont nc-icon-fenxiangV6xx"},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])):(l(),s(f,{key:1,class:"goods-item-style-two flex flex-col bg-[#fff] box-border rounded-[12rpx] overflow-hidden mt-[20rpx]",onClick:a=>fe(e.goods_id)},{default:o((()=>[r(S,{width:"100%",height:"350rpx",src:k(z)(e.goods_cover_thumb_mid?e.goods_cover_thumb_mid:""),model:"aspectFill"},{error:o((()=>[r(v,{class:"w-[100%] h-[350rpx]",src:k(z)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),r(f,{class:"px-[16rpx] flex-1 pt-[16rpx] pb-[20rpx] flex flex-col justify-between"},{default:o((()=>[r(f,{class:"text-[#303133] leading-[40rpx] text-[28rpx] multi-hidden"},{default:o((()=>[c(i(e.goods_name),1)])),_:2},1024),r(f,{class:"text-[#303133] leading-[40rpx] text-[20rpx] multi-hidden"},{default:o((()=>[c(i(e.sub_title),1)])),_:2},1024),r(f,{class:"flex justify-between flex-wrap items-baseline mt-[16rpx]"},{default:o((()=>[r(f,{class:"text-[var(--price-text-color)] price-font flex items-baseline"},{default:o((()=>[u('\t\t\t\t\t\t\t\t\t\t<text class="text-[20rpx]  mr-[4rpx]">￥</text>'),u('\t\t\t\t\t\t\t\t\t\t<text class="text-[36rpx] font-500">{{ item.goodsSku.price }}</text>'),r(p,{class:"text-[26rpx] font-500"},{default:o((()=>[c("￥")])),_:1}),r(p,{class:"text-[36rpx] font-500"},{default:o((()=>[c(i(_e(e).toFixed(2).split(".")[0]),1)])),_:2},1024),r(p,{class:"text-[24rpx] font-500"},{default:o((()=>[c("."+i(_e(e).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==ve(e)?(l(),s(v,{key:0,class:"h-[24rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/VIP.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0),"discount_price"==ve(e)?(l(),s(v,{key:1,class:"h-[24rpx] ml-[6rpx]",src:k(z)("addon/phone_shop/discount.png"),mode:"heightFix"},null,8,["src"])):u("v-if",!0)])),_:2},1024),r(p,{class:"text-[22rpx] text-[#999]"},{default:o((()=>[c(" 库存"+i(e.goodsSku.stock)+i(e.unit),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"]))],64)))),256))])),_:1},8,["class"])):u("v-if",!0),!W.value.length&&ee.value?(l(),s(f,{key:1,class:"mx-[30rpx] mt-[20rpx] bg-[#fff] rounded-[16rpx] noData flex items-center justify-center"},{default:o((()=>[r(q,{option:{tip:"暂无商品"}})])),_:1})):u("v-if",!0)])),_:1},8,["onInit"]),u(" 小程序隐私协议 "),r(B,{ref:"wxPrivacyPopupRef"},null,512),r(H)])),_:1},8,["style"])}}}),[["__scopeId","data-v-b450e168"]]);export{W as default};
