import{d as e,q as a,bU as t,r as l,bI as r,a as s,g as n,by as p,h as o,b7 as d,aA as u,o as i,c,w as y,A as v,b as m,y as _,z as x,u as f,F as g,a7 as b,U as h,V as S,ad as k,E as w,f as C,t as I,i as T,ac as P,C as E,_ as R}from"./index-71c7df08.js";import{p as U,g as j}from"./pay.4cfa8889.js";const A=R(e({__name:"pay",emits:["close"],setup(e,{expose:R,emit:A}){a()&&t.init();const D=l(!1),O=l(!1),z=l(null),H=l(""),$=()=>{var e,l;uni.$u.test.isEmpty(H.value)?I({title:g("pay.notHavePayType"),icon:"none"}):O.value||(O.value=!0,U({trade_type:null==(e=z.value)?void 0:e.trade_type,trade_id:null==(l=z.value)?void 0:l.trade_id,type:H.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,n,p,o,d;switch(console.log(e),H.value){case"yinshengpay":uni.openEmbeddedMiniProgram({appId:"wx0b8ae52e31ccc08c",path:"pages/index/index",extraData:{businessData:e.data.businessData},success(e){}});case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{F()},cancel:()=>{O.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=z.value)?void 0:l.trade_type,trade_id:null==(r=z.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(n=z.value)?void 0:n.trade_type,trade_id:null==(p=z.value)?void 0:p.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(o=z.value)?void 0:o.trade_type,trade_id:null==(d=z.value)?void 0:d.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo"});F()}})).catch((()=>{O.value=!1})))};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const q=l(!1),F=()=>{var e,a;s({url:"/app/pages/pay/result",param:{trade_type:null==(e=z.value)?void 0:e.trade_type,trade_id:null==(a=z.value)?void 0:a.trade_id},mode:"redirectTo"})},M=()=>{uni.removeStorageSync("paymenting"),D.value=!1,A("close")};return R({open:(e,a,t="")=>{q.value||(q.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t)),j(e,a).then((e=>{let{data:a}=e;z.value=a,uni.$u.test.isEmpty(a)?I({title:g("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(H.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",D.value=!0,q.value=!1):F()})).catch((()=>{q.value=!1})))}}),(e,a)=>{const t=T,l=n(o("u-image"),p),r=n(o("u-icon"),d),s=P,I=E,R=n(o("u-popup"),u);return i(),c(R,{show:D.value,round:10,onClose:M,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:y((()=>[z.value?(i(),c(t,{key:0,class:"flex flex-col h-[75vh] popup-common",onTouchmove:a[0]||(a[0]=v((()=>{}),["prevent","stop"]))},{default:y((()=>[m(t,{class:"head"},{default:y((()=>[m(t,{class:"title"},{default:y((()=>[_(x(f(g)("pay.payTitle")),1)])),_:1}),m(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx] price-font"},{default:y((()=>[m(t,{class:"text-base mr-[4rpx]"},{default:y((()=>[_(x(f(g)("currency")),1)])),_:1}),_(" "+x(f(b)(z.value.money)),1)])),_:1})])),_:1}),m(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:y((()=>[m(t,{class:"flex text-[28rpx] px-[36rpx] py-[20rpx] mb-[10rpx]"},{default:y((()=>[m(t,{class:"text-[var(--text-color-light6)]"},{default:y((()=>[_(x(f(g)("pay.orderInfo")),1)])),_:1}),m(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:y((()=>[_(x(z.value.body),1)])),_:1})])),_:1}),m(t,{class:"mx-[var(--popup-sidebar-m)] px-[30rpx] bg-white rounded-[20rpx] bg-[var(--temp-bg)]"},{default:y((()=>[z.value.pay_type_list.length?(i(!0),h(S,{key:0},k(z.value.pay_type_list,((e,a)=>(i(),c(t,{class:"pay-item py-[30rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>H.value=e.key},{default:y((()=>[m(l,{src:f(w)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),m(t,{class:"flex-1 px-[20rpx] text-[28rpx] font-500"},{default:y((()=>[_(x(e.name),1)])),_:2},1024),e.key==H.value?(i(),c(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):C("v-if",!0)])),_:2},1032,["onClick"])))),128)):(i(),c(t,{key:1,class:"py-[30rpx] text-center text-[24rpx] text-gray-subtitle"},{default:y((()=>[_(x(f(g)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),m(t,{class:"btn-wrap"},{default:y((()=>[m(I,{class:"primary-btn-bg btn","hover-class":"none",loading:O.value,onClick:$},{default:y((()=>[_(x(f(g)("pay.confirmPay")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):C("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-8e1a7f4b"]]);export{A as _};
