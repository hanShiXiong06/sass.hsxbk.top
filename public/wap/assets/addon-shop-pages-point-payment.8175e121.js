import{d as e,r as t,aF as a,g as l,h as r,o as s,c as d,w as o,b as i,A as u,y as c,z as p,u as n,F as x,P as v,Q as _,a7 as f,R as m,f as y,a as g,i as b,D as k,a6 as h,C as w,_ as j,b7 as C,n as F,t as S,B as V,a5 as A,E as T,aG as E}from"./index-7bf68536.js";import{_ as R}from"./u--image.b3bf1d5c.js";import{_ as $}from"./u-alert.97ce073c.js";import{_ as z}from"./u-tabbar.d98653fa.js";import{_ as O}from"./pay.d2e850e8.js";import{o as D,d as I}from"./point.8ad0430b.js";import{_ as M,a as B}from"./invoice.vue_vue_type_script_setup_true_lang.a6ce1d0c.js";import{_ as U}from"./u-popup.be4bfacd.js";import{_ as G}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.e46f68ef.js";import"./u-icon.0c1c54c7.js";import"./u-transition.cdf87992.js";import"./u-safe-bottom.908eeae4.js";import"./pay.2db06871.js";import"./u-loading-icon.b37701e7.js";import"./u-empty.68b4529f.js";import"./order.3552570e.js";import"./u-form.78a4f7c2.js";import"./u-line.463a2a45.js";import"./u-input.09a5cedd.js";import"./uni-popup.3d2f7726.js";const J=e({__name:"address-list",emits:["confirm"],setup(e,{expose:j,emit:C}){const F=t(!1),S=t(!1),V=t(""),A=t({}),T=t([]);a({}).then((({data:e})=>{T.value=e,S.value=!1}));const E=(e,t=2)=>{uni.setStorage({key:"selectAddressCallback",data:{back:"/addon/shop/pages/point/payment",delivery:A.value.delivery},success(){g({url:"/app/pages/member/address_edit",param:{id:e.id,source:"shop_order_payment",isSelectMap:t}})}})},R=()=>{uni.setStorage({key:"selectAddressCallback",data:{back:"/addon/shop/pages/point/payment",delivery:A.value.delivery},success(){g({url:"/app/pages/member/address_edit",param:{source:"shop_order_payment"}})}})};return j({open:e=>{F.value=!0,A.value=e,V.value=e.id}}),(e,t)=>{const a=b,g=k,j=h,S=w,$=l(r("u-popup"),U);return s(),d($,{show:F.value,onClose:t[1]||(t[1]=e=>F.value=!1),mode:"bottom",round:10},{default:o((()=>[i(a,{onTouchmove:t[0]||(t[0]=u((()=>{}),["prevent","stop"])),class:"popup-common"},{default:o((()=>[i(a,{class:"title"},{default:o((()=>[c(p(n(x)("selectAddress")),1)])),_:1}),i(j,{"scroll-y":"true",class:"h-[50vh]"},{default:o((()=>[(s(!0),v(_,null,f(T.value,((e,t)=>(s(),d(a,{key:e.id,class:m(["flex items-center mx-[var(--popup-sidebar-m)] border-1 border-[#eee] border-solid rounded-[var(--rounded-mid)] px-[var(--pad-sidebar-m)] py-[var(--pad-top-m)]",{"mb-[var(--top-m)]":T.value.length-1!=t,"text-[var(--primary-color)] !border-[var(--primary-color)]":e.id==V.value}]),onClick:e=>(e=>{let t=T.value[e];if("local_delivery"!=A.value.delivery||t.lat||t.lng){let t={};t.address_id=T.value[e].id,t.delivery=A.value.delivery,C("confirm",t)}else E(t,1);F.value=!1})(t)},{default:o((()=>[i(g,{class:"nc-iconfont nc-icon-dingweiV6xx-1 text-[36rpx]"}),i(a,{class:"flex flex-col mx-[20rpx] w-[480rpx]"},{default:o((()=>[i(a,{class:"flex items-center truncate leading-[1.5]"},{default:o((()=>[i(g,{class:"mr-[8rpx] text-[30rpx] truncate max-w-[300rpx]"},{default:o((()=>[c(p(e.name),1)])),_:2},1024),i(g,{class:"text-[30rpx]"},{default:o((()=>[c(p(e.mobile),1)])),_:2},1024)])),_:2},1024),i(a,{class:"truncate text-[26rpx] leading-[1.5] mt-[12rpx]"},{default:o((()=>[c(p(e.full_address),1)])),_:2},1024)])),_:2},1024),i(g,{class:"nc-iconfont nc-icon-xiugaiV6xx text-[32rpx] ml-auto",onClick:t=>E(e)},null,8,["onClick"])])),_:2},1032,["class","onClick"])))),128)),!T.value||T.value&&!T.value.length?(s(),d(a,{key:0,class:"text-[var(--text-color-light6)] text-[28rpx] text-center"},{default:o((()=>[c(p(n(x)("emptyAddress")),1)])),_:1})):y("v-if",!0)])),_:1}),i(a,{class:"btn-wrap"},{default:o((()=>[i(S,{class:"primary-btn-bg btn",onClick:R},{default:o((()=>[c(p(n(x)("addAddress")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),N=G(e({__name:"payment",setup(e){const a=t({order_key:"",member_remark:"",discount:{},invoice:{},delivery:{delivery_type:""}}),u=t(null),x=t(),h=t(),U=t(),G=t(!1),N=t(0),P=t([]),Q=t();uni.getStorageSync("orderCreateData")&&Object.assign(a.value,uni.getStorageSync("orderCreateData"));const X=uni.getStorageSync("selectAddressCallback");X&&(a.value.order_key="",a.value.delivery.delivery_type=X.delivery,a.value.delivery.take_address_id=X.address_id,uni.removeStorage({key:"selectAddressCallback"}));const q=(e,t)=>{a.value.delivery.delivery_type!=e&&(N.value=t,a.value.order_key="",a.value.delivery.delivery_type=e,a.value.delivery.take_address_id=0,H())},H=()=>{D(a.value).then((({data:e})=>{u.value=e,a.value.order_key=e.order_key,u.value.delivery.delivery_type_list&&(P.value=Object.values(u.value.delivery.delivery_type_list)),X&&(N.value=P.value.findIndex((e=>e.key===u.value.delivery.delivery_type))),!a.value.delivery.delivery_type&&e.delivery.delivery_type&&(a.value.delivery.delivery_type=e.delivery.delivery_type)})).catch()};H(),j((()=>P.value.length),((e,t)=>{P.value.length&&uni.getStorageSync("distributionType")&&(P.value.forEach(((e,t)=>{e.name==uni.getStorageSync("distributionType")&&(N.value=t,q(e.key,t))})),uni.removeStorage({key:"distributionType"}))}));let K=0;const L=()=>{W()&&!G.value&&(G.value=!0,I(a.value).then((({data:e})=>{var t;K=e.order_id,0==u.value.basic.order_money?g({url:"/addon/shop/pages/order/detail",param:{order_id:K},mode:"redirectTo"}):null==(t=h.value)||t.open(e.trade_type,e.order_id,`/addon/shop/pages/order/detail?order_id=${e.order_id}`)})).catch((()=>{G.value=!1})))},W=()=>{const e=a.value;if(u.value.basic.has_goods_types.includes("real")){if(["express","local_delivery"].includes(e.delivery.delivery_type)&&!u.value.delivery.take_address)return S({title:"请选择收货地址",icon:"none"}),!1;if("store"==e.delivery.delivery_type&&!e.delivery.take_store_id)return S({title:"请选择自提点",icon:"none"}),!1}return!0},Y=()=>{g({url:"/addon/shop/pages/order/detail",param:{order_id:K},mode:"redirectTo"})},Z=()=>{let e={};e.delivery=a.value.delivery.delivery_type,e.type="local_delivery"==a.value.delivery.delivery_type?"location_address":"address",e.id=u.value.delivery.take_address.id,Q.value.open(e)},ee=e=>{a.value.delivery.take_store_id=e&&e.store_id?e.store_id:0,H()},te=e=>{a.value.invoice=e},ae=e=>{a.value.order_key="",a.value.delivery.delivery_type=e.delivery,a.value.delivery.take_address_id=e.address_id,H()};return(e,t)=>{const g=b,j=V,S=k,D=l(r("u--image"),R),I=l(r("u-alert"),$),G=A,X=w,H=l(r("u-tabbar"),z),K=l(r("pay"),O);return s(),d(g,{style:F(e.themeColor())},{default:o((()=>[u.value?(s(),d(g,{key:0,class:"bg-[var(--page-bg-color)] min-h-[100vh]"},{default:o((()=>[i(g,{class:"pt-[30rpx] sidebar-margin payment-bottom"},{default:o((()=>[y(" 配送方式 "),u.value.basic.has_goods_types.includes("real")&&P.value.length?(s(),d(g,{key:0,class:"mb-[var(--top-m)] rounded-[var(--rounded-big)] bg-white"},{default:o((()=>[P.value.length>1?(s(),d(g,{key:0,class:"rounded-tl-[var(--rounded-big)] rounded-tr-[var(--rounded-big)] head-tab flex items-center w-full bg-[#f1f1f1]"},{default:o((()=>[(s(!0),v(_,null,f(P.value,((e,t)=>(s(),d(g,{key:t,class:m(["head-tab-item flex-1 relative",{active:t===N.value}])},{default:o((()=>[i(g,{class:"h-[74rpx] relative z-10 text-center leading-[74rpx] text-[28rpx]",onClick:a=>q(e.key,t)},{default:o((()=>[c(p(e.name),1)])),_:2},1032,["onClick"]),t===N.value&&3==P.value.length?(s(),d(j,{key:0,class:"tab-image absolute bottom-[-2rpx] h-[94rpx] w-[240rpx]",src:n(T)(`addon/shop/payment/tab_${t}.png`),mode:"aspectFit"},null,8,["src"])):t===N.value&&2==P.value.length?(s(),d(j,{key:1,class:"tab-img absolute bottom-[-2rpx] h-[95rpx] w-[354rpx]",src:n(T)(`addon/shop/payment/tabstyle_${t}.png`),mode:"aspectFit"},null,8,["src"])):y("v-if",!0)])),_:2},1032,["class"])))),128))])),_:1})):y("v-if",!0),i(g,{class:"min-h-[140rpx] flex items-center px-[30rpx]"},{default:o((()=>[y(" 收货地址 "),["express","local_delivery"].includes(a.value.delivery.delivery_type)?(s(),d(g,{key:0,class:"w-full",onClick:Z},{default:o((()=>[e.$u.test.isEmpty(u.value.delivery.take_address)?(s(),d(g,{key:1,class:"flex items-center"},{default:o((()=>[i(j,{class:"w-[26rpx] h-[30rpx] mr-[10rpx]",src:n(T)("addon/shop/payment/position_02.png"),mode:"aspectFit"},null,8,["src"]),i(S,{class:"text-[28rpx]"},{default:o((()=>[c("添加收货地址")])),_:1}),i(S,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[var(--text-color-light9)] ml-auto"})])),_:1})):(s(),d(g,{key:0,class:"pt-[20rpx] pb-[30rpx] flex items-center"},{default:o((()=>[i(j,{class:"w-[60rpx] h-[60rpx] mr-[20rpx] flex-shrink-0",src:n(T)("addon/shop/payment/position_01.png"),mode:"aspectFit"},null,8,["src"]),i(g,{class:"flex flex-col overflow-hidden"},{default:o((()=>[i(S,{class:"text-[26rpx] text-[var(--text-color-light9)] mt-[16rpx] truncate max-w-[536rpx]"},{default:o((()=>[c(p(u.value.delivery.take_address.full_address.split(u.value.delivery.take_address.address)[0]),1)])),_:1}),i(S,{class:"font-500 text-[30rpx] mt-[14rpx] text-[#333] truncate max-w-[536rpx]"},{default:o((()=>[c(p(u.value.delivery.take_address.address),1)])),_:1}),i(g,{class:"flex items-center text-[26rpx] text-[var(--text-color-light6)] mt-[16rpx]"},{default:o((()=>[i(S,{class:"mr-[16rpx]"},{default:o((()=>[c(p(u.value.delivery.take_address.name),1)])),_:1}),i(S,null,{default:o((()=>[c(p(n(E)(u.value.delivery.take_address.mobile)),1)])),_:1})])),_:1})])),_:1}),i(S,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[var(--text-color-light9)]"})])),_:1}))])),_:1})):y("v-if",!0),y(" 自提点 "),"store"==a.value.delivery.delivery_type?(s(),d(g,{key:1,class:"flex items-center w-full flex items-center",onClick:t[0]||(t[0]=e=>x.value.open())},{default:o((()=>[e.$u.test.isEmpty(u.value.delivery.take_store)?(s(),d(g,{key:1,class:"flex items-center w-full"},{default:o((()=>[i(j,{class:"w-[26rpx] h-[30rpx] mr-[10rpx]",src:n(T)("addon/shop/payment/position_02.png"),mode:"aspectFit"},null,8,["src"]),i(S,{class:"text-[28rpx]"},{default:o((()=>[c("请选择自提点")])),_:1}),i(S,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[var(--text-color-light9)]"})])),_:1})):(s(),d(g,{key:0,class:"pt-[26rpx] pb-[30rpx] w-full flex items-centerv"},{default:o((()=>[i(g,{class:"flex flex-col"},{default:o((()=>[i(g,{class:"text-[30rpx] font-500 text-[#303133] mb-[20rpx]"},{default:o((()=>[c(p(u.value.delivery.take_store.store_name),1)])),_:1}),i(g,{class:"text-[24rpx] text-[var(--text-color-light6)] mb-[14rpx]"},{default:o((()=>[c("门店地址："+p(u.value.delivery.take_store.full_address),1)])),_:1}),i(g,{class:"text-[24rpx] text-[var(--text-color-light6)] mb-[14rpx]"},{default:o((()=>[c("联系电话："+p(u.value.delivery.take_store.store_mobile),1)])),_:1}),i(g,{class:"text-[24rpx] text-[var(--text-color-light6)]"},{default:o((()=>[c("营业时间："+p(u.value.delivery.take_store.trade_time),1)])),_:1})])),_:1}),i(S,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[var(--text-color-light9)]"})])),_:1}))])),_:1})):y("v-if",!0)])),_:1})])),_:1})):y("v-if",!0),u.value.basic.has_goods_types.includes("real")&&!P.value.length?(s(),d(g,{key:1,class:"mb-[var(--top-m)] card-template h-[100rpx] flex items-center"},{default:o((()=>[C("p",{class:"text-[28rpx] text-[var(--primary-color)]"},"商家尚未配置配送方式")])),_:1})):y("v-if",!0),i(g,{class:"mb-[var(--top-m)] card-template"},{default:o((()=>[i(g,{class:"mb-[30rpx]"},{default:o((()=>[(s(!0),v(_,null,f(u.value.goods_data,((e,t,a)=>(s(),d(g,{class:m(["flex",{"pb-[40rpx]":a+1!=Object.keys(u.value.goods_data).length}]),key:a},{default:o((()=>[i(D,{radius:"var(--goods-rounded-big)",width:"180rpx",height:"180rpx",src:n(T)(e.sku_image.split(",")[0]),model:"aspectFill"},{error:o((()=>[i(j,{class:"w-[180rpx] h-[180rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:n(T)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),i(g,{class:"flex flex-1 w-0 flex-col justify-between ml-[20rpx] py-[6rpx]"},{default:o((()=>[i(g,{class:"line-normal"},{default:o((()=>[i(g,{class:"truncate text-[#303133] text-[28rpx] leading-[32rpx]"},{default:o((()=>[c(p(e.goods.goods_name),1)])),_:2},1024),e.sku_name?(s(),d(g,{key:0,class:"mt-[14rpx] flex"},{default:o((()=>[i(S,{class:"truncate text-[24rpx] text-[var(--text-color-light9)] leading-[28rpx]"},{default:o((()=>[c(p(e.sku_name),1)])),_:2},1024)])),_:2},1024)):y("v-if",!0)])),_:2},1024),e.not_support_delivery?(s(),d(g,{key:0,class:m(["mb-auto",{"mt-[6rpx]":!e.sku_name}])},{default:o((()=>[i(I,{type:"error",description:"该商品不支持当前所选配送方式",class:"leading-[30rpx] !inline-block",fontSize:"11"})])),_:2},1032,["class"])):y("v-if",!0),i(g,{class:"flex justify-between items-baseline"},{default:o((()=>[i(g,{class:"text-[var(--price-text-color)] flex items-baseline price-font"},{default:o((()=>[i(g,{class:"flex items-baseline price-font"},{default:o((()=>[i(S,{class:"text-[40rpx] font-200"},{default:o((()=>[c(p(e.exchange_info.point),1)])),_:2},1024),i(S,{class:"text-[32rpx]"},{default:o((()=>[c("积分")])),_:1})])),_:2},1024),parseFloat(e.price)?(s(),v(_,{key:0},[i(S,{class:"mx-[4rpx] text-[32rpx]"},{default:o((()=>[c("+")])),_:1}),i(g,{class:"flex items-baseline price-font"},{default:o((()=>[i(S,{class:"text-[40rpx] font-200"},{default:o((()=>[c(p(parseFloat(e.price).toFixed(2)),1)])),_:2},1024),i(S,{class:"text-[32rpx]"},{default:o((()=>[c("元")])),_:1})])),_:2},1024)],64)):y("v-if",!0)])),_:2},1024),i(g,{class:"font-400 text-[28rpx] text-[#303133]"},{default:o((()=>[i(S,null,{default:o((()=>[c("x")])),_:1}),i(S,null,{default:o((()=>[c(p(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),y(" 买家留言 "),i(g,{class:"bg-white flex items-center leading-[30rpx]"},{default:o((()=>[i(g,{class:"text-[28rpx] w-[150rpx] text-[#303133]"},{default:o((()=>[c("买家留言")])),_:1}),i(g,{class:"flex-1 text-[#303133]"},{default:o((()=>[i(G,{type:"text",modelValue:a.value.member_remark,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.member_remark=e),class:"text-right text-[#333] text-[28rpx]",maxlength:"50",placeholder:"请输入留言信息给卖家","placeholder-class":"text-[var(--text-color-light9)] text-[28rpx]"},null,8,["modelValue"])])),_:1}),y(' <text class="nc-iconfont nc-icon-youV6xx text-[26rpx] text-[var(--text-color-light9)]"></text> ')])),_:1}),y(" 发票 "),U.value&&U.value.invoiceOpen?(s(),d(g,{key:0,class:"flex items-center text-[#303133] leading-[30rpx] mt-[30rpx]",onClick:t[2]||(t[2]=e=>U.value.open())},{default:o((()=>[i(g,{class:"text-[28rpx] w-[150rpx] text-[#303133]"},{default:o((()=>[c("发票信息")])),_:1}),i(g,{class:"flex-1 w-0 text-right truncate"},{default:o((()=>[i(S,{class:"text-[28rpx] text-[#333]"},{default:o((()=>[c(p(a.value.invoice.header_name||"不需要发票"),1)])),_:1})])),_:1}),i(S,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[var(--text-color-light9)]"})])),_:1})):y("v-if",!0)])),_:1}),i(g,{class:"card-template"},{default:o((()=>[i(g,{class:"title"},{default:o((()=>[c("价格明细")])),_:1}),i(g,{class:"card-template-item"},{default:o((()=>[i(g,{class:"text-[28rpx] w-[150rpx] leading-[30rpx] text-[#303133]"},{default:o((()=>[c("商品金额")])),_:1}),i(g,{class:"flex-1 w-0 text-right price-font text-[#333] text-[32rpx]"},{default:o((()=>[i(g,{class:"inline-block"},{default:o((()=>[i(S,{class:"text-[32rpx] mr-[2rpx]"},{default:o((()=>[c(p(u.value.basic.point_sum),1)])),_:1}),i(S,{class:"text-[30rpx]"},{default:o((()=>[c("积分")])),_:1})])),_:1}),u.value.basic&&parseFloat(u.value.basic.goods_money)?(s(),v(_,{key:0},[i(S,{class:"text-[28rpx] mx-[4rpx]"},{default:o((()=>[c("+")])),_:1}),i(g,{class:"inline-block"},{default:o((()=>[i(S,{class:"text-[32rpx] mr-[2rpx]"},{default:o((()=>[c(p(parseFloat(u.value.basic.goods_money).toFixed(2)),1)])),_:1}),i(S,{class:"text-[30rpx]"},{default:o((()=>[c("元")])),_:1})])),_:1})],64)):y("v-if",!0)])),_:1})])),_:1}),u.value.basic.delivery_money?(s(),d(g,{key:0,class:"card-template-item"},{default:o((()=>[i(g,{class:"text-[26rpx] w-[150rpx] leading-[30rpx] text-[#303133]"},{default:o((()=>[c("配送费用")])),_:1}),i(g,{class:"flex-1 w-0 text-right price-font text-[#333] text-[32rpx]"},{default:o((()=>[c(" ￥"+p(parseFloat(u.value.basic.delivery_money)),1)])),_:1})])),_:1})):y("v-if",!0),u.value.basic.discount_money?(s(),d(g,{key:1,class:"card-template-item"},{default:o((()=>[i(g,{class:"text-[26rpx] w-[150rpx] leading-[30rpx] text-[#303133]"},{default:o((()=>[c("优惠金额")])),_:1}),i(g,{class:"flex-1 w-0 text-right text-[var(--price-text-color)] text-[32rpx] price-font leading-[1]"},{default:o((()=>[c(" -￥"+p(parseFloat(u.value.basic.discount_money)),1)])),_:1})])),_:1})):y("v-if",!0)])),_:1})])),_:1}),i(H,{fixed:!0,placeholder:!0,safeAreaInsetBottom:!0},{default:o((()=>[i(g,{class:"flex-1 flex items-center justify-between pl-[30rpx] pr-[20rpx]"},{default:o((()=>[i(g,{class:"flex items-baseline"},{default:o((()=>[i(S,{class:"text-[26rpx] text-[#333] leading-[32rpx]"},{default:o((()=>[c("合计：")])),_:1}),i(S,{class:"text-[var(--price-text-color)] price-font inline-block"},{default:o((()=>[i(S,{class:"text-[44rpx]"},{default:o((()=>[c(p(u.value.basic.point_sum),1)])),_:1}),i(S,{class:"text-[38rpx]"},{default:o((()=>[c("积分")])),_:1})])),_:1}),u.value.basic&&parseFloat(u.value.basic.goods_money)?(s(),v(_,{key:0},[i(S,{class:"text-[38rpx] text-[var(--price-text-color)] price-font mx-[4rpx]"},{default:o((()=>[c("+")])),_:1}),i(g,{class:"inline-block"},{default:o((()=>[i(S,{class:"text-[44rpx] text-[var(--price-text-color)] price-font"},{default:o((()=>[c(p(parseFloat(u.value.basic.order_money).toFixed(2)),1)])),_:1}),i(S,{class:"text-[38rpx] text-[var(--price-text-color)] price-font"},{default:o((()=>[c("元")])),_:1})])),_:1})],64)):y("v-if",!0)])),_:1}),i(X,{class:"primary-btn-bg w-[196rpx] h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] !border-[0] rounded-[100rpx] m-0","hover-class":"none",onClick:L},{default:o((()=>[c("提交订单")])),_:1})])),_:1})])),_:1}),y(" 选择自提点 "),i(n(M),{ref_key:"storeRef",ref:x,onConfirm:ee},null,512),y(" 发票 "),i(n(B),{ref_key:"invoiceRef",ref:U,onConfirm:te},null,512),y(" 地址 "),i(n(J),{ref_key:"addressRef",ref:Q,onConfirm:ae},null,512),i(K,{ref_key:"payRef",ref:h,onClose:Y},null,512)])),_:1})):y("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-eb11700e"]]);export{N as default};
