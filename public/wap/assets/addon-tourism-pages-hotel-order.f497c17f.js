import{d as e,r as t,m as l,j as a,o,c as s,w as n,b as u,x as r,y as i,E as c,F as f,u as d,G as m,f as x,aN as p,n as _,aK as v,I as b,a as y,Y as g,C as h,i as j,g as C,h as k,a4 as w,N as V,V as F,H as S}from"./index-905183d4.js";import{_ as $}from"./u-form.7ae4e9da.js";import{_ as z}from"./u--input.f049e512.js";import{_ as D}from"./u--form.8d42ab01.js";import{_ as I}from"./u-picker.776b349c.js";import{_ as N}from"./u-popup.e3f6594b.js";import{_ as A}from"./pay.2560ca84.js";import{_ as E}from"./u-button.d3798ecb.js";import{_ as B}from"./u-parse.b0851c53.js";import{_ as O}from"./u-empty.09c683e5.js";import{_ as U}from"./u-loading-page.7aa0a449.js";import{n as H,o as K,p as P}from"./tourism.31e9949d.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.86a2aad0.js";import"./u-line.9e44f7cf.js";import"./u-input.07f64251.js";import"./u-loading-icon.c376267d.js";import"./u-transition.dbaca185.js";import"./u-safe-bottom.e94b03c1.js";import"./u-image.44c969ef.js";import"./pay.01186f9d.js";const G=T(e({__name:"order",setup(e){const T=t(null),G=t(!0),J=t(""),R=t(uni.getStorageSync("hotelCreateData")||{}),W=t(null),Y=t(!1),q=l((()=>{const e=[];for(let t=1;t<=W.value.goods_info.stock;t++)e.push({label:`${t}间`,id:t});return[e]})),L=t(!1);let M=t(!1);a((()=>{H(R.value).then((({data:e})=>{G.value=!1,W.value=e,ee()})).catch((e=>{J.value=e.msg,G.value=!1}))}));const Q=t(!1),X=()=>{if(Z()){if(Q.value)return;Q.value=!0;const e=uni.$u.deepClone(v(R.value));e.buyer_info=JSON.stringify(e.buyer_info),K(e).then((({data:e})=>{var t;null==(t=T.value)||t.open(e.trade_type,e.trade_id,`/addon/tourism/pages/order/detail?order_id=${e.trade_id}`),Q.value=!1})).catch((e=>{Q.value=!1,b({title:e.msg,icon:"none"})}))}},Z=()=>{let e=!0;for(let l=0;l<R.value.buyer_info.length;l++){const t=R.value.buyer_info[l];if(uni.$u.test.isEmpty(t.name)){e=!1,b({title:"请输入"+(l?`房间${l+1}的`:"")+"入住人姓名",icon:"none"});break}}if(!e)return!1;let t=R.value.buyer_info.map((e=>e.name));if(new Set(t).size!==t.length)return b({title:"入住人姓名不能重复",icon:"none"}),!1;if(uni.$u.test.isEmpty(R.value.mobile))return b({title:"请输入手机号",icon:"none"}),!1;return!!/^1[3-9]\d{9}$/.test(R.value.mobile)||(b({title:"请输入正确的手机号",icon:"none"}),!1)},ee=()=>{var e,t;R.value.buyer_info=[{name:""}],R.value.mobile="",W.value.start_time=le(null==(e=W.value)?void 0:e.start_time),W.value.end_time=le(null==(t=W.value)?void 0:t.end_time)},te=l((()=>W.value?W.value.goods_info.goods_attribute.split(","):[])),le=e=>{const t=new Date(e);return uni.$u.timeFormat(t,"mm月dd日 ")+["周日","周一","周二","周三","周四","周五","周六"][t.getDay()]},ae=e=>{R.value.num=e.value[0].id,Y.value=!1;for(let t=0;t<R.value.num;t++)null==R.value.buyer_info[t]&&(R.value.buyer_info[t]={name:""});R.value.buyer_info.length>R.value.num&&R.value.buyer_info.splice(R.value.num,R.value.buyer_info.length-R.value.num),G.value=!0,P(R.value).then((({data:e})=>{var t,l;W.value=e,W.value.start_time=le(null==(t=W.value)?void 0:t.start_time),W.value.end_time=le(null==(l=W.value)?void 0:l.end_time),G.value=!1})).catch((e=>{G.value=!1,b({title:e.msg,icon:"none"})}))},oe=()=>{y({url:"/addon/tourism/pages/order/list",mode:"redirectTo"})};let se=t({});const ne=()=>{se.value=W.value.goods_info,M.value=!0},ue=()=>{g()};return(e,t)=>{const l=h,a=j,v=C(k("u-form-item"),$),b=C(k("u--input"),z),y=C(k("u--form"),D),g=C(k("u-picker"),I),H=w,K=C(k("u-popup"),N),P=C(k("pay"),A),Z=C(k("u-button"),E),ee=V,le=C(k("u-parse"),B),re=C(k("u-empty"),O),ie=C(k("u-loading-page"),U);return o(),s(a,{style:_(e.themeColor())},{default:n((()=>[W.value?(o(),s(a,{key:0,class:"bg-[#f7f7f7] min-h-screen overflow-hidden"},{default:n((()=>[u(a,{class:"chunk-wrap pb-2 pt-2"},{default:n((()=>[u(a,{class:"chunk-head h-[88rpx]"},{default:n((()=>[u(l,null,{default:n((()=>[r(i(W.value.goods_info.goods_name),1)])),_:1}),u(a,{class:"text-[#797C8D] text-xs",onClick:ne},{default:n((()=>[u(l,{class:"!font-normal"},{default:n((()=>[r("房型详情")])),_:1}),u(l,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1}),u(a,{class:"text-[26rpx] text-[#19293F] font-bold mt-3"},{default:n((()=>[r(i(W.value.start_time)+" - "+i(W.value.end_time)+" 共"+i(W.value.days)+"晚",1)])),_:1}),u(a,{class:"house-type"},{default:n((()=>[(o(!0),c(m,null,f(d(te),(e=>(o(),s(l,{class:"house-type-item"},{default:n((()=>[r(i(e),1)])),_:2},1024)))),256))])),_:1}),u(a,{class:"border-0 border-t border-solid border-[#F2F2F2] mt-2 h-[80rpx] flex items-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-fengefuV6xx text-[#D1D7E0]"}),u(l,{class:"text-xs"},{default:n((()=>[r("入住时间：14:00以后 离店时间：12:00以前")])),_:1})])),_:1})])),_:1}),u(a,{class:"chunk-wrap"},{default:n((()=>[u(a,{class:"chunk-head"},{default:n((()=>[u(l,null,{default:n((()=>[r("入住信息")])),_:1})])),_:1}),u(a,{class:"py-2"},{default:n((()=>[u(y,{labelPosition:"left",ref:"form1",labelWidth:"90",labelStyle:{color:"#A3A3A3",fontSize:"14px"}},{default:n((()=>[u(v,{label:"房间数",prop:"userInfo.name",borderBottom:"",onClick:t[0]||(t[0]=e=>Y.value=!0)},{default:n((()=>[u(a,{class:"border-style relative"},{default:n((()=>[u(a,null,{default:n((()=>[r(i(R.value.num)+"间",1)])),_:1}),u(a,{class:"text-xs text-[#797C8D] absolute select-room"},{default:n((()=>[u(l,null,{default:n((()=>[r("选择")])),_:1}),u(l,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1})])),_:1}),(o(!0),c(m,null,f(R.value.num,(e=>(o(),s(v,{label:R.value.num>1?"房间"+e:"入住人",prop:"userInfo.name",borderBottom:""},{default:n((()=>[u(a,{class:"border-style"},{default:n((()=>[u(b,{border:"none",placeholder:"每间需要1位入住人姓名",placeholderClass:"text-sm",modelValue:R.value.buyer_info[e-1].name,"onUpdate:modelValue":t=>R.value.buyer_info[e-1].name=t},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["label"])))),256)),u(v,{label:"手机号",prop:"userInfo.name",borderBottom:""},{default:n((()=>[u(a,{class:"border-style !border-0"},{default:n((()=>[u(b,{border:"none",placeholder:"用于接收预订信息",placeholderClass:"text-sm",modelValue:R.value.mobile,"onUpdate:modelValue":t[1]||(t[1]=e=>R.value.mobile=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},512)])),_:1})])),_:1}),u(g,{show:Y.value,columns:d(q),keyName:"label",closeOnClickOverlay:!0,onCancel:t[2]||(t[2]=e=>Y.value=!1),onConfirm:ae,immediateChange:!0},null,8,["show","columns"]),u(K,{show:L.value,onClose:t[4]||(t[4]=e=>L.value=!1)},{default:n((()=>[u(a,{class:"text-base font-bold flex justify-center items-center h-[96rpx] px-[26rpx] bg-[#fff] relative"},{default:n((()=>[u(l,{class:"text-[30rpx]"},{default:n((()=>[r("费用明细")])),_:1}),u(l,{class:"nc-iconfont nc-icon-guanbiV6xx text-[#666] absolute text-[32rpx] right-[26rpx]",onClick:t[3]||(t[3]=e=>L.value=!1)})])),_:1}),u(H,{"scroll-y":"true",class:"max-h-[40vh]"},{default:n((()=>[u(a,{class:"flex px-[30rpx] mt-[20rpx]"},{default:n((()=>[u(a,{class:"font-bold"},{default:n((()=>[r("总价")])),_:1}),u(a,{class:"text-right flex-1 font-bold price-font"},{default:n((()=>[u(l,{class:"text-sm font-normal"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"text-[38rpx]"},{default:n((()=>{var e;return[r(i(null==(e=W.value.order_money)?void 0:e.toFixed(2)),1)]})),_:1})])),_:1})])),_:1}),(o(!0),c(m,null,f(W.value.order_items,((e,t)=>(o(),s(a,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:n((()=>[u(a,null,{default:n((()=>[r(i(e.year)+"-"+i(e.month)+"-"+i(e.day),1)])),_:2},1024),u(a,{class:"text-right flex-1"},{default:n((()=>[u(l,{class:"text-xs price-font"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"price-font"},{default:n((()=>[r(i(e.price),1)])),_:2},1024),u(l,{class:"mx-[10rpx]"},{default:n((()=>[r("x")])),_:1}),u(l,null,{default:n((()=>[r(i(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256)),u(a,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:n((()=>[u(a,null,{default:n((()=>[r(i(R.value.end_time)+" 离店日",1)])),_:1}),u(a,{class:"text-right flex-1"})])),_:1})])),_:1}),u(a,{class:"h-[150rpx]"})])),_:1},8,["show"]),u(P,{ref_key:"payRef",ref:T,onClose:oe},null,512),u(a,{class:"h-[148rpx] w-screen"}),u(a,{class:"bg-white p-3 fixed bottom-0 left-0 right-0 flex items-center justify-between z-10 shadow"},{default:n((()=>[u(a,{class:"text-[#FA6400] text-xs"},{default:n((()=>[u(l,null,{default:n((()=>[r("总价")])),_:1}),u(l,{class:"ml-[2rpx] price-font"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"text-[38rpx] price-font"},{default:n((()=>{var e;return[r(i(null==(e=W.value.order_money)?void 0:e.toFixed(2)),1)]})),_:1})])),_:1}),u(a,{class:"ml-auto mr-2",onClick:t[5]||(t[5]=e=>L.value=!L.value)},{default:n((()=>[u(l,{class:"text-[#686868] text-xs mr-1"},{default:n((()=>[r("明细")])),_:1}),u(l,{class:"nc-iconfont nc-icon-shangV6xx-1 text-[#C2C2C2] text-xs font-bold"})])),_:1}),u(Z,{text:"提交订单",color:"var(--primary-color)",shape:"circle",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"278rpx"},type:"primary",size:"16",loading:Q.value,onClick:X},null,8,["loading"])])),_:1}),x(" 酒店房型详情 "),u(K,{show:d(M),mode:"bottom",round:10,onClose:t[7]||(t[7]=e=>p(M)?M.value=!1:M=!1)},{default:n((()=>[u(a,{class:"flex flex-col rounded-t-3xl bg-[#f8f8f8] overflow-hidden relative z-10"},{default:n((()=>[u(a,{class:"text-base font-bold flex justify-between items-center h-[96rpx] px-[26rpx] bg-[#fff]"},{default:n((()=>[u(l,{class:"text-[30rpx]"},{default:n((()=>[r(i(d(se).goods_name),1)])),_:1}),u(l,{class:"nc-iconfont nc-icon-guanbiV6xx text-[32rpx] text-[#666]",onClick:t[6]||(t[6]=e=>p(M)?M.value=!1:M=!1)})])),_:1}),u(H,{class:"max-h-[60vh]","scroll-y":!0},{default:n((()=>[u(ee,{src:d(F)(d(se).goods_cover),class:"w-[750rpx] h-[218]",mode:"aspectFill"},null,8,["src"]),u(a,{class:"px-4 bg-[#fff]"},{default:n((()=>[u(a,{class:"flex justify-between border-0 border-b-1 border-[#F2F2F2] border-solid px-1 py-4"},{default:n((()=>[u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-chuangV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_bed||"双人床"),1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-loucengV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_floor||"1层"),1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-fangziV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_area||0)+"㎡",1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-jiamengV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).room_stay||1)+"人",1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-liebiaoV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(i(d(se).stock||0)+"间",1)])),_:1})])),_:1})])),_:1}),d(se).goods_attribute?(o(),s(a,{key:0,class:"flex items-center my-4"},{default:n((()=>[u(l,{class:"mr-2 text-sm"},{default:n((()=>[r("房间设施")])),_:1}),u(a,null,{default:n((()=>[(o(!0),c(m,null,f(d(se).goods_attribute.split(","),((e,t)=>{var a,u;return o(),s(l,{class:S(["mr-1 text-sm",{"class-select":t<(null==(u=null==(a=d(se).goods_attribute)?void 0:a.split(","))?void 0:u.length)-1}])},{default:n((()=>[r(i(e),1)])),_:2},1032,["class"])})),256))])),_:1})])),_:1})):x("v-if",!0)])),_:1}),u(a,{class:"mt-2 px-3 bg-[#fff]"},{default:n((()=>[u(a,{class:"border-0 border-b-1 border-[#F2F2F2] border-solid py-3 text-[30rpx] font-bold"},{default:n((()=>[r(" 房型详情 ")])),_:1}),u(a,{class:"py-3 px-1 scheduling-content"},{default:n((()=>[d(se).goods_content?(o(),s(le,{key:0,content:d(se).goods_content,tagStyle:{img:"vertical-align: top;"}},null,8,["content"])):(o(),s(a,{key:1},{default:n((()=>[r("暂无房型详情")])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})):x("v-if",!0),J.value?(o(),s(a,{key:1,class:"w-screen h-screen flex flex-col justify-center items-center"},{default:n((()=>[u(re,{icon:d(F)("static/resource/images/order_empty.png"),text:J.value},null,8,["icon","text"]),u(a,{class:"w-[240rpx] mt-[40rpx]"},{default:n((()=>[u(Z,{type:"primary",text:"返回上一页",shape:"circle",onClick:ue})])),_:1})])),_:1})):x("v-if",!0),u(ie,{loading:G.value,"loading-text":"","bg-color":"none",loadingColor:"var(--primary-color)",iconSize:"35"},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-207291bd"]]);export{G as default};
