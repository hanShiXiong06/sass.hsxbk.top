import{d as e,r as t,j as l,p as a,o as s,c as o,w as n,b as u,y as r,z as c,U as d,ad as f,u as i,V as x,f as m,cd as _,n as p,aV as v,t as b,a as y,Z as g,$ as h,D as C,i as k,g as w,h as V,ac as j,B as F,C as $,E as D,W as S,R as z,bm as A,ca as E,b$ as B,aA as I,bX as U,M as O,a$ as N,_ as R}from"./index-71c7df08.js";import{_ as W}from"./pay.6aa36878.js";import{_ as H}from"./loading-page.vue_vue_type_script_setup_true_lang.c7dc2256.js";import{n as J,o as L,p as M}from"./tourism.86990a9a.js";import"./pay.4cfa8889.js";const P=R(e({__name:"order",setup(e){const R=t(null),P=t(!0),T=t(""),X=t(uni.getStorageSync("hotelCreateData")||{}),Z=t(null),q=t(!1),G=l((()=>{const e=[];for(let t=1;t<=Z.value.goods_info.stock;t++)e.push({label:`${t}间`,id:t});return[e]})),K=t(!1);let Q=t(!1);a((()=>{J(X.value).then((({data:e})=>{P.value=!1,Z.value=e,le()})).catch((e=>{T.value=e.msg,P.value=!1}))}));const Y=t(!1),ee=()=>{if(te()){if(Y.value)return;Y.value=!0;const e=uni.$u.deepClone(v(X.value));e.buyer_info=JSON.stringify(e.buyer_info),L(e).then((({data:e})=>{var t;null==(t=R.value)||t.open(e.trade_type,e.trade_id,`/addon/tourism/pages/order/detail?order_id=${e.trade_id}`),Y.value=!1})).catch((e=>{Y.value=!1,b({title:e.msg,icon:"none"})}))}},te=()=>{let e=!0;for(let l=0;l<X.value.buyer_info.length;l++){const t=X.value.buyer_info[l];if(uni.$u.test.isEmpty(t.name)){e=!1,b({title:"请输入"+(l?`房间${l+1}的`:"")+"入住人姓名",icon:"none"});break}}if(!e)return!1;let t=X.value.buyer_info.map((e=>e.name));if(new Set(t).size!==t.length)return b({title:"入住人姓名不能重复",icon:"none"}),!1;if(uni.$u.test.isEmpty(X.value.mobile))return b({title:"请输入手机号",icon:"none"}),!1;return!!/^1[3-9]\d{9}$/.test(X.value.mobile)||(b({title:"请输入正确的手机号",icon:"none"}),!1)},le=()=>{var e,t;X.value.buyer_info=[{name:""}],X.value.mobile="",Z.value.start_time=se(null==(e=Z.value)?void 0:e.start_time),Z.value.end_time=se(null==(t=Z.value)?void 0:t.end_time)},ae=l((()=>Z.value?Z.value.goods_info.goods_attribute.split(","):[])),se=e=>{const t=new Date(e);return uni.$u.timeFormat(t,"mm月dd日 ")+["周日","周一","周二","周三","周四","周五","周六"][t.getDay()]},oe=e=>{X.value.num=e.value[0].id,q.value=!1;for(let t=0;t<X.value.num;t++)null==X.value.buyer_info[t]&&(X.value.buyer_info[t]={name:""});X.value.buyer_info.length>X.value.num&&X.value.buyer_info.splice(X.value.num,X.value.buyer_info.length-X.value.num),P.value=!0,M(X.value).then((({data:e})=>{var t,l;Z.value=e,Z.value.start_time=se(null==(t=Z.value)?void 0:t.start_time),Z.value.end_time=se(null==(l=Z.value)?void 0:l.end_time),P.value=!1})).catch((e=>{P.value=!1,b({title:e.msg,icon:"none"})}))},ne=()=>{y({url:"/addon/tourism/pages/order/list",mode:"redirectTo"})};let ue=t({});const re=()=>{ue.value=Z.value.goods_info,Q.value=!0},ce=()=>{g().length>1?h({delta:1}):y({url:"/addon/tourism/pages/index",mode:"reLaunch"})};return(e,t)=>{const l=C,a=k,v=w(V("u-form-item"),z),b=w(V("u--input"),A),y=w(V("u--form"),E),g=w(V("u-picker"),B),h=j,J=w(V("u-popup"),I),L=w(V("pay"),W),M=w(V("u-button"),U),te=F,le=w(V("u-parse"),O),se=w(V("u-empty"),N),de=$,fe=w(V("loading-page"),H);return s(),o(a,{style:p(e.themeColor())},{default:n((()=>[Z.value?(s(),o(a,{key:0,class:"bg-[#f7f7f7] min-h-screen overflow-hidden"},{default:n((()=>[u(a,{class:"chunk-wrap pb-2 pt-2"},{default:n((()=>[u(a,{class:"chunk-head h-[88rpx]"},{default:n((()=>[u(l,null,{default:n((()=>[r(c(Z.value.goods_info.goods_name),1)])),_:1}),u(a,{class:"text-[#797C8D] text-xs",onClick:re},{default:n((()=>[u(l,{class:"!font-normal"},{default:n((()=>[r("房型详情")])),_:1}),u(l,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1}),u(a,{class:"text-[26rpx] text-[#19293F] font-bold mt-3"},{default:n((()=>[r(c(Z.value.start_time)+" - "+c(Z.value.end_time)+" 共"+c(Z.value.days)+"晚",1)])),_:1}),u(a,{class:"house-type"},{default:n((()=>[(s(!0),d(x,null,f(i(ae),(e=>(s(),o(l,{class:"house-type-item"},{default:n((()=>[r(c(e),1)])),_:2},1024)))),256))])),_:1}),u(a,{class:"border-0 border-t border-solid border-[#F2F2F2] mt-2 h-[80rpx] flex items-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-fengefuV6xx text-[#D1D7E0]"}),u(l,{class:"text-xs"},{default:n((()=>[r("入住时间：14:00以后 离店时间：12:00以前")])),_:1})])),_:1})])),_:1}),u(a,{class:"chunk-wrap"},{default:n((()=>[u(a,{class:"chunk-head"},{default:n((()=>[u(l,null,{default:n((()=>[r("入住信息")])),_:1})])),_:1}),u(a,{class:"py-2"},{default:n((()=>[u(y,{labelPosition:"left",ref:"form1",labelWidth:"90",labelStyle:{color:"#A3A3A3",fontSize:"14px"}},{default:n((()=>[u(v,{label:"房间数",prop:"userInfo.name",borderBottom:"",onClick:t[0]||(t[0]=e=>q.value=!0)},{default:n((()=>[u(a,{class:"border-style relative"},{default:n((()=>[u(a,null,{default:n((()=>[r(c(X.value.num)+"间",1)])),_:1}),u(a,{class:"text-xs text-[#797C8D] absolute select-room"},{default:n((()=>[u(l,null,{default:n((()=>[r("选择")])),_:1}),u(l,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1})])),_:1}),(s(!0),d(x,null,f(X.value.num,(e=>(s(),o(v,{label:X.value.num>1?"房间"+e:"入住人",prop:"userInfo.name",borderBottom:""},{default:n((()=>[u(a,{class:"border-style"},{default:n((()=>[u(b,{border:"none",placeholder:"每间需要1位入住人姓名",placeholderClass:"text-sm",modelValue:X.value.buyer_info[e-1].name,"onUpdate:modelValue":t=>X.value.buyer_info[e-1].name=t},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["label"])))),256)),u(v,{label:"手机号",prop:"userInfo.name",borderBottom:""},{default:n((()=>[u(a,{class:"border-style !border-0"},{default:n((()=>[u(b,{border:"none",placeholder:"用于接收预订信息",placeholderClass:"text-sm",modelValue:X.value.mobile,"onUpdate:modelValue":t[1]||(t[1]=e=>X.value.mobile=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},512)])),_:1})])),_:1}),u(g,{show:q.value,columns:i(G),keyName:"label",closeOnClickOverlay:!0,onCancel:t[2]||(t[2]=e=>q.value=!1),onConfirm:oe,immediateChange:!0},null,8,["show","columns"]),u(J,{show:K.value,onClose:t[4]||(t[4]=e=>K.value=!1)},{default:n((()=>[u(a,{class:"text-base font-bold flex justify-center items-center h-[96rpx] px-[26rpx] bg-[#fff] relative"},{default:n((()=>[u(l,{class:"text-[30rpx]"},{default:n((()=>[r("费用明细")])),_:1}),u(l,{class:"nc-iconfont nc-icon-guanbiV6xx text-[var(--text-color-light6)] absolute text-[32rpx] right-[26rpx]",onClick:t[3]||(t[3]=e=>K.value=!1)})])),_:1}),u(h,{"scroll-y":"true",class:"max-h-[40vh]"},{default:n((()=>[u(a,{class:"flex px-[30rpx] mt-[20rpx]"},{default:n((()=>[u(a,{class:"font-bold"},{default:n((()=>[r("总价")])),_:1}),u(a,{class:"text-right flex-1 font-bold price-font"},{default:n((()=>[u(l,{class:"text-sm font-normal"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"text-[38rpx]"},{default:n((()=>{var e;return[r(c(null==(e=Z.value.order_money)?void 0:e.toFixed(2)),1)]})),_:1})])),_:1})])),_:1}),(s(!0),d(x,null,f(Z.value.order_items,((e,t)=>(s(),o(a,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:n((()=>[u(a,null,{default:n((()=>[r(c(e.year)+"-"+c(e.month)+"-"+c(e.day),1)])),_:2},1024),u(a,{class:"text-right flex-1"},{default:n((()=>[u(l,{class:"text-xs price-font"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"price-font"},{default:n((()=>[r(c(e.price),1)])),_:2},1024),u(l,{class:"mx-[10rpx]"},{default:n((()=>[r("x")])),_:1}),u(l,null,{default:n((()=>[r(c(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256)),u(a,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:n((()=>[u(a,null,{default:n((()=>[r(c(X.value.end_time)+" 离店日",1)])),_:1}),u(a,{class:"text-right flex-1"})])),_:1})])),_:1}),u(a,{class:"h-[150rpx]"})])),_:1},8,["show"]),u(L,{ref_key:"payRef",ref:R,onClose:ne},null,512),u(a,{class:"h-[148rpx] w-screen"}),u(a,{class:"bg-white p-3 fixed bottom-0 left-0 right-0 flex items-center justify-between z-10 shadow"},{default:n((()=>[u(a,{class:"text-[#FA6400] text-xs"},{default:n((()=>[u(l,null,{default:n((()=>[r("总价")])),_:1}),u(l,{class:"ml-[2rpx] price-font"},{default:n((()=>[r("￥")])),_:1}),u(l,{class:"text-[38rpx] price-font"},{default:n((()=>{var e;return[r(c(null==(e=Z.value.order_money)?void 0:e.toFixed(2)),1)]})),_:1})])),_:1}),u(a,{class:"ml-auto mr-2",onClick:t[5]||(t[5]=e=>K.value=!K.value)},{default:n((()=>[u(l,{class:"text-[#686868] text-xs mr-1"},{default:n((()=>[r("明细")])),_:1}),u(l,{class:"nc-iconfont nc-icon-shangV6xx-1 text-[#C2C2C2] text-xs font-bold"})])),_:1}),u(M,{text:"提交订单",color:"var(--primary-color)",shape:"circle",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"278rpx"},type:"primary",size:"16",loading:Y.value,onClick:ee},null,8,["loading"])])),_:1}),m(" 酒店房型详情 "),u(J,{show:i(Q),mode:"bottom",round:10,onClose:t[7]||(t[7]=e=>_(Q)?Q.value=!1:Q=!1)},{default:n((()=>[u(a,{class:"flex flex-col rounded-t-3xl bg-[#f8f8f8] overflow-hidden relative z-10"},{default:n((()=>[u(a,{class:"text-base font-bold flex justify-between items-center h-[96rpx] px-[26rpx] bg-[#fff]"},{default:n((()=>[u(l,{class:"text-[30rpx]"},{default:n((()=>[r(c(i(ue).goods_name),1)])),_:1}),u(l,{class:"nc-iconfont nc-icon-guanbiV6xx text-[32rpx] text-[var(--text-color-light6)]",onClick:t[6]||(t[6]=e=>_(Q)?Q.value=!1:Q=!1)})])),_:1}),u(h,{class:"max-h-[60vh]","scroll-y":!0},{default:n((()=>[u(te,{src:i(D)(i(ue).goods_cover),class:"w-[750rpx] h-[218]",mode:"aspectFill"},null,8,["src"]),u(a,{class:"px-4 bg-[#fff]"},{default:n((()=>[u(a,{class:"flex justify-between border-0 border-b-1 border-[#F2F2F2] border-solid px-1 py-4"},{default:n((()=>[u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-chuangV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(c(i(ue).room_bed||"双人床"),1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-loucengV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(c(i(ue).room_floor||"1层"),1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-fangziV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(c(i(ue).room_area||0)+"㎡",1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-jiamengV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(c(i(ue).room_stay||1)+"人",1)])),_:1})])),_:1}),u(a,{class:"flex flex-col items-center justify-center"},{default:n((()=>[u(l,{class:"nc-iconfont nc-icon-liebiaoV6xx text-[36rpx] text-[#555] mb-1"}),u(l,{class:"text-xs font-bold"},{default:n((()=>[r(c(i(ue).stock||0)+"间",1)])),_:1})])),_:1})])),_:1}),i(ue).goods_attribute?(s(),o(a,{key:0,class:"flex items-center my-4"},{default:n((()=>[u(l,{class:"mr-2 text-sm"},{default:n((()=>[r("房间设施")])),_:1}),u(a,null,{default:n((()=>[(s(!0),d(x,null,f(i(ue).goods_attribute.split(","),((e,t)=>{var a,u;return s(),o(l,{class:S(["mr-1 text-sm",{"class-select":t<(null==(u=null==(a=i(ue).goods_attribute)?void 0:a.split(","))?void 0:u.length)-1}])},{default:n((()=>[r(c(e),1)])),_:2},1032,["class"])})),256))])),_:1})])),_:1})):m("v-if",!0)])),_:1}),u(a,{class:"mt-2 px-3 bg-[#fff]"},{default:n((()=>[u(a,{class:"border-0 border-b-1 border-[#F2F2F2] border-solid py-3 text-[30rpx] font-bold"},{default:n((()=>[r(" 房型详情 ")])),_:1}),u(a,{class:"py-3 px-1 scheduling-content"},{default:n((()=>[i(ue).goods_content?(s(),o(le,{key:0,content:i(ue).goods_content,tagStyle:{img:"vertical-align: top;"}},null,8,["content"])):(s(),o(a,{key:1},{default:n((()=>[r("暂无房型详情")])),_:1}))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})):m("v-if",!0),T.value?(s(),o(a,{key:1,class:"w-screen h-screen flex flex-col justify-center items-center"},{default:n((()=>[u(se,{icon:i(D)("static/resource/images/order_empty.png"),text:T.value},null,8,["icon","text"]),u(a,{class:"w-[240rpx] mt-[40rpx]"},{default:n((()=>[u(de,{class:"bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:ce},{default:n((()=>[r("返回上一页")])),_:1})])),_:1})])),_:1})):m("v-if",!0),u(fe,{loading:P.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-b06ac3de"]]);export{P as default};
