import{d as e,r as a,p as l,a1 as t,j as r,o as s,c as u,w as o,b as d,u as n,y as p,z as i,f as x,n as c,A as f,P as _,a7 as m,Q as v,av as y,t as g,a as h,B as b,g as w,h as j,i as k,D as V,a6 as C,ag as N,a5 as A,c2 as F,C as U,ae as z,E as B}from"./index-7bf68536.js";import{_ as D}from"./u--image.b3bf1d5c.js";import{_ as E}from"./u-upload.ab11cc5c.js";import{_ as L,a as M}from"./u-radio-group.2aeaf438.js";import{_ as O}from"./u-popup.be4bfacd.js";import{g as P,c as S,d as T,e as I}from"./refund.fe7053ad.js";import{_ as Q}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.e46f68ef.js";import"./u-icon.0c1c54c7.js";import"./u-transition.cdf87992.js";import"./u-loading-icon.b37701e7.js";/* empty css                                                                 */import"./u-safe-bottom.908eeae4.js";const R=Q(e({__name:"edit_apply",setup(e){var Q;const R=a(null),Y=a({}),Z=a(0),q=a(0),G=a(!1),H=a({order_id:null==(Q=R.value)?void 0:Q.order_id,order_goods_id:Z.value,order_refund_no:"",refund_type:"",apply_money:"",reason:"",remark:"",voucher:[]}),J=a({}),K=a([]),W=a("");P().then((({data:e})=>{K.value=e,K.value&&K.value.length&&(W.value=K.value[0])})),l((e=>{Z.value=e.order_goods_id||0,S(e.order_refund_no).then((({data:e})=>{R.value=e,Y.value=e.order_goods,H.value.order_goods_id=e.order_goods_id,H.value.order_id=e.order_id,H.value.order_refund_no=e.order_refund_no,H.value.remark=e.remark,H.value.reason=e.reason,W.value=e.reason,H.value.voucher=e.voucher})),T({order_refund_no:e.order_refund_no}).then((e=>{J.value=e.data,H.value.apply_money=t(J.value.refund_money)}))}));const X=r((e=>function(e){return""==e||0==e?"70rpx":18*String(e).length+"rpx"})),$=e=>{H.value.refund_type=e,q.value=1},ee=r((()=>H.value.voucher.map((e=>({url:B(e)}))))),ae=e=>{e.file.forEach((e=>{y({filePath:e.url,name:"file"}).then((e=>{H.value.voucher.length<9&&H.value.voucher.push(e.data.url)})).catch((()=>{}))}))},le=e=>{H.value.voucher.splice(e.index,1)},te=a(!1),re=()=>H.value.reason?Number(H.value.apply_money).toFixed(2)<0?(g({title:"退款金额不能为0,保留两位小数",icon:"none"}),!1):Number(H.value.apply_money)>Number(J.value.refund_money)?(g({title:"退款金额不能大于可退款总额",icon:"none"}),!1):void(te.value||(te.value=!0,I(H.value).then((e=>{te.value=!1,setTimeout((()=>{h({url:"/addon/phone_shop/pages/order/detail",param:{order_id:H.value.order_id}})}),1e3)})).catch((()=>{te.value=!1})))):(g({title:"请选择退款原因",icon:"none"}),!1),se=()=>{H.value.reason=W.value,G.value=!1};return(e,a)=>{const l=b,t=w(j("u--image"),D),r=k,y=V,g=C,h=N,P=A,S=w(j("u-upload"),E),T=F,I=U,Q=w(j("u-radio"),L),Z=w(j("u-radio-group"),M),ue=w(j("u-popup"),O),oe=z;return s(),u(r,{style:c(e.themeColor())},{default:o((()=>[R.value?(s(),u(oe,{key:0,"indicator-dots":!1,autoplay:!1,"disable-touch":!0,current:q.value,class:"h-screen",duration:300},{default:o((()=>[d(h,null,{default:o((()=>[d(g,{"scroll-y":"true",class:"bg-page h-screen"},{default:o((()=>[d(r,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(r,{class:"flex py-[30rpx] border-0 !border-b !border-[#f5f5f5] border-solid"},{default:o((()=>[d(t,{width:"120rpx",height:"120rpx",src:n(B)(Y.value.sku_image),model:"aspectFill"},{error:o((()=>[d(l,{class:"w-[120rpx] h-[120rpx]",src:n(B)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:1},8,["src"]),d(r,{class:"flex flex-1 w-0 flex-col justify-between ml-[20rpx]"},{default:o((()=>[d(r,null,{default:o((()=>[d(r,{class:"text-ellipsis text-[#303133] text-sm leading-normal"},{default:o((()=>[p(i(Y.value.goods_name),1)])),_:1}),d(r,{class:"mt-[10rpx] text-[26rpx] text-gray-subtitle"},{default:o((()=>[p(i(Y.value.sku_name),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),d(r,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(r,{class:"py-[24rpx] flex items-center",onClick:a[0]||(a[0]=e=>$(1))},{default:o((()=>[d(r,{class:"flex-1"},{default:o((()=>[d(r,{class:"text-sm"},{default:o((()=>[p("仅退款")])),_:1}),"real"==Y.value.goods_type?(s(),u(r,{key:0,class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:o((()=>[p(" 未收到货，或与商家协商一致不用退货只退款")])),_:1})):"virtual"==Y.value.goods_type?(s(),u(r,{key:1,class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:o((()=>[p(" 与商家协商一致不用退货只退款")])),_:1})):x("v-if",!0)])),_:1}),d(y,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1}),"real"!=Y.value.goods_type||Y.value.delivery_status&&"wait_delivery"==Y.value.delivery_status?x("v-if",!0):(s(),u(r,{key:0,class:"py-[24rpx] flex items-center border-0 !border-t !border-[#f5f5f5] border-solid",onClick:a[1]||(a[1]=e=>$(2))},{default:o((()=>[d(r,{class:"flex-1"},{default:o((()=>[d(r,{class:"text-sm"},{default:o((()=>[p("退货退款")])),_:1}),d(r,{class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:o((()=>[p("已收到货，需退还收到的货物")])),_:1})])),_:1}),d(y,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1}))])),_:1})])),_:1})])),_:1}),d(h,null,{default:o((()=>[d(g,{"scroll-y":"true",class:"bg-page h-screen"},{default:o((()=>[d(r,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(r,{class:"py-[24rpx] flex justify-between items-center"},{default:o((()=>[d(r,{class:"text-sm"},{default:o((()=>[p("退款原因")])),_:1}),d(r,{class:"flex items-center",onClick:a[2]||(a[2]=e=>G.value=!0)},{default:o((()=>[d(r,{class:"flex-1 text-right"},{default:o((()=>[d(r,{class:"text-xs text-gray-subtitle truncate w-[460rpx]"},{default:o((()=>[p(i(H.value.reason||"请选择"),1)])),_:1})])),_:1}),d(y,{class:"nc-iconfont nc-icon-youV6xx text-[30rpx] text-[#999]"})])),_:1})])),_:1})])),_:1}),d(r,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(r,{class:"py-[24rpx] flex items-center"},{default:o((()=>[d(r,{class:"text-sm"},{default:o((()=>[p("退款金额")])),_:1}),d(r,{class:"flex-1 text-right"},{default:o((()=>[d(r,{class:"flex justify-end items-center"},{default:o((()=>[d(y,{class:"font-bold text-sm leading-none"},{default:o((()=>[p("￥")])),_:1}),d(P,{type:"digit",modelValue:H.value.apply_money,"onUpdate:modelValue":a[3]||(a[3]=e=>H.value.apply_money=e),modelModifiers:{number:!0},class:"font-bold text-sm leading-none",style:c({width:n(X)(H.value.apply_money)})},null,8,["modelValue","style"])])),_:1}),d(r,{class:"text-xs text-gray-subtitle mt-[10rpx]"},{default:o((()=>[d(y,null,{default:o((()=>[p("最多可输入金额￥"+i(J.value.refund_money),1)])),_:1}),1===J.value.is_refund_delivery&&Number(J.value.refund_delivery_money)>0?(s(),u(y,{key:0,class:"ml-[10rpx]"},{default:o((()=>[p("(包含运费￥"+i(J.value.refund_delivery_money)+")",1)])),_:1})):x("v-if",!0)])),_:1})])),_:1})])),_:1})])),_:1}),d(r,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(r,{class:"py-[24rpx]"},{default:o((()=>[d(r,{class:"text-sm"},{default:o((()=>[p("上传凭证"),d(y,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:o((()=>[p("选填")])),_:1})])),_:1}),d(r,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx]"},{default:o((()=>[d(S,{fileList:n(ee),onAfterRead:ae,onDelete:le,multiple:"",maxCount:9},null,8,["fileList"])])),_:1})])),_:1})])),_:1}),d(r,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:o((()=>[d(r,{class:"py-[24rpx]"},{default:o((()=>[d(r,{class:"text-sm"},{default:o((()=>[p("补充描述"),d(y,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:o((()=>[p("选填")])),_:1})])),_:1}),d(r,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx] h-[200rpx]"},{default:o((()=>[d(T,{modelValue:H.value.remark,"onUpdate:modelValue":a[4]||(a[4]=e=>H.value.remark=e),cols:"30",rows:"5",placeholder:"补充描述,有助于更好的处理售后问题","placeholder-class":"text-sm"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),d(r,{class:"mt-[40rpx] m-[24rpx]"},{default:o((()=>[d(I,{class:"bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:re,loading:te.value},{default:o((()=>[p("提交")])),_:1},8,["loading"])])),_:1}),x(" 退款原因 "),d(ue,{show:G.value,onClose:e.close,onOpen:e.open},{default:o((()=>[d(r,{class:"px-[30rpx] pb-[30rpx]",onTouchmove:a[7]||(a[7]=f((()=>{}),["prevent","stop"]))},{default:o((()=>[d(r,{class:"flex items-center h-[90rpx] justify-between"},{default:o((()=>[d(y,null,{default:o((()=>[p("退款原因")])),_:1}),d(y,{class:"nc-iconfont nc-icon-guanbiV6xx",onClick:a[5]||(a[5]=e=>G.value=!1)})])),_:1}),d(g,{"scroll-y":"true",class:"h-[450rpx] mt-[20rpx]"},{default:o((()=>[d(Z,{modelValue:W.value,"onUpdate:modelValue":a[6]||(a[6]=e=>W.value=e),placement:"column"},{default:o((()=>[(s(!0),_(v,null,m(K.value,((e,a)=>(s(),u(Q,{activeColor:"var(--primary-color)",customStyle:{marginBottom:"8px"},key:a,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),d(I,{class:"mt-[40rpx] bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:se},{default:o((()=>[p("确定")])),_:1})])),_:1})])),_:1},8,["show","onClose","onOpen"])])),_:1})])),_:1})])),_:1},8,["current"])):x("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-49a215eb"]]);export{R as default};
