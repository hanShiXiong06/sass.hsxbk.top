import{d as e,r as a,T as t,E as l,o as s,c as u,w as r,b as o,y as d,u as i,f as n,n as c,au as m,a as p,i as f,g as x,h as v,D as _,Q as b,R as g,ax as h,aU as w,bX as y,S as q,_ as V}from"./index-71c7df08.js";import{c as C,m as R}from"./member.822e7467.js";const T=V(e({__name:"bind-wx",setup(e){const V=a(!1),T=a([]),I=a({wx_id:"",wx_qrcode:"",status:1});let D=a(!0);t((()=>{setTimeout((()=>{D.value=!1}),800),z()}));const U={wx_id:[{type:"string",required:!0,message:"请输入微信号",trigger:["blur","change"]}],wx_qrcode:{type:"string",required:!0,message:"请上传微信二维码",trigger:["change"]}},W=e=>{I.value.status=e},j=e=>{T.value.splice(e.index,1)},k=async e=>{let a=[].concat(e.file),t=T.value.length;a.map((e=>{T.value.push({...e,status:"uploading",message:"上传中"})}));for(let l=0;l<a.length;l++){const e=await L(a[l].url);1==e.code&&(I.value.wx_qrcode=e.data.url);let s=T.value[t];T.value.splice(t,1,{...s,status:1==e.code?"success":"failed",message:1==e.code?"":e.msg,url:e.data.url}),t++}},L=async e=>{let a=!1;return await m({filePath:e,name:"file"}).then((e=>{a=e})).catch((e=>{a=e})),a},P=a(null),z=()=>{C().then((e=>{e.data.id&&(I.value=e.data,T.value[0]={url:l(e.data.wx_qrcode)})}))},A=()=>{P.value.validate().then((()=>{V.value||(V.value=!0,R(I.value).then((e=>{V.value=!1,p({url:"/app/pages/member/index",mode:"redirectTo"})})).catch((()=>{V.value=!1})))}))};return(e,a)=>{const t=f,l=x(v("u-input"),b),m=x(v("u-form-item"),g),p=x(v("u-upload"),h),C=x(v("up-switch"),w),R=_,L=x(v("u-button"),y),z=x(v("u-form"),q);return s(),u(t,{class:"w-screen h-screen flex flex-col",style:c(e.themeColor())},{default:r((()=>[o(t,{class:"flex-1"},{default:r((()=>[o(t,{class:"h-[100rpx]"}),o(t,{class:"px-[60rpx] pt-[100rpx] mb-[100rpx]"},{default:r((()=>[o(t,{class:"font-bold text-lg"},{default:r((()=>[d("绑定微信")])),_:1})])),_:1}),o(t,{class:"px-[60rpx]"},{default:r((()=>[o(z,{labelPosition:"left",model:I.value,errorType:"toast",rules:U,ref_key:"formRef",ref:P},{default:r((()=>[o(m,{labelWidth:"100",label:"微信号",prop:"wx_id","border-bottom":!0,required:"true"},{default:r((()=>[o(l,{modelValue:I.value.wx_id,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value.wx_id=e),border:"none",clearable:"",placeholder:"请输入微信号",class:"!bg-transparent",disabled:i(D)},null,8,["modelValue","disabled"])])),_:1}),n(' <u-form-item label="" prop="wx_qrcode" :border-bottom="true">\n\t\t\t\t\t\t<u-upload @afterRead="afterRead" :maxCount="1">\n\t\t\t\t\t\t\t<u-avatar :src="img(formData.wx_qrcode)" size="60" leftIcon="none"></u-avatar>\n\t\t\t\t\t\t\t<view class="text-primary text-sm mt-[10rpx]">{{ t(\'updateHeadimg\') }}</view>\n\t\t\t\t\t\t</u-upload>\n\t\t\t\t\t</u-form-item> '),o(m,{label:"二维码",prop:"wx_qrcode",labelWidth:"100",required:"true"},{default:r((()=>[o(p,{uploadIcon:"photo-fill",accept:"image",fileList:T.value,onAfterRead:k,maxCount:1,onDelete:j,previewFullImage:!0},null,8,["fileList"])])),_:1}),o(m,{labelWidth:"100",label:"是否显示",prop:"status","border-bottom":!0},{default:r((()=>[o(C,{activeValue:1,inactiveValue:0,modelValue:I.value.status,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value.status=e),onChange:W},null,8,["modelValue"])])),_:1}),o(R,{class:"text-[12px] text-gray-subtitle"},{default:r((()=>[d("开启后，你的下级可以通过以上信息添加您的微信")])),_:1}),o(t,{class:"mt-[60rpx]"},{default:r((()=>[o(L,{type:"primary",text:"绑定",loading:V.value,loadingText:"绑定中",onClick:A},null,8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1},8,["style"])}}}),[["__scopeId","data-v-9f7fae12"]]);export{T as default};
