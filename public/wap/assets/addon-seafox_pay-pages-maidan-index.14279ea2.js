import{bG as e,_ as t,bf as s,t as l,o as a,c as i,w as n,b as o,n as r,y as d,z as c,f as h,W as y,A as f,bn as u,U as p,V as m,D as g,i as _,d as x,r as k,p as b,a4 as v,B as w,cq as z,g as S,h as C}from"./index-71c7df08.js";import{_ as K}from"./pay.6aa36878.js";import"./pay.4cfa8889.js";const P=t({name:"keyBoard",props:{confirmText:{default:"充值",type:String},btnColor:{default:"#2B76EF",type:String},placeholder:{default:"请输入充值金额",type:String},currency:{default:"￥",type:String},maxNumber:{default:1e11,type:Number},fontSize:{type:[String,Number],default:30},isBold:{type:Boolean,default:!0},isFilter:{type:Boolean,default:!0}},data:()=>({fristShow:!0,isShow:!1,size:0,height:0,allWidth:0,money:""}),created(){this.height=this.fontSize,this.size=this.fontSize;var e=s().in(this);setTimeout((()=>{this.show(),e.select(".keyboard-content").boundingClientRect((e=>{this.allWidth=e.width})).exec()}),200)},watch:{money(e){this.$emit("change",parseFloat(e))}},methods:{show(){this.isShow=!0},hide(){},filterMoney:e=>e?(e=e.replace(/\$\s?|(,*)/g,"")).replace(/\B(?=(\d{3})+(?!\d))/g,","):"",_handleKeyPress(e){if(-1==e)return!1;switch(String(e)){case".":this._handleDecimalPoint();break;case"delete":this._handleDeleteKey();break;case"confirm":this._handleConfirmKey();break;default:this._handleNumberKey(e)}},_handleDecimalPoint(){if(this.money.indexOf(".")>-1)return!1;this.money.length?this.money=this.money+".":this.money="0.",s().in(this).select("#text").boundingClientRect((e=>{e.width+Number(this.size)>this.allWidth&&(this.size-=5)})).exec()},_handleDeleteKey(){let e=this.money;if(!e.length)return!1;this.money=e.substring(0,e.length-1),s().in(this).select("#input-text").boundingClientRect((e=>{e.width+20<this.allWidth&&this.size<this.height&&(this.size+=5)})).exec()},_handleNumberKey(e){if(Number(this.money+e)>this.maxNumber)return;let t=this.money;if(t.indexOf(".")>-1&&t.substring(t.indexOf(".")+1).length<2&&(this.money=t+e),!(t.indexOf(".")>-1&&t.substring(t.indexOf(".")+1).length>=2)){if(!(t.indexOf(".")>-1))if(0==e&&0==t.length)this.money="0.";else{if(t.length&&0===Number(t.charAt(0)))return;this.money=t+e}s().in(this).select("#text").boundingClientRect((e=>{e.width+Number(this.size)>this.allWidth&&(this.size-=5)})).exec()}},_handleConfirmKey(){let e=this.money;if(!e.length||0==e)return l({title:this.placeholder,icon:"none",duration:1e3}),!1;e.indexOf(".")>-1&&e.indexOf(".")==e.length-1&&(e=Number(e.substring(0,e.length-1)).toFixed(2)),e=Number(e).toFixed(2),this.$emit("confirm",parseFloat(e))}}},[["render",function(e,t,s,l,x,k){const b=g,v=_;return a(),i(v,{class:"keyboard-main",style:r([{height:x.height+"px"},{background:"#fff",padding:"20rpx"}])},{default:n((()=>[o(b,{style:r([{"margin-top":"10px"},{fontSize:parseInt(s.fontSize/3*2)+"px"}])},{default:n((()=>[d(c(s.currency),1)])),_:1},8,["style"]),o(v,{class:"keyboard-content",style:r({height:x.height+"px"})},{default:n((()=>[x.money?h("v-if",!0):(a(),i(v,{key:0,class:"placeholder",style:r({fontSize:parseInt(s.fontSize/3*2)+"px",height:x.height+"px"})},{default:n((()=>[d(c(s.placeholder),1)])),_:1},8,["style"])),o(v,{class:y(["input",{zIndex:x.isShow}]),style:r({fontSize:x.size+"px",fontWeight:s.isBold?"bold":"initial"}),onClick:f(k.show,["stop"])},{default:n((()=>[u("span",{id:"text",style:{"margin-top":"-12px"}},[s.isFilter?(a(),p(m,{key:0},[d(c(k.filterMoney(x.money)),1)],64)):h("v-if",!0),s.isFilter?h("v-if",!0):(a(),p(m,{key:1},[d(c(x.money),1)],64)),h(' <view class="line" style="margin-top:-212px" :style="{height:parseInt((height/4*3))+\'px\',\'background\':btnColor}"></view> ')])])),_:1},8,["class","style","onClick"])])),_:1},8,["style"]),h(' <view class="mask" @click.stop="hide" v-if="isShow"></view> '),o(v,{class:y(["keyboard",{noPadding:!x.isShow}])},{default:n((()=>[x.isShow?(a(),i(v,{key:0,class:"key-row"},{default:n((()=>[o(v,{class:"key-cell",onClick:t[0]||(t[0]=f((e=>k._handleKeyPress(1)),["stop"]))},{default:n((()=>[d("1")])),_:1}),o(v,{class:"key-cell",onClick:t[1]||(t[1]=f((e=>k._handleKeyPress(2)),["stop"]))},{default:n((()=>[d("2")])),_:1}),o(v,{class:"key-cell",onClick:t[2]||(t[2]=f((e=>k._handleKeyPress(3)),["stop"]))},{default:n((()=>[d("3")])),_:1}),o(v,{class:"key-cell last-child",onClick:t[3]||(t[3]=f((e=>k._handleKeyPress("delete")),["stop"]))},{default:n((()=>[d(" 删除 "),h(' <image class="icon" src="../../static/fx-amountInput/backspace.png" mode="aspectFill"></image> ')])),_:1})])),_:1})):h("v-if",!0),x.isShow?(a(),i(v,{key:1,class:"key-row"},{default:n((()=>[o(v,{class:"key-cell",onClick:t[4]||(t[4]=f((e=>k._handleKeyPress(4)),["stop"]))},{default:n((()=>[d("4")])),_:1}),o(v,{class:"key-cell",onClick:t[5]||(t[5]=f((e=>k._handleKeyPress(5)),["stop"]))},{default:n((()=>[d("5")])),_:1}),o(v,{class:"key-cell",onClick:t[6]||(t[6]=f((e=>k._handleKeyPress(6)),["stop"]))},{default:n((()=>[d("6")])),_:1}),o(v,{class:"key-cell last-child"})])),_:1})):h("v-if",!0),x.isShow?(a(),i(v,{key:2,class:"key-row"},{default:n((()=>[o(v,{class:"key-cell",onClick:t[7]||(t[7]=f((e=>k._handleKeyPress(7)),["stop"]))},{default:n((()=>[d("7")])),_:1}),o(v,{class:"key-cell",onClick:t[8]||(t[8]=f((e=>k._handleKeyPress(8)),["stop"]))},{default:n((()=>[d("8")])),_:1}),o(v,{class:"key-cell",onClick:t[9]||(t[9]=f((e=>k._handleKeyPress(9)),["stop"]))},{default:n((()=>[d("9")])),_:1}),o(v,{class:"key-cell last-child"})])),_:1})):h("v-if",!0),x.isShow?(a(),i(v,{key:3,class:"key-zero-and-point"},{default:n((()=>[o(v,{class:"a zero",onClick:t[10]||(t[10]=f((e=>k._handleKeyPress(0)),["stop"]))},{default:n((()=>[d("0")])),_:1}),o(v,{class:"a point",onClick:t[11]||(t[11]=f((e=>k._handleKeyPress(".")),["stop"]))},{default:n((()=>[d(".")])),_:1}),o(v,{class:"a last-child"})])),_:1})):h("v-if",!0),o(v,{class:y(["key-confirm",{big:x.isShow,frist:x.fristShow}]),style:r({background:s.btnColor}),onClick:t[12]||(t[12]=f((e=>k._handleKeyPress("confirm")),["stop"]))},{default:n((()=>[d(c(s.confirmText),1)])),_:1},8,["class","style"])])),_:1},8,["class"]),h(" <view id=\"input-text\" :style=\"{fontSize:(size+5)+'px',fontWeight:isBold?'bold':'initial'}\">\n\t\t\t{{filterMoney(money)}}\n\t\t</view> ")])),_:1},8,["style"])}],["__scopeId","data-v-c3dfd4e8"]]),N=t(x({__name:"index",setup(t){k({trade_type:"",trade_id:""});const s=k(),i=k(""),r=k({logo:"",name:""});b((e=>{console.log(e,e.merchant_id,"query"),i.value=e.merchant_id||1,f.value=e.amount||"",y()}));const y=()=>{var t;(t={merchant_id:i.value},e.get("seafox_pay/maidan/info",t,{showErrorMessage:!0})).then((e=>{r.value=e.data})).catch((()=>{}))},f=k(""),u=k(!0),g=k(!1);setTimeout((function(){u.value=!1,g.value=!0}),600);const x=e=>{console.log(e),f.value=e+""};v(f,((e,t)=>{var s=e;Number(s)>1e8?f.value=s.slice(0,8):("."==s.slice(0,1)&&(s=""),(s=(s=(s=s.replace(/\.{2,}/g,".")).replace(".","$#$").replace(/\./g,"").replace("$#$",".")).replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf("."),f.value=s)}));const N=()=>{var t;(g.value=!0,console.log(f.value),F())&&(t={money:f.value,merchant_id:i.value},e.post("seafox_pay/maidan/order",t,{showErrorMessage:!0})).then((e=>{var t;e.order_id,null==(t=s.value)||t.open(e.data.trade_type,e.data.trade_id,"/addon/seafox_pay/pages/maidan/index")})).catch((()=>{}))},F=()=>{f.value;return!(!Number(f.value)||Number(f.value)<.01)||(l({title:"请输入金额",icon:"none"}),!1)},$=e=>{console.log(e)};return(e,t)=>{const l=w,i=_,y=z,f=S(C("pay"),K);return a(),p(m,null,[o(i,{style:{position:"relative","z-index":"3"}},{default:n((()=>[o(i,{style:{display:"flex","flex-direction":"column",margin:"100rpx 0 50rpx","align-items":"center"}},{default:n((()=>[o(l,{src:r.value.logo||"",style:{"border-radius":"50%",width:"150rpx",height:"150rpx"},mode:"aspectFill"},null,8,["src"]),o(i,{style:{"margin-top":"20rpx","font-size":"16px"}},{default:n((()=>[d(c(r.value.name||""),1)])),_:1})])),_:1}),h(' <view style="background: #fff;margin: 50rpx 3%;padding: 20rpx 3%;flex:1;font-size: 20px;" @click="openKeyboard()">\n\t\t\t<span style="margin-right: 20rpx;">￥</span>\n\t\t\t<span v-if="amount" style="font-weight: bold;">{{amount}}</span>\n\t\t\t<span v-else style="color: #999;">输入金额</span>\n\t\t</view> '),o(P,{confirmText:"支付",placeholder:"请输入金额",fontSize:30,isFilter:!0,onConfirm:N,onChange:x}),o(y,{url:"/addon/seafox_pay/pages/maidan/order",style:{"text-align":"center","margin-top":"150rpx",color:"#1677ff","font-size":"14px"}},{default:n((()=>[d("买单记录")])),_:1})])),_:1}),h(' <button @click="openKeyboard" v-if="!loading&&!showKeyboard">支付</button> '),h(' <tn-keyboard mode="digit" z-index="0" :vibrate="false" :overlay-closeable="false" v-model="amount" v-model:show="showKeyboard" @confirm="topay" /> '),o(f,{ref_key:"payRef",ref:s,onClose:$},null,512)],64)}}}),[["__scopeId","data-v-308d4965"]]);export{N as default};
