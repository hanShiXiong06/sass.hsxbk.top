import{d as e,r as a,L as t,j as l,p as s,F as r,K as u,s as o,H as d,x as n,o as i,c,w as p,P as x,b as f,y as m,z as _,u as v,f as g,Q as b,a7 as k,R as y,n as h,a as j,t as w,D as T,i as C,C as F,g as I,h as O,E,A as V,B as A,a5 as B}from"./index-7bf68536.js";import{_ as z}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{h as G,u as D}from"./card.83abd190.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-page.566c330a.js";import"./u-loading-icon.b37701e7.js";import"./u-transition.cdf87992.js";const R=L(e({__name:"use_goods_select",setup(e){const L=a({}),R=a(!0),S=a(!1),U=t({card_id:"",sku_data:[]}),H=a({}),K=l((()=>{let e=0;return Object.values(H.value).forEach((a=>{e+=parseInt(a.num||0)})),e}));s((e=>{if(e.card_id){if(!o())return d().setLoginBack({url:"/addon/shop_giftcard/pages/use_goods_select",param:{card_id:e.card_id}}),!1;U.card_id=e.card_id,Q(e.card_id)}else{let e={url:"/addon/shop_giftcard/pages/index",title:r("notCard"),mode:"reLaunch"};u(e)}})),n((()=>{Object.keys(L.value).length&&Q(L.value.card_id)}));const P=a(!1),Q=e=>{R.value=!0,H.value={},G(e).then((e=>{L.value=e.data,P.value=!1,e.data.cardGoods.forEach((e=>{let a=0;a="diy"==L.value.giftcard.card_goods_type?L.value.total_num-L.value.use_num:e.total_num-e.use_num,H.value[e.sku_id]={sku_id:e.sku_id,max_num:a>e.stock?parseInt(e.stock):a,stock:e.stock,num:0},P.value||e.status&&e.stock||(P.value=!0)})),R.value=!1}))},q=(e,a)=>{"jia"==a?H.value[e].num=parseInt(H.value[e].num)+1:"jian"==a&&(H.value[e].num=parseInt(H.value[e].num)-1),""!==H.value[e].num&&null!=H.value[e].num||(H.value[e].num=0),H.value[e].num<0&&(H.value[e].num=0),H.value[e].num>H.value[e].max_num&&(H.value[e].num=parseInt(H.value[e].max_num)),H.value[e].num=parseInt(H.value[e].num),"diy"==L.value.giftcard.card_goods_type&&(()=>{for(let e in H.value){let a=L.value.total_num-L.value.use_num,t=0;Object.values(H.value).forEach((e=>{t+=parseInt(e.num||0)})),a-=t-H.value[e].num,H.value[e].max_num=a>H.value[e].stock?parseInt(H.value[e].stock):a}})()},J=()=>{j({url:"/addon/shop_giftcard/pages/my_card_list",mode:"redirectTo"})},M=()=>{S.value||(K.value?"diy"==L.value.giftcard.card_goods_type&&"all"==L.value.giftcard.delivery_way&&K.value<L.value.total_num-L.value.use_num?w({title:r("saveTipsTwo"),icon:"none"}):(S.value=!0,U.sku_data=Object.values(H.value).map((e=>({sku_id:e.sku_id,num:e.num}))).filter((e=>e.num)),D(U).then((e=>{S.value=!1,e.data&&uni.setStorage({key:"orderCreateData",data:e.data,success:()=>{j({url:"/addon/shop/pages/order/payment"})}})})).catch((()=>{S.value=!1}))):w({title:r("saveTipsOne"),icon:"none"}))};return(e,a)=>{const t=T,l=C,s=A,u=B,o=F,d=I(O("loading-page"),z);return i(),c(l,{class:"bg-[#f8f8f8] min-h-[100vh]",style:h(e.themeColor())},{default:p((()=>[Object.keys(L.value).length&&Object.keys(H.value).length?(i(),x(b,{key:0},[P.value?(i(),c(l,{key:0,class:"h-[66rpx] bg-[#FCF2DF] flex items-center px-[var(--sidebar-m)]"},{default:p((()=>[f(t,{class:"iconfont iconshengyinpc !text-[26rpx]"}),f(t,{class:"text-[24rpx] leading-[34rpx] ml-[16rpx] font-400"},{default:p((()=>[m(_(v(r)("pageTips")),1)])),_:1})])),_:1})):g("v-if",!0),f(l,{class:"px-[var(--sidebar-m)] py-[var(--top-m)]"},{default:p((()=>[f(l,{class:"card-template"},{default:p((()=>[f(l,{class:"flex items-center justify-between pb-[20rpx] border-0 !border-b-[2rpx] border-solid border-[#f8f8f8]"},{default:p((()=>["diy"==L.value.giftcard.card_goods_type?(i(),x(b,{key:0},[f(t,{class:"title !mb-0"},{default:p((()=>[m(_(v(r)("goodsTitle"))+_(L.value.total_num-L.value.use_num)+_(v(r)("goodsTitleAnd")),1)])),_:1}),f(l,{class:"text-[30rpx] text-[var(--text-color-light6)]"},{default:p((()=>[f(t,{class:"!text-[var(--primary-color)]"},{default:p((()=>[m(_(v(K)),1)])),_:1}),f(t,null,{default:p((()=>[m("/"+_(L.value.total_num-L.value.use_num),1)])),_:1})])),_:1})],64)):(i(),c(t,{key:1,class:"title !mb-0"},{default:p((()=>[m(_(v(r)("goodsTitleTwo")),1)])),_:1}))])),_:1}),(i(!0),x(b,null,k(L.value.cardGoods,((e,a)=>(i(),c(l,{key:e.sku_id,class:"mt-[var(--pad-top-m)] flex"},{default:p((()=>[f(l,{class:"w-[210rpx] h-[210rpx] rounded-[var(--rounded-mid)] relative"},{default:p((()=>[e.sku_image?(i(),c(s,{key:0,class:"w-[210rpx] h-[210rpx] rounded-[var(--rounded-mid)]",src:v(E)(e.sku_image),onError:a=>e.sku_image="static/resource/images/diy/shop_default.jpg",mode:"aspectFill"},null,8,["src","onError"])):(i(),c(s,{key:1,class:"w-[210rpx] h-[210rpx] rounded-[var(--rounded-mid)]",src:v(E)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])),e.stock?e.status?g("v-if",!0):(i(),c(l,{key:3,class:"absolute w-full w-[210rpx] h-[210rpx] bg-[rgba(51,51,51,0.6)] z-10 left-0 top-0 rounded-[var(--rounded-mid)]"},{default:p((()=>[f(l,{class:"text-[#fff] leading-[210rpx] text-center text-[24rpx] font-500"},{default:p((()=>[m(_(v(r)("goodsRemove")),1)])),_:1})])),_:1})):(i(),c(l,{key:2,class:"absolute w-full w-[210rpx] h-[210rpx] bg-[rgba(51,51,51,0.6)] z-10 left-0 top-0 rounded-[var(--rounded-mid)]"},{default:p((()=>[f(l,{class:"text-[#fff] leading-[210rpx] text-center text-[24rpx] font-500"},{default:p((()=>[m(_(v(r)("goodsSellOut")),1)])),_:1})])),_:1}))])),_:2},1024),f(l,{class:"ml-[20rpx] flex-1 flex flex-col justify-between"},{default:p((()=>[f(l,{class:"w-full"},{default:p((()=>[f(l,{class:"max-w-[432rpx] text-[28rpx] leading-[40rpx] font-400 truncate text-[#303133]"},{default:p((()=>[m(_(e.goods_name),1)])),_:2},1024),f(l,{class:"mt-[20rpx] text-[24rpx] text-[var(--text-color-light6)] font-400 truncate leading-[34rpx] max-w-[432rpx]"},{default:p((()=>[m(_(e.sku_name),1)])),_:2},1024),"all"==L.value.giftcard.card_goods_type?(i(),c(l,{key:0,class:"mt-[20rpx] text-[24rpx] text-[var(--text-color-light6)] font-400 truncate leading-[34rpx] max-w-[432rpx]"},{default:p((()=>[m(_(v(r)("cardGoodsTypeAllTips"))+_(e.total_num)+_(v(r)("cardGoodsTypeAllTipsAnd"))+_(e.use_num)+_(v(r)("unit")),1)])),_:2},1024)):g("v-if",!0)])),_:2},1024),f(l,{class:"flex items-center justify-between h-[52rpx]"},{default:p((()=>[f(l,{class:"text-[var(--price-text-color)] flex items-baseline"},{default:p((()=>[f(t,{class:"text-[22rpx] price-font"},{default:p((()=>[m("ï¿¥")])),_:1}),f(t,{class:"text-[36rpx] font-500 price-font"},{default:p((()=>[m(_(parseFloat(e.price).toFixed(2).split(".")[0]),1)])),_:2},1024),f(t,{class:"text-[22rpx] font-500 price-font"},{default:p((()=>[m("."+_(parseFloat(e.price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),H.value[e.sku_id].max_num?(i(),c(l,{key:0,class:"flex items-center h-[52rpx]"},{default:p((()=>[f(l,{onClick:V((a=>q(e.sku_id,"jian")),["stop"]),class:y(["text-[24rpx] font-500 nc-iconfont nc-icon-jianV6xx leading-[52rpx] w-[52rpx] text-right box-border pr-[10rpx]",{"text-[var(--text-color-light9)]":!H.value[e.sku_id].num}])},null,8,["onClick","class"]),f(u,{class:"text-[#303133] text-[28rpx] w-[80rpx] h-[44rpx] bg-[var(--temp-bg)] leading-[44rpx] text-center rounded-[6rpx]",type:"number",onBlur:a=>q(e.sku_id,""),modelValue:H.value[e.sku_id].num,"onUpdate:modelValue":a=>H.value[e.sku_id].num=a},null,8,["onBlur","modelValue","onUpdate:modelValue"]),f(t,{onClick:V((a=>q(e.sku_id,"jia")),["stop"]),class:y(["text-[24rpx] font-500 nc-iconfont nc-icon-jiahaoV6xx leading-[52rpx] w-[52rpx] box-border pl-[10rpx]",{"text-[var(--text-color-light9)]":H.value[e.sku_id].num==H.value[e.sku_id].max_num}])},null,8,["onClick","class"])])),_:2},1024)):g("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),f(l,{class:"tab-bar-placeholder"}),f(l,{class:"border-[0] border-t-[2rpx] border-solid border-[#f5f5f5] w-[100%] flex justify-between pl-[30rpx] pr-[20rpx] bg-[#fff] box-border fixed left-0 bottom-0 tab-bar z-1 items-center"},{default:p((()=>[f(l,{class:"flex flex-shrink-0 items-center mr-[30rpx]"},{default:p((()=>[f(l,{class:"flex flex-col justify-center items-center",onClick:J},{default:p((()=>[f(l,{class:"iconfont nc-icon-kabao text-[36rpx]"}),f(t,{class:"text-[20rpx] mt-[10rpx]"},{default:p((()=>[m(_(v(r)("cardBag")),1)])),_:1})])),_:1})])),_:1}),f(l,{class:"flex flex-1 items-center"},{default:p((()=>["to_use"==L.value.status||"can_use"==L.value.status?(i(),c(o,{key:0,class:y(["w-full !h-[70rpx] font-500 text-[26rpx] !text-[#fff] primary-btn-bg !m-0 leading-[70rpx] rounded-full remove-border",{"opacity-40":S.value}]),onClick:M},{default:p((()=>[m(_(v(r)("confirmExchange")),1)])),_:1},8,["class"])):g("v-if",!0),"used"==L.value.status?(i(),c(o,{key:1,class:"w-full !h-[70rpx] font-500 text-[26rpx] !text-[#fff] !bg-[var(--text-color-light9)] !m-0 leading-[70rpx] rounded-full opacity-40 remove-border"},{default:p((()=>[m(_(v(r)("used")),1)])),_:1})):g("v-if",!0),"invalid"==L.value.status?(i(),c(o,{key:2,class:"w-full !h-[70rpx] font-500 text-[26rpx] !text-[#fff] !bg-[var(--text-color-light9)] !m-0 leading-[70rpx] rounded-full opacity-40 remove-border"},{default:p((()=>[m(_(v(r)("invalid")),1)])),_:1})):g("v-if",!0)])),_:1})])),_:1})],64)):g("v-if",!0),f(d,{loading:R.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-68d8faee"]]);export{R as default};
