import{d as e,r as a,j as l,m as t,o as s,c as u,w as r,b as o,u as d,x as n,y as i,f as p,aN as c,n as m,_ as x,E as f,F as _,G as v,au as y,I as g,a as h,g as b,h as j,i as w,C as k,a4 as C,ai as V,a3 as N,c0 as E,ag as F,V as U,$ as B}from"./index-905183d4.js";import{_ as I}from"./u-icon.86a2aad0.js";import{_ as L}from"./u--image.b5d65e0e.js";import{_ as O}from"./u-upload.54f0d339.js";import{_ as S}from"./u-button.d3798ecb.js";import{_ as T,a as z}from"./u-radio-group.96b59d73.js";import{_ as A}from"./u-popup.e3f6594b.js";import{g as D}from"./order.f2e9a9a3.js";import{g as G,a as M}from"./refund.cd7301d6.js";import{_ as P}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.44c969ef.js";import"./u-transition.dbaca185.js";import"./u-loading-icon.c376267d.js";/* empty css                                                                 */import"./u-safe-bottom.e94b03c1.js";const Q=P(e({__name:"apply",setup(e){var P;const Q=a(null),R=a({}),$=a(0),q=a(0);let H=a(!1);const J=a({order_id:null==(P=Q.value)?void 0:P.order_id,order_goods_id:$.value,refund_type:"",apply_money:"",reason:"",remark:"",voucher:[]}),K=a([]),W=a("");G().then((({data:e})=>{K.value=e,K.value&&K.value.length&&(W.value=K.value[0])})).catch(),l((e=>{$.value=e.order_goods_id||0,J.value.order_goods_id=$.value,J.value.order_id=e.order_id||0,D(e.order_id).then((({data:e})=>{Q.value=e,Q.value.order_goods.forEach(((e,a)=>{$.value==e.order_goods_id&&(R.value=e)})),J.value.apply_money=X.value})).catch((()=>{}))}));const X=t((()=>{let e=R.value.goods_money-R.value.discount_money;return B(e)})),Y=t((e=>function(e){return""==e||0==e?"60rpx":17*String(e).length+"rpx"})),Z=e=>{J.value.refund_type=e,q.value=1},ee=t((()=>J.value.voucher.map((e=>({url:U(e)}))))),ae=e=>{e.file.forEach((e=>{y({filePath:e.url,name:"file"}).then((e=>{J.value.voucher.length<9&&J.value.voucher.push(e.data.url)})).catch((()=>{}))}))},le=e=>{J.value.voucher.splice(e.index,1)},te=a(!1),se=()=>J.value.reason?Number(J.value.apply_money).toFixed(2)<0?(g({title:"退款金额不能为0,保留两位小数",icon:"none"}),!1):Number(J.value.apply_money)>Number(X.value)?(g({title:"退款金额不能大于可退款总额",icon:"none"}),!1):void(te.value||(te.value=!0,M(J.value).then((e=>{te.value=!1,setTimeout((()=>{h({url:"/addon/shop/pages/order/detail",param:{order_id:J.value.order_id}})}),1e3)})).catch((()=>{te.value=!1})))):(g({title:"请选择退款原因",icon:"none"}),!1),ue=()=>{J.value.reason=W.value,H.value=!1},re=e=>{Number(e.detail.value)>Number(X.value)&&(g({title:"退款金额不能大于可退款总额",icon:"none"}),J.value.apply_money=X.value)};return(e,a)=>{const l=b(j("u-icon"),I),t=b(j("u--image"),L),y=w,g=k,h=C,B=V,D=N,G=b(j("u-upload"),O),M=E,P=b(j("u-button"),S),$=b(j("u-radio"),T),oe=b(j("u-radio-group"),z),de=b(j("u-popup"),A),ne=F;return s(),u(y,{style:m(e.themeColor())},{default:r((()=>[Q.value?(s(),u(ne,{key:0,"indicator-dots":!1,autoplay:!1,"disable-touch":!0,current:q.value,class:"h-screen",duration:300},{default:r((()=>[o(B,null,{default:r((()=>[o(h,{"scroll-y":"true",class:"bg-page h-screen"},{default:r((()=>[o(y,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:r((()=>[o(y,{class:"flex py-[30rpx] border-0 !border-b !border-[#f5f5f5] border-solid"},{default:r((()=>[o(t,{width:"120rpx",height:"120rpx",src:d(U)(R.value.sku_image),model:"aspectFill"},{error:r((()=>[o(l,{name:"photo",color:"#999",size:"50"})])),_:1},8,["src"]),o(y,{class:"flex flex-1 w-0 flex-col justify-between ml-[20rpx]"},{default:r((()=>[o(y,null,{default:r((()=>[o(y,{class:"text-ellipsis text-[#303133] text-sm leading-normal"},{default:r((()=>[n(i(R.value.goods_name),1)])),_:1}),o(y,{class:"mt-[10rpx] text-[26rpx] text-gray-subtitle"},{default:r((()=>[n(i(R.value.sku_name),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(y,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:r((()=>[o(y,{class:"py-[24rpx] flex items-center",onClick:a[0]||(a[0]=e=>Z(1))},{default:r((()=>[o(y,{class:"flex-1"},{default:r((()=>[o(y,{class:"text-sm"},{default:r((()=>[n("仅退款")])),_:1}),o(y,{class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:r((()=>[n("未收到货，或与商家协商一致不用退货只退款")])),_:1})])),_:1}),o(g,{class:"iconfont iconxiangyoujiantou text-[26rpx] text-gray-subtitle"})])),_:1}),"real"!=R.value.goods_type||R.value.delivery_status&&"wait_delivery"==R.value.delivery_status?p("v-if",!0):(s(),u(y,{key:0,class:"py-[24rpx] flex items-center border-0 !border-t !border-[#f5f5f5] border-solid",onClick:a[1]||(a[1]=e=>Z(2))},{default:r((()=>[o(y,{class:"flex-1"},{default:r((()=>[o(y,{class:"text-sm"},{default:r((()=>[n("退货退款")])),_:1}),o(y,{class:"text-xs mt-[10rpx] text-gray-subtitle"},{default:r((()=>[n("已收到货，需退还收到的货物")])),_:1})])),_:1}),o(g,{class:"iconfont iconxiangyoujiantou text-[26rpx] text-gray-subtitle"})])),_:1}))])),_:1})])),_:1})])),_:1}),o(B,null,{default:r((()=>[o(h,{"scroll-y":"true",class:"bg-page h-screen"},{default:r((()=>[o(y,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:r((()=>[o(y,{class:"py-[24rpx] flex justify-between items-center"},{default:r((()=>[o(y,{class:"text-sm"},{default:r((()=>[n("退款原因")])),_:1}),o(y,{class:"flex items-center",onClick:a[2]||(a[2]=e=>c(H)?H.value=!0:H=!0)},{default:r((()=>[o(y,{class:"flex-1 text-right"},{default:r((()=>[o(y,{class:"text-xs text-gray-subtitle truncate w-[460rpx]"},{default:r((()=>[n(i(J.value.reason||"请选择"),1)])),_:1})])),_:1}),o(g,{class:"iconfont iconxiangyoujiantou text-[26rpx] text-gray-subtitle"})])),_:1})])),_:1})])),_:1}),o(y,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:r((()=>[o(y,{class:"py-[24rpx] flex items-center"},{default:r((()=>[o(y,{class:"text-sm"},{default:r((()=>[n("退款金额")])),_:1}),o(y,{class:"flex-1 text-right"},{default:r((()=>[o(y,{class:"flex justify-end items-center"},{default:r((()=>[o(g,{class:"font-bold text-sm leading-none"},{default:r((()=>[n("￥")])),_:1}),o(D,{type:"number",modelValue:J.value.apply_money,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.apply_money=e),modelModifiers:{number:!0},class:"font-bold text-sm leading-none",style:m({width:d(Y)(J.value.apply_money)}),onBlur:re},null,8,["modelValue","style"])])),_:1}),o(y,{class:"text-xs text-gray-subtitle mt-[10rpx]"},{default:r((()=>[n("最多可输入金额￥"+i(d(X)),1)])),_:1})])),_:1})])),_:1})])),_:1}),o(y,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:r((()=>[o(y,{class:"py-[24rpx]"},{default:r((()=>[o(y,{class:"text-sm"},{default:r((()=>[n("上传凭证"),o(g,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:r((()=>[n("选填")])),_:1})])),_:1}),o(y,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx]"},{default:r((()=>[o(G,{fileList:d(ee),onAfterRead:ae,onDelete:le,multiple:"",maxCount:9},null,8,["fileList"])])),_:1})])),_:1})])),_:1}),o(y,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:r((()=>[o(y,{class:"py-[24rpx]"},{default:r((()=>[o(y,{class:"text-sm"},{default:r((()=>[n("补充描述"),o(g,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:r((()=>[n("选填")])),_:1})])),_:1}),o(y,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx] h-[200rpx]"},{default:r((()=>[o(M,{modelValue:J.value.remark,"onUpdate:modelValue":a[4]||(a[4]=e=>J.value.remark=e),cols:"30",rows:"5",placeholder:"补充描述,有助于更好的处理售后问题","placeholder-class":"text-sm"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),o(y,{class:"mt-[40rpx] m-[24rpx]"},{default:r((()=>[o(P,{type:"primary",shape:"circle",text:"提交",onClick:se,loading:te.value},null,8,["loading"])])),_:1}),p(" 退款原因 "),o(de,{show:d(H),onClose:e.close,onOpen:e.open},{default:r((()=>[o(y,{class:"px-[30rpx] pb-[30rpx]",onTouchmove:a[7]||(a[7]=x((()=>{}),["prevent","stop"]))},{default:r((()=>[o(y,{class:"flex items-center h-[90rpx] justify-between"},{default:r((()=>[o(g,null,{default:r((()=>[n("退款原因")])),_:1}),o(g,{class:"iconfont iconguanbi",onClick:a[5]||(a[5]=e=>c(H)?H.value=!1:H=!1)})])),_:1}),o(h,{"scroll-y":"true",class:"h-[450rpx] mt-[20rpx]"},{default:r((()=>[o(oe,{modelValue:W.value,"onUpdate:modelValue":a[6]||(a[6]=e=>W.value=e),placement:"column"},{default:r((()=>[(s(!0),f(v,null,_(K.value,((e,a)=>(s(),u($,{activeColor:"var(--primary-color)",customStyle:{marginBottom:"8px"},key:a,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(P,{type:"primary",class:"mt-[40rpx]",shape:"circle",onClick:ue},{default:r((()=>[n("确定")])),_:1})])),_:1})])),_:1},8,["show","onClose","onOpen"])])),_:1})])),_:1})])),_:1},8,["current"])):p("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-6390e8ec"]]);export{Q as default};
