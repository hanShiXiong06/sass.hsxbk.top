import{d as e,l as a,j as r,r as l,p as t,t as d,a as s,s as o,H as i,an as u,o as c,c as p,w as n,U as v,b as g,u as f,W as b,y as m,z as _,f as x,V as h,ad as y,n as k,a3 as w,B as j,D as C,C as U,i as V,c3 as F,g as P,h as I,E as z,_ as B}from"./index-71c7df08.js";import{_ as E}from"./loading-page.vue_vue_type_script_setup_true_lang.c7dc2256.js";import{c as O}from"./card.1368a464.js";import{s as T}from"./share-poster.aefc8367.js";const D=B(e({__name:"give",setup(e){const B=a(),D=r((()=>B.info)),L=l({}),M=l(!0),S=l(!1),H=l({card_id:"",blessing:""}),R=l(!1),W=l(""),{setShare:q}=w();l(null),t((e=>{if(e.card_id){if(!o())return i().setLoginBack({url:"/addon/shop_giftcard/pages/give",param:{card_id:e.card_id}}),!1;u((()=>{})),H.value.card_id=e.card_id,D.value?A():B.getMemberInfo((()=>{A()}))}else d({title:"礼品卡不存在",icon:"none"}),setTimeout((()=>{s({url:"/addon/shop_giftcard/pages/index",mode:"reLaunch"})}),600)}));const A=(e=null)=>{M.value=!0,O(H.value).then((a=>{if(a.data){L.value=a.data,Z();let r="",l="/addon/shop_giftcard/pages/receive_info"+X.value,t=location.pathname,d=["/app/","/addon/"];for(let e=0;e<d.length;e++)-1!=t.indexOf(d[e])&&(t=t.substr(0,t.indexOf(d[e])));r=location.origin+t+l,setTimeout((()=>{let e={title:"嘿！朋友送你一张礼品卡，快来领取吧~",desc:H.value.blessing,url:L.value.card_cover,link:r,path:l};q({wechat:{...e},weapp:{...e}})}),600),e&&e()}M.value=!1,S.value=!1})).catch((()=>{M.value=!1,S.value=!1}))},G=e=>{R.value=!e,e&&(W.value=""),H.value.blessing=e},J=()=>{W.value=W.value.substr(0,20)},K=()=>{S.value||(R.value&&(H.value.blessing=W.value),H.value.blessing?(S.value=!0,A((()=>{$()}))):d({title:"请填写您的祝福语",icon:"none"}))},N=l(null),Q=l("/addon/shop_giftcard/pages/receive_info"),X=l("");let Y={};const Z=()=>{X.value="?give_id="+L.value.give_id,D.value&&D.value.member_id&&(X.value+="&mid="+D.value.member_id)},$=()=>{Y.give_id=L.value.give_id,D.value&&D.value.member_id&&(Y.member_id=D.value.member_id),N.value.openShare()},ee=e=>{let a="";return a="balance"==e.giftcard.card_right_type?"addon/shop_giftcard/diy/index/value_card.jpg":"addon/shop_giftcard/diy/index/redemption_card.jpg",a};return(e,a)=>{const r=j,l=C,t=U,d=V,s=F,o=P(I("loading-page"),E);return c(),p(d,{class:"bg-[#f8f8f8] min-h-[100vh]",style:k(e.themeColor())},{default:n((()=>[Object.keys(L.value).length?(c(),v(h,{key:0},[g(d,{class:"px-[var(--sidebar-m)] py-[var(--top-m)]"},{default:n((()=>[g(d,{class:"w-full h-[430rpx] relative"},{default:n((()=>[L.value.card_cover?(c(),p(r,{key:0,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:f(z)(L.value.card_cover),onError:a[0]||(a[0]=e=>L.value.card_cover=ee(L.value)),mode:"aspectFill"},null,8,["src"])):(c(),p(r,{key:1,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:f(z)(ee(L.value)),mode:"aspectFill"},null,8,["src"])),g(d,{class:"absolute bottom-[var(--pad-top-m)] left-0 right-0 flex justify-center"},{default:n((()=>[g(t,{class:b([{"!bg-[#EF000C]":"balance"==L.value.giftcard.card_right_type,"!bg-[#FF7700]":"goods"==L.value.giftcard.card_right_type},"h-[44rpx] font-500 text-[24rpx] !text-[#fff] bg-[var(--primary-color)] m-0 rounded-[var(--rounded-big)] remove-border"])},{default:n((()=>[g(l,{class:b(["text-[20rpx] text-[24rpx] iconfont mr-[5rpx]",{iconchuzhikaV6mm:"balance"==L.value.giftcard.card_right_type,"iconduihuankaV6mm-1":"goods"==L.value.giftcard.card_right_type}])},null,8,["class"]),"balance"==L.value.giftcard.card_right_type?(c(),p(l,{key:0,class:"leading-[44rpx]"},{default:n((()=>[m(_(L.value.balance)+"元",1)])),_:1})):x("v-if",!0),g(l,{class:"leading-[44rpx]"},{default:n((()=>[m(_(L.value.giftcard.card_right_type_name),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),g(d,{class:"mt-[var(--top-m)] card-template"},{default:n((()=>[g(d,{class:"title"},{default:n((()=>[m("送上您的祝福")])),_:1}),L.value.giftcard.blessing_json?(c(),p(d,{key:0,class:"w-full flex flex-wrap gap-x-[var(--pad-sidebar-m)]"},{default:n((()=>[(c(!0),v(h,null,y(L.value.giftcard.blessing_json,(e=>(c(),p(d,{key:e.id,onClick:a=>G(e.blessing),class:b(["h-[60rpx] px-[30rpx] box-border text-[28rpx] leading-[56rpx] rounded-[30rpx] bg-[var(--temp-bg)] mb-[var(--pad-top-m)] box-border border-[2rpx] border-solid border-[var(--temp-bg)]",{"!border-[var(--primary-color)] !bg-[var(--primary-color-light)] !text-[var(--primary-color)]":e.blessing===H.value.blessing}])},{default:n((()=>[m(_(e.blessing),1)])),_:2},1032,["onClick","class"])))),128)),g(d,{onClick:a[1]||(a[1]=e=>G("")),class:b(["h-[60rpx] px-[30rpx] box-border text-[28rpx] leading-[56rpx] rounded-[30rpx] bg-[var(--temp-bg)] mb-[var(--pad-top-m)] box-border border-[2rpx] border-solid border-[var(--temp-bg)]",{"!border-[var(--primary-color)] !bg-[var(--primary-color-light)] !text-[var(--primary-color)]":R.value}])},{default:n((()=>[m(" 自定义祝福语 ")])),_:1},8,["class"])])),_:1})):x("v-if",!0),R.value?(c(),p(d,{key:1,class:"h-[200rpx] bg-[var(--temp-bg)] rounded-[var(--rounded-big)] px-[var(--pad-sidebar-m)] py-[var(--pad-top-m)] box-border"},{default:n((()=>[g(s,{class:"leading-[1.5] h-[100%] w-[100%] text-[28rpx]",modelValue:W.value,"onUpdate:modelValue":a[2]||(a[2]=e=>W.value=e),modelModifiers:{trim:!0},cols:"30",rows:"5",placeholder:"请输入祝福语","placeholder-class":"text-[28rpx] text-[var(--text-color-light9)]",maxlength:"20",onBlur:J},null,8,["modelValue"])])),_:1})):x("v-if",!0)])),_:1})])),_:1}),g(d,{class:"tab-bar-placeholder"}),g(d,{class:"border-[0] border-t-[2rpx] border-solid border-[#f5f5f5] w-[100%] flex justify-between px-[var(--pad-sidebar-m)] bg-[#fff] box-border fixed left-0 bottom-0 tab-bar z-1 items-center"},{default:n((()=>["to_use"==L.value.status&&L.value.giftcard.is_give?(c(),p(t,{key:0,class:b(["w-full !h-[70rpx] font-500 text-[26rpx] !text-[#fff] primary-btn-bg !m-0 leading-[70rpx] rounded-full remove-border",{"opacity-40":S.value}]),onClick:K},{default:n((()=>[m("确定赠送好友")])),_:1},8,["class"])):x("v-if",!0)])),_:1}),g(T,{ref_key:"sharePosterRef",ref:N,posterType:"shop_giftcard_give",posterId:L.value.giftcard.poster_id,copyUrl:Q.value,posterParam:f(Y),copyUrlParam:X.value},null,8,["posterId","copyUrl","posterParam","copyUrlParam"])],64)):x("v-if",!0),g(o,{loading:M.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-2e4f41a4"]]);export{D as default};
