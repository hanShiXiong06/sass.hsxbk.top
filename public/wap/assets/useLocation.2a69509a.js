import{m as t,p as e,q as i,bw as a,aK as n}from"./index-7bf68536.js";import{m as o}from"./manifest.c5d7e573.js";import{f as l}from"./cloneDeep.77735539.js";function r(r){const s=t();let d=r;1!=s.mapConfig.is_open&&(d=!1);const c=()=>{if(!d)return!1;uni.getStorageSync("manually_select_location_from_map")||i()&&s.mapConfig.is_open&&!uni.getStorageSync("curr_shipping_address")&&a.init((()=>{a.getLocation((t=>{let e=t.latitude+","+t.longitude;u(e)}))}))},u=(t="")=>{if(!d)return!1;let e={latlng:""};if(t){e.latlng=t;let a={latitude:"",longitude:""};a.latitude=e.latlng.split(",")[0],a.longitude=e.latlng.split(",")[1];var i=l(s.location)||{};i=Object.assign(i,a),s.setLocation(i)}else e.latlng=s.location.latitude+","+s.location.longitude;n(e).then((t=>{if(t.data&&Object.keys(t.data).length){let e={};e.latitude=t.latitude,e.longitude=t.longitude,e.full_address=null!=t.data.province?t.data.province:"",e.full_address+=null!=t.data.city?t.data.city:"",e.full_address+=null!=t.data.district?t.data.district:"",e.full_address+=null!=t.data.community?t.data.community:"",e.province_id=t.data.province_id,e.province=t.data.province,e.city_id=t.data.city_id,e.city=t.data.city,e.district_id=t.data.district_id,e.district=t.data.district,e.community=t.data.community,e.formatted_addresses=t.data.formatted_addresses,s.setCurrShippingAddress(e)}else s.setCurrShippingAddress("");setTimeout((()=>{uni.removeStorageSync("manually_select_location_from_map")}),500)}))},p=()=>{let t=uni.getStorageSync("location");if(t){var e=new Date;s.mapConfig.valid_time>0?t.is_expired=e.getTime()/1e3>t.valid_time:t.is_expired=!1}else t={is_expired:!1};return t};return{initFn:c,onLoad:(t="")=>{e((e=>{if(e&&e.latng){let t={latitude:"",longitude:""};t.latitude=e.latng.split(",")[0],t.longitude=e.latng.split(",")[1];var i=l(s.location)||{};i=Object.assign(i,t),s.setLocation(i),i&&i.latitude&&i.longitude?u(""):s.setCurrShippingAddress("")}uni.removeStorageSync("manually_select_location_from_map"),"function"==typeof t&&t(e)}))},refreshLocationFn:()=>{if(!d)return!1;!uni.getStorageSync("manually_select_location_from_map")&&uni.getStorageSync("curr_shipping_address")&&(p()&&!p().is_expired?s.setCurrShippingAddress(uni.getStorageSync("curr_shipping_address")):uni.removeStorageSync("curr_shipping_address")),!uni.getStorageSync("manually_select_location_from_map")&&p()&&p().is_expired&&c()},repositionFn:()=>{if(!d)return!1;s.location&&s.location.latitude,s.location&&s.location.longitude,uni.setStorageSync("manually_select_location_from_map",!0);let t=location.origin+location.pathname;window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(t)+"&key="+o.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"}}}export{r as u};
