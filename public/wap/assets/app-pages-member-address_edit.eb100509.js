import{d as e,r as a,j as l,aG as t,m as r,aH as s,I as d,o as i,c as o,w as u,b as n,u as c,x as m,y as p,_ as v,f,n as _,aI as b,aJ as x,a as g,g as y,h,i as k,C as j,t as S}from"./index-905183d4.js";import{_ as V}from"./u-input.07f64251.js";import{_ as w,a as C}from"./u-form.7ae4e9da.js";import{_ as A}from"./u-switch.b3c679e0.js";import{_ as P}from"./u-button.d3798ecb.js";import{_ as q}from"./area-select.vue_vue_type_script_setup_true_lang.90f3d421.js";import{m as I}from"./manifest.78a5c925.js";import"./u-icon.86a2aad0.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.9e44f7cf.js";import"./u-loading-icon.c376267d.js";import"./u-popup.e3f6594b.js";import"./u-transition.dbaca185.js";import"./u-safe-bottom.e94b03c1.js";const z=e({__name:"address_edit",setup(e){const z=a({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:""}),$=a(),M=a(null),U=a(""),E=a(!1);let T=a(!1),R=a("address"),O=a(2);l((e=>{O.value=e.isSelectMap||"";const a=uni.getStorageSync("selectAddressCallback");if(e.id)t(e.id).then((e=>{e.data&&Object.assign(z.value,e.data),R.value=e.data.lat&&e.data.lng?"locationAddress":"address",a&&(R.value="express"==a.delivery?"address":"locationAddress")})).catch();else if(e.name){uni.getStorageSync("addressInfo")&&Object.assign(z.value,uni.getStorageSync("addressInfo")),z.value.address=e.name,Y(e.latng);var l=Z("latng").split(",");z.value.lat=l[0],z.value.lng=l[1]}U.value=e.source||"",a&&(R.value="express"==a.delivery?"address":"locationAddress")}));const G=r((()=>({name:{type:"string",required:!0,message:S("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:S("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,l){/^1[3-9]\d{9}$/.test(a)?l():l(new Error(S("mobileError")))}}],area:{validator(){let e=!0;return uni.$u.test.isEmpty(z.value.area)&&uni.$u.test.isEmpty(z.value.address_name)&&(e=!1),e},message:S("selectAreaPlaceholder")},address:{type:"string",required:!0,message:S("addressPlaceholder"),trigger:["blur","change"]}}))),H=()=>{T.value=!0,$.value.open()},J=e=>{!T.value||z.value.province_id!=e.province.id&&z.value.city_id==e.city.id&&z.value.district_id==e.district.id||(z.value.lat="",z.value.lng=""),z.value.province_id=e.province.id||0,z.value.city_id=e.city.id||0,z.value.district_id=e.district.id||0,z.value.area=`${e.province.name||""}${e.city.name||""}${e.district.name||""}`,T.value=!1},K=a(!1),N=()=>{const e=z.value.id?b:x;M.value.validate().then((()=>{if(!K.value){if(K.value=!0,E.value=!0,z.value.full_address=z.value.area+z.value.address,1==O.value&&!z.value.lat&&!z.value.lng)return d({title:"缺少经纬度，请在地图上重新选点",icon:"none"}),K.value=!1,E.value=!1,!1;e(z.value).then((e=>{K.value=!1,setTimeout((()=>{if(E.value=!1,"shop_order_payment"==U.value){const a=uni.getStorageSync("selectAddressCallback");a&&(a.address_id=e.data.id||z.value.id,uni.setStorage({key:"selectAddressCallback",data:a,success(){g({url:a.back,mode:"redirectTo"})}}))}else g({url:"/app/pages/member/address",mode:"redirectTo",param:{source:U.value}})}),1e3)})).catch((()=>{K.value=!1,E.value=!1}))}}))},W=(e={})=>{var a=z.value;uni.setStorageSync("addressInfo",a);let l=location.origin+location.pathname+"?source="+U.value;O.value&&(l=l+"&isSelectMap="+O.value),window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(l)+"&key="+I.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"},Y=e=>{s({latlng:e}).then((e=>{e.data?(z.value.full_address="",z.value.full_address+=null!=e.data.province?e.data.province:"",z.value.full_address+=null!=e.data.city?""+e.data.city:"",z.value.full_address+=null!=e.data.district?""+e.data.district:"",z.value.address_name=z.value.full_address.replace(/-/g,""),z.value.area=e.data.full_address,z.value.province_id=null!=e.data.province_id?e.data.province_id:0,z.value.city_id=null!=e.data.city_id?e.data.city_id:0,z.value.district_id=null!=e.data.district_id?e.data.district_id:0):d({title:e.msg,icon:"none"})}))},Z=e=>{for(var a=window.location.search.substring(1).split("&"),l=0;l<a.length;l++){var t=a[l].split("=");if(t[0]==e)return t[1]}return!1};return(e,a)=>{const l=y(h("u-input"),V),t=y(h("u-form-item"),w),r=k,s=j,d=y(h("u-switch"),A),b=y(h("u-button"),P),x=y(h("u-form"),C),g=y(h("area-select"),q);return i(),o(r,{class:"px-[30rpx]",style:_(e.themeColor())},{default:u((()=>[n(x,{labelPosition:"left",model:z.value,labelWidth:"200rpx",errorType:"toast",rules:c(G),ref_key:"formRef",ref:M},{default:u((()=>[n(r,{class:"mt-[10rpx]"},{default:u((()=>[n(t,{label:c(S)("name"),prop:"name","border-bottom":!0},{default:u((()=>[n(l,{fontSize:"30rpx",modelValue:z.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value.name=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"25",placeholder:c(S)("namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[10rpx]"},{default:u((()=>[n(t,{label:c(S)("mobile"),prop:"mobile","border-bottom":!0},{default:u((()=>[n(l,{fontSize:"30rpx",modelValue:z.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>z.value.mobile=e),modelModifiers:{trim:!0},border:"none",clearable:"",placeholder:c(S)("mobilePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[10rpx]"},{default:u((()=>[n(t,{label:c(S)("selectArea"),prop:"area","border-bottom":!0},{default:u((()=>["address"==c(R)&&1!=c(O)?(i(),o(r,{key:0,class:"flex w-full items-center",onClick:H},{default:u((()=>[z.value.area?(i(),o(r,{key:1,class:"text-[30rpx] flex-1"},{default:u((()=>[m(p(z.value.area),1)])),_:1})):(i(),o(r,{key:0,class:"text-gray-placeholder text-[30rpx] flex-1"},{default:u((()=>[m(p(c(S)("selectAreaPlaceholder")),1)])),_:1})),n(r,{onClick:v(W,["stop"]),class:"flex items-center"},{default:u((()=>[n(s,{class:"nc-iconfont nc-icon-dizhiguanliV6xx mr-[4rpx] text-[32rpx] text-[#e93323]"}),n(s,{class:"text-[24rpx] whitespace-nowrap"},{default:u((()=>[m("定位")])),_:1})])),_:1},8,["onClick"])])),_:1})):(i(),o(r,{key:1,class:"flex justify-between items-center flex-1",onClick:W},{default:u((()=>[z.value.area||z.value.address_name?(i(),o(r,{key:0,class:"text-[30rpx] text-[#303133]"},{default:u((()=>[m(p(z.value.area||z.value.address_name),1)])),_:1})):(i(),o(r,{key:1,class:"text-[#c3c4d5] text-[30rpx]"},{default:u((()=>[m(p(c(S)("selectAddressPlaceholder")),1)])),_:1})),n(r,{class:"flex items-center"},{default:u((()=>[n(s,{class:"nc-iconfont nc-icon-dizhiguanliV6xx text-[32rpx] mr-[4rpx] text-[#e93323]"}),n(s,{class:"text-[24rpx] whitespace-nowrap"},{default:u((()=>[m("定位")])),_:1})])),_:1})])),_:1}))])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[10rpx]"},{default:u((()=>[n(t,{label:c(S)("address"),prop:"address","border-bottom":!0},{default:u((()=>[n(l,{fontSize:"30rpx",modelValue:z.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>z.value.address=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"120",placeholder:c(S)("addressPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[10rpx]"},{default:u((()=>[n(t,{label:c(S)("defaultAddress"),prop:"name","border-bottom":!0},{default:u((()=>[n(d,{modelValue:z.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>z.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[40rpx]"},{default:u((()=>[n(b,{type:"primary",shape:"circle",text:c(S)("save"),onClick:N,disabled:E.value,loading:K.value},null,8,["text","disabled","loading"])])),_:1})])),_:1},8,["model","rules"]),"address"==c(R)?(i(),o(g,{key:0,ref_key:"areaRef",ref:$,onComplete:J,"area-id":z.value.district_id},null,8,["area-id"])):f("v-if",!0)])),_:1},8,["style"])}}});export{z as default};
