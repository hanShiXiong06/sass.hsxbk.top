import{d as e,r as t,aN as a,g as l,h as s,o as r,c as d,w as i,b as o,A as p,y as x,z as c,u as n,F as u,U as _,V as f,ad as v,W as y,f as m,a as g,i as b,D as h,ac as k,C as w,aA as F,a4 as C,bn as S,n as j,t as V,B as A,ab as T,E as O,aO as $,bl as E,cp as R,bF as z,_ as D}from"./index-71c7df08.js";import{_ as I}from"./pay.6aa36878.js";import{o as B,d as U}from"./point.16230268.js";import{_ as H,a as L}from"./invoice.vue_vue_type_script_setup_true_lang.53ed7300.js";import"./pay.4cfa8889.js";import"./order.fd75567a.js";const M=e({__name:"address-list",emits:["confirm"],setup(e,{expose:C,emit:S}){const j=t(!1),V=t(!1),A=t(""),T=t({}),O=t([]);a({}).then((({data:e})=>{O.value=e,V.value=!1}));const $=(e,t=2)=>{uni.setStorage({key:"selectAddressCallback",data:{back:"/addon/phone_shop/pages/point/payment",delivery:T.value.delivery},success(){g({url:"/app/pages/member/address_edit",param:{id:e.id,source:"shop_order_payment",isSelectMap:t}})}})},E=()=>{uni.setStorage({key:"selectAddressCallback",data:{back:"/addon/phone_shop/pages/point/payment",delivery:T.value.delivery},success(){g({url:"/app/pages/member/address_edit",param:{source:"shop_order_payment"}})}})};return C({open:e=>{j.value=!0,T.value=e,A.value=e.id}}),(e,t)=>{const a=b,g=h,C=k,V=w,R=l(s("u-popup"),F);return r(),d(R,{show:j.value,onClose:t[1]||(t[1]=e=>j.value=!1),mode:"bottom",round:10,closeable:!0},{default:i((()=>[o(a,{onTouchmove:t[0]||(t[0]=p((()=>{}),["prevent","stop"]))},{default:i((()=>[o(a,{class:"text-center p-[30rpx]"},{default:i((()=>[x(c(n(u)("selectAddress")),1)])),_:1}),o(C,{"scroll-y":"true",class:"max-h-[50vh]"},{default:i((()=>[(r(!0),_(f,null,v(O.value,((e,t)=>(r(),d(a,{key:e.id,class:y(["flex items-center px-[30rpx]",{"mb-[30rpx]":O.value.length-1!=t,"text-[var(--primary-color)]":e.id==A.value}]),onClick:e=>(e=>{let t=O.value[e];if("local_delivery"!=T.value.delivery||t.lat||t.lng){let t={};t.address_id=O.value[e].id,t.delivery=T.value.delivery,S("confirm",t)}else $(t,1);j.value=!1})(t)},{default:i((()=>[o(g,{class:"nc-iconfont nc-icon-dingweiV6xx-1 text-[36rpx]"}),o(a,{class:"flex flex-col mx-[30rpx] w-[480rpx]"},{default:i((()=>[o(a,{class:"flex items-center truncate leading-[1.5]"},{default:i((()=>[o(g,{class:"mr-[8rpx] text-[28rpx] truncate max-w-[300rpx]"},{default:i((()=>[x(c(e.name),1)])),_:2},1024),o(g,{class:"text-[28rpx]"},{default:i((()=>[x(c(e.mobile),1)])),_:2},1024)])),_:2},1024),o(a,{class:"truncate text-[28rpx] leading-[1.5]"},{default:i((()=>[x(c(e.full_address),1)])),_:2},1024)])),_:2},1024),o(g,{class:"nc-iconfont nc-icon-xiugaiV6xx text-[32rpx] ml-auto",onClick:t=>$(e)},null,8,["onClick"])])),_:2},1032,["class","onClick"])))),128)),!O.value||O.value&&!O.value.length?(r(),d(a,{key:0,class:"text-[#666] text-[28rpx] text-center"},{default:i((()=>[x(c(n(u)("emptyAddress")),1)])),_:1})):m("v-if",!0)])),_:1}),o(a,{class:"p-[30rpx] pt-[40rpx]"},{default:i((()=>[o(V,{class:"bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:E},{default:i((()=>[x(c(n(u)("addAddress")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),N=D(e({__name:"payment",setup(e){const a=t({order_key:"",member_remark:"",discount:{},invoice:{},delivery:{delivery_type:""}}),p=t(null),u=t(),F=t(),D=t(),N=t(!1),W=t(0),q=t([]),G=t();uni.getStorageSync("orderCreateData")&&Object.assign(a.value,uni.getStorageSync("orderCreateData"));const J=uni.getStorageSync("selectAddressCallback");J&&(a.value.order_key="",a.value.delivery.delivery_type=J.delivery,a.value.delivery.take_address_id=J.address_id,uni.removeStorage({key:"selectAddressCallback"}));const K=(e,t)=>{a.value.delivery.delivery_type!=e&&(W.value=t,a.value.order_key="",a.value.delivery.delivery_type=e,a.value.delivery.take_address_id=0,P())},P=()=>{B(a.value).then((({data:e})=>{p.value=e,a.value.order_key=e.order_key,p.value.delivery.delivery_type_list&&(q.value=Object.values(p.value.delivery.delivery_type_list)),J&&(W.value=q.value.findIndex((e=>e.key===p.value.delivery.delivery_type))),!a.value.delivery.delivery_type&&e.delivery.delivery_type&&(a.value.delivery.delivery_type=e.delivery.delivery_type)})).catch()};P(),C((()=>q.value.length),((e,t)=>{q.value.length&&uni.getStorageSync("distributionType")&&(q.value.forEach(((e,t)=>{e.name==uni.getStorageSync("distributionType")&&(W.value=t,K(e.key,t))})),uni.removeStorage({key:"distributionType"}))}));let Q=0;const X=()=>{Y()&&!N.value&&(N.value=!0,U(a.value).then((({data:e})=>{var t;Q=e.order_id,0==p.value.basic.order_money?g({url:"/addon/phone_shop/pages/order/detail",param:{order_id:Q},mode:"redirectTo"}):null==(t=F.value)||t.open(e.trade_type,e.order_id,`/addon/phone_shop/pages/order/detail?order_id=${e.order_id}`)})).catch((()=>{N.value=!1})))},Y=()=>{const e=a.value;if(p.value.basic.has_goods_types.includes("real")){if(["express","local_delivery"].includes(e.delivery.delivery_type)&&!p.value.delivery.take_address)return V({title:"请选择收货地址",icon:"none"}),!1;if("store"==e.delivery.delivery_type&&!e.delivery.take_store_id)return V({title:"请选择自提点",icon:"none"}),!1}return!0},Z=()=>{g({url:"/addon/phone_shop/pages/order/detail",param:{order_id:Q},mode:"redirectTo"})},ee=()=>{let e={};e.delivery=a.value.delivery.delivery_type,e.type="local_delivery"==a.value.delivery.delivery_type?"location_address":"address",e.id=p.value.delivery.take_address.id,G.value.open(e)},te=e=>{a.value.delivery.take_store_id=e&&e.store_id?e.store_id:0,P()},ae=e=>{a.value.invoice=e},le=e=>{a.value.order_key="",a.value.delivery.delivery_type=e.delivery,a.value.delivery.take_address_id=e.address_id,P()};return(e,t)=>{const g=b,C=A,V=h,B=l(s("u--image"),E),U=l(s("u-alert"),R),N=T,J=w,P=l(s("u-tabbar"),z),Q=l(s("pay"),I),Y=k;return r(),d(g,{style:j(e.themeColor())},{default:i((()=>[p.value?(r(),d(Y,{key:0,"scroll-y":"true",class:"bg-[#f6f6f6] h-screen"},{default:i((()=>[o(g,{class:"pt-[30rpx] sidebar-marign payment-bottom"},{default:i((()=>[m(" 配送方式 "),p.value.basic.has_goods_types.includes("real")&&q.value.length?(r(),d(g,{key:0,class:"mb-[20rpx] rounded-[16rpx] bg-white"},{default:i((()=>[q.value.length>1?(r(),d(g,{key:0,class:"rounded-tl-[16rpx] rounded-tr-[16rpx] head-tab flex items-center w-full bg-[#efefef]"},{default:i((()=>[(r(!0),_(f,null,v(q.value,((e,t)=>(r(),d(g,{key:t,class:y(["head-tab-item flex-1 relative",{active:t===W.value}])},{default:i((()=>[o(g,{class:"h-[74rpx] relative z-10 text-center leading-[74rpx] text-[28rpx]",onClick:a=>K(e.key,t)},{default:i((()=>[x(c(e.name),1)])),_:2},1032,["onClick"]),t===W.value&&3==q.value.length?(r(),d(C,{key:0,class:"tab-image absolute bottom-[-2rpx] h-[94rpx] w-[240rpx]",src:n(O)(`addon/phone_shop/payment/tab_${t}.png`),mode:"aspectFit"},null,8,["src"])):t===W.value&&2==q.value.length?(r(),d(C,{key:1,class:"tab-img absolute bottom-[-2rpx] h-[95rpx] w-[354rpx]",src:n(O)(`addon/phone_shop/payment/tabstyle_${t}.png`),mode:"aspectFit"},null,8,["src"])):m("v-if",!0)])),_:2},1032,["class"])))),128))])),_:1})):m("v-if",!0),o(g,{class:"min-h-[90rpx] flex items-center px-[30rpx]"},{default:i((()=>[m(" 收货地址 "),["express","local_delivery"].includes(a.value.delivery.delivery_type)?(r(),d(g,{key:0,class:"w-full",onClick:ee},{default:i((()=>[e.$u.test.isEmpty(p.value.delivery.take_address)?(r(),d(g,{key:1,class:"flex items-center"},{default:i((()=>[o(C,{class:"w-[26rpx] h-[30rpx] mr-[10rpx]",src:n(O)("addon/phone_shop/payment/position_02.png"),mode:"aspectFit"},null,8,["src"]),o(V,{class:"text-[26rpx]"},{default:i((()=>[x("添加收货地址")])),_:1}),o(V,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999] ml-auto"})])),_:1})):(r(),d(g,{key:0,class:"py-[30rpx]"},{default:i((()=>[o(g,{class:"flex items-center"},{default:i((()=>[o(C,{class:"w-[60rpx] h-[60rpx] mr-[20rpx] flex-shrink-0",src:n(O)("addon/phone_shop/payment/position_01.png"),mode:"aspectFit"},null,8,["src"]),o(g,{class:"flex flex-col"},{default:i((()=>[o(V,{class:"text-[22rpx] text-[#999] truncate max-w-[536rpx]"},{default:i((()=>[x(c(p.value.delivery.take_address.full_address.split(p.value.delivery.take_address.address)[0]),1)])),_:1}),o(V,{class:"text-[32rpx] text-[#303133] mt-[16rpx] truncate max-w-[536rpx]"},{default:i((()=>[x(c(p.value.delivery.take_address.address),1)])),_:1})])),_:1}),o(V,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1}),o(g,{class:"flex items-center text-[24rpx] text-[#666] mt-[20rpx]"},{default:i((()=>[o(V,{class:"mr-[16rpx]"},{default:i((()=>[x(c(p.value.delivery.take_address.name),1)])),_:1}),o(V,null,{default:i((()=>[x(c(n($)(p.value.delivery.take_address.mobile)),1)])),_:1})])),_:1})])),_:1}))])),_:1})):m("v-if",!0),m(" 自提点 "),"store"==a.value.delivery.delivery_type?(r(),d(g,{key:1,class:"flex items-center w-full",onClick:t[0]||(t[0]=e=>u.value.open())},{default:i((()=>[e.$u.test.isEmpty(p.value.delivery.take_store)?(r(),d(g,{key:1,class:"flex items-center w-full"},{default:i((()=>[o(C,{class:"w-[26rpx] h-[30rpx] mr-[10rpx]",src:n(O)("addon/phone_shop/payment/position_02.png"),mode:"aspectFit"},null,8,["src"]),o(V,{class:"text-[26rpx]"},{default:i((()=>[x("请选择自提点")])),_:1}),o(V,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1})):(r(),d(g,{key:0,class:"py-[24rpx] w-full"},{default:i((()=>[o(g,{class:"flex items-center mb-[12rpx]"},{default:i((()=>[o(g,{class:"flex flex-col"},{default:i((()=>[o(g,{class:"text-[32rpx] text-[#303133] mb-[16rpx]"},{default:i((()=>[x(c(p.value.delivery.take_store.store_name),1)])),_:1}),o(g,{class:"text-[22rpx] text-[#666]"},{default:i((()=>[x(c(p.value.delivery.take_store.full_address),1)])),_:1})])),_:1}),o(V,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1}),o(g,{class:"text-[22rpx] text-[#666] mb-[12rpx]"},{default:i((()=>[x("手机号："+c(p.value.delivery.take_store.store_mobile),1)])),_:1}),o(g,{class:"text-[22rpx] text-[#666]"},{default:i((()=>[x("营业时间："+c(p.value.delivery.take_store.trade_time),1)])),_:1})])),_:1}))])),_:1})):m("v-if",!0)])),_:1})])),_:1})):m("v-if",!0),p.value.basic.has_goods_types.includes("real")&&!q.value.length?(r(),d(g,{key:1,class:"mb-[20rpx] rounded-[16rpx] bg-white p-[24rpx] py-[40rpx]"},{default:i((()=>[S("p",{class:"text-[26rpx] text-gray-subtitle"},"商家尚未配置配送方式")])),_:1})):m("v-if",!0),o(g,{class:"mb-[20rpx] p-[30rpx] rounded-[16rpx] bg-white"},{default:i((()=>[o(g,{class:"mb-[30rpx]"},{default:i((()=>[(r(!0),_(f,null,v(p.value.goods_data,((e,t,a)=>(r(),d(g,{class:y(["flex",{"pb-[40rpx]":a+1!=Object.keys(p.value.goods_data).length}]),key:a},{default:i((()=>[o(B,{class:"rounded-[10rpx] overflow-hidden",width:"170rpx",height:"170rpx",src:n(O)(e.sku_image.split(",")[0]),model:"aspectFill"},{error:i((()=>[o(C,{class:"w-[170rpx] h-[170rpx] rounded-[10rpx] overflow-hidden",src:n(O)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),o(g,{class:"flex flex-1 w-0 flex-col justify-between ml-[16rpx]"},{default:i((()=>[o(g,{class:"line-normal"},{default:i((()=>[o(g,{class:"truncate text-[#303133] text-[28rpx] leading-[32rpx] font-400"},{default:i((()=>[x(c(e.goods.goods_name),1)])),_:2},1024),e.sku_name?(r(),d(g,{key:0,class:"mt-[14rpx] flex"},{default:i((()=>[o(V,{class:"truncate bg-[#F2F2F2] px-[18rpx] py-[2rpx] rounded-[20rpx] text-[22rpx] text-[#666] leading-[28rpx]"},{default:i((()=>[x(c(e.sku_name),1)])),_:2},1024)])),_:2},1024)):m("v-if",!0)])),_:2},1024),o(g,{class:"alert-wrap mt-[6rpx]"},{default:i((()=>[e.not_support_delivery?(r(),d(U,{key:0,type:"error",description:"该商品不支持当前所选配送方式",class:"leading-[32rpx] !inline-block",fontSize:"12"})):m("v-if",!0)])),_:2},1024),o(g,{class:"flex justify-between items-center"},{default:i((()=>[o(g,{class:"text-[var(--price-text-color)] flex items-baseline price-font"},{default:i((()=>[o(V,{class:"text-[32rpx]"},{default:i((()=>[x(c(e.exchange_info.point)+"积分",1)])),_:2},1024),parseFloat(e.price)?(r(),_(f,{key:0},[o(V,{class:"mx-[4rpx]"},{default:i((()=>[x("+")])),_:1}),o(V,{class:"text-[32rpx] font-500"},{default:i((()=>[x("￥")])),_:1}),o(V,{class:"text-[32rpx] font-500"},{default:i((()=>[x(c(parseFloat(e.price).toFixed(2).split(".")[0]),1)])),_:2},1024),o(V,{class:"text-[32rpx] font-500"},{default:i((()=>[x("."+c(parseFloat(e.price).toFixed(2).split(".")[1]),1)])),_:2},1024)],64)):m("v-if",!0)])),_:2},1024),o(g,{class:"font-400 text-[28rpx] text-[#303133]"},{default:i((()=>[o(V,null,{default:i((()=>[x("x")])),_:1}),o(V,null,{default:i((()=>[x(c(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),m(" 买家留言 "),o(g,{class:"bg-white flex items-center leading-[30rpx]"},{default:i((()=>[o(g,{class:"text-[26rpx] font-400 w-[150rpx] text-[#303133]"},{default:i((()=>[x("买家留言")])),_:1}),o(g,{class:"flex-1 text-[#303133]"},{default:i((()=>[o(N,{type:"text",modelValue:a.value.member_remark,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.member_remark=e),class:"text-right text-[26rpx]",maxlength:"50",placeholder:"请输入留言信息给卖家","placeholder-class":"text-[#999]"},null,8,["modelValue"])])),_:1}),o(V,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1}),m(" 发票 "),D.value&&D.value.invoiceOpen?(r(),d(g,{key:0,class:"flex items-center text-[#303133] leading-[30rpx] mt-[30rpx]",onClick:t[2]||(t[2]=e=>D.value.open())},{default:i((()=>[o(g,{class:"text-[26rpx] w-[150rpx] text-[#303133] font-400"},{default:i((()=>[x("发票信息")])),_:1}),o(g,{class:"flex-1 w-0 text-right truncate"},{default:i((()=>[o(V,{class:"text-[26rpx]"},{default:i((()=>[x(c(a.value.invoice.header_name||"不需要发票"),1)])),_:1})])),_:1}),o(V,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1})):m("v-if",!0)])),_:1}),o(g,{class:"p-[30rpx] rounded-[16rpx] bg-white"},{default:i((()=>[o(g,{class:"text-[32rpx] font-500 text-[#303133] leading-[38rpx]"},{default:i((()=>[x("价格明细")])),_:1}),o(g,{class:"flex items-center mt-[25rpx] text-[#303133]"},{default:i((()=>[o(g,{class:"text-[26rpx] w-[150rpx] leading-[30rpx] text-[#303133] font-400"},{default:i((()=>[x("商品金额")])),_:1}),o(g,{class:"flex-1 w-0 text-right price-font"},{default:i((()=>[o(V,{class:"text-[32rpx]"},{default:i((()=>[x(c(p.value.basic.point_sum)+"积分",1)])),_:1}),p.value.basic&&parseFloat(p.value.basic.goods_money)?(r(),_(f,{key:0},[o(V,{class:"text-[28rpx] mx-[4rpx]"},{default:i((()=>[x("+")])),_:1}),o(V,{class:"text-[32rpx]"},{default:i((()=>[x("￥")])),_:1}),o(V,{class:"text-[32rpx]"},{default:i((()=>[x(c(parseFloat(p.value.basic.goods_money).toFixed(2).split(".")[0]),1)])),_:1}),o(V,{class:"text-[32rpx]"},{default:i((()=>[x("."+c(parseFloat(p.value.basic.goods_money).toFixed(2).split(".")[1]),1)])),_:1})],64)):m("v-if",!0)])),_:1})])),_:1}),p.value.basic.delivery_money?(r(),d(g,{key:0,class:"flex items-center mt-[25rpx]"},{default:i((()=>[o(g,{class:"text-[26rpx] w-[150rpx] leading-[30rpx] text-[#303133] font-400"},{default:i((()=>[x("配送费用")])),_:1}),o(g,{class:"flex-1 w-0 text-right price-font text-[26rpx]"},{default:i((()=>[o(V,{class:"text-[26rpx]"},{default:i((()=>[x("￥")])),_:1}),o(V,{class:"text-[26rpx]"},{default:i((()=>[x(c(parseFloat(p.value.basic.delivery_money).toFixed(2).split(".")[0]),1)])),_:1}),o(V,{class:"text-[26rpx]"},{default:i((()=>[x("."+c(parseFloat(p.value.basic.delivery_money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1})])),_:1})):m("v-if",!0),p.value.basic.discount_money?(r(),d(g,{key:1,class:"flex items-center mt-[25rpx] text-[#303133]"},{default:i((()=>[o(g,{class:"text-[26rpx] w-[150rpx] leading-[30rpx] text-[#303133] font-400"},{default:i((()=>[x("优惠金额")])),_:1}),o(g,{class:"flex-1 w-0 text-right text-[var(--price-text-color)] price-font"},{default:i((()=>[o(V,{class:"text-[26rpx]"},{default:i((()=>[x("-￥")])),_:1}),o(V,{class:"text-[26rpx]"},{default:i((()=>[x(c(parseFloat(p.value.basic.discount_money).toFixed(2).split(".")[0]),1)])),_:1}),o(V,{class:"text-[26rpx]"},{default:i((()=>[x("."+c(parseFloat(p.value.basic.discount_money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1})])),_:1})):m("v-if",!0)])),_:1})])),_:1}),o(P,{fixed:!0,placeholder:!0,safeAreaInsetBottom:!0},{default:i((()=>[o(g,{class:"flex-1 flex items-center justify-between"},{default:i((()=>[o(g,{class:"whitespace-nowrap px-[30rpx]"},{default:i((()=>[o(V,{class:"text-[28rpx] text-[#303133] leading-[32rpx]"},{default:i((()=>[x("合计：")])),_:1}),o(V,{class:"text-[32rpx] font-500 text-[var(--price-text-color)] price-font leading-[32rpx]"},{default:i((()=>[x(c(p.value.basic.point_sum)+"积分",1)])),_:1}),p.value.basic&&parseFloat(p.value.basic.goods_money)?(r(),_(f,{key:0},[o(V,{class:"text-[28rpx] font-500 text-[var(--price-text-color)] price-font leading-[46rpx] mx-[4rpx]"},{default:i((()=>[x("+")])),_:1}),o(V,{class:"text-[32rpx] font-500 text-[var(--price-text-color)] price-font leading-[31rpx]"},{default:i((()=>[x("￥")])),_:1}),o(V,{class:"text-[32rpx] font-500 text-[var(--price-text-color)] price-font leading-[32rpx]"},{default:i((()=>[x(c(parseFloat(p.value.basic.order_money).toFixed(2).split(".")[0]),1)])),_:1}),o(V,{class:"text-[32rpx] font-500 text-[var(--price-text-color)] price-font leading-[32rpx]"},{default:i((()=>[x("."+c(parseFloat(p.value.basic.order_money).toFixed(2).split(".")[1]),1)])),_:1})],64)):m("v-if",!0)])),_:1}),o(J,{class:"primary-btn-bg !border-[0] rounded-[33rpx] text-[#fff] w-[180rpx] h-[66rpx] text-[28rpx] leading-[66rpx] m-0 mr-[30rpx]","hover-class":"none",onClick:X},{default:i((()=>[x("提交订单")])),_:1})])),_:1})])),_:1}),m(" 选择自提点 "),o(n(H),{ref_key:"storeRef",ref:u,onConfirm:te},null,512),m(" 发票 "),o(n(L),{ref_key:"invoiceRef",ref:D,onConfirm:ae},null,512),m(" 地址 "),o(n(M),{ref_key:"addressRef",ref:G,onConfirm:le},null,512),o(Q,{ref_key:"payRef",ref:F,onClose:Z},null,512)])),_:1})):m("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-bcf63370"]]);export{N as default};
