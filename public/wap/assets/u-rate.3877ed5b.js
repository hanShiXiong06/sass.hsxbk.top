import{_ as t}from"./u-icon.5ba98c98.js";import{al as e,am as a,an as i,c0 as n,aW as o,aX as s,bj as c,c1 as l,ar as r,g as d,h,o as u,c as m,w as v,b as f,Y as _,I as p,K as g,J as I,L as y,n as x,f as C,i as b}from"./index-d8a8f699.js";import{_ as W}from"./_plugin-vue_export-helper.1b428a4d.js";const w=W({name:"u-rate",mixins:[a,i,{props:{modelValue:{type:[String,Number],default:()=>e.rate.value},count:{type:[String,Number],default:()=>e.rate.count},disabled:{type:Boolean,default:()=>e.rate.disabled},readonly:{type:Boolean,default:()=>e.rate.readonly},size:{type:[String,Number],default:()=>e.rate.size},inactiveColor:{type:String,default:()=>e.rate.inactiveColor},activeColor:{type:String,default:()=>e.rate.activeColor},gutter:{type:[String,Number],default:()=>e.rate.gutter},minCount:{type:[String,Number],default:()=>e.rate.minCount},allowHalf:{type:Boolean,default:()=>e.rate.allowHalf},activeIcon:{type:String,default:()=>e.rate.activeIcon},inactiveIcon:{type:String,default:()=>e.rate.inactiveIcon},touchable:{type:Boolean,default:()=>e.rate.touchable}}}],data(){return{elId:n(),elClass:n(),rateBoxLeft:0,activeIndex:this.modelValue,rateWidth:0,moving:!1}},watch:{modelValue(t){this.activeIndex=t},activeIndex:"emitEvent"},emits:["update:modelValue","change"],methods:{addStyle:o,addUnit:s,init(){c().then((()=>{this.getRateItemRect(),this.getRateIconWrapRect()}))},async getRateItemRect(){await c(),this.$uGetRect("#"+this.elId).then((t=>{this.rateBoxLeft=t.left}))},getRateIconWrapRect(){this.$uGetRect("."+this.elClass).then((t=>{this.rateWidth=t.width}))},touchMove(t){if(!this.touchable)return;this.preventEvent(t);const e=t.changedTouches[0].pageX;this.getActiveIndex(e)},touchEnd(t){if(!this.touchable)return;this.preventEvent(t);const e=t.changedTouches[0].pageX;this.getActiveIndex(e)},clickHandler(t,e){if("ios"===l()&&this.moving)return;this.preventEvent(t);let a=0;a=t.changedTouches[0].pageX,this.getActiveIndex(a,!0)},emitEvent(){this.$emit("change",this.activeIndex),this.$emit("update:modelValue",this.activeIndex)},getActiveIndex(t,e=!1){if(this.disabled||this.readonly)return;const a=this.rateWidth*this.count+this.rateBoxLeft,i=t=r(this.rateBoxLeft,a,t)-this.rateBoxLeft;let n;if(this.allowHalf){n=Math.floor(i/this.rateWidth);const t=i%this.rateWidth;t<=this.rateWidth/2&&t>0?n+=.5:t>this.rateWidth/2&&n++}else{n=Math.floor(i/this.rateWidth);const t=i%this.rateWidth;e?t>0&&n++:t>this.rateWidth/2&&n++}this.activeIndex=Math.min(n,this.count),this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),setTimeout((()=>{this.moving=!0}),10),setTimeout((()=>{this.moving=!1}),10)}},mounted(){this.init()}},[["render",function(e,a,i,n,o,s){const c=d(h("u-icon"),t),l=b;return u(),m(l,{class:"u-rate",id:o.elId,ref:"u-rate",style:x([s.addStyle(e.customStyle)])},{default:v((()=>[f(l,{class:"u-rate__content",onTouchmove:_(s.touchMove,["stop"]),onTouchend:_(s.touchEnd,["stop"])},{default:v((()=>[(u(!0),p(g,null,I(Number(e.count),((t,a)=>(u(),m(l,{class:y(["u-rate__content__item cursor-pointer",[o.elClass]]),key:a},{default:v((()=>[f(l,{class:"u-rate__content__item__icon-wrap",ref_for:!0,ref:"u-rate__content__item__icon-wrap",onClick:_((t=>s.clickHandler(t,a+1)),["stop"])},{default:v((()=>[f(c,{name:Math.floor(o.activeIndex)>a?e.activeIcon:e.inactiveIcon,color:e.disabled?"#c8c9cc":Math.floor(o.activeIndex)>a?e.activeColor:e.inactiveColor,"custom-style":{padding:`0 ${s.addUnit(e.gutter/2)}`},size:e.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick"]),e.allowHalf?(u(),m(l,{key:0,onClick:_((t=>s.clickHandler(t,a+1)),["stop"]),class:"u-rate__content__item__icon-wrap u-rate__content__item__icon-wrap--half",style:x([{width:s.addUnit(o.rateWidth/2)}]),ref_for:!0,ref:"u-rate__content__item__icon-wrap"},{default:v((()=>[f(c,{name:Math.ceil(o.activeIndex)>a?e.activeIcon:e.inactiveIcon,color:e.disabled?"#c8c9cc":Math.ceil(o.activeIndex)>a?e.activeColor:e.inactiveColor,"custom-style":{padding:`0 ${s.addUnit(e.gutter/2)}`},size:e.size},null,8,["name","color","custom-style","size"])])),_:2},1032,["onClick","style"])):C("v-if",!0)])),_:2},1032,["class"])))),128))])),_:1},8,["onTouchmove","onTouchend"])])),_:1},8,["id","style"])}],["__scopeId","data-v-2d03dda9"]]);export{w as _};
