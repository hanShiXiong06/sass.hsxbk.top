import{d as e,l as t,j as a,m as l,r as s,a7 as o,x as r,p as n,o as c,O as i,b as u,w as d,y as m,z as p,P as f,a6 as _,u as g,c as x,f as b,Y as v,H as y,t as k,ba as h,bb as j,aI as S,i as w,g as C,h as F,a5 as z,C as P,Q as A,E as L,b9 as T,B as I,D as E}from"./index-2882a2d8.js";import{_ as M}from"./u-icon.1104ad2f.js";import{_ as B}from"./u-tag.4c3b3b6c.js";import{_ as O}from"./u-line-progress.db925d9b.js";import{_ as U}from"./u-loading-icon.a37f7e61.js";import{_ as N}from"./tabbar.f422f3d5.js";import{_ as Q}from"./share-poster.cdaa31fc.js";import"./mescroll-uni.5c06c44b.js";import"./mescroll-body.e69cb222.js";import{u as R}from"./useMescroll.26ccf5de.js";import{M as Y}from"./mescroll-empty.7f392528.js";import{c as $,g as D}from"./bwc.9ba4e6d4.js";import{t as H}from"./common.7837e76b.js";import{_ as V}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-transition.4448d2e5.js";/* empty css                                                                       */import"./u-badge.e8ba7dff.js";import"./u-tabbar.b113c065.js";import"./u-safe-bottom.f13b01b8.js";import"./u-popup.2abbe959.js";import"./u-overlay.1a317a4e.js";import"./mescroll-i18n.c2747603.js";/* empty css                                                                       */const W=V(e({__name:"act",setup(e){R();const{setShare:V,onShareAppMessage:W,onShareTimeline:q}=v(),G=t(),J=a((()=>G.info));l();const K=s(uni.getStorageSync("currentPositiontk"));let X=s(null),Z=s(""),ee={};const te=s(0);let ae=s([]),le=s(!1);const se=s(4),oe=s([{name:"所有活动",value:4},{name:"美团",value:2},{name:"饿了么",value:3}]),re=s(uni.getStorageSync("localtkcps"));V(),W(),q();const ne=e=>{T({url:`/addon/tk_cps/pages/bwc/detail?planId=${e.planId}`})},ce=s(1);s([]);const ie=()=>{ue(),le.value=!0;let e={page:ce.value,mapLat:re.value.latitude,mapLon:re.value.longitude,planSource:se.value};D(e).then((e=>{let t=e.data.data.merchantList;1==ce.value?ae.value=t:ae.value=ae.value.concat(t),0==t.length&&(le.value=!1,k({title:"已经没有更多数据",icon:"none"}))})).catch((()=>{le.value=!1}))},ue=()=>{uni.getStorageSync("localtkcps")||j({type:"wgs84",success:function(e){re.value=e,uni.setStorageSync("localtkcps",re.value),de(),ae.value=[],ie()}})},de=()=>{let e={latlng:""};e.latlng=re.value.latitude+","+re.value.longitude,S(e).then((e=>{e.data&&Object.keys(e.data).length?(K.value=e.data.formatted_addresses.recommend,uni.setStorageSync("currentPositiontk",K.value)):K.value="定位中..."}))};return o((()=>{ce.value++,ie()})),r((()=>{J.value&&J.value.member_id&&(Z.value+="?mid="+J.value.member_id)})),n((e=>{if(e.mid)uni.setStorageSync("pid",e.mid),$({pid:e.mid});else{let e=uni.getStorageSync("pid");e&&e>0&&$({pid:e})}ie()})),(e,t)=>{const a=w,l=C(F("u-icon"),M),s=z,o=I,r=E,n=C(F("u-tag"),B),v=C(F("u-line-progress"),O),j=C(F("up-loading-icon"),U),S=P,T=C(F("tabbar"),N),R=C(F("share-poster"),Q);return c(),i(f,null,[u(a,{class:"flex items-center mb-[16rpx] mt-[32rpx] flex-right justify-between mr-2"},{default:d((()=>[u(a,{class:"ml-4 font-bold text-[36rpx]"},{default:d((()=>[m("全城霸王餐")])),_:1}),u(a,{class:"flex items-center"},{default:d((()=>[u(a,null,{default:d((()=>[u(l,{name:"map",color:"#ffab45",size:"18"})])),_:1}),u(a,{onClick:t[0]||(t[0]=e=>{h({success:e=>{re.value=e,uni.setStorageSync("localtkcps",re.value),de(),ae.value=[],ie()},fail:e=>{e.errMsg&&e.errno&&(104==e.errno?k({title:"用户未授权隐私权限，选择位置失败",icon:"none"}):112==e.errno?k({title:"隐私协议中未声明，打开地图选择位置失败",icon:"none"}):k({title:e.errMsg,icon:"none"}))}})}),class:"text-[#ffab45] text-xs tk-sltext"},{default:d((()=>[m(p(K.value),1)])),_:1}),u(a,null,{default:d((()=>[u(l,{name:"arrow-right",color:"#ffab45",size:"18"})])),_:1})])),_:1})])),_:1}),u(a,{class:""},{default:d((()=>[u(s,{"scroll-x":"true",class:"scroll-Y box-border bg-white"},{default:d((()=>[u(a,{class:"flex whitespace-nowrap justify-around"},{default:d((()=>[(c(!0),i(f,null,_(oe.value,((e,t)=>(c(),x(a,{class:A(["text-sm leading-[90rpx]",{"class-select":se.value===e.value}]),onClick:t=>{return a=e.value,ce.value=1,se.value=a,ae.value=[],void ie();var a}},{default:d((()=>[m(p(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1})])),_:1})])),_:1}),(c(!0),i(f,null,_(g(ae),((e,t)=>(c(),x(a,{class:"tk-card"},{default:d((()=>[u(a,{class:"flex"},{default:d((()=>[u(o,{style:{width:"180rpx",height:"140rpx","background-color":"#eeeeee","border-radius":"8px"},src:e.logo,mode:"aspectFill"},null,8,["src"]),u(a,{class:"flex flex-col ml-2 w-[100%] justify-between",style:{}},{default:d((()=>[u(a,{class:"font-bold tk-sltext"},{default:d((()=>[m(p(e.name),1)])),_:2},1024),u(a,{class:"flex justify-between"},{default:d((()=>[u(a,{class:"flex items-center"},{default:d((()=>[u(o,{style:{width:"32rpx",height:"32rpx","background-color":"#eeeeee","border-radius":"8px"},src:e.platformLogo,mode:"aspectFill"},null,8,["src"]),u(a,{class:"text-xs mt-[4rpx] ml-2"},{default:d((()=>[m(p(e.platformName),1)])),_:2},1024)])),_:2},1024),u(a,{class:"text-xs"},{default:d((()=>[m(p(e.distance),1)])),_:2},1024)])),_:2},1024),u(a,{class:"flex justify-between"},{default:d((()=>[u(r,{class:"text-xs"},{default:d((()=>[m("共"+p(e.planList.length)+"个活动",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),(c(!0),i(f,null,_(e.planList,((e,t)=>(c(),x(a,{class:"",key:t},{default:d((()=>[u(a,{class:"flex items-center mt-2 mb-2"},{default:d((()=>[u(a,{class:"bg-slate-100 pl-2 pr-2 pt-1 pb-1 text-xs text-blue-100 rounded-lg"},{default:d((()=>[m("活动"+p(t+1),1)])),_:2},1024),u(a,{class:"text-xs"},{default:d((()=>[u(r,null,{default:d((()=>[m(p("0:0"==g(H)(e.startTime)?"00:00":g(H)(e.startTime))+"-",1)])),_:2},1024),u(r,null,{default:d((()=>[m(p(g(H)(e.endTime)),1)])),_:2},1024)])),_:2},1024),u(a,{class:"line-box"})])),_:2},1024),u(a,{onClick:t=>ne(e),class:"flex justify-between items-center"},{default:d((()=>[u(a,{class:"flex"},{default:d((()=>[u(a,{class:""},{default:d((()=>[u(n,{text:"最高返"+e.commission,bgColor:"#FA6400",borderColor:"#FE5A49",size:"mini"},null,8,["text"])])),_:2},1024),u(a,{class:"ml-2"},{default:d((()=>[1==e.planType?(c(),x(n,{key:0,text:"需要用餐评价",type:"success",plain:"",plainFill:"",size:"mini"})):(c(),x(n,{key:1,text:"无需评价",type:"error",plain:"",plainFill:"",size:"mini",color:"#FA6400"}))])),_:2},1024)])),_:2},1024),u(a,{class:"flex items-center"},{default:d((()=>[u(a,{class:"kucun"},{default:d((()=>[u(r,{class:"text-xs"},{default:d((()=>[m("还剩"+p(e.restStock)+"份",1)])),_:2},1024),u(v,{percentage:e.restStock/e.totalStock*100,activeColor:"#FFBA00",height:"5",showText:!1},null,8,["percentage"])])),_:2},1024),u(l,{name:"arrow-right",color:"#cccccc",size:"10"}),u(a,{class:"ml-2"},{default:d((()=>[e.restStock>0?(c(),x(n,{key:0,onClick:t=>ne(e),text:"去报名",bgColor:"#FA6400",borderColor:"#FE5A49"},null,8,["onClick"])):b("v-if",!0),0==e.restStock?(c(),x(n,{key:1,text:"已抢光",bgColor:"#6e6f6e",borderColor:"#ffffff"})):b("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:2},1024)))),256)),u(j,{class:"mt-4 mb-4",show:g(le),mode:"circle","inactive-color":"#FE5A49","timing-function":"linear"},null,8,["show"]),g(ae).length||0!=g(le)?b("v-if",!0):(c(),x(Y,{key:0,option:{icon:g(L)("static/resource/images/empty.png")}},null,8,["option"])),u(S,{onClick:t[1]||(t[1]=e=>(()=>{if(!J.value){let e=uni.getStorageSync("pid");return e&&e>0?(y().setLoginBack({url:"/addon/tk_cps/pages/bwc/act?mid="+e}),!1):(y().setLoginBack({url:"/addon/tk_cps/pages/bwc/act"}),!1)}J.value&&J.value.member_id&&(ee.member_id=J.value.member_id),X.value.openShare()})()),class:"fixed bottom-48 right-4 z-50 rounded-full p-2 text-white hover:bg-blue-700"},{default:d((()=>[u(l,{name:"share",color:"#000000",size:"24"})])),_:1}),u(T,{addon:"tk_cps"}),u(R,{ref_key:"sharePosterRef",ref:X,posterType:"tk_cps_bwc",posterId:te.value,posterParam:g(ee),copyUrlParam:g(Z)},null,8,["posterId","posterParam","copyUrlParam"])],64)}}}),[["__scopeId","data-v-afd7b7d4"]]);export{W as default};
