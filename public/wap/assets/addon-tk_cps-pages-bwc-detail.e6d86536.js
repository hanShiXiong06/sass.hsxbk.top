import{d as e,r as l,Z as a,l as t,j as s,x as r,p as o,o as i,P as u,c as n,w as c,b as d,y as p,z as f,u as m,Q as x,a7 as _,f as v,bc as b,H as g,s as h,a as y,J as w,B as k,i as j,g as S,h as F,D as z,C,aG as T}from"./index-7bf68536.js";import{_ as A}from"./u-tag.c797e3e1.js";import{_ as I}from"./u-line-progress.288a6e80.js";import{_ as P}from"./u-parse.525658f5.js";import{_ as L}from"./u-icon.0c1c54c7.js";import{_ as B}from"./u-button.359d7329.js";import{_ as H}from"./u-input.09a5cedd.js";import{_ as U}from"./u-popup.be4bfacd.js";import{s as D}from"./share-poster.5efeffe7.js";import{c as R,s as V,d as E}from"./bwc.28e2fa51.js";import{g as G,t as N}from"./common.1828864e.js";import{_ as O}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-transition.cdf87992.js";import"./u-loading-icon.b37701e7.js";import"./u-safe-bottom.908eeae4.js";/* empty css                                                                     */const $=O(e({__name:"detail",setup(e){const O=l(uni.getStorageSync("orderphone")),{setShare:$,onShareAppMessage:J,onShareTimeline:M}=a();$(),J(),M();const Q=e=>{b({url:e})},X=l(!1),Z=t(),q=s((()=>Z.info));let K=l(null),W=l(""),Y={};const ee=l(0),le=l(!1);l(!1);const ae=()=>{le.value=!0},te=async()=>{if(uni.setStorageSync("orderphone",O.value),!O.value)return le.value=!0,void uni.$u.toast("请填写电话号码");if(!h())return g().setLoginBack({url:"/addon/tk_cps/pages/bwc/detail",param:{planId:re.value.plan.planId}}),!1;se.value=G(),X.value=!0;try{const l=await V({planId:re.value.plan.planId,telephone:O.value,mapLat:se.value.latitude||"39.908823",mapLon:se.value.longitude||"116.39747",data:re.value});le.value=!1,X.value=!1,e=l.data,y({url:"/addon/tk_cps/pages/bwc/orderdetail?id="+e})}catch(l){le.value=!1,X.value=!1}var e},se=l(),re=l();return r((()=>{q.value&&q.value.member_id&&(W.value+="?mid="+q.value.member_id)})),o((e=>{if(e.mid)uni.setStorageSync("pid",e.mid),R({pid:e.mid});else{let e=uni.getStorageSync("pid");e&&e>0&&R({pid:e})}e.planId&&(async e=>{se.value=G();const l=await E({planId:e,mapLat:se.value.latitude,mapLon:se.value.longitude,telephone:O.value||"13545454545"});0!=l.data.code&&(uni.$u.toast("请切换地址--"+l.data.message),setTimeout((()=>{uni.removeStorageSync("localtkcps"),y({url:"/addon/tk_cps/pages/diy"})}),1e3)),re.value=l.data.data,w({title:re.value.name})})(e.planId)})),(e,l)=>{const a=k,t=j,s=S(F("u-tag"),A),r=z,o=S(F("u-line-progress"),I),b=S(F("u-parse"),P),h=S(F("u-icon"),L),y=S(F("u-button"),B),w=S(F("u-input"),H),R=S(F("u-popup"),U),V=C,E=S(F("share-poster"),D);return i(),u(x,null,[re.value?(i(),n(t,{key:0,class:"detail-box"},{default:c((()=>[d(t,{class:"tk-card"},{default:c((()=>[d(t,{class:"flex"},{default:c((()=>[d(a,{style:{width:"120rpx",height:"100rpx","background-color":"#eeeeee","border-radius":"8px"},src:re.value.logo,mode:"aspectFill"},null,8,["src"]),d(t,{class:"flex flex-col ml-2 w-[100%] text-xs justify-between",style:{}},{default:c((()=>[d(t,{class:"font-bold tk-sltext"},{default:c((()=>[p(f(re.value.name),1)])),_:1}),d(t,{class:"flex justify-between"},{default:c((()=>[d(t,{class:"flex items-center"},{default:c((()=>[d(a,{style:{width:"32rpx",height:"32rpx","background-color":"#eeeeee","border-radius":"8px"},src:re.value.platformLogo,mode:"aspectFill"},null,8,["src"]),d(t,{class:"text-xs mt-[4rpx] ml-2"},{default:c((()=>[p(f(re.value.platformName),1)])),_:1})])),_:1}),d(t,null,{default:c((()=>[p(f(re.value.distance),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(t,{class:"flex mt-3 items-center"},{default:c((()=>[d(t,{class:""},{default:c((()=>[d(s,{class:"",text:"按实付"+re.value.plan.ratio+"%返",bgColor:"#FA6400",borderColor:"#FE5A49",size:"mini"},null,8,["text"])])),_:1}),d(t,{class:"ml-2 mr-2"},{default:c((()=>[d(s,{text:"最高可返"+re.value.plan.commission,type:"error",plain:"",plainFill:"",size:"mini"},null,8,["text"])])),_:1}),d(t,{class:""},{default:c((()=>[1==re.value.plan.planType?(i(),n(s,{key:0,text:"需要用餐评价",type:"success",plain:"",plainFill:"",size:"mini"})):(i(),n(s,{key:1,text:"无需评价",type:"error",plain:"",plainFill:"",size:"mini",color:"#FA6400"}))])),_:1})])),_:1}),d(t,{class:"line-box w-[100%] mt-3 mb-3"}),d(t,{class:"flex mt-2 justify-between items-center"},{default:c((()=>[d(t,{class:"flex text-xs"},{default:c((()=>[d(r,null,{default:c((()=>[p(f("0:0"==m(N)(re.value.plan.startTime)?"00:00":m(N)(e.item1.startTime))+"-",1)])),_:1}),d(r,null,{default:c((()=>[p(f(m(N)(re.value.plan.endTime)),1)])),_:1})])),_:1}),d(t,{class:"flex items-center"},{default:c((()=>[d(t,{class:""},{default:c((()=>[d(r,{class:"text-xs mb-1"},{default:c((()=>[p("还剩"+f(re.value.plan.restStock)+"份",1)])),_:1}),d(o,{percentage:re.value.plan.restStock/re.value.plan.totalStock*100,activeColor:"#FFBA00",height:"5",showText:!1},null,8,["percentage"])])),_:1})])),_:1})])),_:1}),re.value.sku_list&&re.value.sku_list.length>0?(i(),n(t,{key:0,class:"flex flex-wrap justify-start"},{default:c((()=>[(i(!0),u(x,null,_(re.value.sku_list,((e,l)=>(i(),u(x,{key:l},[l<=3?(i(),n(t,{key:0,class:"w-[20%] p-1 rounded-lg mr-1"},{default:c((()=>[d(a,{src:e.picUrl,mode:"aspectFill",style:{width:"140rpx",height:"140rpx","background-color":"#eeeeee","border-radius":"8px"}},null,8,["src"]),d(t,{class:"text-xs tk-sltext"},{default:c((()=>[p(f(e.name),1)])),_:2},1024),d(t,{class:"flex align-items-end"},{default:c((()=>[d(t,{class:"price"},{default:c((()=>[p(f(e.actPrice),1)])),_:2},1024),d(t,{class:"oriPrice-line text-xs ml-1"},{default:c((()=>[p("￥"+f(e.oriPrice),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):v("v-if",!0)],64)))),128))])),_:1})):v("v-if",!0),d(t,{class:"flex mt-1"},{default:c((()=>[d(s,{onClick:l[0]||(l[0]=e=>(e=>{let l=e.actionUrl;1==e.platform&&(window.location.href=l.h5.mt),2==e.platform&&(window.location.href=l.h5.elm)})(re.value)),text:"查看店铺",type:"error",plain:"",plainFill:"",size:"mini",color:"#FA6400"})])),_:1})])),_:1}),d(t,{class:"tk-card"},{default:c((()=>[d(t,{class:"flex"},{default:c((()=>[d(t,{class:"font-bold"},{default:c((()=>[p("活动要求")])),_:1}),d(t,{class:"ml-2"},{default:c((()=>[p(" 先抢名额再下单")])),_:1})])),_:1}),d(t,{class:"flex mt-3 justify-between text-xs mb-2"},{default:c((()=>[d(t,{class:"font-bold"},{default:c((()=>[p("平台")])),_:1}),d(t,{class:"flex"},{default:c((()=>[d(a,{style:{width:"32rpx",height:"32rpx","background-color":"#eeeeee","border-radius":"8px"},src:re.value.platformLogo,mode:"aspectFill"},null,8,["src"]),d(t,{class:"ml-1"},{default:c((()=>[p(f(re.value.platformName),1)])),_:1}),d(t,{class:"ml-4"},{default:c((()=>[p("剩余名额"+f(re.value.plan.restStock)+"份",1)])),_:1})])),_:1})])),_:1}),d(t,{class:"line-box w-[100%] mb-3"}),d(t,{class:"flex justify-between text-xs mb-2"},{default:c((()=>[d(t,{class:"font-bold"},{default:c((()=>[p("报名手机号")])),_:1}),d(t,{class:"flex items-center"},{default:c((()=>[d(t,{class:"ml-2 mr-2"},{default:c((()=>[p(f(m(T)(O.value)),1)])),_:1}),O.value?(i(),n(s,{key:0,onClick:l[1]||(l[1]=e=>ae()),class:"ml-2",text:"修改",type:"error",plain:"",plainFill:"",size:"mini"})):v("v-if",!0),O.value?v("v-if",!0):(i(),n(s,{key:1,onClick:l[2]||(l[2]=e=>ae()),class:"ml-2",text:"填写手机号",type:"error",plain:"",plainFill:"",size:"mini"}))])),_:1})])),_:1}),d(t,{class:"line-box w-[100%] mb-3"}),d(t,{class:"flex text-xs mb-2 justify-between"},{default:c((()=>[d(t,{class:"font-bold"},{default:c((()=>[p("要求")])),_:1}),d(t,{class:"flex"},{default:c((()=>[d(t,{class:"ml-2"},{default:c((()=>[p(f(re.value.plan.planTypeCh),1)])),_:1}),d(t,{class:"ml-2 text-[#FA6400]"},{default:c((()=>[p(f(re.value.plan.planTypeDescCh),1)])),_:1})])),_:1})])),_:1}),d(t,{class:"line-box mb-3 bg-[#ffc300]",style:{"background-color":"#ffc300"}}),d(t,{class:"flex justify-between text-xs"},{default:c((()=>[d(t,{class:"font-bold"},{default:c((()=>[p("限购")])),_:1}),d(t,{class:"ml-2"},{default:c((()=>[p(f(re.value.limitBuyCh),1)])),_:1})])),_:1})])),_:1}),d(t,{class:"tk-card"},{default:c((()=>[d(t,{class:"font-bold"},{default:c((()=>[p("报名须知")])),_:1}),d(b,{content:re.value.rule},null,8,["content"])])),_:1}),d(t,{class:"mt-[380rpx] mb-[260rpx] flex items-center"}),d(t,{class:"b-tabbar safe-area-inset-bottom"},{default:c((()=>[d(t,{class:"b-tabbar-back fb items-center p-2"},{default:c((()=>[d(t,{class:"flex flex-col items-center",onClick:l[3]||(l[3]=e=>Q("/addon/tk_cps/pages/bwc/act"))},{default:c((()=>[d(h,{name:"clock",color:"#000000",size:"22"}),d(t,{class:"text-xs font-bold"},{default:c((()=>[p("活动")])),_:1})])),_:1}),d(t,{class:"flex flex-col items-center",onClick:l[4]||(l[4]=e=>Q("/addon/tk_cps/pages/bwc/order"))},{default:c((()=>[d(h,{name:"order",color:"#000000",size:"22"}),d(t,{class:"text-xs font-bold"},{default:c((()=>[p("订单")])),_:1})])),_:1}),d(y,{loading:X.value,loadingText:"正在报名",color:"#FA6400",shape:"circle",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"278rpx"},type:"primary",size:"12",onClick:l[5]||(l[5]=e=>te())},{default:c((()=>[p("立即报名")])),_:1},8,["loading"])])),_:1}),v(" \t\t<u-safe-bottom></u-safe-bottom> ")])),_:1})])),_:1})):v("v-if",!0),d(R,{show:le.value,mode:"center",round:10,"border-radius":20,"safe-area-inset-bottom":!0},{default:c((()=>[d(t,{class:"p-4 items-center"},{default:c((()=>[d(t,{class:""},{default:c((()=>[p("请填写正确手机号")])),_:1}),d(t,{class:"ml-2 mb-4 text-[#fc7777] text-xs"},{default:c((()=>[p("*"+f(re.value.plan.planTypeDescCh),1)])),_:1}),d(w,{modelValue:O.value,"onUpdate:modelValue":l[6]||(l[6]=e=>O.value=e),placeholder:"请输入手机号",type:"number"},null,8,["modelValue"]),d(t,{class:"flex justify-between mt-2 mb-2"},{default:c((()=>[d(y,{color:"#828282",shape:"circle",size:"small",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"200rpx",marginTop:"12rpx",marginRight:"12rpx"},onClick:l[7]||(l[7]=e=>le.value=!1)},{default:c((()=>[p("关闭")])),_:1}),d(y,{loading:X.value,loadingText:"正在报名",color:"#FA6400",shape:"circle",size:"small",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"200rpx",marginTop:"12rpx"},onClick:l[8]||(l[8]=e=>te())},{default:c((()=>[p("立即报名")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["show"]),v(' <u-popup :show="showSubmitOrder" mode="center" :round="10" :border-radius="20" :safe-area-inset-bottom="true">\r\n\t\t<view class="p-4">\r\n\t\t\t<view class="">提示</view>\r\n\t\t\t<view class="">订单创建成功，请及时填写订单号</view>\r\n\t\t\t<view class="flex justify-end mt-2 mb-2">\r\n\t\t\t\t<u-button color="#828282" shape="circle" size="small"\r\n\t\t\t\t\t:customStyle="{lineHeight:\'76rpx\', margin:\'0rpx\', color:\'#fff\',width:\'120rpx\',marginTop:\'12rpx\',marginRight:\'12rpx\'}"\r\n\t\t\t\t\t@click="goOrder()">去下单</u-button>\r\n\t\t\t\t<u-button color="#FA6400" shape="circle" size="small"\r\n\t\t\t\t\t:customStyle="{lineHeight:\'76rpx\', margin:\'0rpx\', color:\'#fff\',width:\'240rpx\',marginTop:\'12rpx\'}"\r\n\t\t\t\t\t@click="showEditPhone=false">领大额优惠券</u-button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</u-popup> '),d(V,{onClick:l[9]||(l[9]=e=>(()=>{if(!q.value){let e=uni.getStorageSync("pid");return e&&e>0?(g().setLoginBack({url:"/addon/tk_cps/pages/bwc/act?mid="+e}),!1):(g().setLoginBack({url:"/addon/tk_cps/pages/bwc/act"}),!1)}q.value&&q.value.member_id&&(Y.member_id=q.value.member_id),K.value.openShare()})()),class:"fixed bottom-48 right-4 z-50 rounded-full p-2 text-white hover:bg-blue-700"},{default:c((()=>[d(h,{name:"share",color:"#000000",size:"24"})])),_:1}),d(E,{ref_key:"sharePosterRef",ref:K,posterType:"tk_cps_bwc",posterId:ee.value,posterParam:m(Y),copyUrlParam:m(W)},null,8,["posterId","posterParam","copyUrlParam"])],64)}}}),[["__scopeId","data-v-87d21ae4"]]);export{$ as default};
