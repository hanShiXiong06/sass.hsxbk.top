import{d as e,r as a,p as l,aR as s,j as t,aS as d,t as r,o,c as u,w as n,b as i,u as c,y as m,z as p,n as v,aQ as f,aT as b,a as _,i as g,g as h,h as y,ac as x,F as V,Q as S,R as w,b7 as k,aU as q,bX as j,S as C}from"./index-71c7df08.js";import{m as U}from"./manifest.6e483234.js";const $=e({__name:"edit",setup(e){a("");const $=a({id:0,name:"",mobile:"",lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:"",type:"location_address"}),I=a(!1);a(null),l((e=>{if(e.id)s(e.id).then((({data:e})=>{e&&(Object.assign($.value,e),$.value.area=$.value.full_address.replace($.value.address,"").replace($.value.address_name,""))})).catch();else if(option.name){uni.getStorageSync("addressInfo")&&Object.assign($.value,uni.getStorageSync("addressInfo")),$.value.address=option.name,T(option.latng);var a=A("latng").split(",");$.value.lat=a[0],$.value.lng=a[1]}}));const P=a(null),R=t((()=>({address:{type:"string",required:!0,message:"请填写门牌号",trigger:["blur","change"]},name:{type:"string",required:!0,message:"请输入联系人姓名",trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:"请输入手机号码",trigger:["blur","change"]},{validator:()=>uni.$u.test.mobile($.value.mobile),message:"请输入正确的手机号"}]}))),A=e=>{for(var a=window.location.search.substring(1).split("&"),l=0;l<a.length;l++){var s=a[l].split("=");if(s[0]==e)return s[1]}return!1},T=e=>{d({latlng:e}).then((e=>{e.data&&e.data.length?($.value.full_address="",$.value.full_address+=null!=e.data.province?e.data.province:"",$.value.full_address+=null!=e.data.city?""+e.data.city:"",$.value.full_address+=null!=e.data.district?""+e.data.district:"",$.value.address_name=$.value.full_address.replace(/-/g,""),$.value.area=e.data.full_address,$.value.province_id=null!=e.data.province_id?e.data.province_id:0,$.value.city_id=null!=e.data.city_id?e.data.city_id:0,$.value.district_id=null!=e.data.district_id?e.data.district_id:0):r({title:e.msg,icon:"none"})}))},z=a(!1),O=()=>{if(uni.$u.test.isEmpty($.value.area))return void r({title:"请选择地址",icon:"none"});const e=$.value.id?f:b;P.value.validate().then((()=>{z.value||(z.value=!0,I.value=!0,$.value.full_address=`${$.value.area}${$.value.address_name}${$.value.address}`,e($.value).then((e=>{z.value=!1,uni.removeStorageSync("addressInfo"),setTimeout((()=>{I.value=!1,_({url:"/addon/o2o/pages/address/index"})}),1e3)})).catch((()=>{z.value=!1,I.value=!1})))}))},Q=()=>{var e=$.value;uni.setStorageSync("addressInfo",e);let a=location.href;window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(a)+"&key="+U.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"};return(e,a)=>{const l=g,s=h(y("u-input"),S),t=h(y("u-form-item"),w),d=h(y("u-icon"),k),r=h(y("u-switch"),q),f=h(y("u-button"),j),b=h(y("u-form"),C),_=x;return o(),u(l,{style:v(e.themeColor())},{default:n((()=>[i(_,{"scroll-y":"true",class:"bg-page h-screen"},{default:n((()=>[i(l,{class:"h-[30rpx]"}),i(l,{class:"m-[30rpx] mt-0 p-[30rpx] pt-[10rpx] rounded-md bg-white"},{default:n((()=>[i(b,{labelPosition:"left",model:$.value,labelWidth:"200rpx",errorType:"toast",rules:c(R),ref_key:"formRef",ref:P},{default:n((()=>[i(l,{class:"mt-[10rpx]"},{default:n((()=>[i(t,{label:c(V)("name"),prop:"name","border-bottom":!0},{default:n((()=>[i(s,{modelValue:$.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>$.value.name=e),border:"none",clearable:"",maxlength:"25",placeholder:c(V)("namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),i(l,{class:"mt-[10rpx]"},{default:n((()=>[i(t,{label:c(V)("mobile"),prop:"mobile","border-bottom":!0},{default:n((()=>[i(s,{modelValue:$.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>$.value.mobile=e),border:"none",clearable:"",placeholder:c(V)("mobilePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),i(l,{class:"mt-[10rpx]"},{default:n((()=>[i(t,{label:c(V)("homeAddress"),prop:"address_name","border-bottom":!0},{default:n((()=>[i(l,{class:"flex justify-between flex-1",onClick:Q},{default:n((()=>[i(l,{class:"text-[#c3c4d5] text-[15px]"},{default:n((()=>[m(p($.value.area?$.value.address_name:c(V)("selectAddressPlaceholder")),1)])),_:1}),i(d,{name:"arrow-right",color:"#c3c4d5"})])),_:1})])),_:1},8,["label"])])),_:1}),i(l,{class:"mt-[10rpx]"},{default:n((()=>[i(t,{label:c(V)("address"),prop:"address","border-bottom":!0},{default:n((()=>[i(s,{modelValue:$.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>$.value.address=e),border:"none",clearable:"",maxlength:"120",placeholder:c(V)("addressPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),i(l,{class:"mt-[10rpx]"},{default:n((()=>[i(t,{label:c(V)("defaultAddress"),prop:"name","border-bottom":!0},{default:n((()=>[i(r,{modelValue:$.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),i(l,{class:"mt-[40rpx]"},{default:n((()=>[i(f,{class:"text-[var-(--primary-color)]",type:"primary",shape:"circle",text:c(V)("save"),onClick:O,disabled:I.value,loading:z.value},null,8,["text","disabled","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1})])),_:1},8,["style"])}}});export{$ as default};
