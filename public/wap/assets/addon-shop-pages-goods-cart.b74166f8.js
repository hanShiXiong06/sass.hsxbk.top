import{d as e,l as t,m as l,r,a9 as s,W as o,t as a,o as d,c,w as i,u,b as x,x as n,y as p,E as f,F as m,G as g,f as _,H as h,n as v,B as b,I as k,a as w,N as y,i as F,ab as S,C as j,g as C,h as z,a4 as V,V as E,X as I,aj as H}from"./index-656dc629.js";import{_ as P}from"./u-icon.286409fc.js";import{_ as B}from"./u--image.8451ef47.js";import{_ as L}from"./u-number-box.7dc72c85.js";import{_ as R}from"./u-swipe-action-item.5d1cdbba.js";import{_ as U}from"./u-swipe-action.5ac2b80d.js";import{_ as A}from"./u-button.e2de732d.js";import{_ as D}from"./u-loading-page.f8275a02.js";import{_ as G}from"./tabbar.d997a979.js";import{u as N,g as O}from"./cart.f9388c32.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.38c45e12.js";import"./u-transition.825c0e35.js";import"./u-loading-icon.5e5c27a0.js";import"./u-badge.973492be.js";import"./u-tabbar.8ee28cae.js";import"./u-safe-bottom.d9fa806b.js";const W=T(e({__name:"cart",setup(e){const T=t(),W=l((()=>T.info)),X=r(!0),Y=r(!1),Z=r("0.00"),$=r([]),q=r([]),J=r(!1),K=r(!0),M=N(),Q=()=>{O({}).then((({data:e})=>{$.value=[],q.value=[],X.value=!1,e.forEach((e=>{e.checked=!1,e.goods.status&&0==e.goods.delete_time&&e.goodsSku.stock?(e.num>e.goodsSku.stock&&(e.num=e.goodsSku.stock),$.value.push(e)):q.value.push(e)})),oe(),K.value&&(K.value=!1)})).catch((e=>{401==e.code&&($.value=[],q.value=[],X.value=!1)}))};s((()=>{Q(),M.getList()}));const ee=l((()=>{let e=0;return $.value.forEach((t=>{t.checked&&(e+=1)})),e}));o((()=>$.value),(()=>{let e=0;$.value.forEach((t=>{if(t.checked&&t.goodsSku){let l=0;l=t.goods.is_discount?t.goodsSku.sale_price:t.goods.member_discount&&I()?t.goodsSku.member_price:t.goodsSku.price,e+=parseFloat(l)*t.num}})),Z.value=e.toFixed(2)}),{deep:!0});const te=()=>{b().setLoginBack({url:"/addon/shop/pages/goods/cart"})},le=e=>({min:1,max:e.goodsSku.stock||1}),re=r([{text:a("delete"),style:{backgroundColor:"#F56C6C"}}]),se=r(),oe=()=>{const e=$.value.length!=ee.value;$.value.forEach((t=>{t.checked=e}))},ae=()=>{if(!ee.value)return void k({title:"还没有选择商品",icon:"none"});const e=[];$.value.forEach((t=>{t.checked&&e.push(t.id)})),uni.setStorage({key:"orderCreateData",data:{cart_ids:e},success(){w({url:"/addon/shop/pages/order/payment"})}})},de=()=>{if(!ee.value)return void k({title:"还没有选择商品",icon:"none"});if(Y.value)return;Y.value=!0;const e=[];$.value.forEach((t=>{t.checked&&e.push(t.id)})),M.delete(e,(()=>{Q(),Y.value=!1}))},ce=()=>{if(Y.value)return;Y.value=!0;const e=q.value.map((e=>e.id));M.delete(e,(()=>{Q(),Y.value=!1})),q.value=[]};let ie=e=>{let t="";return t=e.goods.is_discount?"discount_price":e.goods.member_discount&&I()?"member_price":"",t},ue=e=>{let t="0.00";return t=e.goods.is_discount?e.goodsSku.sale_price?e.goodsSku.sale_price:e.goodsSku.price:e.goods.member_discount&&I()&&e.goodsSku.member_price?e.goodsSku.member_price:e.goodsSku.price,t};return(e,t)=>{const l=y,r=F,s=S,o=j,a=C(z("u-icon"),P),b=C(z("u--image"),B),k=C(z("u-number-box"),L),I=C(z("u-swipe-action-item"),R),N=C(z("u-swipe-action"),U),O=V,T=C(z("u-button"),A),K=C(z("u-loading-page"),D),Q=C(z("tabbar"),G);return d(),c(r,{style:v(e.themeColor())},{default:i((()=>[X.value?_("v-if",!0):(d(),c(r,{key:0,class:"bg-page h-screen overflow-hidden flex flex-col"},{default:i((()=>[u(W)?$.value.length||q.value.length?(d(),c(r,{key:2,class:"flex-1 h-0"},{default:i((()=>[x(O,{class:"scroll-height box-border","scroll-y":!0},{default:i((()=>[x(r,{class:"py-[20rpx] px-[30rpx]"},{default:i((()=>[$.value.length?(d(),c(r,{key:0,class:"bg-[#fff] pb-[10rpx] box-border rounded-[16rpx]"},{default:i((()=>[x(r,{class:"flex px-[20rpx] justify-between items-center h-[79rpx] box-border font-400 text-[#303133] text-[24rpx] mb-[10rpx] leading-[30rpx] border-0 border-b-[2rpx] border-solid border-[#f6f6f6]"},{default:i((()=>[x(o,null,{default:i((()=>[n("共"),x(o,{class:"text-[var(--price-text-color)]"},{default:i((()=>[n(p($.value.length),1)])),_:1}),n("件商品")])),_:1}),x(o,{onClick:t[1]||(t[1]=e=>J.value=!J.value),class:"text-[#666] text-[26rpx]"},{default:i((()=>[n(p(J.value?"完成":"管理"),1)])),_:1})])),_:1}),x(N,{ref_key:"swipeActive",ref:se},{default:i((()=>[(d(!0),f(g,null,m($.value,((e,t)=>(d(),f(g,null,[e.goodsSku?(d(),c(r,{key:0,class:"py-[20rpx] overflow-hidden w-full"},{default:i((()=>[x(I,{options:re.value,onClick:l=>((e,t)=>{Y.value||(Y.value=!0,M.delete(t.id,(()=>{$.value.splice(e,1),H((()=>{se.value&&se.value.closeOther()})),Y.value=!1})))})(t,e)},{default:i((()=>[x(r,{class:"flex px-[20rpx]"},{default:i((()=>[x(o,{class:h(["self-center iconfont text-color text-[34rpx] mr-[20rpx] w-[34rpx] h-[34rpx] rounded-[17rpx] overflow-hidden shrink-0",{iconxuanze1:e.checked,"bg-[#F5F5F5]":!e.checked}]),onClick:t=>e.checked=!e.checked},null,8,["class","onClick"]),x(b,{class:"rounded-[8rpx] overflow-hidden",width:"170rpx",height:"170rpx",onClick:t=>{w({url:"/addon/shop/pages/goods/detail",param:{goods_id:e.goods_id}})},src:u(E)(e.goodsSku.sku_image_thumb_mid||""),model:"aspectFill"},{error:i((()=>[x(a,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["onClick","src"]),x(r,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:i((()=>[x(r,{class:"w-[100%]"},{default:i((()=>[x(r,{class:"w-[406rpx] text-[#333] text-[28rpx] max-h-[80rpx] leading-[40rpx] multi-hidden font-400"},{default:i((()=>[n(p(e.goods.goods_name),1)])),_:2},1024),x(r,{class:"w-[406rpx] mt-[12rpx] truncate text-[#888] text-[24rpx] leading-[32rpx]"},{default:i((()=>[n(p(e.goodsSku.sku_spec_format),1)])),_:2},1024)])),_:2},1024),x(r,{class:"flex justify-between items-end self-end w-[100%]"},{default:i((()=>[x(r,{class:"flex items-end text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:i((()=>[x(o,{class:"text-[var(--price-text-color)] price-font"},{default:i((()=>[x(o,{class:"text-[26rpx] font-500"},{default:i((()=>[n("￥")])),_:1}),x(o,{class:"text-[36rpx] font-500"},{default:i((()=>[n(p(parseFloat(u(ue)(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),x(o,{class:"text-[24rpx] font-500"},{default:i((()=>[n("."+p(parseFloat(u(ue)(e)).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==u(ie)(e)?(d(),c(l,{key:0,class:"h-[24rpx] ml-[6rpx]",src:u(E)("addon/shop/VIP.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0),"discount_price"==u(ie)(e)?(d(),c(l,{key:1,class:"h-[24rpx] ml-[6rpx]",src:u(E)("addon/shop/discount.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0)])),_:2},1024)])),_:2},1024),x(k,{modelValue:e.num,"onUpdate:modelValue":t=>e.num=t,min:le(e).min,max:le(e).max,integer:"",step:1,"input-width":"68rpx","input-height":"52rpx","button-size":"52rpx",disabledInput:"",onChange:e=>((e,t)=>{uni.$u.debounce((e=>{const l=$.value[t];M.increase({id:l.id,goods_id:l.goods_id,sku_id:l.sku_id,stock:l.goodsSku.stock,sale_price:l.goodsSku.sale_price,num:l.num},0)}),500)})(0,t)},{minus:i((()=>[x(o,{class:h([{"text-[#999]":e.num===le(e).min,"text-[#303133]":e.num!==le(e).min},"text-[34rpx] nc-iconfont nc-icon-jianV6xx"])},null,8,["class"])])),input:i((()=>[x(o,{class:"text-[#303133] text-[24rpx] mx-[10rpx] min-w-[56rpx] h-[38rpx] leading-[40rpx] text-center border-[1rpx] border-solid border-[#ddd] rounded-[4rpx]"},{default:i((()=>[n(p(e.num),1)])),_:2},1024)])),plus:i((()=>[x(o,{class:h([{"text-[#999]":e.num===le(e).max," text-[#303133]":e.num!==le(e).max},"text-[34rpx] nc-iconfont nc-icon-jiahaoV6xx"])},null,8,["class"])])),_:2},1032,["modelValue","onUpdate:modelValue","min","max","onChange"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["options","onClick"])])),_:2},1024)):_("v-if",!0)],64)))),256))])),_:1},512)])),_:1})):_("v-if",!0),q.value.length?(d(),c(r,{key:1,class:"bg-[#fff] pb-[10rpx] box-border rounded-[16rpx] mt-[20rpx]"},{default:i((()=>[x(r,{class:"flex px-[20rpx] justify-between items-center h-[79rpx] box-border font-400 text-[#303133] text-[24rpx] mb-[10rpx] leading-[30rpx] border-0 border-b-[2rpx] border-solid border-[#f6f6f6]"},{default:i((()=>[x(o,null,{default:i((()=>[n("共"),x(o,{class:"text-[var(--price-text-color)]"},{default:i((()=>[n(p(q.value.length),1)])),_:1}),n("件失效商品")])),_:1}),x(o,{class:"text-[#666] text-[26rpx]",onClick:ce},{default:i((()=>[n("清空")])),_:1})])),_:1}),(d(!0),f(g,null,m(q.value,((e,t)=>(d(),c(r,{class:"py-[20rpx] overflow-hidden"},{default:i((()=>[x(r,{class:"flex px-[20rpx]"},{default:i((()=>[x(o,{class:"self-center iconfont iconxuanze1 text-[34rpx] mr-[20rpx] text-[#F5F5F5] rounded-[50%] overflow-hidden shrink-0"}),x(r,{class:"relative w-[168rpx] h-[168rpx]"},{default:i((()=>[x(b,{class:"rounded-[8rpx] overflow-hidden",width:"168rpx",height:"168rpx",src:u(E)(e.goodsSku.sku_image_thumb_mid),model:"aspectFill"},{error:i((()=>[x(a,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["src"]),0==e.goodsSku.stock?(d(),c(r,{key:0,class:"absolute left-0 top-0 w-[168rpx] h-[168rpx] leading-[168rpx] text-center",style:{"background-color":"rgba(0,0,0,0.3)"}},{default:i((()=>[x(o,{class:"text-[#fff] text-[24rpx]"},{default:i((()=>[n("已售罄")])),_:1})])),_:1})):_("v-if",!0),0!=e.goodsSku.stock?(d(),c(r,{key:1,class:"absolute left-0 top-0 w-[168rpx] h-[168rpx] leading-[168rpx] text-center",style:{"background-color":"rgba(0,0,0,0.3)"}},{default:i((()=>[x(o,{class:"text-[#fff] text-[24rpx]"},{default:i((()=>[n("已失效")])),_:1})])),_:1})):_("v-if",!0)])),_:2},1024),x(r,{class:"flex flex-1 flex-wrap ml-[20rpx]"},{default:i((()=>[x(r,{class:"w-[100%]"},{default:i((()=>[x(r,{class:"w-[406rpx] text-[#333] text-[28rpx] max-h-[80rpx] leading-[40rpx] font-400 multi-hidden"},{default:i((()=>[n(p(e.goods.goods_name),1)])),_:2},1024),x(r,{class:"w-[406rpx] mt-[12rpx] truncate text-[#888] text-[24rpx] leading-[32rpx]"},{default:i((()=>[n(p(e.goodsSku.sku_spec_format),1)])),_:2},1024)])),_:2},1024),x(r,{class:"flex justify-between items-end self-end w-[100%]"},{default:i((()=>[x(r,{class:"flex items-end text-[var(--price-text-color)] leading-[40rpx] price-font"},{default:i((()=>[x(o,{class:"text-[var(--price-text-color)] price-font"},{default:i((()=>[x(o,{class:"text-[26rpx] font-500"},{default:i((()=>[n("￥")])),_:1}),x(o,{class:"text-[36rpx] font-500"},{default:i((()=>[n(p(parseFloat(u(ue)(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),x(o,{class:"text-[24rpx] font-500"},{default:i((()=>[n("."+p(parseFloat(u(ue)(e)).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==u(ie)(e)?(d(),c(l,{key:0,class:"h-[24rpx] ml-[6rpx]",src:u(E)("addon/shop/VIP.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0),"discount_price"==u(ie)(e)?(d(),c(l,{key:1,class:"h-[24rpx] ml-[6rpx]",src:u(E)("addon/shop/discount.png"),mode:"heightFix"},null,8,["src"])):_("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})):_("v-if",!0)])),_:1})])),_:1})])),_:1})):(d(),c(r,{key:1,class:"flex-1 flex flex-col justify-center bg-[#fff]"},{default:i((()=>[x(l,{class:"rounded-[8rpx] overflow-hidden mx-auto w-[390rpx] h-[222rpx]",src:u(E)("addon/shop/cart-empty.png"),model:"aspectFill"},null,8,["src"]),x(r,{class:"text-[#999] text-[26rpx] font-400 mt-[26rpx] text-center leading-[30rpx]"},{default:i((()=>[n("赶紧去逛逛, 购买心仪的商品吧")])),_:1}),x(s,{shape:"circle",class:"!w-[200rpx] mt-[40rpx] text-[26rpx] leading-[70rpx] !text-[#fff] rounded-full bg-color",onClick:t[0]||(t[0]=e=>u(w)({url:"/addon/shop/pages/goods/list"}))},{default:i((()=>[n("去逛逛")])),_:1})])),_:1})):(d(),c(r,{key:0,class:"flex-1 flex flex-col justify-center bg-[#fff]"},{default:i((()=>[x(l,{class:"rounded-[8rpx] overflow-hidden mx-auto w-[390rpx] h-[222rpx]",src:u(E)("static/resource/images/system/login.png"),model:"aspectFill"},null,8,["src"]),x(r,{class:"text-[#999] text-[26rpx] font-400 mt-[26rpx] text-center leading-[30rpx]"},{default:i((()=>[n("暂未登录")])),_:1}),x(s,{shape:"circle",class:"!w-[200rpx] mt-[40rpx] text-[26rpx] leading-[70rpx] !text-[#fff] rounded-full bg-color",onClick:te},{default:i((()=>[n("去登录")])),_:1})])),_:1}))])),_:1})),$.value.length?(d(),c(r,{key:1,class:"flex h-[100rpx] items-center bg-[#fff] fixed left-0 right-0 bottom-[50px] box-solid mb-ios justify-between"},{default:i((()=>[x(r,{class:"flex items-center pl-[30rpx]",onClick:oe},{default:i((()=>[x(o,{class:h(["self-center iconfont text-color text-[34rpx] mr-[20rpx] w-[34rpx] h-[34rpx] rounded-[17rpx] overflow-hidden shrink-0",$.value.length==u(ee)?"iconxuanze1":"bg-[#F5F5F5]"])},null,8,["class"]),x(o,{class:"font-400 text-[#303133] text-[26rpx]"},{default:i((()=>[n("全选")])),_:1})])),_:1}),x(r,{class:"flex items-center"},{default:i((()=>[J.value?(d(),c(r,{key:1,class:"flex-1 flex items-center justify-end"},{default:i((()=>[x(T,{text:"删除",customStyle:{width:"160rpx",height:"66rpx",color:"#fff",fontSize:"28rpx",lineHeight:"66rpx",marginRight:"30rpx",background:"linear-gradient( 94deg,  var(--primary-help-color) 0%, var(--price-text-color) 69%), var(--price-text-color)"},shape:"circle",onClick:de},null,8,["customStyle"])])),_:1})):(d(),c(r,{key:0,class:"flex-1 flex items-center justify-between"},{default:i((()=>[x(r,{class:"flex items-center mr-[67rpx] text-[var(--price-text-color)] leading-[45rpx]"},{default:i((()=>[x(r,{class:"font-400 text-[#303133] text-[26rpx]"},{default:i((()=>[n("合计：")])),_:1}),x(o,{class:"text-[var(--price-text-color)] price-font"},{default:i((()=>[x(o,{class:"text-[26rpx] font-500"},{default:i((()=>[n("￥")])),_:1}),x(o,{class:"text-[36rpx] font-500"},{default:i((()=>[n(p(parseFloat(Z.value).toFixed(2).split(".")[0]),1)])),_:1}),x(o,{class:"text-[24rpx] font-500"},{default:i((()=>[n("."+p(parseFloat(Z.value).toFixed(2).split(".")[1]),1)])),_:1})])),_:1})])),_:1}),x(T,{text:"结算",customStyle:{width:"160rpx",height:"66rpx",color:"#fff",fontSize:"28rpx",lineHeight:"66rpx",marginRight:"30rpx",background:"linear-gradient( 94deg,  var(--primary-help-color) 0%, var(--price-text-color) 69%), var(--price-text-color)"},shape:"circle",onClick:ae},null,8,["customStyle"])])),_:1}))])),_:1})])),_:1})):_("v-if",!0),x(K,{"bg-color":"rgb(248,248,248)",loading:X.value,loadingText:"",fontSize:"16",color:"#303133"},null,8,["loading"]),x(Q)])),_:1},8,["style"])}}}),[["__scopeId","data-v-356717fb"]]);export{W as default};
