import{d as e,Z as a,l as t,j as l,m as s,r as o,_ as r,a8 as i,x as n,p as c,o as u,P as d,b as m,w as p,y as f,u as _,z as g,Q as x,a7 as b,f as v,c as y,H as h,t as k,i as j,g as S,h as w,a6 as C,C as F,R as A,E as L,bc as z,B as I,D as T}from"./index-7bf68536.js";import{_ as B}from"./u-icon.0c1c54c7.js";import{_ as P}from"./u-tag.c797e3e1.js";import{_ as E}from"./u-line-progress.288a6e80.js";import{_ as D}from"./u-loading-icon.b37701e7.js";import{_ as M}from"./tabbar.e049672c.js";import{s as H}from"./share-poster.5efeffe7.js";import"./mescroll-uni.3ef5aea1.js";import"./mescroll-body.b6d57b41.js";import{u as R}from"./useMescroll.26ccf5de.js";import{M as U}from"./mescroll-empty.fcefb74e.js";import{c as J,g as N}from"./bwc.28e2fa51.js";import{a as Q,g as Y,t as Z}from"./common.1828864e.js";import{u as $}from"./useLocation.2a69509a.js";import{_ as q}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-transition.cdf87992.js";import"./u-badge.d8d91719.js";import"./u-tabbar.d98653fa.js";import"./u-safe-bottom.908eeae4.js";import"./cloneDeep.77735539.js";import"./u-popup.be4bfacd.js";/* empty css                                                                     */import"./mescroll-i18n.14e7fe02.js";/* empty css                                                                       */import"./manifest.c5d7e573.js";const G=q(e({__name:"act",setup(e){R();const{setShare:q,onShareAppMessage:G,onShareTimeline:K}=a(),O=t(),V=l((()=>O.info)),W=s();Q();const X=$(!0);X.onLoad(),X.initFn();const ee=o("定位中");let ae=o(null),te=o(""),le={};const se=o(0);let oe=o([]),re=o(!1);const ie=o(4),ne=o([{name:"所有活动",value:4},{name:"美团",value:2},{name:"饿了么",value:3}]);o(uni.getStorageSync("localtkcps")),q(),G(),K();const ce=e=>{z({url:`/addon/tk_cps/pages/bwc/detail?planId=${e.planId}`})},ue=o(""),de=o([]),me=()=>{let e=Y();e||(e=uni.getStorageSync("location")),re.value=!0;let a={pageId:ue.value,mapLat:e.latitude,mapLon:e.longitude,planSource:ie.value};N(a).then((e=>{let a=e.data.data.merchantList;if(0==a.length)return re.value=!1,void k({title:"已经没有更多数据",icon:"none"});""==ue.value?(ue.value=e.data.data.pageId,oe.value=a):(ue.value=e.data.data.pageId,oe.value=oe.value.concat(a))})).catch((()=>{re.value=!1}))};r((()=>W.location),((e,a)=>{e.latitude&&e.longitude?(re.value=!0,de.value=[],ue.value="",me()):ee.value="定位中..."}),{deep:!0});return i((()=>{me()})),n((()=>{V.value&&V.value.member_id&&(te.value+="?mid="+V.value.member_id)})),c((e=>{if(uni.getStorageSync("addressByLatlng")&&(ee.value=uni.getStorageSync("addressByLatlng").formatted_addresses.recommend),e.mid)uni.setStorageSync("pid",e.mid),J({pid:e.mid});else{let e=uni.getStorageSync("pid");e&&e>0&&J({pid:e})}me()})),(e,a)=>{const t=j,l=S(w("u-icon"),B),s=C,o=I,r=T,i=S(w("u-tag"),P),n=S(w("u-line-progress"),E),c=S(w("up-loading-icon"),D),k=F,z=S(w("tabbar"),M),R=S(w("share-poster"),H);return u(),d(x,null,[m(t,{class:"detail-box"},{default:p((()=>[m(t,{class:"flex items-center mb-[16rpx] mt-[32rpx] flex-right justify-between mr-2"},{default:p((()=>[m(t,{class:"ml-4 font-bold text-[36rpx]"},{default:p((()=>[f("全城霸王餐")])),_:1}),m(t,{class:"flex items-center",onClick:a[0]||(a[0]=e=>_(X).repositionFn())},{default:p((()=>[m(t,null,{default:p((()=>[m(l,{name:"map",color:"#ffab45",size:"18"})])),_:1}),m(t,{class:"text-[#ffab45] text-xs tk-sltext"},{default:p((()=>[f(g(_(W).currShippingAddress?_(W).currShippingAddress.community:"选择位置"),1)])),_:1}),m(t,null,{default:p((()=>[m(l,{name:"arrow-right",color:"#ffab45",size:"18"})])),_:1})])),_:1})])),_:1}),m(t,{class:""},{default:p((()=>[m(s,{"scroll-x":"true",class:"scroll-Y box-border bg-white"},{default:p((()=>[m(t,{class:"flex whitespace-nowrap justify-around"},{default:p((()=>[(u(!0),d(x,null,b(ne.value,((e,a)=>(u(),y(t,{class:A(["text-sm leading-[90rpx]",{"class-select":ie.value===e.value}]),onClick:a=>{return t=e.value,ue.value="",ie.value=t,oe.value=[],void me();var t}},{default:p((()=>[f(g(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1})])),_:1})])),_:1}),_(oe)&&_(oe).length>0?(u(!0),d(x,{key:0},b(_(oe),((e,a)=>(u(),y(t,{class:"tk-card"},{default:p((()=>[m(t,{class:"flex"},{default:p((()=>[m(o,{style:{width:"180rpx",height:"140rpx","background-color":"#eeeeee","border-radius":"8px"},src:e.logo,mode:"aspectFill"},null,8,["src"]),m(t,{class:"flex flex-col ml-2 w-[100%] justify-between",style:{}},{default:p((()=>[m(t,{class:"font-bold tk-sltext"},{default:p((()=>[f(g(e.name),1)])),_:2},1024),m(t,{class:"flex justify-between"},{default:p((()=>[m(t,{class:"flex items-center"},{default:p((()=>[m(o,{style:{width:"32rpx",height:"32rpx","background-color":"#eeeeee","border-radius":"8px"},src:e.platformLogo,mode:"aspectFill"},null,8,["src"]),m(t,{class:"text-xs mt-[4rpx] ml-2"},{default:p((()=>[f(g(e.platformName),1)])),_:2},1024)])),_:2},1024),m(t,{class:"text-xs"},{default:p((()=>[f(g(e.distance),1)])),_:2},1024)])),_:2},1024),m(t,{class:"flex justify-between"},{default:p((()=>[m(r,{class:"text-xs"},{default:p((()=>[f("共"+g(e.planList.length)+"个活动",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),(u(!0),d(x,null,b(e.planList,((e,a)=>(u(),y(t,{class:"",key:a},{default:p((()=>[m(t,{class:"flex items-center mt-2 mb-2"},{default:p((()=>[m(t,{class:"bg-slate-100 pl-2 pr-2 pt-1 pb-1 text-xs text-blue-100 rounded-lg"},{default:p((()=>[f("活动"+g(a+1),1)])),_:2},1024),m(t,{class:"text-xs"},{default:p((()=>[m(r,null,{default:p((()=>[f(g("0:0"==_(Z)(e.startTime)?"00:00":_(Z)(e.startTime))+"-",1)])),_:2},1024),m(r,null,{default:p((()=>[f(g(_(Z)(e.endTime)),1)])),_:2},1024)])),_:2},1024),m(t,{class:"line-box"})])),_:2},1024),m(t,{onClick:a=>ce(e),class:"flex justify-between items-center"},{default:p((()=>[m(t,{class:"flex"},{default:p((()=>[m(t,{class:""},{default:p((()=>[m(i,{text:"最高返"+e.commission,bgColor:"#FA6400",borderColor:"#FE5A49",size:"mini"},null,8,["text"])])),_:2},1024),m(t,{class:"ml-2"},{default:p((()=>[1==e.planType?(u(),y(i,{key:0,text:"需要用餐评价",type:"success",plain:"",plainFill:"",size:"mini"})):(u(),y(i,{key:1,text:"无需评价",type:"error",plain:"",plainFill:"",size:"mini",color:"#FA6400"}))])),_:2},1024)])),_:2},1024),m(t,{class:"flex items-center"},{default:p((()=>[m(t,{class:"kucun"},{default:p((()=>[m(r,{class:"text-xs"},{default:p((()=>[f("还剩"+g(e.restStock)+"份",1)])),_:2},1024),m(n,{percentage:e.restStock/e.totalStock*100,activeColor:"#FFBA00",height:"5",showText:!1},null,8,["percentage"])])),_:2},1024),m(l,{name:"arrow-right",color:"#cccccc",size:"10"}),m(t,{class:"ml-2"},{default:p((()=>[e.restStock>0?(u(),y(i,{key:0,onClick:a=>ce(e),text:"去报名",bgColor:"#FA6400",borderColor:"#FE5A49"},null,8,["onClick"])):v("v-if",!0),0==e.restStock?(u(),y(i,{key:1,text:"已抢光",bgColor:"#6e6f6e",borderColor:"#ffffff"})):v("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:2},1024)))),256)):v("v-if",!0)])),_:1}),m(c,{class:"mt-4 mb-4",show:_(re),mode:"circle","inactive-color":"#FE5A49","timing-function":"linear"},null,8,["show"]),_(oe).length||0!=_(re)?v("v-if",!0):(u(),y(U,{key:0,option:{icon:_(L)("static/resource/images/empty.png")}},null,8,["option"])),m(k,{onClick:a[1]||(a[1]=e=>(()=>{if(!V.value)return h().setLoginBack({url:"/addon/tk_cps/pages/bwc/act?mid="+pid}),!1;V.value&&V.value.member_id&&(le.member_id=V.value.member_id),ae.value.openShare()})()),class:"fixed bottom-48 right-4 z-50 rounded-full p-2 text-white hover:bg-blue-700"},{default:p((()=>[m(l,{name:"share",color:"#000000",size:"24"})])),_:1}),m(z,{addon:"tk_cps"}),m(R,{ref_key:"sharePosterRef",ref:ae,posterType:"tk_cps_bwc",posterId:se.value,posterParam:_(le),copyUrlParam:_(te)},null,8,["posterId","posterParam","copyUrlParam"])],64)}}}),[["__scopeId","data-v-cf252444"]]);export{G as default};
