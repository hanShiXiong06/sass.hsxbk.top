import{d as e,r as a,p as t,aM as s,o as l,c as r,w as o,b as d,P as u,a7 as n,Q as i,y as p,z as c,f,u as m,n as _,t as x,a as g,U as v,V as y,i as h,D as w,g as j,h as b,C,E as k,B as F}from"./index-7bf68536.js";import{_ as z}from"./u-button.359d7329.js";import{_ as S}from"./pay.d2e850e8.js";import{_ as A}from"./u-empty.68b4529f.js";import{_ as N}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{q as $,t as D}from"./vipcard.fb0aea23.js";import"./u-loading-icon.b37701e7.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.0c1c54c7.js";import"./u-image.e46f68ef.js";import"./u-transition.cdf87992.js";import"./u-popup.be4bfacd.js";import"./u-safe-bottom.908eeae4.js";import"./pay.2db06871.js";import"./u-loading-page.566c330a.js";const E=e({__name:"payment",setup(e){const E=a(null),J=a(!0),M=a(""),O=a(uni.getStorageSync("vipcardCreateData")),q=a(null);let B=0;t((()=>{const e=uni.$u.deepClone(s(O.value));e.goods=JSON.stringify(e.goods),$(e).then((({data:e})=>{J.value=!1,q.value=e})).catch((e=>{M.value=e.msg,J.value=!1}))}));const I=a(!1),K=()=>{if(I.value)return;I.value=!0;const e=uni.$u.deepClone(s(O.value));e.goods=JSON.stringify(e.goods),D(e).then((({data:e})=>{var a;B=e.trade_id,null==(a=E.value)||a.open(e.trade_type,e.trade_id,`/addon/vipcard/pages/order/detail?order_id=${e.trade_id}`),I.value=!1})).catch((e=>{I.value=!1,x({title:e.msg,icon:"none"})}))},L=()=>{g({url:"/addon/vipcard/pages/order/detail",param:{order_id:B},mode:"redirectTo"})},P=()=>{v().length>1?y({delta:1}):g({url:"/addon/vipcard/pages/index",mode:"reLaunch"})};return(e,a)=>{const t=h,s=F,x=w,g=j(b("u-button"),z),v=j(b("pay"),S),y=j(b("u-empty"),A),$=C,D=j(b("loading-page"),N);return l(),r(t,{style:_(e.themeColor())},{default:o((()=>[q.value?(l(),r(t,{key:0,class:"bg-[#f7f7f7] min-h-screen overflow-hidden"},{default:o((()=>[d(t,{class:"h-3"}),d(t,{class:"chunk-wrap p-3 bg-white mx-3 rounded-md"},{default:o((()=>[(l(!0),u(i,null,n(q.value.goods,((e,a)=>(l(),r(t,{class:"flex"},{default:o((()=>[d(t,{class:"w-[200rpx] mr-3 overflow-hidden rounded"},{default:o((()=>[d(s,{src:m(k)(e.cover_thumb_mid),mode:"widthFix",class:"w-full"},null,8,["src"])])),_:2},1024),d(t,{class:"flex-1 w-0"},{default:o((()=>[d(t,{class:"font-bold truncate"},{default:o((()=>[p(c(e.goods_name),1)])),_:2},1024),d(t,{class:"text-[#FA6400] text-xs mt-2"},{default:o((()=>[d(x,{class:"ml-[2rpx]"},{default:o((()=>[p("￥")])),_:1}),d(x,{class:"text-[38rpx]"},{default:o((()=>[p(c(e.price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),d(t,{class:"chunk-wrap p-3 bg-white mx-3 mt-3 rounded-md"},{default:o((()=>[d(t,{class:"flex justify-between items-center"},{default:o((()=>[d(t,{class:"text-gray-400"},{default:o((()=>[p("实付金额")])),_:1}),d(t,{class:"text-[#FA6400] text-xs mt-2 font-bold"},{default:o((()=>[d(x,{class:"ml-[2rpx]"},{default:o((()=>[p("￥")])),_:1}),d(x,{class:"text-[38rpx]"},{default:o((()=>[p(c(q.value.pay_money.toFixed(2)),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(t,{class:"h-[148rpx] w-screen"}),d(t,{class:"bg-white p-3 fixed bottom-0 left-0 right-0 flex items-center justify-between z-10 shadow"},{default:o((()=>[d(g,{text:"提交订单",class:"!rounded-3xl !m-0",type:"primary",size:"16",loading:I.value,onClick:K},null,8,["loading"])])),_:1}),d(v,{ref_key:"payRef",ref:E,onClose:L},null,512)])),_:1})):f("v-if",!0),M.value?(l(),r(t,{key:1,class:"w-screen h-screen flex flex-col justify-center items-center"},{default:o((()=>[d(y,{icon:m(k)("static/resource/images/order_empty.png"),text:M.value},null,8,["icon","text"]),d(t,{class:"w-[240rpx] mt-[40rpx]"},{default:o((()=>[d($,{class:"bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:P},{default:o((()=>[p("返回上一页")])),_:1})])),_:1})])),_:1})):f("v-if",!0),d(D,{loading:J.value},null,8,["loading"])])),_:1},8,["style"])}}});export{E as default};
