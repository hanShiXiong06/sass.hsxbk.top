import{d as e,r as a,j as l,aG as r,p as s,aH as t,H as d,o,c as u,w as i,b as n,f as c,u as m,L as p,y as v,z as f,n as _,x as b,aI as g,aJ as h,a as y,i as x,g as V,h as j,E as w,a2 as k}from"./index-d8a8f699.js";import{_ as C}from"./u-input.9468a367.js";import{_ as P,a as S}from"./u-form.11d92cf8.js";import{_ as q}from"./u-icon.5ba98c98.js";import{_ as I}from"./u-switch.e6aa1f1d.js";import{m as E}from"./manifest.866d8b43.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.d86b0940.js";import"./u-loading-icon.6808ae8c.js";const U=e({__name:"location_address_edit",setup(e){const U=a(""),$=a(""),A=a(!1),H=a({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:"",type:"location_address"});l((e=>{if(e.id)r(e.id).then((({data:e})=>{e&&(Object.assign(H.value,e),H.value.area=H.value.full_address.replace(H.value.address,"").replace(H.value.address_name,""))})).catch();else if(e.name){uni.getStorageSync("addressInfo")&&Object.assign(H.value,uni.getStorageSync("addressInfo")),H.value.address=e.name,O(e.latng);var a=M("latng").split(",");H.value.lat=a[0],H.value.lng=a[1]}U.value=e.type||"",$.value=e.source||""}));const T=a(null),z=s((()=>({address:{type:"string",required:!0,message:b("addressError"),trigger:["blur","change"]},name:{type:"string",required:!0,message:b("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:b("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,l){/^1[3-9]\d{9}$/.test(a)?l():l(new Error(b("mobileError")))}}]}))),M=e=>{for(var a=window.location.search.substring(1).split("&"),l=0;l<a.length;l++){var r=a[l].split("=");if(r[0]==e)return r[1]}return!1},O=e=>{t({latlng:e}).then((e=>{e.data?(H.value.full_address="",H.value.full_address+=null!=e.data.province?e.data.province:"",H.value.full_address+=null!=e.data.city?""+e.data.city:"",H.value.full_address+=null!=e.data.district?""+e.data.district:"",H.value.address_name=H.value.full_address.replace(/-/g,""),H.value.area=e.data.full_address,H.value.province_id=null!=e.data.province_id?e.data.province_id:0,H.value.city_id=null!=e.data.city_id?e.data.city_id:0,H.value.district_id=null!=e.data.district_id?e.data.district_id:0):d({title:e.msg,icon:"none"})}))},R=a(!1),W=()=>{if(uni.$u.test.isEmpty(H.value.area))return void d({title:b("selectAddressPlaceholder"),icon:"none"});const e=H.value.id?g:h;T.value.validate().then((()=>{R.value||(R.value=!0,A.value=!0,H.value.full_address=`${H.value.area}${H.value.address_name}${H.value.address}`,e(H.value).then((e=>{R.value=!1,uni.removeStorageSync("addressInfo"),setTimeout((()=>{A.value=!1,y({url:"/app/pages/member/address",mode:"redirectTo",param:{type:U.value,source:$.value}})}),1e3)})).catch((()=>{R.value=!1,A.value=!1})))}))},B=()=>{var e=H.value;uni.setStorageSync("addressInfo",e);let a=location.origin+location.pathname+"?type="+U.value+"&source="+$.value;window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(a)+"&key="+E.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"};return(e,a)=>{const l=x,r=V(j("u-input"),C),s=V(j("u-form-item"),P),t=V(j("u-icon"),q),d=V(j("u-switch"),I),g=w,h=V(j("u-form"),S),y=k;return o(),u(l,{style:_(e.themeColor())},{default:i((()=>[n(y,{"scroll-y":"true",class:"bg-page h-screen"},{default:i((()=>[c(' <view class="h-[88rpx]">\r\n                    <u-navbar title="添加地址" @rightClick="rightClick" :autoBack="true"></u-navbar>\r\n            </view> '),n(l,{class:"h-[30rpx]"}),n(l,{class:"m-[30rpx] mt-0 p-[30rpx] pt-[10rpx] rounded-md bg-white"},{default:i((()=>[n(h,{labelPosition:"left",model:H.value,labelWidth:"200rpx",errorType:"toast",rules:m(z),ref_key:"formRef",ref:T},{default:i((()=>[n(l,{class:"mt-[10rpx]"},{default:i((()=>[n(s,{label:m(b)("name"),prop:"name","border-bottom":!0},{default:i((()=>[n(r,{modelValue:H.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>H.value.name=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"25",placeholder:m(b)("namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(l,{class:"mt-[10rpx]"},{default:i((()=>[n(s,{label:m(b)("mobile"),prop:"mobile","border-bottom":!0},{default:i((()=>[n(r,{modelValue:H.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>H.value.mobile=e),border:"none",clearable:"",placeholder:m(b)("mobilePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(l,{class:"mt-[10rpx]"},{default:i((()=>[n(s,{label:m(b)("deliveryAddress"),prop:"address_name","border-bottom":!0},{default:i((()=>[n(l,{class:"flex justify-between flex-1",onClick:B},{default:i((()=>[n(l,{class:p(["text-[15px]",{"text-[#303133]":H.value.area,"text-[#c3c4d5]":!H.value.area}])},{default:i((()=>[v(f(H.value.area?H.value.address_name:m(b)("selectAddressPlaceholder")),1)])),_:1},8,["class"]),n(t,{name:"arrow-right",color:"#c3c4d5"})])),_:1})])),_:1},8,["label"])])),_:1}),n(l,{class:"mt-[10rpx]"},{default:i((()=>[n(s,{label:m(b)("address"),prop:"address","border-bottom":!0},{default:i((()=>[n(r,{modelValue:H.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>H.value.address=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"120",placeholder:m(b)("addressPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(l,{class:"mt-[10rpx]"},{default:i((()=>[n(s,{label:m(b)("defaultAddress"),prop:"name","border-bottom":!0},{default:i((()=>[n(d,{modelValue:H.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>H.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),n(l,{class:"mt-[40rpx]"},{default:i((()=>[n(g,{class:p(["!bg-[var(--primary-color)] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",{"opacity-50":A.value}]),onClick:W,disabled:A.value,loading:R.value},{default:i((()=>[v(f(m(b)("save")),1)])),_:1},8,["class","disabled","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1})])),_:1},8,["style"])}}});export{U as default};
