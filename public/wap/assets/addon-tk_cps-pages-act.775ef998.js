import{_ as e}from"./u-input.9468a367.js";import{d as a,r as o,o as t,I as s,b as r,w as l,u as n,K as i,J as c,c as p,f as d,a3 as u,a4 as m,S as f,g as _,h,i as g,y as b,z as j,l as y,a as w,Q as v}from"./index-d8a8f699.js";import{_ as k}from"./tabbar.fdead755.js";import{_ as x}from"./pay.9a75868d.js";import{g as C,a as S}from"./cps.52f153e7.js";import{M as I}from"./mescroll-body.f9302aea.js";import{M as E}from"./mescroll-empty.2fe85dec.js";import{u as M}from"./useMescroll.26ccf5de.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.5ba98c98.js";import"./u-badge.d38c6915.js";import"./u-tabbar.5fed7184.js";import"./u-safe-bottom.a4431b09.js";import"./u-image.e646392b.js";import"./u-transition.db07fff7.js";import"./u-popup.0d48946e.js";import"./pay.974edcbe.js";import"./mescroll-i18n.49872024.js";const D=U(a({__name:"act",setup(a){const{mescrollInit:U,downCallback:D,getMescroll:O}=M(m,u),{setShare:R,onShareAppMessage:V,onShareTimeline:z}=f();let Z=o([]),A=o(!1);R(),V(),z(),o([]);const B=o(""),J=e=>{if(-1===e.url.indexOf("style=embedded"))-1!=e.url.indexOf("http")||-1!=e.url.indexOf("http")?window.location.href=e.url:w({url:e.url});else{let a=function(e){const a={},o=e.split("&");for(const t of o){const[e,o]=t.split("=");a[e]=decodeURIComponent(o)}return a};const o=e.url.split("?")[1];if(o){const e=a(o),t=e.type,s=e.act_id;S({type:t,act_id:s}).then((e=>{""!=e.data.h5&&(window.location.href=e.data.h5),""!=e.data.wap_url&&(window.location.href=e.data.wap_url)})).catch((e=>{console.error("获取CPS信息失败",e)}))}else console.error("链接中没有查询参数")}},K=e=>{A.value=!1;let a={page:e.num,limit:e.size,act_name:B.value};C(a).then((a=>{let o=a.data.data;1==e.num&&(Z.value=[]),Z.value=Z.value.concat(o),e.endSuccess(o.length),A.value=!0})).catch((()=>{A.value=!0,e.endErr()}))};return(a,o)=>{const u=_(h("u-input"),e),m=g,f=v,w=_(h("tabbar"),k),C=_(h("pay"),x);return t(),s(i,null,[r(m,{class:"bg-[#f8f8f8] min-h-screen overflow-hidden"},{default:l((()=>[r(m,{class:"tk-card fl items-center"},{default:l((()=>[r(u,{clearable:"",modelValue:B.value,"onUpdate:modelValue":o[0]||(o[0]=e=>B.value=e),placeholder:"如美团|饿了么|点餐|滴滴等",onChange:o[1]||(o[1]=e=>{O().resetUpScroll()})},null,8,["modelValue"])])),_:1}),r(I,{ref:"mescrollRef",top:"0",onInit:n(U),onDown:n(D),onUp:K},{default:l((()=>[(t(!0),s(i,null,c(n(Z),((e,o)=>(t(),p(m,{class:"tk-card",onClick:a=>(e=>{const a="/addon/tk_cps/pages/index?type="+e.type+"&act_id="+e.act_id+"&style=embedded";J({url:a})})(e)},{default:l((()=>[r(f,{style:{width:"100%",height:"120px","background-color":"#eeeeee","border-radius":"8px"},mode:e.mode,src:e.img,onError:a.imageError},null,8,["mode","src","onError"]),r(m,{class:"font-bold"},{default:l((()=>[b(j(e.act_name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),256)),!n(Z).length&&n(A)?(t(),p(E,{key:0,option:{icon:n(y)("static/resource/images/empty.png")}},null,8,["option"])):d("v-if",!0)])),_:1},8,["onInit","onDown"])])),_:1}),r(w,{addon:"tk_cps"}),r(C,{ref:"payRef",onClose:o[2]||(o[2]=e=>a.payLoading=!1)},null,512)],64)}}}),[["__scopeId","data-v-e4a1adcd"]]);export{D as default};
