import{d as e,r as t,Z as a,p as l,F as r,K as s,x as i,t as o,a as d,E as n,J as u,ah as c,l as p,j as x,o as m,c as f,w as v,b as _,u as g,R as b,y as h,z as y,f as k,P as w,a7 as j,Q as C,n as F,H as V,B as T,D as E,C as I,i as S,a6 as D,a5 as O,g as z,h as A,A as B,cd as G}from"./index-7bf68536.js";import{_ as L}from"./u-number-box.30c0ab2e.js";import{_ as U}from"./u-parse.525658f5.js";import{b as J}from"./bind-mobile.37d1c6df.js";import{_ as K}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{b as N}from"./giftcard.66db0fe0.js";import{_ as Q}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.0c1c54c7.js";import"./u-form.78a4f7c2.js";import"./u-line.463a2a45.js";import"./sms-code.vue_vue_type_script_setup_true_lang.eace8f61.js";import"./u-input.09a5cedd.js";import"./u-modal.b47eb877.js";import"./u-loading-icon.b37701e7.js";import"./u-popup.be4bfacd.js";import"./u-transition.cdf87992.js";import"./u-safe-bottom.908eeae4.js";import"./u-checkbox-group.b2a485bf.js";import"./u-loading-page.566c330a.js";const R=Q(e({__name:"detail",setup(e){const Q=t({}),R=t(0),Z=t(!0);t(null);const H=t({giftcard_id:"",num:1,balance:"",material_id:""}),M=t(0),{setShare:P}=a();l((e=>{if(H.value.giftcard_id=e.giftcard_id||"",e.giftcard_id)X(e.giftcard_id);else{let e={url:"/addon/shop_giftcard/pages/list",title:r("lackCardId"),mode:"reLaunch"};s(e)}})),i((()=>{H.value.giftcard_id&&X(H.value.giftcard_id)}));const W=e=>{R.value=e},X=e=>{Z.value=!0,N(e).then((e=>{if(!e.data||"[]"===JSON.stringify(e.data))return o({title:r("unableToFindGiftCard"),icon:"none"}),setTimeout((()=>{d({url:"/addon/shop_giftcard/pages/index",mode:"reLaunch"})}),600),!1;if(Q.value=e.data,setTimeout((()=>{let e={title:Q.value.card_name,desc:"",url:n(Q.value.material_list[R.value].url)};P({wechat:{...e},weapp:{...e}})}),600),u({title:Q.value.card_name}),"goods"==Q.value.card_right_type&&(M.value=Q.value.card_price*(H.value.num||1)),"balance"==Q.value.card_right_type){H.value.balance=Q.value.balance_json[0].balance;let e=Q.value.balance_json.findIndex((e=>e.balance==H.value.balance));M.value=Q.value.balance_json[e].price*(H.value.num||1)}Z.value=!1,W(0),c((()=>{}))}))},Y=()=>{setTimeout((()=>{H.value.num>=99&&(H.value.num=99),H.value.num=parseInt(H.value.num)}),0)},q=()=>{setTimeout((()=>{if((!H.value.num||H.value.num<=0)&&(H.value.num=1),H.value.num>=99&&(H.value.num=99),"goods"==Q.value.card_right_type&&(M.value=Q.value.card_price*(H.value.num||1)),"balance"==Q.value.card_right_type){let e=Q.value.balance_json.findIndex((e=>e.balance==H.value.balance));M.value=Q.value.balance_json[e].price*(H.value.num||1)}}),0)},$=p(),ee=x((()=>$.info)),te=t(null);t(uni.getStorageSync("isbindmobile"));const ae=()=>ee.value?uni.getStorageSync("isbindmobile")?(te.value.open(),!1):(H.value.material_id=Q.value.material_list[R.value].material_id,(!H.value.num||H.value.num<=0)&&(H.value.num=1),void uni.setStorage({key:"giftCardOrderCreateData",data:{giftcard_data:H.value},success:()=>{d({url:"/addon/shop_giftcard/pages/payment"})}})):(V().setLoginBack({url:"/addon/shop_giftcard/pages/detail",param:{giftcard_id:Q.value.giftcard_id}}),!1),le=x((()=>{let e=!1;return Q.value&&"date"==Q.value.validity_type&&Date.now()/1e3>G(Q.value.validity_time)&&(e=!0),e})),re=e=>{let t="";return t="balance"==e.card_right_type?"addon/shop_giftcard/diy/index/value_card.jpg":"addon/shop_giftcard/diy/index/redemption_card.jpg",t};return(e,t)=>{const a=T,l=E,s=I,i=S,o=D,u=O,c=z(A("u-number-box"),L),p=z(A("u-parse"),U),x=z(A("bind-mobile"),J),V=z(A("loading-page"),K);return m(),f(i,{style:F(e.themeColor())},{default:v((()=>[Object.keys(Q.value).length?(m(),f(i,{key:0,class:"bg-[#f8f8f8] min-h-[100vh]"},{default:v((()=>[_(i,{class:"px-[var(--sidebar-m)] py-[var(--top-m)]"},{default:v((()=>[_(i,{class:"w-full h-[430rpx] relative"},{default:v((()=>[Q.value.material_list[R.value]?(m(),f(a,{key:0,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:g(n)(Q.value.material_list[R.value].url||""),onError:t[0]||(t[0]=e=>Q.value.material_list[R.value].url=re(Q.value)),mode:"aspectFill"},null,8,["src"])):(m(),f(a,{key:1,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:g(n)(re(Q.value)),mode:"aspectFill"},null,8,["src"])),_(i,{class:"absolute bottom-[var(--pad-top-m)] left-0 right-0 flex justify-center"},{default:v((()=>[_(s,{class:b(["h-[44rpx] font-500 text-[24rpx] !text-[#fff] m-0 rounded-[var(--rounded-big)] remove-border",{"!bg-[#EF000C]":"balance"==Q.value.card_right_type,"!bg-[#FF7700]":"goods"==Q.value.card_right_type}])},{default:v((()=>[_(l,{class:b(["text-[24rpx] leading-[44rpx] iconfont mr-[5rpx]",{iconchuzhikaV6mm:"balance"==Q.value.card_right_type,"iconduihuankaV6mm-1":"goods"==Q.value.card_right_type}])},null,8,["class"]),_(l,{class:"leading-[44rpx]"},{default:v((()=>[h(y(Q.value.card_right_type_name),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),k(' <view v-if="detail.material_list.length>1" class="text-[28rpx] leading-[39rpx] font-400 mt-[var(--top-m)]">选择封面</view> '),Q.value.material_list.length>1?(m(),f(i,{key:0,class:"h-[110rpx] mt-[var(--top-m)]"},{default:v((()=>[k(' <swiper v-if="detail.material_list.length > 5" class="h-full" display-multiple-items=\'5\' circular=\'true\' previous-margin=\'0rpx\'\r\n\t\t\t\t\t\tnext-margin=\'-160rpx\' :current="current" @change="swiperChange" indicator-active-color=\'red\'>\r\n\t\t\t\t\t\t<block v-for="(item,index) in detail.material_list" :key=\'index\'>\r\n\t\t\t\t\t\t\t<swiper-item class="sitem" @click.stop="swiperCardClick(index)">\r\n\t\t\t\t\t\t\t\t<view class="swiper-item flex justify-center items-center">\r\n\t\t\t\t\t\t\t\t\t<image class="w-[144rpx] h-[90rpx] rounded-[var(--goods-rounded-small)] flex-shrink-0"\r\n\t\t\t\t\t\t\t\t\t:class="{\'!w-[180rpx] !h-[110rpx] box-border border-[2rpx] border-solid border-[var(--primary-color)]\':index==activeIndex}"\r\n\t\t\t\t\t\t\t\t\t:src="img(item.url)" mode="aspectFit"/>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</swiper-item>\r\n\t\t\t\t\t\t</block>\r\n\t\t\t\t\t</swiper> '),k(" :scroll-into-view=\"'id' + activeIndex\" "),_(o,{"scroll-x":!0},{default:v((()=>[_(i,{class:"flex items-center"},{default:v((()=>[(m(!0),w(C,null,j(Q.value.material_list,((e,t)=>(m(),w(C,{key:t},[e.url?(m(),f(a,{key:0,id:"id"+t,onClick:B((e=>W(t)),["stop"]),class:b(["w-[144rpx] h-[90rpx] rounded-[var(--goods-rounded-small)] flex-shrink-0 mr-[20rpx]",{"!w-[180rpx] !h-[110rpx] box-border border-[2rpx] border-solid border-[var(--primary-color)]":t==R.value}]),src:g(n)(e.url),onError:t=>e.url=re(Q.value),mode:"aspectFill"},null,8,["id","onClick","class","src","onError"])):(m(),f(a,{key:1,id:"id"+t,onClick:B((e=>W(t)),["stop"]),class:b(["w-[144rpx] h-[90rpx] rounded-[var(--goods-rounded-small)] flex-shrink-0 mr-[20rpx]",{"!w-[180rpx] !h-[110rpx] box-border border-[2rpx] border-solid border-[var(--primary-color)]":t==R.value}]),src:g(n)(re(Q.value)),mode:"aspectFill"},null,8,["id","onClick","class","src"]))],64)))),128))])),_:1})])),_:1})])),_:1})):k("v-if",!0),_(i,{class:"mt-[var(--top-m)] card-template flex items-center justify-between !pr-0"},{default:v((()=>[_(l,{class:"text-[28rpx] leading-[39rpx] font-400"},{default:v((()=>[h(y(g(r)("purchaseQuantity")),1)])),_:1}),_(c,{modelValue:H.value.num,"onUpdate:modelValue":t[2]||(t[2]=e=>H.value.num=e),min:1,max:99,integer:"",step:1,"input-width":"68rpx","input-height":"52rpx",onChange:q},{minus:v((()=>[_(i,{class:b(["text-[#303133] text-[24rpx] font-500 nc-iconfont nc-icon-jianV6xx leading-[50rpx] w-[60rpx] text-right box-border pr-[10rpx]",{"!text-[var(--text-color-light9)]":H.value.num<=1}])},null,8,["class"])])),input:v((()=>[_(u,{class:"text-[#303133] text-[28rpx] w-[80rpx] h-[44rpx] bg-[var(--temp-bg)] leading-[44rpx] text-center rounded-[6rpx]",type:"number",modelValue:H.value.num,"onUpdate:modelValue":t[1]||(t[1]=e=>H.value.num=e),onInput:Y,onBlur:q},null,8,["modelValue"])])),plus:v((()=>[_(i,{class:b(["text-[#303133] text-[24rpx] font-500 nc-iconfont nc-icon-jiahaoV6xx leading-[50rpx] w-[50rpx] box-border pl-[10rpx]",{"!text-[var(--text-color-light9)]":H.value.num>=99}])},null,8,["class"])])),_:1},8,["modelValue"])])),_:1}),"balance"==Q.value.card_right_type?(m(),f(i,{key:1,class:"mt-[var(--top-m)] card-template"},{default:v((()=>[_(i,{class:"text-[#333] text-[26rpx] leading-[30rpx] font-400 shrink-0 mr-[20rpx]"},{default:v((()=>[h(y(g(r)("selectDenomination")),1)])),_:1}),_(i,{class:"flex flex-wrap gap-x-[31rpx]"},{default:v((()=>[(m(!0),w(C,null,j(Q.value.balance_json,((e,t)=>(m(),f(i,{key:t,onClick:t=>(e=>{H.value.balance=e;let t=Q.value.balance_json.findIndex((t=>t.balance==e));M.value=Q.value.balance_json[t].price*(H.value.num||1)})(e.balance),class:b([{"border-0 primary-btn-bg !text-[#fff]":e.balance==H.value.balance},"w-[200rpx] h-[88rpx] box-border flex items-center justify-center mt-[30rpx] border-[2rpx] border-solid border-[#ddd] rounded-[var(--rounded-small)]"])},{default:v((()=>[_(i,{class:"flex items-baseline font-500"},{default:v((()=>[_(l,{class:"text-[24rpx]"},{default:v((()=>[h("￥")])),_:1}),_(l,{class:"text-[34rpx]"},{default:v((()=>[h(y(e.balance),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick","class"])))),128))])),_:1})])),_:1})):k("v-if",!0),"goods"==Q.value.card_right_type?(m(),f(i,{key:2,class:"mt-[var(--top-m)] card-template"},{default:v((()=>[_(i,{class:"flex items-center"},{default:v((()=>[_(l,{class:"title !mb-0"},{default:v((()=>[h(y(g(r)("convertibleGoods")),1)])),_:1}),"diy"==Q.value.card_goods_type?(m(),f(l,{key:0,class:"text-[24rpx] text-[var(--text-color-light9)] leading-[34rpx] ml-[10rpx]"},{default:v((()=>[h(y(g(r)("goodsTitleOne"))+y(Q.value.card_goods_count)+y(g(r)("goodsTitleOneAnd")),1)])),_:1})):(m(),f(l,{key:1,class:"text-[24rpx] text-[var(--text-color-light9)] leading-[34rpx] ml-[10rpx]"},{default:v((()=>[h(y(g(r)("goodsTitleTwo ")),1)])),_:1}))])),_:1}),(m(!0),w(C,null,j(Q.value.goods_sku_list,((e,t)=>(m(),f(i,{key:t,class:"mt-[var(--pad-top-m)] flex",onClick:B((t=>g(d)({url:"/addon/shop/pages/goods/detail",param:{sku_id:e.sku_id}})),["stop"])},{default:v((()=>[e.sku.sku_image?(m(),f(a,{key:0,class:"w-[190rpx] h-[190rpx] rounded-[var(--rounded-mid)]",src:g(n)(e.sku.sku_image),mode:"aspectFill",onError:t=>e.sku.sku_image="static/resource/images/diy/shop_default.jpg"},null,8,["src","onError"])):(m(),f(a,{key:1,class:"w-[170rpx] h-[170rpx] rounded-[var(--rounded-mid)]",src:g(n)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])),_(i,{class:"ml-[20rpx] flex-1 flex flex-col justify-between"},{default:v((()=>[_(i,{class:"w-full"},{default:v((()=>[_(i,{class:"max-w-[472rpx] text-[28rpx] leading-[40rpx] font-400 truncate text-[#303133]"},{default:v((()=>[h(y(e.goods.goods_name),1)])),_:2},1024),_(i,{class:"mt-[15rpx] flex items-center justify-between"},{default:v((()=>[_(i,{class:"text-[24rpx] text-[var(--text-color-light6)] font-400 truncate leading-[34rpx] w-[452rpx]"},{default:v((()=>[h(y(e.sku.sku_name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),_(i,{class:"flex items-center justify-between"},{default:v((()=>[_(i,{class:"text-[var(--price-text-color)] flex items-baseline"},{default:v((()=>[_(l,{class:"text-[22rpx] price-font"},{default:v((()=>[h("￥")])),_:1}),_(l,{class:"text-[36rpx] font-500 price-font"},{default:v((()=>[h(y(parseFloat(e.sku.price).toFixed(2).split(".")[0]),1)])),_:2},1024),_(l,{class:"text-[22rpx] font-500 price-font"},{default:v((()=>[h("."+y(parseFloat(e.sku.price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),"all"==Q.value.card_goods_type?(m(),f(i,{key:0,class:"font-400 text-[28rpx] text-[#303133]"},{default:v((()=>[_(l,null,{default:v((()=>[h("x")])),_:1}),_(l,null,{default:v((()=>[h(y(e.num),1)])),_:2},1024)])),_:2},1024)):k("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):k("v-if",!0),Q.value.instruction?(m(),f(i,{key:3,class:"mt-[var(--top-m)] card-template"},{default:v((()=>[_(i,{class:"title"},{default:v((()=>[h(y(g(r)("instruction")),1)])),_:1}),_(i,{class:"u-content"},{default:v((()=>[_(p,{content:Q.value.instruction,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):k("v-if",!0),Q.value.card_desc?(m(),f(i,{key:4,class:"mt-[var(--top-m)] card-template"},{default:v((()=>[_(i,{class:"title"},{default:v((()=>[h(y(g(r)("cardDesc")),1)])),_:1}),_(i,{class:"u-content"},{default:v((()=>[_(p,{content:Q.value.card_desc,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):k("v-if",!0)])),_:1}),_(i,{class:"tab-bar-placeholder"}),_(i,{class:"border-[0] border-t-[2rpx] border-solid border-[#f5f5f5] w-[100%] flex justify-between pl-[30rpx] pr-[20rpx] bg-[#fff] box-border fixed left-0 bottom-0 tab-bar z-1 items-center"},{default:v((()=>[_(i,{class:"flex items-baseline"},{default:v((()=>[_(i,{class:"text-[24rpx] leading-[34rpx] font-500 mr-[6rpx]"},{default:v((()=>[h(y(g(r)("price"))+":",1)])),_:1}),_(i,{class:"text-[var(--price-text-color)] flex items-baseline"},{default:v((()=>[_(l,{class:"text-[26rpx] price-font"},{default:v((()=>[h("￥")])),_:1}),_(l,{class:"text-[44rpx] font-500 price-font"},{default:v((()=>[h(y(parseFloat(M.value).toFixed(2).split(".")[0]),1)])),_:1}),_(l,{class:"text-[26rpx] font-500 price-font"},{default:v((()=>[h("."+y(parseFloat(M.value).toFixed(2).split(".")[1]),1)])),_:1})])),_:1})])),_:1}),1==Q.value.status?(m(),w(C,{key:0},[g(le)?(m(),f(s,{key:1,class:"w-[300rpx] !h-[70rpx] font-500 text-[26rpx] !text-[#fff] bg-[#ccc] !m-0 leading-[70rpx] rounded-full remove-border"},{default:v((()=>[h(y(g(r)("EventEnds")),1)])),_:1})):(m(),f(s,{key:0,class:"w-[300rpx] !h-[70rpx] font-500 text-[26rpx] !text-[#fff] primary-btn-bg !m-0 leading-[70rpx] rounded-full remove-border",onClick:ae},{default:v((()=>[h(y(g(r)("buyNow")),1)])),_:1}))],64)):k("v-if",!0),0==Q.value.status?(m(),f(s,{key:1,class:"w-[300rpx] !h-[70rpx] font-500 text-[26rpx] !text-[#fff] bg-[#ccc] !m-0 leading-[70rpx] rounded-full remove-border"},{default:v((()=>[h(y(g(r)("removed")),1)])),_:1})):k("v-if",!0)])),_:1})])),_:1})):k("v-if",!0),k(" 强制绑定手机号 "),_(x,{ref_key:"bindMobileRef",ref:te},null,512),_(V,{loading:Z.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-a555c255"]]);export{R as default};
