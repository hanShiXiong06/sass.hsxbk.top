import{d as e,r as t,p as l,j as a,o as s,c as o,w as r,b as u,y as n,z as i,u as d,f as c,O as m,a6 as f,P as p,n as x,t as _,aL as v,a as y,U as b,i as g,D as h,g as w,h as j,a5 as k}from"./index-2882a2d8.js";import{_ as C}from"./u-number-box.86ecacda.js";import{_ as F}from"./u-parse.40683feb.js";import{_ as V}from"./u-popup.2abbe959.js";import{_ as $}from"./u--input.e0cc8d22.js";import{_ as S}from"./u-form-item.03ed7ff5.js";import{_ as A}from"./u--form.b2bc768e.js";import{_ as D}from"./u-button.0ab7ff00.js";import{_ as B}from"./pay.d604a92e.js";import{_ as E}from"./u-empty.662c89c7.js";import{_ as U}from"./u-loading-page.8280c7ab.js";import{w as z,f as N,h as O,i as P}from"./tourism.50341d59.js";import{_ as H}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.1104ad2f.js";import"./u-overlay.1a317a4e.js";import"./u-transition.4448d2e5.js";import"./u-safe-bottom.f13b01b8.js";import"./u-input.6410b5d0.js";/* empty css                                                                */import"./u-line.d7ff94e2.js";/* empty css                                                               */import"./u-form.54744837.js";import"./u-loading-icon.a37f7e61.js";/* empty css                                                                       */import"./u-image.46ebbbc1.js";import"./pay.a752545f.js";const I=H(e({__name:"order",setup(e){const H=e=>{T.value.num=e.value,K()},I=t(null),J=t(null),L=t(!0),R=t(""),T=t(uni.getStorageSync("wayCreateData")||{}),W=t(null),X=t(!1),q=t(!1),G=t("");l((()=>{z(T.value).then((({data:e})=>{L.value=!1,W.value=e,G.value=e.goods_info.buy_info,ee()})).catch((e=>{R.value=e.msg,L.value=!1}))}));const K=()=>{L.value=!0,N(T.value).then((({data:e})=>{W.value=e,L.value=!1})).catch((e=>{L.value=!1,_({title:e.msg,icon:"none"})}))},M=t(!1),Q=()=>{if(Z()){if(M.value)return;M.value=!0;const e=uni.$u.deepClone(v(T.value));e.buyer_info=JSON.stringify(e.buyer_info),O(e).then((({data:e})=>{var t;null==(t=J.value)||t.open(e.trade_type,e.trade_id,`/addon/tourism/pages/order/detail?order_id=${e.trade_id}`),M.value=!1})).catch((e=>{M.value=!1,_({title:e.msg,icon:"none"})}))}};let Y=t("0");P().then((e=>{Y.value=e.data.is_allow_refund}));const Z=()=>{const e=T.value.buyer_info;if(uni.$u.test.isEmpty(e.name))return _({title:"请输入联系人姓名",icon:"none"}),!1;if(uni.$u.test.isEmpty(T.value.mobile))return _({title:"请输入手机号",icon:"none"}),!1;if(!/^1[3-9]\d{9}$/.test(T.value.mobile))return _({title:"请输入正确的手机号",icon:"none"}),!1;if(uni.$u.test.isEmpty(e.id_card))return _({title:"请输入身份证号",icon:"none"}),!1;return!!/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(e.id_card)||(_({title:"请输入正确的身份证号",icon:"none"}),!1)},ee=()=>{var e;T.value.buyer_info={name:"",id_card:""},T.value.mobile="",W.value.reserve_time=te(null==(e=W.value)?void 0:e.reserve_time)};a((()=>W.value?W.value.goods_info.goods_attribute.split(","):[]));const te=e=>{const t=new Date(e);return uni.$u.timeFormat(t,"yyyy-mm-dd ")+["周日","周一","周二","周三","周四","周五","周六"][t.getDay()]},le=()=>{y({url:"/addon/tourism/pages/order/list",mode:"redirectTo"})},ae=()=>{b()};return(e,t)=>{const l=g,a=h,_=w(j("u-number-box"),C),v=w(j("u-parse"),F),y=k,b=w(j("u-popup"),V),z=w(j("u--input"),$),N=w(j("u-form-item"),S),O=w(j("u--form"),A),P=w(j("u-button"),D),K=w(j("pay"),B),Z=w(j("u-empty"),E),ee=w(j("u-loading-page"),U);return s(),o(l,{style:x(e.themeColor())},{default:r((()=>[W.value?(s(),o(l,{key:0,class:"bg-[#f7f7f7] min-h-screen overflow-hidden"},{default:r((()=>[u(l,{class:"chunk-wrap pb-2 pt-4"},{default:r((()=>[u(l,{class:"font-bold"},{default:r((()=>[n(i(W.value.goods_info.goods_name),1)])),_:1}),u(l,{class:"flex justify-between items-center mt-3"},{default:r((()=>[u(l,{class:"text-xs text-[#888]"},{default:r((()=>[u(a,{class:"text-[#FA6400] text-[26rpx]"},{default:r((()=>[n("￥")])),_:1}),u(a,{class:"text-[#FA6400] text-[38rpx]"},{default:r((()=>[n(i(W.value.order_items[0].price),1)])),_:1}),n(" /人起 ")])),_:1}),u(l,{class:"text-xs"},{default:r((()=>[n("出发日期："+i(T.value.reserve_time.split("/").join("-")),1)])),_:1})])),_:1}),u(l,{class:"flex justify-between items-center mt-3"},{default:r((()=>[u(a,{class:"text-sm"},{default:r((()=>[n("选择人数")])),_:1}),u(_,{modelValue:T.value.num,"onUpdate:modelValue":t[0]||(t[0]=e=>T.value.num=e),max:W.value.goods_info.stock,onChange:H},null,8,["modelValue","max"])])),_:1}),u(l,{class:"flex items-center justify-between mt-5 bg-[#FFF1E7] py-[16rpx] px-[18rpx] rounded-md"},{default:r((()=>[u(a,{class:"text-xs text-[#E02020]"},{default:r((()=>[n(i(Number(d(Y))?"随时可退":"购买后不可退款"),1)])),_:1}),u(l,{class:"flex items-center text-[#774C33] text-xs",onClick:t[1]||(t[1]=e=>q.value=!0)},{default:r((()=>[u(a,null,{default:r((()=>[n("购买须知")])),_:1}),u(a,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})])),_:1})])),_:1}),c(" 购买须知弹窗 "),u(b,{show:q.value,onClose:t[2]||(t[2]=e=>q.value=!1),closeable:!0},{default:r((()=>[u(l,{class:"text-center py-[30rpx] font-bold leading-none"},{default:r((()=>[u(a,null,{default:r((()=>[n("购买须知")])),_:1})])),_:1}),u(l,{class:"pt-[28rpx] pb-[40rpx] px-[28rpx]"},{default:r((()=>[u(y,{class:"max-h-[60vh]","scroll-y":!0},{default:r((()=>[G.value?(s(),o(v,{key:0,content:G.value,tagStyle:{img:"vertical-align: top;"}},null,8,["content"])):(s(),o(a,{key:1,class:"block px-5"},{default:r((()=>[n("暂无购买须知")])),_:1}))])),_:1})])),_:1})])),_:1},8,["show"]),u(l,{class:"chunk-wrap"},{default:r((()=>[u(l,{class:"chunk-head"},{default:r((()=>[u(a,null,{default:r((()=>[n("游客信息")])),_:1}),u(l,{class:"text-xs"},{default:r((()=>[n("需填写"),u(a,{class:"text-[#FF2F11]"},{default:r((()=>[n("1")])),_:1}),n("位，用于入园身份验证")])),_:1})])),_:1}),u(l,{class:"py-2"},{default:r((()=>[u(O,{labelPosition:"left",model:T.value,ref_key:"form",ref:I,labelWidth:"90",labelStyle:{color:"#A3A3A3",fontSize:"14px"}},{default:r((()=>[u(N,{label:"联系姓名",prop:"buyer_info.name",borderBottom:""},{default:r((()=>[u(l,{class:"border-style"},{default:r((()=>[u(z,{border:"none",placeholder:"请输入联系姓名",placeholderClass:"text-sm",modelValue:T.value.buyer_info.name,"onUpdate:modelValue":t[3]||(t[3]=e=>T.value.buyer_info.name=e)},null,8,["modelValue"])])),_:1})])),_:1}),u(N,{label:"手机号",prop:"mobile",borderBottom:""},{default:r((()=>[u(l,{class:"border-style"},{default:r((()=>[u(z,{border:"none",placeholder:"请输入手机号",placeholderClass:"text-sm",modelValue:T.value.mobile,"onUpdate:modelValue":t[4]||(t[4]=e=>T.value.mobile=e)},null,8,["modelValue"])])),_:1})])),_:1}),u(N,{label:"证件类型",borderBottom:""},{default:r((()=>[u(l,{class:"border-style"},{default:r((()=>[u(a,{class:"text-sm"},{default:r((()=>[n("身份证")])),_:1})])),_:1})])),_:1}),u(N,{label:"证件号",prop:"buyer_info.id_card",borderBottom:""},{default:r((()=>[u(l,{class:"border-style !border-0"},{default:r((()=>[u(z,{border:"none",placeholder:"请输入证件号",placeholderClass:"text-sm",modelValue:T.value.buyer_info.id_card,"onUpdate:modelValue":t[5]||(t[5]=e=>T.value.buyer_info.id_card=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1}),c(' <view class="chunk-wrap">\r\n                <view class="chunk-head">\r\n                    <text>支付方式</text>\r\n                </view>\r\n                <view class="flex justify-between items-center h-[80rpx]">\r\n                    <view class="flex items-center">\r\n                        <image class="w-[42rpx] h-[42rpx]" :src="img(\'addon/tourism/tourism/way/discount_coupon.png\')" mode="widthFix"></image>\r\n                        <text class="ml-1 text-xs">微信支付</text>\r\n                    </view>\r\n                    <u-radio :labelDisabled="true"></u-radio>\r\n                </view>\r\n            </view>\r\n\r\n            <view class="chunk-wrap">\r\n                <view class="chunk-head">\r\n                    <text>优惠信息</text>\r\n                </view>\r\n                <view class="flex justify-between items-center h-[80rpx]">\r\n                    <view class="flex items-center">\r\n                        <image class="w-[42rpx] h-[42rpx]" :src="img(\'addon/tourism/tourism/way/discount_coupon.png\')" mode="widthFix"></image>\r\n                        <text class="ml-1 text-xs">抵用券</text>\r\n                    </view>\r\n                    <text class="text-[#999] text-xs flex items-center">查看<text class="nc-iconfont nc-icon-youV6xx text-[26rpx]"></text></text>\r\n                </view>\r\n            </view> '),u(l,{class:"h-[148rpx] w-screen"}),u(l,{class:"bg-white p-3 fixed bottom-0 left-0 right-0 flex items-center justify-between"},{default:r((()=>[u(l,{class:"text-[#FA6400] text-xs"},{default:r((()=>[u(a,null,{default:r((()=>[n("总价")])),_:1}),u(a,{class:"ml-[2rpx]"},{default:r((()=>[n("￥")])),_:1}),u(a,{class:"text-[38rpx]"},{default:r((()=>[n(i(W.value.order_money.toFixed(2)),1)])),_:1})])),_:1}),u(l,{class:"ml-auto mr-2",onClick:t[6]||(t[6]=e=>X.value=!X.value)},{default:r((()=>[u(a,{class:"text-[#686868] text-xs mr-1"},{default:r((()=>[n("明细")])),_:1}),u(a,{class:"nc-iconfont nc-icon-shangV6xx-1 text-[#C2C2C2] text-xs font-bold"})])),_:1}),u(P,{text:"提交订单",color:"var(--primary-color)",shape:"circle",customStyle:{lineHeight:"76rpx",margin:"0rpx",color:"#fff",width:"278rpx"},type:"primary",size:"16",loading:M.value,onClick:Q},null,8,["loading"])])),_:1}),u(b,{show:X.value,onClose:t[7]||(t[7]=e=>X.value=!1),closeable:!0},{default:r((()=>[u(l,{class:"text-center py-[30rpx] font-bold leading-none"},{default:r((()=>[u(a,null,{default:r((()=>[n("费用明细")])),_:1})])),_:1}),u(y,{"scroll-y":"true",class:"max-h-[40vh]"},{default:r((()=>[u(l,{class:"flex px-[30rpx] mt-[20rpx]"},{default:r((()=>[u(l,{class:"font-bold"},{default:r((()=>[n("总价")])),_:1}),u(l,{class:"text-right flex-1 font-bold"},{default:r((()=>[u(a,{class:"text-sm font-normal"},{default:r((()=>[n("￥")])),_:1}),u(a,{class:"text-[38rpx]"},{default:r((()=>[n(i(W.value.order_money.toFixed(2)),1)])),_:1})])),_:1})])),_:1}),(s(!0),m(p,null,f(W.value.order_items,((e,t)=>(s(),o(l,{class:"flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle"},{default:r((()=>[c(" <view>{{ item.year }}-{{ item.month }}-{{ item.day }}</view> "),u(l,null,{default:r((()=>[n(i(W.value.reserve_time)+" 出发",1)])),_:1}),u(l,{class:"text-right flex-1"},{default:r((()=>[u(a,{class:"text-xs"},{default:r((()=>[n("￥")])),_:1}),u(a,null,{default:r((()=>[n(i(null==e?void 0:e.price),1)])),_:2},1024),u(a,{class:"mx-[10rpx]"},{default:r((()=>[n("x")])),_:1}),u(a,null,{default:r((()=>[n(i(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256)),c(' <view class="flex px-[30rpx] mt-[10rpx] text-sm text-gray-subtitle">\r\n                        <view>{{ paymentData.reserve_time }} 出发</view>\r\n                        <view class="text-right flex-1"></view>\r\n                    </view> ')])),_:1}),u(l,{class:"h-[150rpx]"})])),_:1},8,["show"])])),_:1})):c("v-if",!0),u(K,{ref_key:"payRef",ref:J,onClose:le},null,512),R.value?(s(),o(l,{key:1,class:"w-screen h-screen flex flex-col justify-center items-center"},{default:r((()=>[u(Z,{icon:e.img("static/resource/images/order_empty.png"),text:R.value},null,8,["icon","text"]),u(l,{class:"w-[240rpx] mt-[40rpx]"},{default:r((()=>[u(P,{type:"primary",text:"返回上一页",shape:"circle",onClick:ae})])),_:1})])),_:1})):c("v-if",!0),u(ee,{loading:L.value,"loading-text":"","bg-color":"none",loadingColor:"var(--primary-color)",iconSize:"35"},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-7fd66c63"]]);export{I as default};
