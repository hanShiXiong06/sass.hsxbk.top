import{d as e,l as t,r as a,p as r,t as l,a as s,s as d,H as o,x as c,o as u,c as i,w as n,U as p,b as f,u as x,W as _,y as g,z as m,f as v,V as b,ad as y,n as h,B as k,D as w,C as j,i as F,g as C,h as z,E,M as S,_ as V}from"./index-71c7df08.js";import{_ as B}from"./uni-popup.402343c9.js";import{_ as D}from"./loading-page.vue_vue_type_script_setup_true_lang.c7dc2256.js";import{e as G,u as I,f as L}from"./card.1368a464.js";const M=V(e({__name:"use_card",setup(e){const V=t(),M=a({}),O=a(!0),R=a(!1);r((e=>{if(e.card_id){if(!d())return o().setLoginBack({url:"/addon/shop_giftcard/pages/use_card",param:{card_id:e.card_id}}),!1;T(e.card_id)}else l({title:"礼品卡不存在",icon:"none"}),setTimeout((()=>{s({url:"/addon/shop_giftcard/pages/index",mode:"reLaunch"})}),600)})),c((()=>{Object.keys(M.value).length&&T(M.value.card_id)}));const T=e=>{O.value=!0,G(e).then((e=>{M.value=e.data,O.value=!1})).catch((()=>{O.value=!1}))},H=()=>{s({url:"/addon/shop_giftcard/pages/my_card_list",mode:"redirectTo"})},P=e=>{let t="";return t="balance"==e.giftcard.card_right_type?"addon/shop_giftcard/diy/index/value_card.jpg":"addon/shop_giftcard/diy/index/redemption_card.jpg",t},U=a(),W=e=>{if("use"==e)if("goods"==M.value.giftcard.card_right_type)if("all"==M.value.giftcard.card_goods_type&&"all"==M.value.giftcard.delivery_way){if(R.value)return;let e={card_id:M.value.card_id,sku_data:[]};e.sku_data=M.value.cardGoods.map((e=>({sku_id:e.sku_id,num:e.total_num-e.use_num}))),R.value=!0,I(e).then((e=>{R.value=!1,e.data&&uni.setStorage({key:"orderCreateData",data:e.data,success:()=>{s({url:"/addon/shop/pages/order/payment"})}})})).catch((()=>{R.value=!1}))}else s({url:"/addon/shop_giftcard/pages/use_goods_select",param:{card_id:M.value.card_id}});else L({card_id:M.value.card_id}).then((e=>{R.value=!1,e.data&&V.getMemberInfo((()=>{U.value.open()}))})).catch((()=>{R.value=!1}));else s({url:"/addon/shop_giftcard/pages/give",param:{card_id:M.value.card_id}})},q=()=>{U.value.close(),s({url:"/app/pages/member/balance"})},A=()=>{T(M.value.card_id),U.value.close()};return(e,t)=>{const a=k,r=w,l=j,s=F,d=C(z("u-parse"),S),o=C(z("uni-popup"),B),c=C(z("loading-page"),D);return u(),i(s,{class:"bg-[#f8f8f8] min-h-[100vh]",style:h(e.themeColor())},{default:n((()=>[Object.keys(M.value).length?(u(),p(b,{key:0},[f(s,{class:"px-[var(--sidebar-m)] py-[var(--top-m)]"},{default:n((()=>[f(s,{class:"w-full h-[430rpx] relative"},{default:n((()=>[M.value.card_cover?(u(),i(a,{key:0,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:x(E)(M.value.card_cover||""),onError:t[0]||(t[0]=e=>M.value.card_cover=P(M.value)),mode:"aspectFill"},null,8,["src"])):(u(),i(a,{key:1,class:"w-full h-[430rpx] rounded-[var(--rounded-mid)]",src:x(E)(P(M.value)),mode:"aspectFill"},null,8,["src"])),f(s,{class:"absolute bottom-[var(--pad-top-m)] left-0 right-0 flex justify-center"},{default:n((()=>[f(l,{class:_([{"!bg-[#EF000C]":"balance"==M.value.giftcard.card_right_type,"!bg-[#FF7700]":"goods"==M.value.giftcard.card_right_type},"h-[44rpx] font-500 text-[24rpx] !text-[#fff] m-0 rounded-[var(--rounded-big)] remove-border"])},{default:n((()=>[f(r,{class:_(["text-[20rpx] text-[24rpx] iconfont mr-[5rpx]",{iconchuzhikaV6mm:"balance"==M.value.giftcard.card_right_type,"iconduihuankaV6mm-1":"goods"==M.value.giftcard.card_right_type}])},null,8,["class"]),"balance"==M.value.giftcard.card_right_type?(u(),i(r,{key:0,class:"leading-[44rpx]"},{default:n((()=>[g(m(M.value.balance)+"元",1)])),_:1})):v("v-if",!0),f(r,{class:"leading-[44rpx]"},{default:n((()=>[g(m(M.value.giftcard.card_right_type_name),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),f(s,{class:"text-[34rpx] font-500 leading-[48rpx] px-[var(--sidebar-m)] mt-[var(--top-m)] text-center"},{default:n((()=>[g(m(M.value.giftcard.card_name),1)])),_:1}),v(' <view class="mt-[var(--top-m)] card-template">\r\n\t\t\t\t\t<view class="card-template-item justify-between">\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-400">卡片类型</text>\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-400">{{detail.giftcard.card_right_type_name}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class="card-template-item justify-between">\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-400">卡片面值</text>\r\n\t\t\t\t\t\t<text class="text-[28rpx] leading-[39rpx] font-500">￥{{detail.balance}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view> '),"goods"==M.value.giftcard.card_right_type?(u(),i(s,{key:0,class:"mt-[var(--top-m)] card-template"},{default:n((()=>[f(s,{class:"flex items-center"},{default:n((()=>[f(r,{class:"title !mb-0"},{default:n((()=>[g("可兑换商品")])),_:1}),"diy"==M.value.giftcard.card_goods_type?(u(),i(r,{key:0,class:"text-[24rpx] text-[var(--text-color-light9)] leading-[34rpx] ml-[10rpx]"},{default:n((()=>[g("该兑换卡可在以下商品中任选"+m(M.value.total_num)+"件商品兑换",1)])),_:1})):(u(),i(r,{key:1,class:"text-[24rpx] text-[var(--text-color-light9)] leading-[34rpx] ml-[10rpx]"},{default:n((()=>[g("该兑换卡可兑换以下商品")])),_:1}))])),_:1}),(u(!0),p(b,null,y(M.value.cardGoods,((e,t)=>(u(),i(s,{key:t,class:"mt-[var(--pad-top-m)] flex"},{default:n((()=>[e.sku_image?(u(),i(a,{key:0,class:"w-[210rpx] h-[210rpx] rounded-[var(--rounded-mid)]",src:x(E)(e.sku_image),mode:"aspectFill",onError:t=>e.sku_image="static/resource/images/diy/shop_default.jpg"},null,8,["src","onError"])):(u(),i(a,{key:1,class:"w-[210rpx] h-[210rpx] rounded-[var(--rounded-mid)]",src:x(E)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])),f(s,{class:"ml-[20rpx] flex-1 flex flex-col justify-between"},{default:n((()=>[f(s,{class:"w-full"},{default:n((()=>[f(s,{class:"max-w-[432rpx] text-[28rpx] leading-[40rpx] font-400 truncate text-[#303133]"},{default:n((()=>[g(m(e.goods_name),1)])),_:2},1024),f(s,{class:"mt-[15rpx] flex items-center justify-between"},{default:n((()=>[f(s,{class:"text-[24rpx] text-[var(--text-color-light6)] font-400 truncate leading-[34rpx] w-[432rpx]"},{default:n((()=>[g(m(e.sku_name),1)])),_:2},1024)])),_:2},1024),"all"==M.value.giftcard.card_goods_type?(u(),i(s,{key:0,class:"mt-[20rpx] text-[24rpx] text-[var(--text-color-light6)] font-400 truncate leading-[34rpx] max-w-[432rpx]"},{default:n((()=>[g("最多可选"+m(e.total_num)+"件 已兑换"+m(e.use_num)+"件",1)])),_:2},1024)):v("v-if",!0)])),_:2},1024),f(s,{class:"flex items-center justify-between"},{default:n((()=>[f(s,{class:"text-[var(--price-text-color)] flex items-baseline"},{default:n((()=>[f(r,{class:"text-[22rpx] price-font"},{default:n((()=>[g("￥")])),_:1}),f(r,{class:"text-[36rpx] font-500 price-font"},{default:n((()=>[g(m(parseFloat(e.price).toFixed(2).split(".")[0]),1)])),_:2},1024),f(r,{class:"text-[22rpx] font-500 price-font"},{default:n((()=>[g("."+m(parseFloat(e.price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),"all"==M.value.giftcard.card_goods_type?(u(),i(s,{key:0,class:"font-400 text-[28rpx] text-[#303133]"},{default:n((()=>[f(r,null,{default:n((()=>[g("x")])),_:1}),f(r,null,{default:n((()=>[g(m(e.total_num),1)])),_:2},1024)])),_:2},1024)):v("v-if",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):v("v-if",!0),M.value.instruction?(u(),i(s,{key:1,class:"mt-[var(--top-m)] card-template"},{default:n((()=>[f(s,{class:"title"},{default:n((()=>[g("使用须知")])),_:1}),f(s,{class:"u-content"},{default:n((()=>[f(d,{content:M.value.instruction,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):v("v-if",!0),M.value.giftcard.card_desc?(u(),i(s,{key:2,class:"mt-[var(--top-m)] card-template"},{default:n((()=>[f(s,{class:"title"},{default:n((()=>[g("礼品卡详情")])),_:1}),f(s,{class:"u-content"},{default:n((()=>[f(d,{content:M.value.giftcard.card_desc,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):v("v-if",!0)])),_:1}),f(s,{class:"tab-bar-placeholder"}),f(s,{class:"border-[0] border-t-[2rpx] border-solid border-[#f5f5f5] w-[100%] flex justify-between pl-[30rpx] pr-[20rpx] bg-[#fff] box-border fixed left-0 bottom-0 tab-bar z-1 items-center"},{default:n((()=>[f(s,{class:"flex items-center mr-[30rpx]"},{default:n((()=>[f(s,{class:"flex flex-col justify-center items-center",onClick:H},{default:n((()=>[f(s,{class:"iconfont nc-icon-kabao text-[36rpx]"}),f(r,{class:"text-[20rpx] mt-[10rpx]"},{default:n((()=>[g("卡包")])),_:1})])),_:1})])),_:1}),f(s,{class:"flex-1 flex items-center"},{default:n((()=>["to_use"==M.value.status&&M.value.giftcard.is_give?(u(),i(l,{key:0,class:"w-[300rpx] !h-[70rpx] font-500 text-[26rpx] !text-[var(--primary-color)] !m-0 !mr-[16rpx] leading-[66rpx] border-[var(--primary-color)] border-solid border-[2rpx] rounded-full !bg-[#fff]",onClick:t[1]||(t[1]=e=>W("give"))},{default:n((()=>[g("赠送好友")])),_:1})):v("v-if",!0),"to_use"==M.value.status||"can_use"==M.value.status?(u(),i(l,{key:1,class:_(["flex-1 min-w-[300rpx] !h-[70rpx] font-500 text-[26rpx] !text-[#fff] primary-btn-bg !m-0 leading-[70rpx] rounded-full remove-border",{"opacity-40":R.value}]),onClick:t[2]||(t[2]=e=>W("use"))},{default:n((()=>[g("去使用")])),_:1},8,["class"])):v("v-if",!0),"used"==M.value.status?(u(),i(l,{key:2,class:"w-full h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] !bg-[var(--text-color-light9)] m-0 rounded-full opacity-40 remove-border"},{default:n((()=>[g("已使用")])),_:1})):v("v-if",!0),"invalid"==M.value.status?(u(),i(l,{key:3,class:"w-full h-[70rpx] font-500 text-[26rpx] leading-[70rpx] !text-[#fff] !bg-[var(--text-color-light9)] m-0 rounded-full remove-border"},{default:n((()=>[g("已失效")])),_:1})):v("v-if",!0)])),_:1})])),_:1}),f(o,{ref_key:"popupRef",ref:U,type:"center","is-mask-click":!1},{default:n((()=>[f(s,{class:"bg-[#fff] w-[530rpx] min-h-[504rpx] rounded-[var(--rounded-big)] box-border p-[32rpx] relative",style:h({"background-image":"url("+x(E)("addon/shop_giftcard/popup_bg.png")+")",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"top"})},{default:n((()=>[f(a,{class:"w-[327rpx] h-[327rpx] rounded-[var(--rounded-mid)] absolute left-[50%] top-[-163.5rpx] transform -translate-x-1/2 z-10",src:x(E)("addon/shop_giftcard/popup_top_balance.png"),mode:"aspectFill"},null,8,["src"]),f(s,{class:"text-[40rpx] leading-[56rpx] font-bold text-center pt-[174rpx]"},{default:n((()=>[g("恭喜您 到账成功！")])),_:1}),f(s,{class:"text-[24rpx] leading-[34rpx] text-center mt-[30rpx]"},{default:n((()=>[g(m(M.value.balance)+"元已充值到您的账户中~",1)])),_:1}),f(l,{class:"w-[370rpx] h-[80rpx] font-500 text-[26rpx] leading-[80rpx] !text-[#fff] primary-btn-bg m-0 !mx-auto rounded-[40rpx] remove-border mt-[90rpx]",onClick:q},{default:n((()=>[g("去看看")])),_:1}),f(s,{class:"iconfont icona-guanbi-34V6xx text-[57rpx] text-[#fff] absolute left-[50%] bottom-[-117rpx] transform -translate-x-1/2 z-10",onClick:A})])),_:1},8,["style"])])),_:1},512)],64)):v("v-if",!0),f(c,{loading:O.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-249b397b"]]);export{M as default};
