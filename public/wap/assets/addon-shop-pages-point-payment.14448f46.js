import{d as e,r as t,W as a,o as l,c as r,w as s,b as i,f as d,E as o,F as p,G as x,u,x as c,y as n,b8 as f,n as _,a as v,I as y,i as m,N as g,C as b,g as k,h,a3 as w,a4 as F,H as j,V as C,aE as S}from"./index-e6ce9fbf.js";import{_ as V}from"./u-icon.c5d9cd81.js";import{_ as E}from"./u--image.2a363e1d.js";import{_ as R}from"./u-alert.57f3e65f.js";import{_ as $}from"./u-button.7a41d301.js";import{_ as z}from"./u-tabbar.2615c204.js";import{_ as I}from"./pay.16fd6339.js";import{o as O,d as T}from"./point.6f048c3e.js";import{_ as A,a as D,b as H}from"./invoice.vue_vue_type_script_setup_true_lang.68c9e2da.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-image.c9386d77.js";import"./u-transition.6919b33f.js";import"./u-loading-icon.39fd4711.js";import"./u-safe-bottom.1ba5bfba.js";import"./u-popup.b16d6e1d.js";import"./pay.f23cf994.js";import"./u-empty.c4d60006.js";import"./order.22cff883.js";import"./u-form.f2229701.js";import"./u-line.ebbd60c6.js";import"./u-input.b98e66b2.js";const B=U(e({__name:"payment",setup(e){const U=t({order_key:"",member_remark:"",discount:{},invoice:{},delivery:{delivery_type:""}}),B=t(null),G=t(),N=t(),P=t(),W=t(!1),q=t(0),J=t([]),K=t();uni.getStorageSync("orderCreateData")&&Object.assign(U.value,uni.getStorageSync("orderCreateData"));const L=uni.getStorageSync("selectAddressCallback");L&&(U.value.order_key="",U.value.delivery.delivery_type=L.delivery,U.value.delivery.take_address_id=L.address_id,uni.removeStorage({key:"selectAddressCallback"}));const M=(e,t)=>{U.value.delivery.delivery_type!=e&&(q.value=t,U.value.order_key="",U.value.delivery.delivery_type=e,U.value.delivery.take_address_id=0,Q())},Q=()=>{O(U.value).then((({data:e})=>{B.value=e,U.value.order_key=e.order_key,B.value.delivery.delivery_type_list&&(J.value=Object.values(B.value.delivery.delivery_type_list)),L&&(q.value=J.value.findIndex((e=>e.key===B.value.delivery.delivery_type))),!U.value.delivery.delivery_type&&e.delivery.delivery_type&&(U.value.delivery.delivery_type=e.delivery.delivery_type)})).catch()};Q(),a((()=>J.value.length),((e,t)=>{J.value.length&&uni.getStorageSync("distributionType")&&J.value.forEach(((e,t)=>{e.name==uni.getStorageSync("distributionType")&&(q.value=t,M(e.key,t))}))}));let X=0;const Y=()=>{Z()&&!W.value&&(W.value=!0,T(U.value).then((({data:e})=>{var t;X=e.order_id,0==B.value.basic.order_money?v({url:"/addon/shop/pages/order/detail",param:{order_id:X},mode:"redirectTo"}):null==(t=N.value)||t.open(e.trade_type,e.order_id,`/addon/shop/pages/order/detail?order_id=${e.order_id}`)})).catch((()=>{W.value=!1})))},Z=()=>{const e=U.value;if(B.value.basic.has_goods_types.includes("real")){if(["express","local_delivery"].includes(e.delivery.delivery_type)&&!B.value.delivery.take_address)return y({title:"请选择收货地址",icon:"none"}),!1;if("store"==e.delivery.delivery_type&&!e.delivery.take_store_id)return y({title:"请选择自提点",icon:"none"}),!1}return!0},ee=()=>{v({url:"/addon/shop/pages/order/detail",param:{order_id:X},mode:"redirectTo"})},te=()=>{let e={};e.delivery=U.value.delivery.delivery_type,e.type="local_delivery"==U.value.delivery.delivery_type?"location_address":"address",e.id=B.value.delivery.take_address.id,K.value.open(e)},ae=e=>{U.value.delivery.take_store_id=e&&e.store_id?e.store_id:0,Q()},le=e=>{U.value.invoice=e},re=e=>{U.value.order_key="",U.value.delivery.delivery_type=e.delivery,U.value.delivery.take_address_id=e.address_id,Q()};return(e,t)=>{const a=m,v=g,y=b,O=k(h("u-icon"),V),T=k(h("u--image"),E),W=k(h("u-alert"),R),L=w,Q=k(h("u-button"),$),X=k(h("u-tabbar"),z),Z=k(h("pay"),I),se=F;return l(),r(a,{style:_(e.themeColor())},{default:s((()=>[B.value?(l(),r(se,{key:0,"scroll-y":"true",class:"bg-[#f6f6f6] h-screen"},{default:s((()=>[i(a,{class:"pt-[40rpx] px-[24rpx] payment-bottom"},{default:s((()=>[d(" 配送方式 "),B.value.basic.has_goods_types.includes("real")&&J.value.length?(l(),r(a,{key:0,class:"mb-[20rpx] rounded-[16rpx] bg-white"},{default:s((()=>[J.value.length>1?(l(),r(a,{key:0,class:"rounded-tl-[16rpx] rounded-tr-[16rpx] head-tab flex items-center w-full bg-[#efefef]"},{default:s((()=>[(l(!0),o(x,null,p(J.value,((e,t)=>(l(),r(a,{key:t,class:j(["head-tab-item flex-1 relative",{active:t===q.value}])},{default:s((()=>[i(a,{class:"h-[74rpx] relative z-10 text-center leading-[74rpx] text-[28rpx]",onClick:a=>M(e.key,t)},{default:s((()=>[c(n(e.name),1)])),_:2},1032,["onClick"]),t===q.value&&3==J.value.length?(l(),r(v,{key:0,class:"tab-image absolute bottom-[-2rpx] h-[94rpx] w-[240rpx]",src:u(C)(`addon/shop/payment/tab_${t}.png`),mode:"aspectFit"},null,8,["src"])):t===q.value&&2==J.value.length?(l(),r(v,{key:1,class:"tab-img absolute bottom-[-2rpx] h-[95rpx] w-[354rpx]",src:u(C)(`addon/shop/payment/tabstyle_${t}.png`),mode:"aspectFit"},null,8,["src"])):d("v-if",!0)])),_:2},1032,["class"])))),128))])),_:1})):d("v-if",!0),i(a,{class:"min-h-[90rpx] flex items-center px-[30rpx]"},{default:s((()=>[d(" 收货地址 "),["express","local_delivery"].includes(U.value.delivery.delivery_type)?(l(),r(a,{key:0,class:"w-full",onClick:te},{default:s((()=>[e.$u.test.isEmpty(B.value.delivery.take_address)?(l(),r(a,{key:1,class:"flex items-center"},{default:s((()=>[i(v,{class:"w-[26rpx] h-[30rpx] mr-[10rpx]",src:u(C)("addon/shop/payment/position_02.png"),mode:"aspectFit"},null,8,["src"]),i(y,{class:"text-[26rpx]"},{default:s((()=>[c("添加收货地址")])),_:1}),i(y,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999] ml-auto"})])),_:1})):(l(),r(a,{key:0,class:"py-[30rpx]"},{default:s((()=>[i(a,{class:"flex items-center"},{default:s((()=>[i(v,{class:"w-[60rpx] h-[60rpx] mr-[20rpx] flex-shrink-0",src:u(C)("addon/shop/payment/position_01.png"),mode:"aspectFit"},null,8,["src"]),i(a,{class:"flex flex-col"},{default:s((()=>[i(y,{class:"text-[22rpx] text-[#999]"},{default:s((()=>[c(n(B.value.delivery.take_address.full_address.split(B.value.delivery.take_address.address)[0]),1)])),_:1}),i(y,{class:"text-[32rpx] text-[#303133] mt-[10rpx]"},{default:s((()=>[c(n(B.value.delivery.take_address.address),1)])),_:1})])),_:1}),i(y,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1}),i(a,{class:"flex items-center text-[24rpx] text-[#666] mt-[18rpx]"},{default:s((()=>[i(y,{class:"mr-[16rpx]"},{default:s((()=>[c(n(B.value.delivery.take_address.name),1)])),_:1}),i(y,null,{default:s((()=>[c(n(u(S)(B.value.delivery.take_address.mobile)),1)])),_:1})])),_:1})])),_:1}))])),_:1})):d("v-if",!0),d(" 自提点 "),"store"==U.value.delivery.delivery_type?(l(),r(a,{key:1,class:"flex items-center w-full",onClick:t[0]||(t[0]=e=>G.value.open())},{default:s((()=>[e.$u.test.isEmpty(B.value.delivery.take_store)?(l(),r(a,{key:1,class:"flex items-center w-full"},{default:s((()=>[i(v,{class:"w-[26rpx] h-[30rpx] mr-[10rpx]",src:u(C)("addon/shop/payment/position_02.png"),mode:"aspectFit"},null,8,["src"]),i(y,{class:"text-[26rpx]"},{default:s((()=>[c("请选择自提点")])),_:1}),i(y,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1})):(l(),r(a,{key:0,class:"py-[24rpx] w-full"},{default:s((()=>[i(a,{class:"flex items-center mb-[12rpx]"},{default:s((()=>[i(a,{class:"flex flex-col"},{default:s((()=>[i(a,{class:"text-[32rpx] text-[#303133] mb-[16rpx]"},{default:s((()=>[c(n(B.value.delivery.take_store.store_name),1)])),_:1}),i(a,{class:"text-[22rpx] text-[#666]"},{default:s((()=>[c(n(B.value.delivery.take_store.full_address),1)])),_:1})])),_:1}),i(y,{class:"ml-auto nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1}),i(a,{class:"text-[22rpx] text-[#666] mb-[12rpx]"},{default:s((()=>[c("手机号："+n(B.value.delivery.take_store.store_mobile),1)])),_:1}),i(a,{class:"text-[22rpx] text-[#666]"},{default:s((()=>[c("营业时间："+n(B.value.delivery.take_store.trade_time),1)])),_:1})])),_:1}))])),_:1})):d("v-if",!0)])),_:1})])),_:1})):d("v-if",!0),B.value.basic.has_goods_types.includes("real")&&!J.value.length?(l(),r(a,{key:1,class:"mb-[20rpx] rounded-[16rpx] bg-white p-[24rpx] py-[40rpx]"},{default:s((()=>[f("p",{class:"text-[26rpx] text-gray-subtitle"},"商家尚未配置配送方式")])),_:1})):d("v-if",!0),i(a,{class:"mb-[20rpx] p-[30rpx] rounded-[16rpx] bg-white"},{default:s((()=>[i(a,{class:"mb-[30rpx]"},{default:s((()=>[(l(!0),o(x,null,p(B.value.goods_data,((e,t,p)=>(l(),r(a,{class:j(["flex",{"pb-[40rpx]":p+1!=Object.keys(B.value.goods_data).length}]),key:p},{default:s((()=>[i(T,{class:"rounded-[10rpx] overflow-hidden",width:"170rpx",height:"170rpx",src:u(C)(e.sku_image),model:"aspectFill"},{error:s((()=>[i(O,{name:"photo",color:"#999",size:"50"})])),_:2},1032,["src"]),i(a,{class:"flex flex-1 w-0 flex-col justify-between ml-[16rpx]"},{default:s((()=>[i(a,{class:"line-normal"},{default:s((()=>[i(a,{class:"truncate text-[#303133] text-[28rpx] leading-[32rpx] font-400"},{default:s((()=>[c(n(e.goods.goods_name),1)])),_:2},1024),e.sku_name?(l(),r(a,{key:0,class:"mt-[14rpx] flex"},{default:s((()=>[i(y,{class:"truncate bg-[#F2F2F2] px-[18rpx] py-[2rpx] rounded-[20rpx] text-[22rpx] text-[#666] leading-[28rpx]"},{default:s((()=>[c(n(e.sku_name),1)])),_:2},1024)])),_:2},1024)):d("v-if",!0)])),_:2},1024),i(a,{class:"alert-wrap mt-[6rpx]"},{default:s((()=>[e.not_support_delivery?(l(),r(W,{key:0,type:"error",description:"该商品不支持当前所选配送方式",class:"leading-[32rpx] !inline-block",fontSize:"12"})):d("v-if",!0)])),_:2},1024),i(a,{class:"flex justify-between items-center"},{default:s((()=>[i(a,{class:"text-[var(--price-text-color)] flex items-baseline price-font"},{default:s((()=>[i(y,null,{default:s((()=>[c(n(e.exchange_info.point)+"积分",1)])),_:2},1024),parseFloat(e.price)?(l(),o(x,{key:0},[i(y,{class:"mx-[4rpx]"},{default:s((()=>[c("+")])),_:1}),i(y,{class:"text-[26rpx] font-500"},{default:s((()=>[c("￥")])),_:1}),i(y,{class:"text-[36rpx] font-500"},{default:s((()=>[c(n(parseFloat(e.price).toFixed(2).split(".")[0]),1)])),_:2},1024),i(y,{class:"text-[24rpx] font-500"},{default:s((()=>[c("."+n(parseFloat(e.price).toFixed(2).split(".")[1]),1)])),_:2},1024)],64)):d("v-if",!0)])),_:2},1024),i(a,{class:"font-400 text-[28rpx] text-[#303133]"},{default:s((()=>[i(y,null,{default:s((()=>[c("x")])),_:1}),i(y,null,{default:s((()=>[c(n(e.num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),d(" 买家留言 "),i(a,{class:"bg-white flex items-center leading-[30rpx]"},{default:s((()=>[i(a,{class:"text-[26rpx] font-400 w-[150rpx] text-[#303133]"},{default:s((()=>[c("买家留言")])),_:1}),i(a,{class:"flex-1 text-[#303133]"},{default:s((()=>[i(L,{type:"text",modelValue:U.value.member_remark,"onUpdate:modelValue":t[1]||(t[1]=e=>U.value.member_remark=e),class:"text-right text-[26rpx]",maxlength:"50",placeholder:"请输入留言信息给卖家","placeholder-class":"text-[#999]"},null,8,["modelValue"])])),_:1}),i(y,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1}),d(" 发票 "),P.value&&P.value.invoiceOpen?(l(),r(a,{key:0,class:"flex items-center text-[#303133] leading-[30rpx] mt-[30rpx]",onClick:t[2]||(t[2]=e=>P.value.open())},{default:s((()=>[i(a,{class:"text-[26rpx] font-500 w-[150rpx]"},{default:s((()=>[c("发票信息")])),_:1}),i(a,{class:"flex-1 w-0 text-right truncate"},{default:s((()=>[i(y,{class:"text-[26rpx]"},{default:s((()=>[c(n(U.value.invoice.header_name||"不需要发票"),1)])),_:1})])),_:1}),i(y,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[#999]"})])),_:1})):d("v-if",!0)])),_:1}),i(a,{class:"p-[30rpx] rounded-[16rpx] bg-white"},{default:s((()=>[i(a,{class:"text-[32rpx] font-500 text-[#303133] leading-[38rpx] mb-[24rpx]"},{default:s((()=>[c("价格明细")])),_:1}),i(a,{class:"flex items-center mb-[25rpx] text-[#303133]"},{default:s((()=>[i(a,{class:"text-[26rpx] w-[150rpx] leading-[30rpx]"},{default:s((()=>[c("商品金额")])),_:1}),i(a,{class:"flex-1 w-0 text-right price-font"},{default:s((()=>[i(y,{class:"text-[28rpx]"},{default:s((()=>[c(n(B.value.basic.point_sum)+"积分",1)])),_:1}),B.value.basic&&parseFloat(B.value.basic.goods_money)?(l(),o(x,{key:0},[i(y,{class:"text-[28rpx] mx-[4rpx]"},{default:s((()=>[c("+")])),_:1}),i(y,{class:"text-[24rpx]"},{default:s((()=>[c("￥")])),_:1}),i(y,{class:"text-[32rpx]"},{default:s((()=>[c(n(parseFloat(B.value.basic.goods_money).toFixed(2).split(".")[0]),1)])),_:1}),i(y,{class:"text-[22rpx]"},{default:s((()=>[c("."+n(parseFloat(B.value.basic.goods_money).toFixed(2).split(".")[1]),1)])),_:1})],64)):d("v-if",!0)])),_:1})])),_:1}),B.value.basic.delivery_money?(l(),r(a,{key:0,class:"flex items-center mb-[25rpx]"},{default:s((()=>[i(a,{class:"text-[26rpx] w-[150rpx] leading-[30rpx]"},{default:s((()=>[c("运费")])),_:1}),i(a,{class:"flex-1 w-0 text-right price-font text-[26rpx]"},{default:s((()=>[i(y,{class:"text-[22rpx]"},{default:s((()=>[c("￥")])),_:1}),i(y,{class:"text-[26rpx]"},{default:s((()=>[c(n(parseFloat(B.value.basic.delivery_money).toFixed(2).split(".")[0]),1)])),_:1}),i(y,{class:"text-[20rpx]"},{default:s((()=>[c("."+n(parseFloat(B.value.basic.delivery_money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1})])),_:1})):d("v-if",!0),B.value.basic.discount_money?(l(),r(a,{key:1,class:"flex items-center text-[#303133]"},{default:s((()=>[i(a,{class:"text-[26rpx] w-[150rpx] leading-[30rpx]"},{default:s((()=>[c("优惠金额")])),_:1}),i(a,{class:"flex-1 w-0 text-right text-[var(--price-text-color)] price-font"},{default:s((()=>[i(y,{class:"text-[22rpx]"},{default:s((()=>[c("-￥")])),_:1}),i(y,{class:"text-[26rpx]"},{default:s((()=>[c(n(parseFloat(B.value.basic.discount_money).toFixed(2).split(".")[0]),1)])),_:1}),i(y,{class:"text-[20rpx]"},{default:s((()=>[c("."+n(parseFloat(B.value.basic.discount_money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1})])),_:1})):d("v-if",!0)])),_:1})])),_:1}),i(X,{fixed:!0,placeholder:!0,safeAreaInsetBottom:!0},{default:s((()=>[i(a,{class:"flex-1 flex items-center justify-between"},{default:s((()=>[i(a,{class:"whitespace-nowrap px-[30rpx]"},{default:s((()=>[i(y,{class:"text-[28rpx] text-[#303133] leading-[32rpx]"},{default:s((()=>[c("合计：")])),_:1}),i(y,{class:"text-[28rpx] font-500 text-[var(--price-text-color)] price-font leading-[46rpx]"},{default:s((()=>[c(n(B.value.basic.point_sum)+"积分",1)])),_:1}),B.value.basic&&parseFloat(B.value.basic.goods_money)?(l(),o(x,{key:0},[i(y,{class:"text-[28rpx] font-500 text-[var(--price-text-color)] price-font leading-[46rpx] mx-[4rpx]"},{default:s((()=>[c("+")])),_:1}),i(y,{class:"text-[26rpx] font-500 text-[var(--price-text-color)] price-font leading-[30rpx]"},{default:s((()=>[c("￥")])),_:1}),i(y,{class:"text-[40rpx] font-500 text-[var(--price-text-color)] price-font leading-[46rpx]"},{default:s((()=>[c(n(parseFloat(B.value.basic.order_money).toFixed(2).split(".")[0]),1)])),_:1}),i(y,{class:"text-[24rpx] font-500 text-[var(--price-text-color)] price-font leading-[46rpx]"},{default:s((()=>[c("."+n(parseFloat(B.value.basic.order_money).toFixed(2).split(".")[1]),1)])),_:1})],64)):d("v-if",!0)])),_:1}),i(Q,{text:"提交订单",customStyle:{width:"180rpx",height:"66rpx",color:"#fff",fontSize:"28rpx",lineHeight:"66rpx",marginRight:"30rpx",background:"linear-gradient( 94deg,  var(--primary-help-color) 0%, var(--price-text-color) 69%), var(--price-text-color)"},shape:"circle",onClick:Y},null,8,["customStyle"])])),_:1})])),_:1}),d(" 选择自提点 "),i(u(A),{ref_key:"storeRef",ref:G,onConfirm:ae},null,512),d(" 发票 "),i(u(D),{ref_key:"invoiceRef",ref:P,onConfirm:le},null,512),d(" 地址 "),i(u(H),{ref_key:"addressRef",ref:K,onConfirm:re},null,512),i(Z,{ref_key:"payRef",ref:N,onClose:ee},null,512)])),_:1})):d("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-0410c0ff"]]);export{B as default};
