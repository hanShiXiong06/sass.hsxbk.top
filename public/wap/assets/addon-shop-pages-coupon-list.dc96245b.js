import{d as e,j as t,r,l as a,p as l,o,c as s,w as c,b as n,n as p,u as i,W as u,y as d,U as x,ad as f,V as v,f as m,A as b,ae as _,af as g,an as h,bf as y,i as k,D as w,ac as C,g as F,h as j,E as T,z,a as S,G as D,bg as I,H as R,C as V,aA as E,_ as B}from"./index-71c7df08.js";import{t as M}from"./topTabbar.cb42d19f.js";import{b as P,c as U,d as A}from"./coupon.6319e3c7.js";/* empty css                                                                    */import{M as N}from"./mescroll-body.49de0f6f.js";import{M as H}from"./mescroll-empty.95b8c17e.js";import{u as O}from"./useMescroll.26ccf5de.js";import"./mescroll-i18n.00218d15.js";/* empty css                                                                       */const G=B(e({__name:"list",setup(e){const{mescrollInit:B,downCallback:G,getMescroll:K}=O(g,_);let L={};M().setTopTabbarParam({title:"优惠券列表"}),t((()=>D(Number(L.height))+D(L.top)+D(8)+364+"rpx"));const Q=t((()=>Object.keys(L).length?D(Number(L.height))+D(L.top)+D(8)+416+"rpx":"416rpx")),W=I();let X=r();h((()=>{setTimeout((()=>{y().in(W).select(".coupon-header").boundingClientRect((e=>{X.value=e.height+"px"})).exec()}))}));const q=r([]),J=r(!0),Y=a(),Z=t((()=>Y.info)),$=e=>{J.value=!0;let t={page:e.num,limit:e.size,order:"all"===ae.value?"":ae.value,sort:"price"==ae.value?te.value:re.value,type:oe.value||""};P(t).then((t=>{let r=t.data.data.map((e=>(-1!=e.sum_count&&e.receive_count===e.sum_count?e.btnType="collected":Z.value&&e.is_receive&&e.limit_count===e.member_receive_count?e.btnType="using":e.btnType="collecting",e)));1==e.num&&(q.value=[]),q.value=q.value.concat(r),e.endSuccess(r.length),J.value=!1})).catch((()=>{J.value=!1,e.endErr()}))},ee=e=>{S({url:"/addon/shop/pages/coupon/detail",param:{coupon_id:e}})},te=r(""),re=r(""),ae=r("all"),le=r(0),oe=r(""),se=r([]),ce=r(!1);l((()=>{U().then((e=>{se.value.push({label:"全部",value:""}),se.value=se.value.concat(e.data)}))}));const ne=e=>{ae.value=e,"all"==e&&(re.value="",te.value=""),"price"==e&&(re.value="",te.value?te.value="asc"==te.value?"desc":"asc":te.value="asc"),"create_time"==e&&(te.value="",re.value?re.value="asc"==re.value?"desc":"asc":re.value="asc"),"type"==e?(re.value="asc",te.value="asc",ce.value=!0):(ce.value=!1,q.value=[],K().resetUpScroll())};return(e,t)=>{const r=k,a=w,l=V,_=C,g=F(j("u-popup"),E);return o(),s(r,{class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden",style:p(e.themeColor())},{default:c((()=>[n(r,{class:"coupon-header fixed left-0 right-0 top-0 z-10080"},{default:c((()=>[n(r,{class:"h-[364rpx]",style:p({backgroundImage:"url("+i(T)("addon/shop/coupon/coupon_uniapp.png")+")",backgroundSize:"cover",backgroundPosition:"bottom",backgroundRepeat:"no-repeat"})},null,8,["style"]),n(r,{class:u(["-mt-[-36rpx] px-[var(--sidebar-m)] py-[24rpx] flex items-center justify-between leading-[40rpx] text-[28rpx] bg-[var(--page-bg-color)] rounded-t-[26rpx] relative z-99999 !pl-[30rpx]",{"!bg-[#fff]":ce.value}])},{default:c((()=>[n(a,{class:u({"text-primary font-500":"all"==ae.value}),onClick:t[0]||(t[0]=e=>ne("all"))},{default:c((()=>[d("默认排序")])),_:1},8,["class"]),n(r,{class:u(["flex items-center",{"text-primary font-500":"create_time"==ae.value}]),onClick:t[1]||(t[1]=e=>ne("create_time"))},{default:c((()=>[n(a,{class:"mr-[4rpx]"},{default:c((()=>[d("最新")])),_:1}),"asc"==re.value?(o(),s(a,{key:0,class:u(["text-[18rpx] text-[var(--text-color-light6)] nc-iconfont nc-icon-a-xiangshangV6xx1",{"!text-primary":"create_time"==ae.value}])},null,8,["class"])):(o(),s(a,{key:1,class:u(["text-[18rpx] text-[var(--text-color-light6)] nc-iconfont nc-icon-a-xiangxiaV6xx1",{"!text-primary":"create_time"==ae.value}])},null,8,["class"]))])),_:1},8,["class"]),n(r,{class:u(["flex items-center",{"text-primary font-500":"price"==ae.value}]),onClick:t[2]||(t[2]=e=>ne("price"))},{default:c((()=>[n(a,{class:"mr-[4rpx]"},{default:c((()=>[d("价格")])),_:1}),"asc"==te.value?(o(),s(a,{key:0,class:u(["text-[18rpx] text-[var(--text-color-light6)] nc-iconfont nc-icon-a-xiangshangV6xx1",{"!text-primary":"price"==ae.value}])},null,8,["class"])):(o(),s(a,{key:1,class:u(["text-[18rpx] text-[var(--text-color-light6)] nc-iconfont nc-icon-a-xiangxiaV6xx1",{"!text-primary":"price"==ae.value}])},null,8,["class"]))])),_:1},8,["class"]),n(r,{class:u(["flex items-center",{"text-primary font-500":"type"==ae.value}]),onClick:t[3]||(t[3]=e=>ne("type"))},{default:c((()=>[n(r,{class:"w-[2rpx] h-[28rpx] bg-gradient-to-b from-[#333] to-[#fff] mr-[20rpx] flex-shrink-0"}),n(a,{class:"mr-[10rpx]"},{default:c((()=>[d("筛选")])),_:1}),n(a,{class:"nc-iconfont color-[var(--text-color-light6)] nc-icon-shaixuanV6xx text-[28rpx]"})])),_:1},8,["class"])])),_:1},8,["class"])])),_:1}),n(N,{ref:"mescrollRef",onInit:i(B),down:{use:!1},height:"auto",onUp:$,top:i(Q)},{default:c((()=>[q.value.length?(o(),s(r,{key:0,class:"pb-[var(--top-m)] sidebar-margin"},{default:c((()=>[(o(!0),x(v,null,f(q.value,((e,t)=>(o(),x(v,null,["collected"===e.btnType?(o(),s(r,{key:0,class:u(["flex items-center relative w-[100%] rounded-[var(--rounded-big)] overflow-hidden bg-[#fff] py-[20rpx] background-size",{"mt-[var(--top-m)]":t}]),style:p({backgroundImage:"url("+i(T)("addon/shop/coupon/coupn_loot.png")+")"}),onClick:t=>ee(e.id)},{default:c((()=>[n(r,{class:"box-border flex-1 border-0 border-r-[1px] border-[#FFDCDC] border-dashed flex items-center"},{default:c((()=>[n(r,{class:"w-[164rpx] box-border flex justify-center"},{default:c((()=>[n(r,{class:"flex items-baseline text-[var(--price-text-color)]"},{default:c((()=>[n(a,{class:"text-[28rpx] leading-[34rpx] text-center font-400 price-font mr-[4rpx]"},{default:c((()=>[d("￥")])),_:1}),n(a,{class:"text-[54rpx] font-500 text-left leading-[70rpx] max-w-[136rpx] price-font"},{default:c((()=>[d(z(e.coupon_price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(r,{class:"flex-1 box-border ml-[10rpx]"},{default:c((()=>[n(r,{class:"text-[26rpx] leading-[42rpx] text-left font-500"},{default:c((()=>["0.00"===e.min_condition_money?(o(),s(a,{key:0},{default:c((()=>[d("无门槛")])),_:1})):(o(),s(a,{key:1},{default:c((()=>[d("满"+z(e.coupon_min_price)+"元可用",1)])),_:2},1024))])),_:2},1024),n(r,{class:"mt-[10rpx] text-left flex items-center"},{default:c((()=>[n(a,{class:"w-[80rpx] text-center bg-[#FFEFF0] whitespace-nowrap text-[var(--primary-color)] text-[18rpx] h-[30rpx] leading-[30rpx] rounded-[16rpx] mr-[10rpx] flex-shrink-0"},{default:c((()=>[d(z(e.type_name),1)])),_:2},1024),n(a,{class:"text-[24rpx] truncate max-w-[190rpx] leading-[30rpx] text-[var(--text-color-light6)]"},{default:c((()=>[d(z(e.title),1)])),_:2},1024)])),_:2},1024),n(r,{class:"w-[100%] mt-[10rpx] text-[20rpx] leading-[30rpx] text-[var(--text-color-light6)]"},{default:c((()=>[1==e.valid_type?(o(),s(a,{key:0},{default:c((()=>[d("领取之日起"+z(e.length||"")+"天内有效",1)])),_:2},1024)):(o(),s(a,{key:1},{default:c((()=>[d(" 有效期至"+z(e.valid_end_time?e.valid_end_time.slice(0,10):""),1)])),_:2},1024))])),_:2},1024)])),_:2},1024)])),_:2},1024),n(r,{class:"pr-[20rpx] pl-[34rpx]"},{default:c((()=>[n(l,{class:"flex-center",style:{width:"150rpx",height:"60rpx",color:"#fff",fontSize:"24rpx",padding:"0",backgroundColor:"#FFB4B1",border:"none",opacity:"1",borderRadius:"30rpx"},disabled:""},{default:c((()=>[d("已领完")])),_:1})])),_:1}),n(r,{class:"absolute top-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-br-[20rpx] rounded-bl-[20rpx] bg-[var(--page-bg-color)]"}),n(r,{class:"absolute bottom-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-tr-[20rpx] rounded-tl-[20rpx] bg-[var(--page-bg-color)]"})])),_:2},1032,["class","style","onClick"])):(o(),s(r,{key:1,class:u(["flex items-center relative w-[100%] rounded-[var(--rounded-big)] overflow-hidden bg-[#fff] py-[20rpx] background-size",{"mt-[var(--top-m)]":t}]),onClick:t=>ee(e.id)},{default:c((()=>[n(r,{class:"relative box-border flex-1 border-0 border-r-[1px] border-[#FFDCDC] border-dashed flex items-center pl-[10rpx]"},{default:c((()=>[n(r,{class:"w-[164rpx] box-border flex justify-center"},{default:c((()=>[n(r,{class:"flex items-baseline text-[var(--price-text-color)]"},{default:c((()=>[n(a,{class:"text-[28rpx] leading-[34rpx] text-center font-400 price-font mr-[4rpx]"},{default:c((()=>[d("￥")])),_:1}),n(a,{class:"text-[54rpx] font-500 text-left leading-[70rpx] max-w-[136rpx] price-font"},{default:c((()=>[d(z(e.coupon_price),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),n(r,{class:"flex-1 box-border ml-[10rpx]"},{default:c((()=>[n(r,{class:"text-[26rpx] leading-[42rpx] text-left font-500"},{default:c((()=>["0.00"===e.min_condition_money?(o(),s(a,{key:0},{default:c((()=>[d("无门槛")])),_:1})):(o(),s(a,{key:1},{default:c((()=>[d("满"+z(e.coupon_min_price)+"元可用",1)])),_:2},1024))])),_:2},1024),n(r,{class:"mt-[10rpx] text-left flex items-center"},{default:c((()=>[n(a,{class:"w-[80rpx] bg-[#FFEFF0] whitespace-nowrap text-[var(--primary-color)] text-[18rpx] h-[30rpx] leading-[30rpx] text-center rounded-[16rpx] mr-[10rpx] flex-shrink-0"},{default:c((()=>[d(z(e.type_name),1)])),_:2},1024),n(a,{class:"text-[24rpx] truncate max-w-[190rpx] leading-[30rpx] text-[var(--text-color-light9)]"},{default:c((()=>[d(z(e.title),1)])),_:2},1024)])),_:2},1024),n(r,{class:"w-[100%] mt-[6rpx] text-[20rpx] leading-[30rpx] text-[var(--text-color-light9)]"},{default:c((()=>[1==e.valid_type?(o(),s(a,{key:0},{default:c((()=>[d("领取之日起"),n(a,null,{default:c((()=>[d(z(e.length||""),1)])),_:2},1024),d("天内有效")])),_:2},1024)):(o(),s(a,{key:1},{default:c((()=>[d(" 有效期至"),n(a,null,{default:c((()=>[d(z(e.valid_end_time?e.valid_end_time.slice(0,10):""),1)])),_:2},1024)])),_:2},1024))])),_:2},1024)])),_:2},1024)])),_:2},1024),"collecting"===e.btnType?(o(),s(r,{key:0,onClick:b((r=>((e,t)=>{if(!Z.value)return R().setLoginBack({url:"/addon/shop/pages/coupon/list"}),!1;A({coupon_id:e,number:1,type:"receive"}).then((e=>{e.code>0&&(q.value[t].member_receive_count+=1,q.value[t].receive_count+=1,(q.value[t].member_receive_count==q.value[t].limit_count||-1!=q.value[t].sum_count&&q.value[t].receive_count===q.value[t].sum_count)&&(q.value[t].btnType="using"))}))})(e.id,t)),["stop"]),class:"pr-[20rpx] pl-[34rpx]"},{default:c((()=>[n(l,{class:"flex-center",style:p({width:"150rpx",height:"60rpx",color:"#fff",fontSize:"24rpx",padding:"0",backgroundColor:"var(--primary-color)",border:"none",borderRadius:"30rpx"})},{default:c((()=>[d("立即领取")])),_:1},8,["style"])])),_:2},1032,["onClick"])):m("v-if",!0),"using"===e.btnType?(o(),s(r,{key:1,onClick:b((t=>{return r=e.id,void S({url:"/addon/shop/pages/goods/list",param:{coupon_id:r}});var r}),["stop"]),class:"pr-[20rpx] pl-[34rpx]"},{default:c((()=>[n(l,{class:"flex-center",style:p({width:"150rpx",height:"60rpx",color:"var(--primary-color)",fontSize:"24rpx",padding:"0",backgroundColor:"transparent",border:"2rpx solid var(--primary-color)",borderRadius:"30rpx"})},{default:c((()=>[d("去使用")])),_:1},8,["style"])])),_:2},1032,["onClick"])):m("v-if",!0),n(r,{class:"absolute top-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-br-[20rpx] rounded-bl-[20rpx] bg-[var(--page-bg-color)]"}),n(r,{class:"absolute bottom-0 right-[190rpx] h-[10rpx] w-[20rpx] rounded-tr-[20rpx] rounded-tl-[20rpx] bg-[var(--page-bg-color)]"})])),_:2},1032,["class","onClick"]))],64)))),256)),m(' <view :style="{\'height\': nullPageHeight}" class="noData bg-[#fff] rounded-[var(--rounded-big)] flex items-center justify-center"> '),m(" </view> ")])),_:1})):m("v-if",!0),m(' <view class=""> '),q.value.length||J.value?m("v-if",!0):(o(),s(H,{key:1,option:{tip:"暂无优惠券",btnText:"去逛逛"},onEmptyclick:t[4]||(t[4]=e=>i(S)({url:"/addon/shop/pages/goods/list"}))})),m(" </view> ")])),_:1},8,["onInit","top"]),n(g,{show:ce.value,mode:"top",onClose:t[6]||(t[6]=e=>ce.value=!1),customStyle:{top:i(X)},safeAreaInsetBottom:!1},{default:c((()=>[n(r,{onTouchmove:t[5]||(t[5]=b((()=>{}),["prevent","stop"]))},{default:c((()=>[n(_,{"scroll-x":!0,"scroll-with-animation":"","scroll-into-view":"id"+(le.value?le.value-1:0),class:"px-[var(--sidebar-m)] box-border bg-white rounded-b-[26rpx]"},{default:c((()=>[n(r,{class:"items-center flex py-[20rpx] border-0 border-t-[2rpx] border-solid border-[#F0F2F8]"},{default:c((()=>[(o(!0),x(v,null,f(se.value,((e,t)=>(o(),s(a,{class:u(["flex-shrink-0 w-[120rpx] h-[50rpx] text-[24rpx] leading-[50rpx] text-center text-[#333] bg-[var(--temp-bg)] rounded-[30rpx] border-box mr-[20rpx] border-[2rpx] border-solid border-[#F8F9FD]",{"!text-primary !border-primary !bg-[rgba(239,0,12,0.04)] font-500":e.value==oe.value}]),key:t,id:"id"+t,onClick:r=>((e,t)=>{le.value=e,oe.value=t,q.value=[],K().resetUpScroll(),ce.value=!1})(t,e.value)},{default:c((()=>[d(z(e.label),1)])),_:2},1032,["class","id","onClick"])))),128))])),_:1})])),_:1},8,["scroll-into-view"])])),_:1})])),_:1},8,["show","customStyle"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-f0e9c044"]]);export{G as default};
