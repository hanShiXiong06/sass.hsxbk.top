import{d as e,r as t,O as a,E as l,o as s,c as u,w as r,b as o,y as d,u as i,f as n,n as p,av as m,a as c,i as f,g as _,h as x,D as v}from"./index-7bf68536.js";import{_ as g}from"./u-input.09a5cedd.js";import{_ as b,a as h}from"./u-form.78a4f7c2.js";import{_ as w}from"./u-upload.ab11cc5c.js";import{_ as y}from"./u-switch.63b76ae8.js";import{_ as j}from"./u-button.359d7329.js";import{c as q,m as V}from"./member.4788035b.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.0c1c54c7.js";import"./u-line.463a2a45.js";import"./u-loading-icon.b37701e7.js";/* empty css                                                                 */const I=C(e({__name:"bind-wx",setup(e){const C=t(!1),I=t([]),R=t({wx_id:"",wx_qrcode:"",status:1});let T=t(!0);a((()=>{setTimeout((()=>{T.value=!1}),800),P()}));const D={wx_id:[{type:"string",required:!0,message:"请输入微信号",trigger:["blur","change"]}],wx_qrcode:{type:"string",required:!0,message:"请上传微信二维码",trigger:["change"]}},U=e=>{R.value.status=e},W=e=>{I.value.splice(e.index,1)},k=async e=>{let t=[].concat(e.file),a=I.value.length;t.map((e=>{I.value.push({...e,status:"uploading",message:"上传中"})}));for(let l=0;l<t.length;l++){const e=await A(t[l].url);1==e.code&&(R.value.wx_qrcode=e.data.url);let s=I.value[a];I.value.splice(a,1,{...s,status:1==e.code?"success":"failed",message:1==e.code?"":e.msg,url:e.data.url}),a++}},A=async e=>{let t=!1;return await m({filePath:e,name:"file"}).then((e=>{t=e})).catch((e=>{t=e})),t},L=t(null),P=()=>{q().then((e=>{e.data.id&&(R.value=e.data,I.value[0]={url:l(e.data.wx_qrcode)})}))},z=()=>{L.value.validate().then((()=>{C.value||(C.value=!0,V(R.value).then((e=>{C.value=!1,c({url:"/app/pages/member/index",mode:"redirectTo"})})).catch((()=>{C.value=!1})))}))};return(e,t)=>{const a=f,l=_(x("u-input"),g),m=_(x("u-form-item"),b),c=_(x("u-upload"),w),q=_(x("up-switch"),y),V=v,A=_(x("u-button"),j),P=_(x("u-form"),h);return s(),u(a,{class:"w-screen h-screen flex flex-col",style:p(e.themeColor())},{default:r((()=>[o(a,{class:"flex-1"},{default:r((()=>[o(a,{class:"h-[100rpx]"}),o(a,{class:"px-[60rpx] pt-[100rpx] mb-[100rpx]"},{default:r((()=>[o(a,{class:"font-bold text-lg"},{default:r((()=>[d("绑定微信")])),_:1})])),_:1}),o(a,{class:"px-[60rpx]"},{default:r((()=>[o(P,{labelPosition:"left",model:R.value,errorType:"toast",rules:D,ref_key:"formRef",ref:L},{default:r((()=>[o(m,{labelWidth:"100",label:"微信号",prop:"wx_id","border-bottom":!0,required:"true"},{default:r((()=>[o(l,{modelValue:R.value.wx_id,"onUpdate:modelValue":t[0]||(t[0]=e=>R.value.wx_id=e),border:"none",clearable:"",placeholder:"请输入微信号",class:"!bg-transparent",disabled:i(T)},null,8,["modelValue","disabled"])])),_:1}),n(' <u-form-item label="" prop="wx_qrcode" :border-bottom="true">\n\t\t\t\t\t\t<u-upload @afterRead="afterRead" :maxCount="1">\n\t\t\t\t\t\t\t<u-avatar :src="img(formData.wx_qrcode)" size="60" leftIcon="none"></u-avatar>\n\t\t\t\t\t\t\t<view class="text-primary text-sm mt-[10rpx]">{{ t(\'updateHeadimg\') }}</view>\n\t\t\t\t\t\t</u-upload>\n\t\t\t\t\t</u-form-item> '),o(m,{label:"二维码",prop:"wx_qrcode",labelWidth:"100",required:"true"},{default:r((()=>[o(c,{uploadIcon:"photo-fill",accept:"image",fileList:I.value,onAfterRead:k,maxCount:1,onDelete:W,previewFullImage:!0},null,8,["fileList"])])),_:1}),o(m,{labelWidth:"100",label:"是否显示",prop:"status","border-bottom":!0},{default:r((()=>[o(q,{activeValue:1,inactiveValue:0,modelValue:R.value.status,"onUpdate:modelValue":t[1]||(t[1]=e=>R.value.status=e),onChange:U},null,8,["modelValue"])])),_:1}),o(V,{class:"text-[12px] text-gray-subtitle"},{default:r((()=>[d("开启后，你的下级可以通过以上信息添加您的微信")])),_:1}),o(a,{class:"mt-[60rpx]"},{default:r((()=>[o(A,{type:"primary",text:"绑定",loading:C.value,loadingText:"绑定中",onClick:z},null,8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1},8,["style"])}}}),[["__scopeId","data-v-9f7fae12"]]);export{I as default};
