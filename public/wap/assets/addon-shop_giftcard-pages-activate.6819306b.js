import{d as e,r as a,j as r,p as t,T as l,o,c as s,w as d,b as p,n,u,f as c,y as i,W as f,a as m,i as b,g as x,h as g,C as v,B as _,F as h,E as y,Q as k,R as w,S as j,M as P,_ as z}from"./index-71c7df08.js";import{_ as C}from"./uni-popup.402343c9.js";import{_ as S}from"./loading-page.vue_vue_type_script_setup_true_lang.c7dc2256.js";import{b as T}from"./card.1368a464.js";import{c as V}from"./giftcard.48be66f9.js";import{t as R}from"./topTabbar.cb42d19f.js";const M=z(e({__name:"activate",setup(e){R().setTopTabbarParam({title:"卡密激活"});const z=a(!0),M=a({}),W=a(!0),q=a(!1),F=a({card_no:"",card_key:""}),I=r((()=>({backgroundImage:"url("+y(M.value.banner||"")+") ",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"bottom"})));t((()=>{U()})),l((()=>{setTimeout((()=>{z.value=!1}),800)}));const N=r((()=>({card_no:{type:"string",required:!0,message:h("cardNumberPlaceholder"),trigger:["blur","change"]},card_key:{type:"string",required:!0,message:h("passwordPlaceholder"),trigger:["blur","change"]}}))),U=()=>{W.value=!0,V().then((e=>{M.value=e.data,W.value=!1})).catch((()=>{W.value=!1}))},B=a(),E=a(null),O=()=>{q.value||E.value.validate().then((()=>{q.value=!0,T(F.value).then((e=>{e.data&&(B.value.open(),F.value.card_no="",F.value.card_key=""),q.value=!1})).catch((()=>{q.value=!1}))}))},Q=()=>{B.value.close(),m({url:"/addon/shop_giftcard/pages/my_card_list",mode:"redirectTo"})},A=()=>{B.value.close()};return(e,a)=>{const r=b,t=x(g("u-input"),k),l=x(g("u-form-item"),w),m=x(g("u-form"),j),T=x(g("u-parse"),P),V=v,R=_,U=x(g("uni-popup"),C),D=x(g("loading-page"),S);return o(),s(r,{class:"bg-[#f8f8f8] min-h-[100vh] w-full",style:n(e.themeColor())},{default:d((()=>[Object.keys(M.value).length?(o(),s(r,{key:0,class:"w-full"},{default:d((()=>[p(r,{class:"pb-[384rpx]",style:n(u(I))},null,8,["style"]),p(r,{class:"card-template sidebar-margin mt-[-56rpx]"},{default:d((()=>[c(' <view class="title">卡密激活</view> '),p(m,{labelPosition:"left",labelWidth:"136rpx",labelStyle:{"font-size":"28rpx","font-weight":"400","line-height":"39rpx"},model:F.value,errorType:"toast",rules:u(N),ref_key:"formRef",ref:E},{default:d((()=>[p(r,{class:"h-[88rpx] flex w-full items-center px-[var(--pad-sidebar-m)] rounded-[44rpx] box-border border-[2rpx] border-solid border-[#eee]"},{default:d((()=>[p(l,{label:"卡片编号",prop:"card_no","border-bottom":!1},{default:d((()=>[p(t,{modelValue:F.value.card_no,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value.card_no=e),modelModifiers:{trim:!0},border:"none",maxlength:"40",placeholder:u(h)("cardNumberPlaceholder"),autocomplete:"off",class:"!bg-transparent",disabled:z.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])])),_:1})])),_:1}),p(r,{class:"mt-[30rpx] h-[88rpx] flex w-full items-center px-[var(--pad-sidebar-m)] rounded-[44rpx] box-border border-[2rpx] border-solid border-[#eee]"},{default:d((()=>[p(l,{label:"卡片密码",prop:"card_key","border-bottom":!1},{default:d((()=>[p(t,{modelValue:F.value.card_key,"onUpdate:modelValue":a[1]||(a[1]=e=>F.value.card_key=e),modelModifiers:{trim:!0},border:"none",type:"password",maxlength:"40",placeholder:u(h)("passwordPlaceholder"),autocomplete:"off",class:"!bg-transparent",disabled:z.value,fontSize:"26rpx",placeholderClass:"!text-[var(--text-color-light9)] text-[26rpx]"},null,8,["modelValue","placeholder","disabled"])])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1}),M.value.tips?(o(),s(r,{key:0,class:"card-template sidebar-margin mt-[var(--sidebar-m)]"},{default:d((()=>[p(r,{class:"title"},{default:d((()=>[i("温馨提示")])),_:1}),p(r,{class:"u-content"},{default:d((()=>[p(T,{content:M.value.tips,tagStyle:{img:"vertical-align: top;",p:"overflow: hidden;word-break:break-word;"}},null,8,["content"])])),_:1})])),_:1})):c("v-if",!0),p(r,{class:"w-full footer"},{default:d((()=>[p(r,{class:"py-[var(--top-m)] px-[var(--sidebar-m)] bg-[#f8f8f8] footer w-full fixed bottom-0 left-0 right-0 box-border"},{default:d((()=>[p(V,{"hover-class":"none",class:f(["primary-btn-bg text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500",{"opacity-40":q.value}]),onClick:O},{default:d((()=>[i("激活卡片")])),_:1},8,["class"])])),_:1})])),_:1}),p(U,{ref_key:"popupRef",ref:B,type:"center","is-mask-click":!1},{default:d((()=>[p(r,{class:"bg-[#fff] w-[530rpx] min-h-[504rpx] rounded-[var(--rounded-big)] box-border p-[32rpx] relative",style:n({"background-image":"url("+u(y)("addon/shop_giftcard/popup_bg.png")+")",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"top"})},{default:d((()=>[p(R,{class:"w-[327rpx] h-[327rpx] rounded-[var(--rounded-mid)] absolute left-[50%] top-[-163.5rpx] transform -translate-x-1/2 z-10",src:u(y)("addon/shop_giftcard/popup_top.png"),mode:"aspectFill"},null,8,["src"]),p(r,{class:"text-[40rpx] leading-[56rpx] font-bold text-center pt-[174rpx]"},{default:d((()=>[i("恭喜您 激活成功！")])),_:1}),p(r,{class:"text-[24rpx] leading-[34rpx] text-center mt-[30rpx]"},{default:d((()=>[i("您已成功激活了1张礼品卡~")])),_:1}),p(V,{class:"w-[370rpx] h-[80rpx] font-500 text-[26rpx] leading-[80rpx] !text-[#fff] primary-btn-bg m-0 !mx-auto rounded-[40rpx] remove-border mt-[90rpx]",onClick:Q},{default:d((()=>[i("去看看")])),_:1}),p(r,{class:"iconfont icona-guanbi-34V6xx text-[57rpx] text-[#fff] absolute left-[50%] bottom-[-117rpx] transform -translate-x-1/2 z-10",onClick:A})])),_:1},8,["style"])])),_:1},512)])),_:1})):c("v-if",!0),p(D,{loading:W.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-77adaa0f"]]);export{M as default};
