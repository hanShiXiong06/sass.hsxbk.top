import{d as e,r as a,p as l,aR as t,j as r,aS as s,t as d,o as i,c as o,w as u,b as n,u as c,y as p,z as v,A as m,W as f,n as _,aQ as x,aT as g,a as b,g as h,h as y,i as k,D as S,C as w,F as V,Q as C,R as A,aU as P,S as j,_ as q}from"./index-71c7df08.js";import{_ as z}from"./area-select.vue_vue_type_script_setup_true_lang.8205cddf.js";import{m as $}from"./manifest.6e483234.js";const U=q(e({__name:"address_edit",setup(e){const q=a({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:""}),U=a(),W=a(null),I=a(""),R=a(!1),T=a(!1),E=a("address"),M=a(2);a(null),l((e=>{M.value=e.isSelectMap||"";const a=uni.getStorageSync("selectAddressCallback");if(e.id)t(e.id).then((e=>{e.data&&Object.assign(q.value,e.data),a&&(E.value="express"==a.delivery?"address":"locationAddress")}));else if(e.name){uni.getStorageSync("addressInfo")&&Object.assign(q.value,uni.getStorageSync("addressInfo")),q.value.address=e.name,H(e.latng);var l=J("latng").split(",");q.value.lat=l[0],q.value.lng=l[1]}I.value=e.source||"",a&&(E.value="express"==a.delivery?"address":"locationAddress")}));const O=r((()=>({name:{type:"string",required:!0,message:V("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:V("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,l){/^1[3-9]\d{9}$/.test(a)?l():l(new Error(V("mobileError")))}}],area:{validator(){let e=!0;return uni.$u.test.isEmpty(q.value.area)&&uni.$u.test.isEmpty(q.value.address_name)&&(e=!1),e},message:V("selectAreaPlaceholder")},address:{type:"string",required:!0,message:V("addressPlaceholder"),trigger:["blur","change"]}}))),Q=()=>{T.value=!0,U.value.open()},D=e=>{!T.value||q.value.province_id!=e.province.id&&q.value.city_id==e.city.id&&q.value.district_id==e.district.id||(q.value.lat="",q.value.lng=""),q.value.province_id=e.province.id||0,q.value.city_id=e.city.id||0,q.value.district_id=e.district.id||0,q.value.area=`${e.province.name||""}${e.city.name||""}${e.district.name||""}`,T.value=!1},F=a(!1),B=()=>{const e=q.value.id?x:g;W.value.validate().then((()=>{if(!F.value){if(F.value=!0,R.value=!0,q.value.full_address=q.value.area+q.value.address,1==M.value&&!q.value.lat&&!q.value.lng)return d({title:"缺少经纬度，请在地图上重新选点",icon:"none"}),F.value=!1,R.value=!1,!1;e(q.value).then((e=>{F.value=!1,setTimeout((()=>{if(R.value=!1,"shop_order_payment"==I.value){const a=uni.getStorageSync("selectAddressCallback");a&&(a.address_id=e.data.id||q.value.id,uni.setStorage({key:"selectAddressCallback",data:a,success(){b({url:a.back,mode:"redirectTo"})}}))}else b({url:"/app/pages/member/address",mode:"redirectTo",param:{source:I.value}})}),1e3)})).catch((()=>{F.value=!1,R.value=!1}))}}))},G=()=>{var e=q.value;uni.setStorageSync("addressInfo",e);let a=location.origin+location.pathname+"?source="+I.value;M.value&&(a=a+"&isSelectMap="+M.value),window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(a)+"&key="+$.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"},H=e=>{s({latlng:e}).then((e=>{e.data?(q.value.full_address="",q.value.full_address+=null!=e.data.province?e.data.province:"",q.value.full_address+=null!=e.data.city?""+e.data.city:"",q.value.full_address+=null!=e.data.district?""+e.data.district:"",q.value.address_name=q.value.full_address.replace(/-/g,""),q.value.area=e.data.province+e.data.city+e.data.district||e.data.full_address,q.value.province_id=null!=e.data.province_id?e.data.province_id:0,q.value.city_id=null!=e.data.city_id?e.data.city_id:0,q.value.district_id=null!=e.data.district_id?e.data.district_id:0):d({title:e.msg,icon:"none"})}))},J=e=>{for(var a=window.location.search.substring(1).split("&"),l=0;l<a.length;l++){var t=a[l].split("=");if(t[0]==e)return t[1]}return!1};return(e,a)=>{const l=h(y("u-input"),C),t=h(y("u-form-item"),A),r=k,s=S,d=h(y("u-switch"),P),x=h(y("u-form"),j),g=w,b=h(y("area-select"),z);return i(),o(r,{class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden address-edit",style:_(e.themeColor())},{default:u((()=>[n(x,{labelPosition:"left",model:q.value,errorType:"toast",rules:c(O),ref_key:"formRef",ref:W},{default:u((()=>[n(r,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[20rpx]"},{default:u((()=>[n(r,{class:""},{default:u((()=>[n(t,{label:c(V)("name"),prop:"name",labelWidth:"200rpx"},{default:u((()=>[n(l,{fontSize:"28rpx",modelValue:q.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value.name=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"25",placeholderStyle:"color: #888",placeholder:c(V)("namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[16rpx]"},{default:u((()=>[n(t,{label:c(V)("mobile"),prop:"mobile",labelWidth:"200rpx"},{default:u((()=>[n(l,{fontSize:"28rpx",modelValue:q.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.mobile=e),modelModifiers:{trim:!0},type:"number",maxlength:"11",border:"none",clearable:"",placeholder:c(V)("mobilePlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[16rpx]"},{default:u((()=>[n(t,{label:c(V)("selectArea"),prop:"area",labelWidth:"200rpx"},{default:u((()=>["address"==E.value&&1!=M.value?(i(),o(r,{key:0,class:"flex w-full items-center h-[52rpx]",onClick:Q},{default:u((()=>[q.value.area?(i(),o(r,{key:1,class:"text-[28rpx] flex-1 leading-[1.4]"},{default:u((()=>[p(v(q.value.area),1)])),_:1})):(i(),o(r,{key:0,class:"text-[#888] text-[28rpx] flex-1"},{default:u((()=>[p(v(c(V)("selectAreaPlaceholder")),1)])),_:1})),n(r,{onClick:m(G,["stop"]),class:"flex items-center"},{default:u((()=>[n(s,{class:"nc-iconfont nc-icon-dizhiguanliV6xx mr-[4rpx] text-[32rpx] text-[#e93323]"}),n(s,{class:"text-[24rpx] whitespace-nowrap text-[#e93323]"},{default:u((()=>[p("定位")])),_:1})])),_:1},8,["onClick"])])),_:1})):(i(),o(r,{key:1,class:"flex justify-between items-center flex-1 h-[52rpx]",onClick:G},{default:u((()=>[q.value.area||q.value.address_name?(i(),o(r,{key:0,class:"text-[28rpx] text-[#303133] leading-[1.4]"},{default:u((()=>[p(v(q.value.area||q.value.address_name),1)])),_:1})):(i(),o(r,{key:1,class:"text-[#888] text-[28rpx]"},{default:u((()=>[p(v(c(V)("selectAddressPlaceholder")),1)])),_:1})),n(r,{class:"flex items-center"},{default:u((()=>[n(s,{class:"nc-iconfont nc-icon-dizhiguanliV6xx text-[32rpx] mr-[4rpx] text-[#e93323]"}),n(s,{class:"text-[24rpx] whitespace-nowrap text-[#e93323]"},{default:u((()=>[p("定位")])),_:1})])),_:1})])),_:1}))])),_:1},8,["label"])])),_:1}),n(r,{class:"mt-[16rpx]"},{default:u((()=>[n(t,{label:c(V)("address"),prop:"address",labelWidth:"200rpx"},{default:u((()=>[n(l,{fontSize:"28rpx",modelValue:q.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value.address=e),border:"none",clearable:"",maxlength:"120",placeholder:c(V)("addressPlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1})])),_:1}),n(r,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[10rpx]"},{default:u((()=>[n(t,{label:c(V)("defaultAddress"),prop:"name","border-bottom":!1,labelWidth:"200rpx"},{default:u((()=>[n(d,{modelValue:q.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>q.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)",inactiveColor:"var(--temp-bg)"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1},8,["model","rules"]),n(r,{class:"w-full footer"},{default:u((()=>[n(r,{class:"py-[var(--top-m)] px-[var(--sidebar-m)] footer w-full fixed bottom-0 left-0 right-0 box-border"},{default:u((()=>[n(g,{"hover-class":"none",class:f(["primary-btn-bg text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500",{"opacity-50":R.value}]),onClick:B,disabled:R.value,loading:F.value},{default:u((()=>[p(v(c(V)("save")),1)])),_:1},8,["disabled","loading","class"])])),_:1})])),_:1}),n(b,{ref_key:"areaRef",ref:U,onComplete:D,"area-id":q.value.district_id},null,8,["area-id"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-79c62cca"]]);export{U as default};
