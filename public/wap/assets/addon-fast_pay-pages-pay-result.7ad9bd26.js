import{d as a,r as e,p as t,J as s,F as l,o as u,c as o,w as r,b as n,R as i,y as c,z as p,u as m,f,n as d,bi as x,s as y,H as v,b_ as _,a as g,aU as j,D as h,i as b,g as w,h as C,a1 as k}from"./index-7bf68536.js";import{_ as S}from"./u-button.359d7329.js";import{_ as T}from"./u-loading-icon.b37701e7.js";import{_ as z}from"./u-modal.b47eb877.js";import{g as F}from"./pay.d8c8791c.js";import{g as B}from"./config.634448d3.js";import"./u-icon.0c1c54c7.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.463a2a45.js";import"./u-popup.be4bfacd.js";import"./u-transition.cdf87992.js";import"./u-safe-bottom.908eeae4.js";const L=a({__name:"result",setup(a){const L=e(null),R=e(!1),D=e(),I=e();let P=0;const U=e();t((a=>{(async()=>{const a=await B();U.value=a.data})(),I.value=a.trade_id,D.value=a.trade_type,A()}));const A=()=>{F(D.value,I.value).then((a=>{if(!uni.$u.test.isEmpty(a.data)){if(1==a.data.status&&P<60)return R.value=!0,P++,void setTimeout((()=>{A()}),1e3);L.value=a.data,R.value=!1,s({title:2==L.value.status?l("pay.paySuccess"):l("pay.payFail")}),2==L.value.status&&""!=U.value.page&&(a=>{if(Object.keys(a).length){if(!a.name)return;if("app/pages/member/index"==x()&&!y())return void v().setLoginBack({url:a.url});_(a)}})(U.value.page)}}))},E=()=>{var a;const e=decodeURIComponent(uni.getStorageSync("payReturn"));g(e?{url:e,mode:"reLaunch"}:{url:j(),param:{code:null==(a=L.value)?void 0:a.out_trade_no},mode:"reLaunch"})};return(a,e)=>{const t=h,s=b,x=w(C("u-button"),S),y=w(C("u-loading-icon"),T),v=w(C("u-modal"),z);return u(),o(s,{style:d(a.themeColor())},{default:r((()=>[L.value?(u(),o(s,{key:0,class:"w-screen h-screen flex flex-col items-center"},{default:r((()=>[n(s,{class:"flex-1 flex flex-col items-center w-full pt-[100rpx]"},{default:r((()=>[n(t,{class:i(["iconfont text-2xl",2==L.value.status?"text-primary iconduigou":"iconzhifushibai text-[#29DB6F]"])},null,8,["class"]),n(s,{class:"text-sm"},{default:r((()=>[c(p(2==L.value.status?m(l)("pay.paySuccess"):m(l)("pay.payFail")),1)])),_:1}),n(s,{class:"text-xl font-bold pt-[30rpx]"},{default:r((()=>[n(t,{class:"text-base"},{default:r((()=>[c(p(m(l)("currency")),1)])),_:1}),n(t,null,{default:r((()=>[c(p(m(k)(L.value.money)),1)])),_:1})])),_:1})])),_:1}),n(s,{class:"pb-[200rpx] w-[240rpx]"},{default:r((()=>[n(x,{type:"primary",text:2==L.value.status?m(l)("complete"):m(l)("close"),plain:!0,onClick:E},null,8,["text"])])),_:1})])),_:1})):f("v-if",!0),n(v,{show:R.value,showCancelButton:!0,confirmText:m(l)("pay.completePay"),cancelText:m(l)("pay.incompletePay"),onCancel:E,confirmColor:"var(--primary-color)"},{default:r((()=>[n(s,{class:"py-[20rpx]"},{default:r((()=>[n(y,{text:m(l)("pay.getting"),textSize:"16",mode:"circle",vertical:!0},null,8,["text"])])),_:1})])),_:1},8,["show","confirmText","cancelText"])])),_:1},8,["style"])}}});export{L as default};
