import{d as e,r as t,O as l,o,c as r,w as a,u as s,b as i,A as u,f as d,P as c,a7 as n,Q as p,R as x,a as f,D as v,a5 as g,i as _,a6 as m,g as b,h,y,z as k,E as w,B as C,j,_ as S,t as F,s as I,C as V,aM as N,l as B,e as E,v as M,n as R,a8 as U,a9 as z,H as L,p as $,x as O,J as T}from"./index-7bf68536.js";import{_ as H}from"./u--image.b3bf1d5c.js";import{_ as D}from"./tabbar.e049672c.js";import{_ as P}from"./loading-page.vue_vue_type_script_setup_true_lang.124ad65f.js";import{b as A,i as W,c as J,j as Y}from"./goods.ac47f924.js";import{M as K}from"./mescroll-empty.fcefb74e.js";import{_ as Q}from"./_plugin-vue_export-helper.1b428a4d.js";import{M as X}from"./mescroll-body.b6d57b41.js";import{u as Z}from"./useMescroll.26ccf5de.js";import{_ as q}from"./u-number-box.30c0ab2e.js";import{_ as G}from"./u-popup.be4bfacd.js";import{u as ee}from"./cart.6bce9836.js";import{f as te}from"./cloneDeep.77735539.js";import{b as le}from"./bind-mobile.37d1c6df.js";import"./u-image.e46f68ef.js";import"./u-icon.0c1c54c7.js";import"./u-transition.cdf87992.js";import"./u-badge.d8d91719.js";import"./u-tabbar.d98653fa.js";import"./u-safe-bottom.908eeae4.js";import"./u-loading-page.566c330a.js";import"./u-loading-icon.b37701e7.js";import"./mescroll-i18n.14e7fe02.js";/* empty css                                                                       */import"./u-form.78a4f7c2.js";import"./u-line.463a2a45.js";import"./sms-code.vue_vue_type_script_setup_true_lang.eace8f61.js";import"./u-input.09a5cedd.js";import"./u-modal.b47eb877.js";import"./u-checkbox-group.b2a485bf.js";const oe=Q(e({__name:"category-template-two-one",props:{config:{type:Object,default:()=>({})},categoryId:{type:[String,Number],default:0}},setup(e){const j=e;let S=j.config,F=j.categoryId;const I=t(""),V=t(!0);l((()=>{B()}));const N=t([]),B=()=>{V.value=!0,A().then((e=>{if(N.value=e.data,F)for(let t=0;t<N.value.length;t++){if(N.value[t].category_id==F){E.value=t;break}if(N.value[t].child_list)for(let e=0;e<N.value[t].child_list.length;e++)if(N.value[t].child_list[e].category_id==F){E.value=t;break}}V.value=!1})).catch((()=>{V.value=!1}))},E=t(0),M=()=>{I.value&&f({url:"/addon/shop/pages/goods/list",param:{goods_name:encodeURIComponent(I.value)}})};return(e,t)=>{const l=v,j=g,F=_,B=m,R=C,U=b(h("u--image"),H),z=b(h("tabbar"),D),L=b(h("loading-page"),P);return o(),r(F,{class:"bg-[var(--page-bg-color)] overflow-hidden min-h-screen"},{default:a((()=>[N.value.length?(o(),r(F,{key:0,class:"mescroll-box"},{default:a((()=>[s(S).search.control?(o(),r(F,{key:0,class:"search-box box-border z-10 fixed top-0 left-0 right-0 h-[100rpx] bg-[#fff]"},{default:a((()=>[i(F,{class:"flex-1 search-input"},{default:a((()=>[i(l,{onClick:u(M,["stop"]),class:"nc-iconfont nc-icon-sousuo-duanV6xx1 btn"},null,8,["onClick"]),i(j,{class:"input",type:"text",modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),placeholder:s(S).search.title,placeholderClass:"text-[var(--text-color-light9)]",onConfirm:M},null,8,["modelValue","placeholder"]),I.value?(o(),r(l,{key:0,class:"nc-iconfont nc-icon-cuohaoV6xx1 clear",onClick:t[1]||(t[1]=e=>I.value="")})):d("v-if",!0)])),_:1})])),_:1})):d("v-if",!0),i(F,{class:x(["tabs-box z-2 fixed left-0 bg-[#fff] bottom-[50px] top-0",{"!top-[100rpx]":s(S).search.control}])},{default:a((()=>[i(B,{"scroll-y":!0,class:"scroll-height"},{default:a((()=>[i(F,{class:"bg-[var(--temp-bg)]"},{default:a((()=>[(o(!0),c(p,null,n(N.value,((e,t)=>(o(),r(F,{class:x(["tab-item truncate",{"tab-item-active":t==E.value,"rounded-br-[12rpx]":E.value-1===t,"rounded-tr-[12rpx]":E.value+1===t}]),key:t,onClick:e=>((e,t)=>{E.value=e})(t)},{default:a((()=>[i(F,{class:"text-box px-[16rpx] truncate"},{default:a((()=>[y(k(e.category_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["class"]),i(B,{class:"h-[100vh]","scroll-y":!0},{default:a((()=>[i(F,{class:x(["pl-[188rpx] scroll-ios pt-[20rpx] pr-[20rpx]",{"!pt-[120rpx]":s(S).search.control}])},{default:a((()=>{var e,t;return[(null==(e=N.value[E.value])?void 0:e.child_list)&&!V.value?(o(),r(F,{key:0,class:"bg-[#fff] grid grid-cols-3 gap-x-[50rpx] gap-y-[32rpx] py-[32rpx] px-[24rpx] rounded-[var(--rounded-big)]"},{default:a((()=>{var e;return[(o(!0),c(p,null,n(null==(e=N.value[E.value])?void 0:e.child_list,((e,t)=>(o(),r(F,{key:e.category_id,onClick:t=>{return l=e.category_id,void f({url:"/addon/shop/pages/goods/list",param:{curr_goods_category:l}});var l},class:"flex items-center justify-center flex-col"},{default:a((()=>[i(U,{radius:"var(--goods-rounded-big)",width:"120rpx",height:"120rpx",src:s(w)(e.image?e.image:""),model:"aspectFill"},{error:a((()=>[i(R,{class:"rounded-[var(--goods-rounded-big)] overflow-hidden w-[120rpx] h-[120rpx]",src:s(w)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"]),i(F,{class:"text-[24rpx] text-center mt-[16rpx] leading-[34rpx]"},{default:a((()=>[y(k(e.category_name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))]})),_:1})):d("v-if",!0),(null==(t=N.value[E.value])?void 0:t.child_list)||V.value?d("v-if",!0):(o(),r(K,{key:1,class:"part",option:{tip:"暂无商品分类"}}))]})),_:1},8,["class"])])),_:1})])),_:1})):d("v-if",!0),i(z),N.value.length||V.value?d("v-if",!0):(o(),r(K,{key:1,option:{tip:"暂无商品分类"}})),i(L,{loading:V.value},null,8,["loading"])])),_:1})}}}),[["__scopeId","data-v-f0126b10"]]),re=Q(e({__name:"add-cart-popup",setup(e,{expose:l}){const f=ee(),B=j((()=>f.cartList)),E=t(!1),M=t({skuId:"",name:[]}),R=t({}),U=t({}),z=t(1),L=t(0),$=t(0),O=t(0),T=t(0),D=()=>{setTimeout((()=>{(!z.value||z.value<=$.value)&&(z.value=$.value||1),z.value>=L.value&&(z.value=L.value),$.value>z.value&&(z.value=0)}),0)},P=()=>{setTimeout((()=>{(!z.value||z.value<=$.value)&&(z.value=$.value||1),z.value>=L.value&&(z.value=L.value),$.value>z.value&&(z.value=0,F({title:"库存数量小于起购数量",icon:"none"}))}),0)},A=()=>{E.value=!1},J=j((()=>{let e=te(R.value);if(Object.keys(e).length&&(Object.keys(M.value.name).length||(M.value.name=e.sku_spec_format.split(",")),e.goodsSpec.forEach(((e,t)=>{let l=e.spec_values.split(",");e.values=[],l.forEach(((l,o)=>{e.values[o]={},e.values[o].name=l,e.values[o].selected=!1,e.values[o].disabled=!1,M.value.name.forEach(((r,a)=>{a==t&&r==l&&(e.values[o].selected=!0)}))}))})),Y(),e.skuList&&Object.keys(e.skuList).length&&e.skuList.forEach((e=>{e.sku_id==M.value.skuId&&(U.value=e)}))),L.value=U.value.stock,e.goods.is_limit){if(e.goods&&e.goods.max_buy){let t=0;if(1==e.goods.limit_type)t=e.goods.max_buy;else{let l=e.goods.max_buy-(e.has_buy||0);t=l>0?l:0}t>U.value.stock?L.value=U.value.stock:t<=U.value.stock&&(L.value=t)}O.value=e.goods.max_buy,0==L.value&&(z.value=0)}return $.value=e.goods.min_buy,z.value=$.value>0?e.goods.min_buy:1,T.value=e.goods.min_buy,$.value>U.value.stock&&(z.value=0),e}));S((()=>U.value),((e,t)=>{if(B.value["goods_"+U.value.goods_id]&&B.value["goods_"+U.value.goods_id]["sku_"+U.value.sku_id])z.value=N(B.value["goods_"+U.value.goods_id]["sku_"+U.value.sku_id].num),U.value.cart_id=N(B.value["goods_"+U.value.goods_id]["sku_"+U.value.sku_id].id);else{let e=1;$.value>0&&(e=$.value),$.value>U.value.stock&&(e=0),z.value=e,U.value.cart_id=""}}));const Y=()=>{R.value.skuList.forEach(((e,t)=>{let l=e.sku_spec_format.split(",");M.value.name.every((e=>l.includes(e)))&&(M.value.skuId=e.sku_id)}))},K=()=>{if($.value&&$.value>U.value.stock)F({title:"商品库存小于起购数量",icon:"none"});else if(J.value.goods.is_limit){let e=`该商品单次限购${J.value.goods.max_buy}件`;1!=J.value.goods.limit_type&&(e=`该商品每人限购${J.value.goods.max_buy}件`),z.value>=J.value.goods.max_buy&&F({title:e,icon:"none"})}},Q=()=>{if(J.value.goods.is_limit&&$.value){let e=`该商品起购${$.value}件`;z.value<=$.value&&F({title:e,icon:"none"})}},X=()=>{if(0==z.value)f.reduce({id:U.value.cart_id||"",goods_id:U.value.goods_id,sale_price:U.value.sale_price,sku_id:U.value.sku_id});else{let e=0;e=J.value.goods.member_discount&&I()&&U.value.member_price!=U.value.price&&U.value.member_price?U.value.member_price:U.value.price,f.increase({id:U.value.cart_id||"",goods_id:U.value.goods_id,sku_id:U.value.sku_id,stock:U.value.stock,sale_price:e,num:z.value},0,(()=>{F({title:"加入购物车成功",icon:"none"})}))}E.value=!1},Z=e=>{let t="0.00";return t=J.value.goods.member_discount&&I()&&e.member_price!=e.price&&e.member_price?e.member_price:e.price,t},le=e=>{let t="";return t=J.value.goods.member_discount&&I()&&e.member_price!=e.price?"member_price":"",t};return l({open:e=>{(e=>{W(e).then((t=>{R.value=t.data,M.value.sku_id=e,R.value.skuList&&Object.keys(R.value.skuList).length&&R.value.skuList.forEach((t=>{t.sku_id==e&&(U.value=t,M.value.name=t.sku_spec_format.split(","))})),E.value=!0}))})(e)}}),(e,t)=>{const l=C,f=b(h("u--image"),H),j=v,S=_,F=g,I=b(h("u-number-box"),q),N=m,R=V,W=b(h("u-popup"),G);return o(),r(S,{onTouchmove:t[9]||(t[9]=u((()=>{}),["prevent","stop"]))},{default:a((()=>[i(W,{show:E.value,onClose:A,mode:"bottom"},{default:a((()=>[Object.keys(s(J)).length?(o(),r(S,{key:0,onTouchmove:t[8]||(t[8]=u((()=>{}),["prevent","stop"])),class:"rounded-t-[20rpx] overflow-hidden bg-[#fff] py-[32rpx] relative"},{default:a((()=>[i(S,{class:"flex px-[32rpx] mb-[58rpx]"},{default:a((()=>[i(f,{width:"180rpx",height:"180rpx",radius:"var(--goods-rounded-big)",src:s(w)(U.value.sku_image),model:"aspectFill"},{error:a((()=>[i(l,{class:"w-[180rpx] h-[180rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:s(w)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:1},8,["radius","src"]),i(S,{class:"flex flex-1 flex-col justify-between ml-[20rpx] py-[10rpx]"},{default:a((()=>[i(S,{class:"w-[100%]"},{default:a((()=>[i(S,{class:"text-[var(--price-text-color)] flex items-baseline"},{default:a((()=>[i(j,{class:"text-[32rpx] font-bold price-font mr-[4rpx]"},{default:a((()=>[y("￥")])),_:1}),i(j,{class:"text-[48rpx] price-font"},{default:a((()=>[y(k(parseFloat(Z(U.value)).toFixed(2).split(".")[0]),1)])),_:1}),i(j,{class:"text-[32rpx] price-font"},{default:a((()=>[y("."+k(parseFloat(Z(U.value)).toFixed(2).split(".")[1]),1)])),_:1}),"member_price"==le(U.value)?(o(),r(l,{key:0,class:"h-[24rpx] ml-[6rpx] max-w-[44rpx]",src:s(w)("addon/shop/VIP.png"),mode:"heightFix"},null,8,["src"])):d("v-if",!0)])),_:1}),i(S,{class:"text-[26rpx] leading-[32rpx] text-[#303133] mt-[12rpx]"},{default:a((()=>[y("库存"+k(U.value.stock)+k(s(J).goods.unit),1)])),_:1})])),_:1}),s(J).goodsSpec&&s(J).goodsSpec.length?(o(),r(S,{key:0,class:"w-[100%] text-[26rpx] leading-[30rpx] text-[var(--text-color-light6)] multi-hidden max-h-[60rpx]"},{default:a((()=>[y("已选规格："+k(U.value.sku_spec_format),1)])),_:1})):d("v-if",!0)])),_:1})])),_:1}),i(N,{class:"h-[500rpx] box-border px-[32rpx] mb-[30rpx]","scroll-y":"true"},{default:a((()=>[(o(!0),c(p,null,n(s(J).goodsSpec,((e,t)=>(o(),r(S,{class:x({"mt-[36rpx]":0!=t}),key:t},{default:a((()=>[i(S,{class:"text-[26rpx] leading-[36rpx] mb-[24rpx]"},{default:a((()=>[y(k(e.spec_name),1)])),_:2},1024),i(S,{class:"flex flex-wrap"},{default:a((()=>[(o(!0),c(p,null,n(e.values,((e,l)=>(o(),r(S,{class:x(["box-border bg-[#f2f2f2] text-[24rpx] px-[44rpx] text-center h-[56rpx] leading-[52rpx] mr-[20rpx] mb-[20rpx] border-1 border-solid rounded-[50rpx] border-[#f2f2f2]",{"!border-[var(--primary-color)] text-[var(--primary-color)] !bg-[var(--primary-color-light)]":e.selected}]),key:l,onClick:l=>((e,t)=>{M.value.name[t]=e.name})(e,t)},{default:a((()=>[y(k(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1032,["class"])))),128)),i(S,{class:"flex justify-between items-center mt-[8rpx]"},{default:a((()=>[i(S,{class:"text-[26rpx]"},{default:a((()=>[y("购买数量")])),_:1}),O.value>0&&T.value>1?(o(),r(j,{key:0,class:"ml-[20rpx] mr-[auto] text-[24rpx] text-[var(--primary-color)]"},{default:a((()=>[y(" ("+k(T.value)+k(s(J).goods.unit)+"起售，限购"+k(O.value)+k(s(J).goods.unit)+") ",1)])),_:1})):O.value>0?(o(),r(j,{key:1,class:"ml-[20rpx] mr-[auto] text-[24rpx] text-[var(--primary-color)]"},{default:a((()=>[y("(限购"+k(O.value)+k(s(J).goods.unit)+")",1)])),_:1})):T.value>1?(o(),r(j,{key:2,class:"ml-[20rpx] mr-[auto] text-[24rpx] text-[var(--primary-color)]"},{default:a((()=>[y("("+k(T.value)+k(s(J).goods.unit)+"起售)",1)])),_:1})):d("v-if",!0),s(B)["goods_"+U.value.goods_id]&&s(B)["goods_"+U.value.goods_id]["sku_"+U.value.sku_id]?(o(),r(I,{key:3,modelValue:z.value,"onUpdate:modelValue":t[3]||(t[3]=e=>z.value=e),min:$.value,max:L.value,integer:"",step:1,"input-width":"98rpx","input-height":"54rpx"},{minus:a((()=>[i(S,{class:"relative w-[34rpx] h-[34rpx]",onClick:t[0]||(t[0]=e=>Q())},{default:a((()=>[i(j,{class:x(["text-[34rpx] nc-iconfont nc-icon-jianV6xx font-500 absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",{"!text-[var(--text-color-light9)]":z.value<=$.value}])},null,8,["class"])])),_:1})])),input:a((()=>[i(F,{class:"text-[#303133] text-[28rpx] mx-[10rpx] w-[80rpx] h-[44rpx] bg-[var(--temp-bg)] leading-[44rpx] text-center rounded-[6rpx]",type:"number",onInput:D,onBlur:P,modelValue:z.value,"onUpdate:modelValue":t[1]||(t[1]=e=>z.value=e)},null,8,["modelValue"])])),plus:a((()=>[i(S,{class:"relative w-[34rpx] h-[34rpx]",onClick:t[2]||(t[2]=e=>K())},{default:a((()=>[i(j,{class:x(["text-[34rpx] nc-iconfont nc-icon-jiahaoV6xx font-500 absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",{"!text-[var(--text-color-light9)]":z.value>=L.value}])},null,8,["class"])])),_:1})])),_:1},8,["modelValue","min","max"])):(o(),r(I,{key:4,modelValue:z.value,"onUpdate:modelValue":t[7]||(t[7]=e=>z.value=e),min:$.value,max:L.value,integer:"",step:1,"input-width":"98rpx","input-height":"54rpx"},{minus:a((()=>[i(S,{class:"relative w-[34rpx] h-[34rpx]",onClick:t[4]||(t[4]=e=>Q())},{default:a((()=>[i(j,{class:x(["text-[34rpx] nc-iconfont nc-icon-jianV6xx font-500 absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",{"!text-[var(--text-color-light9)]":z.value<=$.value}])},null,8,["class"])])),_:1})])),input:a((()=>[i(F,{class:"text-[#303133] text-[28rpx] mx-[10rpx] w-[80rpx] h-[44rpx] bg-[var(--temp-bg)] leading-[44rpx] text-center rounded-[6rpx]",type:"number",onInput:D,onBlur:P,modelValue:z.value,"onUpdate:modelValue":t[5]||(t[5]=e=>z.value=e)},null,8,["modelValue"])])),plus:a((()=>[i(S,{class:"relative w-[34rpx] h-[34rpx]",onClick:t[6]||(t[6]=e=>K())},{default:a((()=>[i(j,{class:x(["text-[34rpx] nc-iconfont nc-icon-jiahaoV6xx font-500 absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",{"!text-[var(--text-color-light9)]":z.value>=L.value}])},null,8,["class"])])),_:1})])),_:1},8,["modelValue","min","max"]))])),_:1})])),_:1}),i(S,{class:"px-[20rpx]"},{default:a((()=>[U.value.stock>0?(o(),r(R,{key:0,class:"!h-[80rpx] font-500 primary-btn-bg leading-[80rpx] text-[26rpx] rounded-[50rpx]",type:"primary",onClick:X},{default:a((()=>[y("确定")])),_:1})):(o(),r(R,{key:1,class:"!h-[80rpx] leading-[80rpx] font-500 text-[26rpx] text-[#fff] bg-[#ccc] rounded-[50rpx]"},{default:a((()=>[y("已售罄")])),_:1}))])),_:1})])),_:1})):d("v-if",!0)])),_:1},8,["show"])])),_:1})}}}),[["__scopeId","data-v-7d4699ba"]]),ae=Q(e({__name:"category-template-one-one",props:{config:{type:Object,default:()=>({})},categoryId:{type:[String,Number],default:0}},setup(e){const S=e,N=ee();N.getList();const $=j((()=>N.cartList)),O=j((()=>N.totalNum)),T=j((()=>N.totalMoney)),W=B(),Y=j((()=>W.info)),{mescrollInit:Q,getMescroll:q}=Z(z,U);let G=S.config,oe=S.categoryId;const ae=t([]),se=t(""),ie=t(!0),ue=t(!1);t([]).value=uni.getStorageSync("shopCart")||[];const de=e=>{ue.value=!1,J({page:e.num,limit:e.size,goods_category:oe}).then((t=>{let l=t.data.data;1==e.num&&(ae.value=[]),ae.value=ae.value.concat(l),ce(),ie.value=!1,e.endSuccess(l.length),ae.value.length||(ue.value=!0)})).catch((()=>{ie.value=!1,ue.value=!0,e.endErr()}))},ce=()=>{ae.value.forEach(((e,t)=>{e.isMaxBuy=!1;let l=-1;if(e.is_limit&&e.max_buy){let t=0;if(1==e.limit_type)t=e.max_buy;else{let l=e.max_buy-(e.has_buy||0);t=l>0?l:0}t>e.stock?l=e.stock:t<=e.stock&&(l=t)}0==l&&(e.isMaxBuy=!0)}))},ne=e=>{f({url:"/addon/shop/pages/goods/detail",param:{goods_id:e}})};l((()=>{_e()}));const pe=t(""),xe=t(!1),fe=t(!1),ve=(e,t)=>{if(xe.value||fe.value)return!1;xe.value=!0,fe.value=!0;let l={goods_id:e.goodsSku.goods_id,sku_id:e.goodsSku.sku_id,sale_price:Se(e),stock:e.goodsSku.stock};e.id&&(l.num=e.num,l.id=e.id);let o=1;o=e.min_buy>0&&!e.num?e.min_buy:1,N.increase(l,o,(()=>{fe.value=!1})),setTimeout((()=>{const e=window.document.getElementById("animation-end"),l=e.getBoundingClientRect().left,o=e.getBoundingClientRect().top,r=window.document.getElementById(t),a=r.getBoundingClientRect().left,s=r.getBoundingClientRect().top;pe.value=`top: ${s}px; left: ${a}px;`,setTimeout((()=>{pe.value=`top: ${o+e.offsetHeight/2-r.offsetHeight/2}px; left: ${l+e.offsetWidth/2-r.offsetHeight/2}px; transition: all 0.8s; transform: rotate(-720deg);`}),20),setTimeout((()=>{pe.value="",xe.value=!1}),1020)}),100)},ge=t([]),_e=()=>{ie.value=!0,A().then((e=>{if(ge.value=e.data,oe)for(let t=0;t<ge.value.length;t++){if(ge.value[t].category_id==oe){me.value=t;break}if(ge.value[t].child_list)for(let e=0;e<ge.value[t].child_list.length;e++)if(ge.value[t].child_list[e].category_id==oe){me.value=t;break}}else oe=e.data[0].category_id;ie.value=!1})).catch((()=>{ie.value=!1}))},me=t(0),be=()=>{se.value&&f({url:"/addon/shop/pages/goods/list",param:{goods_name:encodeURIComponent(se.value)}})},he=t(),ye=(e,t)=>{if("virtual"==e.goods_type&&"verify"==e.virtual_receive_type)return ne(e.goodsSku.goods_id);if("cart"!==G.cart.event)return ne(e.goodsSku.goods_id);if(!Y.value)return L().setLoginBack({url:"/addon/shop/pages/goods/category"}),!1;if(e.goodsSku.sku_spec_format)he.value.open(e.goodsSku.sku_id);else{if(parseInt(e.goodsSku.num||0)>parseInt(e.goodsSku.stock))return void F({title:"商品库存不足",icon:"none"});if(e.min_buy&&e.min_buy>parseInt(e.stock))return void F({title:"商品库存小于起购数量",icon:"none"});ve(e,t)}},ke=()=>{f({url:"/addon/shop/pages/goods/cart"})},we=t(null);t(uni.getStorageSync("isbindmobile"));const Ce=()=>{if(uni.getStorageSync("isbindmobile"))return we.value.open(),!1;if(!O.value)return void F({title:"还没有选择商品",icon:"none"});const e=[];Object.values($.value).forEach((t=>{Object.keys(t).forEach((l=>{"totalNum"!=l&&"totalMoney"!=l&&e.push(t[l].id)}))})),0!=e.length&&uni.setStorage({key:"orderCreateData",data:{cart_ids:e},success(){f({url:"/addon/shop/pages/order/payment"})}})},je=e=>{let t="";return e.member_discount&&I()&&e.goodsSku.member_price!=e.goodsSku.price&&(t="member_price"),t},Se=e=>{let t="0.00";return t=e.member_discount&&I()&&e.goodsSku.member_price!=e.goodsSku.price&&e.goodsSku.member_price?e.goodsSku.member_price:e.goodsSku.price,t};return(e,t)=>{const l=v,f=g,j=_,S=m,I=C,B=b(h("u--image"),H),U=V,z=b(h("loading-page"),P),L=b(h("tabbar"),D);return o(),r(j,{class:"min-h-screen bg-[var(--page-bg-color)] overflow-hidden"},{default:a((()=>[ge.value.length?(o(),r(j,{key:0,class:x(["mescroll-box bg-[var(--page-bg-color)]",{cart:s(G).cart.control&&"cart"===s(G).cart.event,detail:!(s(G).cart.control&&"cart"===s(G).cart.event)}])},{default:a((()=>[i(X,{ref:"mescrollRef",down:{use:!1},onInit:s(Q),onUp:de},{default:a((()=>[s(G).search.control?(o(),r(j,{key:0,class:"search-box z-10 bg-[#fff] fixed top-0 left-0 right-0 h-[100rpx] box-border"},{default:a((()=>[i(j,{class:"flex-1 search-input"},{default:a((()=>[i(l,{onClick:u(be,["stop"]),class:"nc-iconfont nc-icon-sousuo-duanV6xx1 btn"},null,8,["onClick"]),i(f,{class:"input",type:"text",modelValue:se.value,"onUpdate:modelValue":t[0]||(t[0]=e=>se.value=e),placeholder:s(G).search.title,onConfirm:be,placeholderClass:"text-[var(--text-color-light9)]"},null,8,["modelValue","placeholder"]),se.value?(o(),r(l,{key:0,class:"nc-iconfont nc-icon-cuohaoV6xx1 clear",onClick:t[1]||(t[1]=e=>se.value="")})):d("v-if",!0)])),_:1})])),_:1})):d("v-if",!0),i(j,{class:x(["tabs-box z-2 fixed left-0 bg-[#fff] bottom-[50px] top-0",{"!top-[100rpx]":s(G).search.control,"pb-[98rpx]":s(G).cart.control&&"cart"===s(G).cart.event}])},{default:a((()=>[i(S,{"scroll-y":!0,class:"scroll-height"},{default:a((()=>[i(j,{class:"bg-[var(--temp-bg)]"},{default:a((()=>[(o(!0),c(p,null,n(ge.value,((e,t)=>(o(),r(j,{class:x(["tab-item truncate",{"tab-item-active":t==me.value,"rounded-br-[12rpx]":me.value-1===t,"rounded-tr-[12rpx]":me.value+1===t}]),key:t,onClick:l=>((e,t)=>{me.value=e,oe=t.category_id,ae.value=[],q().resetUpScroll()})(t,e)},{default:a((()=>[i(j,{class:"text-box px-[16rpx] truncate"},{default:a((()=>[y(k(e.category_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["class"]),i(j,{class:x(["flex justify-center flex-wrap pl-[188rpx] pb-[20rpx]",{" pt-[120rpx]":s(G).search.control," pt-[20rpx]":!s(G).search.control}])},{default:a((()=>[(o(!0),c(p,null,n(ae.value,((e,t)=>(o(),r(j,{key:e.goods_id,class:x(["box-border bg-white w-full flex mr-[20rpx] py-[24rpx] px-[20rpx] rounded-[var(--rounded-small)]",{"mt-[16rpx]":t}]),onClick:u((t=>ne(e.goods_id)),["stop"])},{default:a((()=>[i(j,{class:"w-[168rpx] h-[168rpx] flex items-center justify-center rounded-[var(--goods-rounded-small)] overflow-hidden"},{default:a((()=>[i(B,{width:"168rpx",height:"168rpx",radius:"var(--goods-rounded-small)",src:s(w)(e.goods_cover_thumb_mid||""),model:"aspectFill"},{error:a((()=>[i(I,{class:"w-[168rpx] h-[168rpx]",src:s(w)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),i(j,{class:"flex flex-1 ml-[20rpx] flex-wrap flex-col"},{default:a((()=>[i(j,{class:"max-h-[80rpx] text-[26rpx] leading-[40rpx] multi-hidden"},{default:a((()=>[y(k(e.goods_name),1)])),_:2},1024),i(j,{class:"flex-1 flex items-end justify-between"},{default:a((()=>[i(j,{class:"text-[var(--price-text-color)] price-font -mb-[8rpx]"},{default:a((()=>[i(l,{class:"text-[24rpx] font-500"},{default:a((()=>[y("￥")])),_:1}),i(l,{class:"text-[40rpx] font-500"},{default:a((()=>[y(k(parseFloat(Se(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),i(l,{class:"text-[24rpx] font-500"},{default:a((()=>[y("."+k(parseFloat(Se(e)).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==je(e)?(o(),r(I,{key:0,class:"h-[24rpx] max-w-[46rpx] ml-[6rpx]",src:s(w)("addon/shop/VIP.png"),mode:"heightFix"},null,8,["src"])):d("v-if",!0)])),_:2},1024),e.isMaxBuy?d("v-if",!0):(o(),c(p,{key:0},[("real"==e.goods_type||"virtual"==e.goods_type&&"verify"!=e.virtual_receive_type)&&""===e.goodsSku.sku_spec_format&&s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id]&&s(G).cart.control&&"cart"===s(G).cart.event?(o(),r(j,{key:0,class:"flex items-center"},{default:a((()=>[i(j,{class:"relative w-[32rpx] h-[32rpx]"},{default:a((()=>[i(l,{class:"text-[32rpx] text-color nc-iconfont nc-icon-jianshaoV6xx absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",onClick:u((t=>((e,t)=>{if(fe.value)return!1;fe.value=!0;let l=1;e.min_buy>0&&e.min_buy==t.num&&(l=e.min_buy),N.reduce({id:t.id,goods_id:t.goods_id,sku_id:t.sku_id,stock:t.stock,sale_price:t.sale_price,num:t.num},l,(()=>{fe.value=!1}))})(e,s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id])),["stop"])},null,8,["onClick"])])),_:2},1024),i(l,{class:"text-[#333] text-[24rpx] mx-[16rpx]"},{default:a((()=>[y(k(s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id].num),1)])),_:2},1024),i(j,{class:"relative w-[32rpx] h-[32rpx]"},{default:a((()=>[i(l,{class:"text-[32rpx] text-color iconfont iconjiahao2fill absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",id:"itemCart"+t,onClick:u((l=>((e,t,l)=>{if(parseInt(t.num)>parseInt(t.stock))return void F({title:"商品库存不足",icon:"none"});let o=t.num;if(e.min_buy>0&&e.min_buy>o&&(o=e.min_buy),e.is_limit&&e.max_buy){let t=0;if(1==e.limit_type)t=e.max_buy;else{let l=e.max_buy-(e.has_buy||0);t=l>0?l:0}e.goodsSku.stock,e.goodsSku.stock}if(e.is_limit&&o>=e.max_buy){let t=`该商品单次限购${e.max_buy}件`;return 1!=e.limit_type&&(t=`该商品每人限购${e.max_buy}件`),F({title:t,icon:"none"}),!1}let r=te(e);r.num=o,r.id=t.id,ve(r,l)})(e,s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id],"itemCart"+t)),["stop"])},null,8,["id","onClick"])])),_:2},1024)])),_:2},1024)):"virtual"==e.goods_type&&"cart"!==s(G).cart.event||"real"==e.goods_type?(o(),c(p,{key:1},[s(G).cart.control&&"style-1"===s(G).cart.style?(o(),r(j,{key:0,class:"h-[44rpx] relative"},{default:a((()=>[i(j,{id:"itemCart"+t,class:"w-[102rpx] box-border text-center text-[#fff] primary-btn-bg h-[46rpx] text-[22rpx] leading-[46rpx] rounded-[100rpx]",onClick:u((l=>ye(e,"itemCart"+t)),["stop"])},{default:a((()=>[y(k(s(G).cart.text),1)])),_:2},1032,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0),s(G).cart.control&&"style-2"===s(G).cart.style?(o(),r(j,{key:1,class:"w-[44rpx] h-[44rpx] relative"},{default:a((()=>[i(l,{id:"itemCart"+t,class:"text-color nc-iconfont nc-icon-tianjiaV6xx text-[44rpx]",onClick:u((l=>ye(e,"itemCart"+t)),["stop"])},null,8,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0),s(G).cart.control&&"style-3"===s(G).cart.style?(o(),r(j,{key:2,class:"w-[44rpx] h-[44rpx] relative"},{default:a((()=>[i(l,{id:"itemCart"+t,class:"text-color nc-iconfont nc-icon-gouwucheV6xx-2 !text-[44rpx]",onClick:u((l=>ye(e,"itemCart"+t)),["stop"])},null,8,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0),s(G).cart.control&&"style-4"===s(G).cart.style?(o(),r(j,{key:3,class:"w-[44rpx] h-[44rpx] relative"},{default:a((()=>[i(j,{id:"itemCart"+t,class:"flex items-center justify-center text-[#fff] bg-color h-[44rpx] w-[44rpx] rounded-[22rpx] text-center",onClick:u((l=>ye(e,"itemCart"+t)),["stop"])},{default:a((()=>[i(l,{class:"nc-iconfont nc-icon-gouwucheV6xx-2 !text-[26rpx]"})])),_:2},1032,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0)],64)):d("v-if",!0)],64))])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128)),ae.value.length||ie.value||!ue.value?d("v-if",!0):(o(),r(K,{key:0,class:"part",option:{tip:"暂无商品"}}))])),_:1},8,["class"]),i(re,{ref_key:"cartRef",ref:he},null,512)])),_:1},8,["onInit"]),s(G).cart.control&&"cart"===s(G).cart.event?(o(),r(j,{key:0,class:"bg-[#fff] z-10 flex justify-between items-center fixed left-0 right-0 bottom-[50px] box-solid px-[24rpx] py-[17rpx] mb-ios border-[0] border-t-[2rpx] border-solid border-[#f6f6f6]"},{default:a((()=>[i(j,{class:"flex items-center"},{default:a((()=>[i(j,{class:"w-[66rpx] h-[66rpx] mr-[27rpx] relative"},{default:a((()=>[i(j,{id:"animation-end",class:"w-[66rpx] h-[66rpx] rounded-[35rpx] bg-[var(--primary-color)] text-center leading-[70rpx]",onClick:u(ke,["stop"])},{default:a((()=>[i(l,{class:"nc-iconfont nc-icon-gouwucheV6mm1 text-[#fff] text-[32rpx]"})])),_:1},8,["onClick"]),s(O)?(o(),r(j,{key:0,class:x(["border-[1rpx] border-solid border-[#fff]",["absolute left-[40rpx] top-[-10rpx] rounded-[28rpx] h-[28rpx] min-w-[28rpx] text-center leading-[26rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border",s(O)>9?"px-[10rpx]":""]])},{default:a((()=>[y(k(s(O)>99?"99+":s(O)),1)])),_:1},8,["class"])):d("v-if",!0)])),_:1}),i(l,{class:"text-[26rpx] font-500 text-[#333]"},{default:a((()=>[y("总计：")])),_:1}),i(j,{class:"text-[var(--price-text-color)] price-font font-bold flex items-baseline"},{default:a((()=>[i(l,{class:"text-[26rpx] mr-[6rpx]"},{default:a((()=>[y("￥")])),_:1}),i(l,{class:"text-[44rpx]"},{default:a((()=>[y(k(parseFloat(s(T))),1)])),_:1})])),_:1})])),_:1}),i(U,{class:x(["w-[180rpx] h-[70rpx] text-[26rpx] leading-[70rpx] font-500 m-0 rounded-full remove-border",{"primary-btn-bg !text-[#fff]":parseFloat(s(T))>0,"bg-[#F7F7F7] !text-[var(--text-color-light9)]":parseFloat(s(T))<=0}]),onClick:Ce},{default:a((()=>[y("去结算")])),_:1},8,["class"])])),_:1})):d("v-if",!0)])),_:1},8,["class"])):d("v-if",!0),E(i(j,{style:R(pe.value),class:"fixed z-999 flex items-center justify-center text-[#fff] bg-color h-[44rpx] w-[44rpx] rounded-[22rpx] text-center"},{default:a((()=>[i(l,{class:"nc-iconfont nc-icon-gouwucheV6xx-2 !text-[30rpx]"})])),_:1},8,["style"]),[[M,pe.value]]),ge.value.length||ie.value?d("v-if",!0):(o(),r(K,{key:1,option:{tip:"暂无商品分类"}})),i(z,{loading:ie.value},null,8,["loading"]),i(L),d(" 强制绑定手机号 "),i(le,{ref_key:"bindMobileRef",ref:we},null,512)])),_:1})}}}),[["__scopeId","data-v-e12dbc4b"]]),se=Q(e({__name:"category-template-two-two",props:{config:{type:Object,default:()=>({})},categoryId:{type:[String,Number],default:0}},setup(e){const S=e,N=ee();N.getList();const $=j((()=>N.cartList)),O=j((()=>N.totalNum)),T=j((()=>N.totalMoney)),W=B(),Y=j((()=>W.info)),{mescrollInit:Q,getMescroll:q}=Z(z,U);let oe=S.config,ae=S.categoryId;const se=t([]),ie=t(""),ue=t(!0),de=t(!1),ce=t(!1);t([]).value=uni.getStorageSync("shopCart")||[];const ne=e=>{de.value=!1,J({page:e.num,limit:e.size,goods_category:ae}).then((t=>{let l=t.data.data;1==e.num&&(se.value=[]),se.value=se.value.concat(l),pe(),ue.value=!1,e.endSuccess(l.length),se.value.length||(de.value=!0)})).catch((()=>{ue.value=!1,de.value=!0,e.endErr()}))},pe=()=>{se.value.forEach(((e,t)=>{e.isMaxBuy=!1;let l=-1;if(e.is_limit&&e.max_buy){let t=0;if(1==e.limit_type)t=e.max_buy;else{let l=e.max_buy-(e.has_buy||0);t=l>0?l:0}t>e.stock?l=e.stock:t<=e.stock&&(l=t)}0==l&&(e.isMaxBuy=!0)}))},xe=e=>{f({url:"/addon/shop/pages/goods/detail",param:{goods_id:e}})};l((()=>{be()}));const fe=t(""),ve=t(!1),ge=t(!1),_e=(e,t)=>{if(ve.value||ge.value)return!1;ve.value=!0,ge.value=!0;let l={goods_id:e.goodsSku.goods_id,sku_id:e.goodsSku.sku_id,sale_price:Ne(e),stock:e.goodsSku.stock};e.id&&(l.num=e.num,l.id=e.id);let o=1;o=e.min_buy>0&&!e.num?e.min_buy:1,N.increase(l,o,(()=>{ge.value=!1})),setTimeout((()=>{const e=window.document.getElementById("animation-end"),l=e.getBoundingClientRect().left,o=e.getBoundingClientRect().top,r=window.document.getElementById(t),a=r.getBoundingClientRect().left,s=r.getBoundingClientRect().top;fe.value=`top: ${s}px; left: ${a}px;`,setTimeout((()=>{fe.value=`top: ${o+e.offsetHeight/2-r.offsetHeight/2}px; left: ${l+e.offsetWidth/2-r.offsetHeight/2}px; transition: all 0.8s; transform: rotate(-720deg);`}),20),setTimeout((()=>{fe.value="",ve.value=!1}),1020)}),100)};t({allActive:-1,data:{category_name:"全部",category_id:""}});const me=t([]),be=()=>{ue.value=!0,A().then((e=>{me.value=e.data;for(let t=0;t<me.value.length;t++)if(me.value[t].child_list){let e={category_name:"全部",category_id:me.value[t].category_id};me.value[t].child_list.unshift(e)}if(ae)for(let t=0;t<me.value.length;t++){if(me.value[t].category_id==ae){he.value=t;break}if(me.value[t].child_list)for(let e=0;e<me.value[t].child_list.length;e++)if(me.value[t].child_list[e].category_id==ae){he.value=t,ye.value=e;break}}else ae=e.data[0].category_id;ue.value=!1})).catch((()=>{ue.value=!1}))},he=t(0),ye=t(0),ke=(e,t)=>{ye.value=e,ae=t.category_id,ce.value=!1,se.value=[],q().resetUpScroll()},we=()=>{ie.value&&f({url:"/addon/shop/pages/goods/list",param:{goods_name:encodeURIComponent(ie.value)}})},Ce=t(),je=(e,t)=>{if("virtual"==e.goods_type&&"verify"==e.virtual_receive_type)return xe(e.goodsSku.goods_id);if("cart"!==oe.cart.event)return xe(e.goods_id);if(!Y.value)return L().setLoginBack({url:"/addon/shop/pages/goods/category"}),!1;if(e.goodsSku.sku_spec_format)Ce.value.open(e.goodsSku.sku_id);else{if(parseInt(e.goodsSku.num||0)>parseInt(e.goodsSku.stock))return void F({title:"商品库存不足",icon:"none"});if(e.min_buy&&e.min_buy>parseInt(e.stock))return void F({title:"商品库存小于起购数量",icon:"none"});_e(e,t)}},Se=()=>{f({url:"/addon/shop/pages/goods/cart"})},Fe=t(null);t(uni.getStorageSync("isbindmobile"));const Ie=()=>{if(uni.getStorageSync("isbindmobile"))return Fe.value.open(),!1;if(!O.value)return void F({title:"还没有选择商品",icon:"none"});const e=[];Object.values($.value).forEach((t=>{Object.keys(t).forEach((l=>{"totalNum"!=l&&"totalMoney"!=l&&e.push(t[l].id)}))})),0!=e.length&&uni.setStorage({key:"orderCreateData",data:{cart_ids:e},success(){f({url:"/addon/shop/pages/order/payment"})}})},Ve=e=>{let t="";return e.member_discount&&I()&&e.goodsSku.member_price!=e.goodsSku.price&&(t="member_price"),t},Ne=e=>{let t="0.00";return t=e.member_discount&&I()&&e.goodsSku.member_price!=e.goodsSku.price&&e.goodsSku.member_price?e.goodsSku.member_price:e.goodsSku.price,t};return(e,t)=>{const l=v,f=g,j=_,S=m,I=b(h("u-popup"),G),B=C,U=b(h("u--image"),H),z=V,L=b(h("loading-page"),P),A=b(h("tabbar"),D);return o(),r(j,{class:"min-h-screen bg-[var(--page-bg-color)] overflow-hidden"},{default:a((()=>[me.value.length?(o(),r(j,{key:0,class:x(["mescroll-box bg-[#f6f6f6]",{cart:s(oe).cart.control&&"cart"===s(oe).cart.event,detail:!(s(oe).cart.control&&"cart"===s(oe).cart.event)}])},{default:a((()=>[i(X,{ref:"mescrollRef",down:{use:!1},onInit:s(Q),onUp:ne},{default:a((()=>{var e,v,g,_,m,b;return[s(oe).search.control?(o(),r(j,{key:0,class:"box-border search-box z-10 bg-[#fff] fixed top-0 left-0 right-0 h-[96rpx]"},{default:a((()=>[i(j,{class:"flex-1 search-input"},{default:a((()=>[i(l,{onClick:u(we,["stop"]),class:"nc-iconfont nc-icon-sousuo-duanV6xx1 btn"},null,8,["onClick"]),i(f,{class:"input",type:"text",modelValue:ie.value,"onUpdate:modelValue":t[0]||(t[0]=e=>ie.value=e),placeholder:s(oe).search.title,placeholderClass:"text-[var(--text-color-light9)]",onConfirm:we},null,8,["modelValue","placeholder"]),ie.value?(o(),r(l,{key:0,class:"nc-iconfont nc-icon-cuohaoV6xx1 clear",onClick:t[1]||(t[1]=e=>ie.value="")})):d("v-if",!0)])),_:1})])),_:1})):d("v-if",!0),i(j,{class:x(["tabs-box z-2 fixed left-0 bg-[#fff] bottom-[50px] top-0",{"!top-[96rpx]":s(oe).search.control,"pb-[98rpx]":s(oe).cart.control&&"cart"===s(oe).cart.event}])},{default:a((()=>[i(S,{"scroll-y":!0,class:"scroll-height"},{default:a((()=>[i(j,{class:"bg-[var(--temp-bg)]"},{default:a((()=>[(o(!0),c(p,null,n(me.value,((e,t)=>(o(),r(j,{class:x(["tab-item truncate",{"tab-item-active ":t==he.value,"rounded-br-[12rpx]":!(he.value-1!==t||me.value[he.value].child_list&&me.value[he.value].child_list.length),"rounded-tr-[12rpx]":!(he.value+1!==t||me.value[he.value].child_list&&me.value[he.value].child_list.length)}]),key:t,onClick:l=>((e,t)=>{he.value=e,t.child_list&&t.child_list.length?ke(0,t.child_list[0]):(ae=t.category_id,se.value=[],q().resetUpScroll())})(t,e)},{default:a((()=>[i(j,{class:"text-box truncate px-[24rpx]"},{default:a((()=>[y(k(e.category_name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["class"]),(null==(e=me.value[he.value])?void 0:e.child_list)&&(null==(v=me.value[he.value])?void 0:v.child_list.length)?(o(),r(j,{key:1,class:x(["flex items-center h-[98rpx] pl-[24rpx] pr-[48rpx] py-[20rpx] z-10 bg-white fixed left-[168rpx] right-0 box-border top-0",{"!top-[94rpx]":s(oe).search.control}])},{default:a((()=>[ce.value?(o(),c(p,{key:1},[i(j,{class:"flex-1 h-[48rpx] text-[28rpx] text-[var(--text-color-light9)] pr-[24rpx] leading-[48rpx]"},{default:a((()=>[y("全部分类")])),_:1}),i(l,{class:"absolute right-[24rpx] nc-iconfont nc-icon-shangV6xx-1 text-[#333] text-[30rpx]",onClick:t[3]||(t[3]=e=>ce.value=!1)})],64)):(o(),c(p,{key:0},[i(S,{"scroll-x":!0,"scroll-with-animation":"","scroll-into-view":"id"+(ye.value?ye.value-1:0),class:"flex-1 h-[54rpx] scroll-Y box-border pr-[24rpx] bg-white"},{default:a((()=>[i(j,{class:"flex items-center h-[54rpx] box-border"},{default:a((()=>{var e;return[(o(!0),c(p,null,n(null==(e=me.value[he.value])?void 0:e.child_list,((e,t)=>(o(),r(l,{class:x(["w-[150rpx] flex-shrink-0 px-[14rpx] h-[54rpx] truncate text-center !leading-[50rpx] !text-[24rpx] border-[2rpx] border-solid !rounded-[100rpx] box-border text-[#333] box-border",{"bg-[var(--primary-color-light)] font-500 text-[var(--primary-color)] border-[var(--primary-color)]":t===ye.value,"border-[var(--temp-bg)]  bg-[var(--temp-bg)]":t!=ye.value," ml-[24rpx]":0!=t}]),key:me.value[he.value].category_id,id:"id"+t,onClick:l=>ke(t,e)},{default:a((()=>[y(k(e.category_name),1)])),_:2},1032,["class","id","onClick"])))),128))]})),_:1})])),_:1},8,["scroll-into-view"]),i(j,{class:"absolute right-[24rpx] nc-iconfont nc-icon-xiaV6xx text-[30rpx] w-[30rpx] h-[30rpx] text-center transform",onClick:t[2]||(t[2]=e=>ce.value=!0)})],64))])),_:1},8,["class"])):d("v-if",!0),i(j,{class:x(["labelPopup",{active:s(oe).search.control}])},{default:a((()=>[i(I,{show:ce.value,mode:"top",onClose:t[5]||(t[5]=e=>ce.value=!1)},{default:a((()=>[i(j,{class:"flex flex-wrap pt-[20rpx] pb-[24rpx]",onTouchmove:t[4]||(t[4]=u((()=>{}),["prevent","stop"]))},{default:a((()=>{var e;return[(o(!0),c(p,null,n(null==(e=me.value[he.value])?void 0:e.child_list,((e,t)=>(o(),r(l,{class:x(["px-[14rpx] flex-shrink-0 w-[160rpx] box-border ml-[20rpx] mb-[26rpx] h-[60rpx] text-center leading-[56rpx] text-[24rpx] border-[2rpx] border-solid !rounded-[100rpx] text-[#333] truncate",{"bg-[var(--primary-color-light)] font-500 text-[var(--primary-color)] border-[var(--primary-color)]":t===ye.value,"border-[var(--temp-bg)]  bg-[var(--temp-bg)]":t!=ye.value}]),key:me.value[he.value].category_id,onClick:l=>ke(t,e)},{default:a((()=>[y(k(e.category_name),1)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1},8,["show"])])),_:1},8,["class"]),i(j,{class:x(["flex justify-center flex-wrap pl-[168rpx] pt-[20rpx] pb-[20rpx]",{"!pt-[214rpx]":s(oe).search.control&&(null==(g=me.value[he.value])?void 0:g.child_list)&&(null==(_=me.value[he.value])?void 0:_.child_list.length),"pt-[120rpx]":s(oe).search.control&&(!me.value[he.value].child_list||!me.value[he.value].child_list.length),"pt-[118rpx]":(null==(m=me.value[he.value])?void 0:m.child_list)&&(null==(b=me.value[he.value])?void 0:b.child_list.length)&&!s(oe).search.control}])},{default:a((()=>[(o(!0),c(p,null,n(se.value,((e,t)=>(o(),r(j,{key:e.goods_id,class:x(["w-[536rpx] box-border bg-white w-full flex mx-[20rpx] py-[24rpx] px-[20rpx] rounded-[var(--rounded-small)]",{"mt-[20rpx]":t}]),onClick:u((t=>xe(e.goods_id)),["stop"])},{default:a((()=>[i(j,{class:"w-[168rpx] h-[168rpx] flex items-center justify-center mr-[20rpx] rounded-[var(--goods-rounded-small)] overflow-hidden"},{default:a((()=>[i(U,{width:"168rpx",height:"168rpx",radius:"var(--goods-rounded-small)",src:s(w)(e.goods_cover_thumb_mid||""),model:"aspectFill"},{error:a((()=>[i(B,{class:"w-[168rpx] h-[168rpx]",src:s(w)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["radius","src"])])),_:2},1024),i(j,{class:"flex flex-1 flex-wrap flex-col"},{default:a((()=>[i(j,{class:"max-h-[80rpx] text-[26rpx] leading-[40rpx] multi-hidden"},{default:a((()=>[y(k(e.goods_name),1)])),_:2},1024),i(j,{class:"flex items-end justify-between flex-1"},{default:a((()=>[i(j,{class:"text-[var(--price-text-color)] price-font -mb-[8rpx]"},{default:a((()=>[i(l,{class:"text-[24rpx] font-500"},{default:a((()=>[y("￥")])),_:1}),i(l,{class:"text-[40rpx] font-500"},{default:a((()=>[y(k(parseFloat(Ne(e)).toFixed(2).split(".")[0]),1)])),_:2},1024),i(l,{class:"text-[24rpx] font-500"},{default:a((()=>[y("."+k(parseFloat(Ne(e)).toFixed(2).split(".")[1]),1)])),_:2},1024),"member_price"==Ve(e)?(o(),r(B,{key:0,class:"h-[24rpx] max-w-[46rpx] ml-[6rpx]",src:s(w)("addon/shop/VIP.png"),mode:"heightFix"},null,8,["src"])):d("v-if",!0)])),_:2},1024),e.isMaxBuy?d("v-if",!0):(o(),c(p,{key:0},[("real"==e.goods_type||"virtual"==e.goods_type&&"verify"!=e.virtual_receive_type)&&""===e.goodsSku.sku_spec_format&&s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id]&&s(oe).cart.control&&"cart"===s(oe).cart.event?(o(),r(j,{key:0,class:"flex items-center"},{default:a((()=>[i(j,{class:"relative w-[32rpx] h-[32rpx]"},{default:a((()=>[i(l,{class:"text-[32rpx] text-color nc-iconfont nc-icon-jianshaoV6xx absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",onClick:u((t=>((e,t)=>{if(ge.value)return!1;ge.value=!0;let l=1;e.min_buy>0&&e.min_buy==t.num&&(l=e.min_buy),N.reduce({id:t.id,goods_id:t.goods_id,sku_id:t.sku_id,stock:t.stock,sale_price:t.sale_price,num:t.num},l,(()=>{ge.value=!1}))})(e,s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id])),["stop"])},null,8,["onClick"])])),_:2},1024),i(l,{class:"text-[#333] text-[24rpx] mx-[16rpx]"},{default:a((()=>[y(k(s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id].num),1)])),_:2},1024),i(j,{class:"relative w-[32rpx] h-[32rpx]"},{default:a((()=>[i(l,{class:"text-[32rpx] text-color iconfont iconjiahao2fill absolute flex items-center justify-center -left-[8rpx] -bottom-[8rpx] -right-[8rpx] -top-[8rpx]",id:"itemCart"+t,onClick:u((l=>((e,t,l)=>{if(parseInt(t.num)>parseInt(t.stock))return void F({title:"商品库存不足",icon:"none"});let o=t.num;if(e.min_buy>0&&e.min_buy>t.num&&(o=e.min_buy),e.is_limit&&e.max_buy){let t=0;if(1==e.limit_type)t=e.max_buy;else{let l=e.max_buy-(e.has_buy||0);t=l>0?l:0}e.goodsSku.stock,e.goodsSku.stock}if(e.is_limit&&o>=e.max_buy){let t=`该商品单次限购${e.max_buy}件`;return 1!=e.limit_type&&(t=`该商品每人限购${e.max_buy}件`),F({title:t,icon:"none"}),!1}let r=te(e);r.num=o,r.id=t.id,_e(r,l)})(e,s($)["goods_"+e.goods_id]["sku_"+e.goodsSku.sku_id],"itemCart"+t)),["stop"])},null,8,["id","onClick"])])),_:2},1024)])),_:2},1024)):"virtual"==e.goods_type&&"cart"!==s(oe).cart.event||"real"==e.goods_type?(o(),c(p,{key:1},[s(oe).cart.control&&"style-1"===s(oe).cart.style?(o(),r(j,{key:0,class:"h-[44rpx] relative pl-[20rpx]"},{default:a((()=>[i(j,{id:"itemCart"+t,class:"w-[102rpx] box-border text-center text-[#fff] primary-btn-bg h-[46rpx] text-[22rpx] leading-[46rpx] rounded-[100rpx]",onClick:u((l=>je(e,"itemCart"+t)),["stop"])},{default:a((()=>[y(k(s(oe).cart.text),1)])),_:2},1032,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0),s(oe).cart.control&&"style-2"===s(oe).cart.style?(o(),r(j,{key:1,class:"w-[44rpx] h-[44rpx] relative"},{default:a((()=>[i(l,{id:"itemCart"+t,class:"text-color nc-iconfont nc-icon-tianjiaV6xx text-[44rpx]",onClick:u((l=>je(e,"itemCart"+t)),["stop"])},null,8,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0),s(oe).cart.control&&"style-3"===s(oe).cart.style?(o(),r(j,{key:2,class:"w-[44rpx] h-[44rpx] relative"},{default:a((()=>[i(l,{id:"itemCart"+t,class:"text-color nc-iconfont nc-icon-gouwucheV6xx-2 !text-[44rpx]",onClick:u((l=>je(e,"itemCart"+t)),["stop"])},null,8,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0),s(oe).cart.control&&"style-4"===s(oe).cart.style?(o(),r(j,{key:3,class:"w-[44rpx] h-[44rpx] relative"},{default:a((()=>[i(j,{id:"itemCart"+t,class:"flex items-center justify-center text-[#fff] bg-color h-[44rpx] w-[44rpx] rounded-[22rpx] text-center",onClick:u((l=>je(e,"itemCart"+t)),["stop"])},{default:a((()=>[i(l,{class:"nc-iconfont nc-icon-gouwucheV6xx-2 !text-[26rpx]"})])),_:2},1032,["id","onClick"]),s($)["goods_"+e.goods_id]&&s($)["goods_"+e.goods_id].totalNum?(o(),r(j,{key:0,class:x(["absolute right-[-16rpx] top-[-16rpx] rounded-[30rpx] h-[30rpx] min-w-[30rpx] text-center leading-[30rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border border-[2rpx] border-solid border-[#fff]",s($)["goods_"+e.goods_id].totalNum>9?"px-[10rpx]":""])},{default:a((()=>[y(k(s($)["goods_"+e.goods_id].totalNum),1)])),_:2},1032,["class"])):d("v-if",!0)])),_:2},1024)):d("v-if",!0)],64)):d("v-if",!0)],64))])),_:2},1024)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128)),se.value.length||ue.value||!de.value?d("v-if",!0):(o(),r(K,{key:0,class:"part",option:{tip:"暂无商品"}}))])),_:1},8,["class"]),i(re,{ref_key:"cartRef",ref:Ce},null,512)]})),_:1},8,["onInit"]),s(oe).cart.control&&"cart"===s(oe).cart.event?(o(),r(j,{key:0,class:"bg-[#fff] z-10 flex justify-between items-center fixed left-0 right-0 bottom-[50px] box-solid px-[24rpx] py-[17rpx] mb-ios border-[0] border-t-[2rpx] border-solid border-[#f6f6f6]"},{default:a((()=>[i(j,{class:"flex items-center"},{default:a((()=>[i(j,{class:"w-[66rpx] h-[66rpx] mr-[27rpx] relative"},{default:a((()=>[i(j,{id:"animation-end",class:"w-[66rpx] h-[66rpx] rounded-[35rpx] bg-[var(--primary-color)] text-center leading-[70rpx]",onClick:u(Se,["stop"])},{default:a((()=>[i(l,{class:"nc-iconfont nc-icon-gouwucheV6mm1 text-[#fff] text-[32rpx]"})])),_:1},8,["onClick"]),s(O)?(o(),r(j,{key:0,class:x(["border-[1rpx] border-solid border-[#fff]",["absolute left-[40rpx] top-[-10rpx] rounded-[28rpx] h-[28rpx] min-w-[28rpx] text-center leading-[26rpx] bg-[#FF4646] text-[#fff] text-[20rpx] font-500 box-border",s(O)>9?"px-[10rpx]":""]])},{default:a((()=>[y(k(s(O)>99?"99+":s(O)),1)])),_:1},8,["class"])):d("v-if",!0)])),_:1}),i(l,{class:"text-[26rpx] text-[#333]"},{default:a((()=>[y("总计：")])),_:1}),i(j,{class:"text-[var(--price-text-color)] price-font font-bold flex items-baseline"},{default:a((()=>[i(l,{class:"text-[26rpx] mr-[6rpx]"},{default:a((()=>[y("￥")])),_:1}),i(l,{class:"text-[44rpx]"},{default:a((()=>[y(k(parseFloat(s(T))),1)])),_:1})])),_:1})])),_:1}),i(z,{class:x(["w-[180rpx] h-[70rpx] text-[26rpx] leading-[70rpx] font-500 m-0 rounded-full remove-border",{"primary-btn-bg !text-[#fff]":parseFloat(s(T))>0,"bg-[#F7F7F7] !text-[var(--text-color-light9)]":parseFloat(s(T))<=0}]),onClick:Ie},{default:a((()=>[y("去结算")])),_:1},8,["class"])])),_:1})):d("v-if",!0)])),_:1},8,["class"])):d("v-if",!0),E(i(j,{style:R(fe.value),class:"fixed z-999 flex items-center justify-center text-[#fff] bg-color h-[44rpx] w-[44rpx] rounded-[22rpx] text-center"},{default:a((()=>[i(l,{class:"nc-iconfont nc-icon-gouwucheV6xx-2 !text-[30rpx]"})])),_:1},8,["style"]),[[M,fe.value]]),me.value.length||ue.value?d("v-if",!0):(o(),r(j,{key:1,class:"flex justify-center items-center w-[100%]"},{default:a((()=>[i(K,{option:{tip:"暂无商品分类"}})])),_:1})),i(L,{loading:ue.value},null,8,["loading"]),i(A),d(" 强制绑定手机号 "),i(le,{ref_key:"bindMobileRef",ref:Fe},null,512)])),_:1})}}}),[["__scopeId","data-v-2ffbad71"]]),ie=Q(e({__name:"category",setup(e){const l=ee(),s=t({}),i=t(0);return $((e=>{i.value=e.category_id||0,Y().then((e=>{s.value=e.data,T({title:s.value.page_title})}))})),O((()=>{l.getList()})),(e,t)=>{const l=_;return o(),r(l,{style:R(e.themeColor())},{default:a((()=>[1===s.value.level&&"style-1"===s.value.template?(o(),r(ae,{key:0,class:"category",categoryId:i.value,config:s.value},null,8,["categoryId","config"])):d("v-if",!0),2===s.value.level&&"style-1"===s.value.template?(o(),r(oe,{key:1,categoryId:i.value,config:s.value},null,8,["categoryId","config"])):d("v-if",!0),2===s.value.level&&"style-2"===s.value.template?(o(),r(se,{key:2,class:"category",categoryId:i.value,config:s.value},null,8,["categoryId","config"])):d("v-if",!0)])),_:1},8,["style"])}}}),[["__scopeId","data-v-13799c8c"]]);export{ie as default};
