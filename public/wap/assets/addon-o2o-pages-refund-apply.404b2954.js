import{d as e,r as a,p as l,j as t,o as r,c as s,w as u,b as o,u as d,y as n,z as x,n as p,f as c,U as i,ad as f,V as m,au as _,t as v,a as h,g,h as b,D as y,i as w,ab as V,c3 as k,C as j,ac as C,E as U,F as E,a7 as M,b7 as P,bl as R,ax as S,c4 as z,c5 as A,aA as D,_ as F}from"./index-71c7df08.js";import{f as I,e as L,r as B}from"./order.7a0e41bc.js";const N=F(e({__name:"apply",setup(e){var F;const N=a(null),T=a({}),q=a(0),G=a(!1),H=a({order_id:null==(F=N.value)?void 0:F.order_id,order_item_id:q.value,apply_money:"",reason:"",remark:"",voucher:[]}),J=a([]),K=a("");I().then((({data:e})=>{J.value=e,J.value&&J.value.length&&(K.value=J.value[0])})),l((e=>{q.value=e.order_item_id||0,H.value.order_item_id=q.value,H.value.order_id=e.order_id||0,L(e.order_id).then((({data:e})=>{N.value=e,N.value.item.forEach(((e,a)=>{q.value==e.order_item_id&&(T.value=e)})),H.value.apply_money=O.value})).catch((()=>{}))}));const O=t((()=>{let e=0;return e=T.value.item_money,M(e)})),Q=t((e=>function(e){return""==e||0==e?"60rpx":17*String(e).length+"rpx"})),W=t((()=>{if(H.value.voucher.length)return H.value.voucher.map((e=>({url:U(e)})))})),X=e=>{e.file.forEach((e=>{_({filePath:e.url,name:"file"}).then((e=>{H.value.voucher.length<9&&H.value.voucher.push(e.data.url)})).catch((()=>{}))}))},Y=e=>{H.value.voucher.splice(e.index,1)},Z=a(!1),$=()=>{if(!H.value.reason)return v({title:"请选择退款原因",icon:"none"}),!1;if(Z.value)return;Z.value=!0;let e=H.value;e.voucher=e.voucher.toString(),B(e).then((e=>{Z.value=!1,setTimeout((()=>{h({url:"/addon/o2o/pages/order/detail",param:{order_id:H.value.order_id}})}),1e3)})).catch((()=>{Z.value=!1}))},ee=()=>{H.value.reason=K.value,G.value=!1};return(e,a)=>{const l=g(b("u-icon"),P),t=g(b("u--image"),R),_=y,v=w,h=V,M=g(b("u-upload"),S),F=k,I=j,L=g(b("u-radio"),z),B=g(b("u-radio-group"),A),q=C,ae=g(b("u-popup"),D);return N.value?(r(),s(v,{key:0,class:"bg-[#f8f8f8] min-h-screen overflow-hidden",style:p(e.themeColor())},{default:u((()=>[o(v,{class:"bg-page"},{default:u((()=>[o(v,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(v,{class:"flex py-[30rpx] border-0 !border-b !border-[#f5f5f5] border-solid"},{default:u((()=>[o(t,{width:"120rpx",height:"120rpx",src:d(U)(T.value.item_image),model:"aspectFill"},{error:u((()=>[o(l,{name:"photo",color:"#999",size:"50"})])),_:1},8,["src"]),o(v,{class:"flex flex-1 flex-col justify-between ml-[20rpx]"},{default:u((()=>[o(v,null,{default:u((()=>[o(_,{class:"text-[28rpx] text-item leading-[40rpx]"},{default:u((()=>[n(x(T.value.item_name),1)])),_:1})])),_:1}),o(v,{class:"text-[22rpx] mt-[14rpx]"},{default:u((()=>[o(_,{class:"text-[var(--primary-color)] rounded-[6rpx] py-[6rpx] bg-[var(--label-bg-color)] px-[10rpx]"},{default:u((()=>[n(x(T.value.item_type_name),1)])),_:1})])),_:1}),o(v,{class:"text-[28rpx] mt-[14rpx] flex justify-between"},{default:u((()=>[o(_,{class:"text-[var(--primary-color)] price-font"},{default:u((()=>[n("￥"+x(T.value.item_money),1)])),_:1}),o(_,{class:"text-[22rpx] ml-[20rpx]"},{default:u((()=>[n("x"+x(T.value.num),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(v,{class:"bg-page"},{default:u((()=>[o(v,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(v,{class:"py-[24rpx] flex justify-between items-center"},{default:u((()=>[o(v,{class:"text-sm"},{default:u((()=>[n(x(d(E)("refundReason")),1)])),_:1}),o(v,{class:"flex items-center",onClick:a[0]||(a[0]=e=>G.value=!0)},{default:u((()=>[o(v,{class:"flex-1 text-right"},{default:u((()=>[o(v,{class:"text-xs text-gray-subtitle truncate w-[460rpx]"},{default:u((()=>[n(x(H.value.reason||d(E)("placeholder")),1)])),_:1})])),_:1}),o(_,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx] text-[var(--text-color-light6)]"})])),_:1})])),_:1})])),_:1}),o(v,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(v,{class:"py-[24rpx] flex items-center"},{default:u((()=>[o(v,{class:"text-sm"},{default:u((()=>[n(x(d(E)("refundMoney")),1)])),_:1}),o(v,{class:"flex-1 text-right"},{default:u((()=>[o(v,{class:"flex justify-end items-center"},{default:u((()=>[o(_,{class:"font-bold text-sm leading-none"},{default:u((()=>[n("￥")])),_:1}),o(h,{type:"digit",modelValue:H.value.apply_money,"onUpdate:modelValue":a[1]||(a[1]=e=>H.value.apply_money=e),modelModifiers:{number:!0},class:"font-bold text-sm leading-none",style:p({width:d(Q)(H.value.apply_money)})},null,8,["modelValue","style"])])),_:1}),o(v,{class:"text-xs text-gray-subtitle mt-[10rpx]"},{default:u((()=>[n(x(d(E)("moreInputMoney"))+x(d(O)),1)])),_:1})])),_:1})])),_:1})])),_:1}),o(v,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(v,{class:"py-[24rpx]"},{default:u((()=>[o(v,{class:"text-sm"},{default:u((()=>[n(x(d(E)("uploadProof")),1),o(_,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:u((()=>[n(x(d(E)("optional")),1)])),_:1})])),_:1}),o(v,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx]"},{default:u((()=>[o(M,{fileList:d(W),onAfterRead:X,onDelete:Y,multiple:"",maxCount:9},{default:u((()=>[o(v,{class:"flex items-center justify-center w-[140rpx] h-[140rpx] border-[2rpx] border-dashed border-[#ebebec] text-center text-[#888]"},{default:u((()=>[o(v,{class:"nc-iconfont nc-icon-xiangjiV6xx text-[50rpx]"})])),_:1})])),_:1},8,["fileList"])])),_:1})])),_:1})])),_:1}),o(v,{class:"m-[24rpx] px-[24rpx] rounded-md bg-white"},{default:u((()=>[o(v,{class:"py-[24rpx]"},{default:u((()=>[o(v,{class:"text-sm"},{default:u((()=>[n(x(d(E)("description")),1),o(_,{class:"text-xs text-gray-subtitle ml-[10rpx]"},{default:u((()=>[n(x(d(E)("optional")),1)])),_:1})])),_:1}),o(v,{class:"p-[20rpx] bg-[#f5f5f5] rounded mt-[20rpx] h-[300rpx] relative"},{default:u((()=>[o(F,{modelValue:H.value.remark,"onUpdate:modelValue":a[2]||(a[2]=e=>H.value.remark=e),placeholder:d(E)("descriptionPlaceholder"),"placeholder-class":"text-sm",maxlength:100,class:"w-full h-full"},null,8,["modelValue","placeholder"]),o(v,{class:"absolute bottom-[20rpx] right-[20rpx] text-[24rpx] text-[#808080]"},{default:u((()=>[n(x(Number(H.value.remark.length)>=100?100:H.value.remark.length)+"/100",1)])),_:1})])),_:1})])),_:1})])),_:1}),o(v,{class:"mt-[40rpx] m-[24rpx]"},{default:u((()=>[o(I,{class:"bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:$,loading:Z.value},{default:u((()=>[n(x(d(E)("submit")),1)])),_:1},8,["loading"])])),_:1}),c(" 退款原因 "),o(ae,{show:G.value},{default:u((()=>[o(v,{class:"px-[30rpx] pb-[30rpx]"},{default:u((()=>[o(v,{class:"flex items-center h-[90rpx] justify-between"},{default:u((()=>[o(_,null,{default:u((()=>[n(x(d(E)("refundReason")),1)])),_:1}),o(_,{class:"nc-iconfont nc-icon-guanbiV6xx text-[32rpx]",onClick:a[3]||(a[3]=e=>G.value=!1)})])),_:1}),o(q,{"scroll-y":"true",class:"h-[450rpx] mt-[20rpx]"},{default:u((()=>[o(B,{modelValue:K.value,"onUpdate:modelValue":a[4]||(a[4]=e=>K.value=e),placement:"column",activeColor:"var(--primary-color)"},{default:u((()=>[(r(!0),i(m,null,f(J.value,((e,a)=>(r(),s(L,{customStyle:{marginBottom:"8px"},key:a,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(I,{class:"mt-[40rpx] bg-[var(--primary-color)] text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[28rpx]",onClick:ee},{default:u((()=>[n(x(d(E)("confirm")),1)])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})])),_:1},8,["style"])):c("v-if",!0)}}}),[["__scopeId","data-v-3d375142"]]);export{N as default};
