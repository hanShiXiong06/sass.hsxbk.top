import{d as oe,l as U,r as C,n as w,h as S,c as E,a as p,b as te,e as d,w as n,i as P,t as u,u as a,q as s,P as V,a6 as T,F as le,Q as ae,s as I,A as se,bs as de,a$ as ne,R as B,E as pe,ak as ie,aI as re,K as ce,J as ue,bM as ge,L as me,aa as _e,I as fe,ac as he,T as ye,a1 as ve,U as Se,p as Pe,g as be}from"./index-17984968.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                        *//* empty css                *//* empty css                          *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  */import{_ as L}from"./goods_default-664bb559.js";import{g as xe,b as ke,c as Ce}from"./goods-e571a7e7.js";import{_ as we}from"./_plugin-vue_export-helper-c27b6911.js";const Ve=b=>(Pe("data-v-051f1f98"),b=b(),be(),b),Ge={class:"inline-block ml-[10px] text-[14px]"},Ee={class:"text-primary mx-[2px]"},Te={class:"flex items-center cursor-pointer"},Ie={class:"min-w-[60px] h-[60px] flex items-center justify-center"},$e=Ve(()=>p("div",{class:"image-slot"},[p("img",{class:"w-[60px] h-[60px]",src:L})],-1)),De={key:1,class:"w-[70px] h-[60px]",src:L,fit:"contain"},Fe={class:"ml-2"},Ne=["title"],Ue={class:"text-primary text-[12px]"},Be={class:"mt-[16px] flex"},Le={class:"flex items-center flex-1"},Re={class:"layui-table-bottom-left-container mr-[10px]"},ze={class:"text-primary mx-[2px]"},Ae={class:"dialog-footer"},Me=oe({__name:"goods-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue","goodsSelect"],setup(b,{expose:R,emit:$}){const m=b,g=U({get(){return m.modelValue},set(t){$("update:modelValue",t)}}),y=C(!1),c=w({}),f=U(()=>Object.keys(c).length),o=w({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{keyword:"",goods_category:[],select_type:"all",goods_ids:"",verify_goods_ids:"",goods_type:""}}),D=C(),z=t=>{v()},G=w([]),F=w([]);(()=>{xe().then(t=>{const e=t.data;if(e){const i=[];e.forEach(r=>{const h=[];r.child_list&&r.child_list.forEach(_=>{h.push({value:_.category_id,label:_.category_name})}),i.push({value:r.category_id,label:r.category_name,children:h})}),G.splice(0,G.length,...i)}}),ke().then(t=>{const e=t.data;if(e)for(const i in e)F.push(e[i])})})();const x=C();C([]);const A=(t,e)=>{let i=!1;for(let r=0;r<t.length;r++)if(t[r].goods_id==e.goods_id){i=!0;break}i?c["goods_"+e.goods_id]=e:delete c["goods_"+e.goods_id]},M=t=>{t.length?t.forEach(e=>{c["goods_"+e.goods_id]=e}):o.data.forEach(e=>{delete c["goods_"+e.goods_id]})},v=(t=1,e=null)=>{o.loading=!0,o.page=t;const i=de(o.searchParam);if(i.select_type=="selected"){const r=[];for(let h in c)r.push(parseInt(h.replace("goods_","")));i.goods_ids=r}else i.goods_ids="";Ce({page:o.page,limit:o.limit,...i}).then(r=>{o.loading=!1,o.data=r.data.data,o.total=r.data.total,e&&e(r.data.verify_goods_ids),N()}).catch(()=>{o.loading=!1})},N=()=>{ne(()=>{if(x.value)for(let t=0;t<o.data.length;t++)x.value.toggleRowSelection(o.data[t],!1),c["goods_"+o.data[t].goods_id]&&x.value.toggleRowSelection(o.data[t],!0)})},O=t=>{t&&(t.resetFields(),v())},j=()=>{for(let t in c)delete c[t];o.searchParam.verify_goods_ids=g.value,v(1,t=>{if(g.value){g.value.splice(0,g.value.length,...t),g.value.forEach(e=>{c["goods_"+e]||(c["goods_"+e]={})});for(let e=0;e<o.data.length;e++)g.value.indexOf(o.data[e].goods_id)!=-1&&(c["goods_"+o.data[e].goods_id]=o.data[e])}}),y.value=!0},q=()=>{for(let t in c)delete c[t];N()},J=()=>{if(m.min&&f.value<m.min){B({type:"warning",message:`${s("goodsSelectPopupGoodsMinTip")}${m.min}${s("goodsSelectPopupPiece")}`});return}if(m.max&&m.max>0&&f.value&&f.value>m.max){B({type:"warning",message:`${s("goodsSelectPopupGoodsMaxTip")}${m.max}${s("goodsSelectPopupPiece")}`});return}let t=[];for(let e in c)t.push(parseInt(e.replace("goods_","")));g.value.splice(0,g.value.length,...t),$("goodsSelect",c),y.value=!1};return R({showDialog:y,selectGoods:c,selectGoodsNum:f}),(t,e)=>{const i=pe,r=ie,h=re,_=ce,K=ue,Q=ge,H=me,k=_e,W=fe,X=he,Y=ye,Z=ve,ee=Se;return S(),E("div",null,[p("div",{onClick:j},[te(t.$slots,"default",{},()=>[d(i,null,{default:n(()=>[P(u(a(s)("goodsSelectPopupSelectGoodsButton")),1)]),_:1}),V(p("div",Ge,[p("span",null,u(a(s)("goodsSelectPopupSelect")),1),p("span",Ee,u(a(g).length),1),p("span",null,u(a(s)("goodsSelectPopupPiece")),1)],512),[[T,a(g).length]])],!0)]),d(Z,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),title:a(s)("goodsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:n(()=>[p("span",Ae,[d(i,{onClick:e[9]||(e[9]=l=>y.value=!1)},{default:n(()=>[P(u(a(s)("cancel")),1)]),_:1}),d(i,{type:"primary",onClick:J},{default:n(()=>[P(u(a(s)("confirm")),1)]),_:1})])]),default:n(()=>[d(H,{inline:!0,model:o.searchParam,ref_key:"searchFormRef",ref:D},{default:n(()=>[d(_,{prop:"select_type",class:"form-item-wrap"},{default:n(()=>[d(h,{modelValue:o.searchParam.select_type,"onUpdate:modelValue":e[0]||(e[0]=l=>o.searchParam.select_type=l),onChange:z},{default:n(()=>[d(r,{label:a(s)("goodsSelectPopupAllGoods"),value:"all"},null,8,["label"]),d(r,{label:a(s)("goodsSelectPopupSelectedGoods"),value:"selected"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),d(_,{label:a(s)("goodsSelectPopupGoodsName"),prop:"keyword",class:"form-item-wrap"},{default:n(()=>[d(K,{modelValue:o.searchParam.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>o.searchParam.keyword=l),placeholder:a(s)("goodsSelectPopupGoodsNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(_,{label:a(s)("goodsSelectPopupGoodsCategory"),prop:"goods_category",class:"form-item-wrap"},{default:n(()=>[d(Q,{modelValue:o.searchParam.goods_category,"onUpdate:modelValue":e[2]||(e[2]=l=>o.searchParam.goods_category=l),options:G,placeholder:a(s)("goodsSelectPopupGoodsCategoryPlaceholder"),clearable:"",props:{value:"value",label:"label",emitPath:!1}},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),d(_,{label:a(s)("goodsSelectPopupGoodsType"),prop:"goods_type",class:"form-item-wrap"},{default:n(()=>[d(h,{modelValue:o.searchParam.goods_type,"onUpdate:modelValue":e[3]||(e[3]=l=>o.searchParam.goods_type=l),placeholder:a(s)("goodsSelectPopupGoodsTypePlaceholder"),clearable:""},{default:n(()=>[(S(!0),E(le,null,ae(F,l=>(S(),I(r,{key:l.type,label:l.name,value:l.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),d(_,{class:"form-item-wrap"},{default:n(()=>[d(i,{type:"primary",onClick:e[4]||(e[4]=l=>v())},{default:n(()=>[P(u(a(s)("search")),1)]),_:1}),d(i,{onClick:e[5]||(e[5]=l=>O(D.value))},{default:n(()=>[P(u(a(s)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),V((S(),I(X,{data:o.data,size:"large",ref_key:"goodsListTableRef",ref:x,"max-height":"400",onSelect:A,onSelectAll:M},{empty:n(()=>[p("span",null,u(o.loading?"":a(s)("emptyData")),1)]),default:n(()=>[d(k,{type:"selection",width:"55"}),d(k,{prop:"goods_id",label:a(s)("goodsSelectPopupGoodsInfo"),"min-width":"400"},{default:n(({row:l})=>[p("div",Te,[p("div",Ie,[l.goods_cover_thumb_small?(S(),I(W,{key:0,class:"w-[60px] h-[60px]",src:a(se)(l.goods_cover_thumb_small),fit:"contain"},{error:n(()=>[$e]),_:2},1032,["src"])):(S(),E("img",De))]),p("div",Fe,[p("span",{title:l.goods_name,class:"multi-hidden"},u(l.goods_name),9,Ne),p("span",Ue,u(l.goods_type_name),1)])])]),_:1},8,["label"]),d(k,{prop:"price",label:a(s)("goodsSelectPopupPrice"),"min-width":"120",align:"right"},{default:n(({row:l})=>[p("div",null,"ï¿¥"+u(l.goodsSku.price),1)]),_:1},8,["label"]),d(k,{prop:"stock",label:a(s)("goodsSelectPopupStock"),"min-width":"120",align:"right"},null,8,["label"])]),_:1},8,["data"])),[[ee,o.loading]]),p("div",Be,[p("div",Le,[V(p("div",Re,[p("span",null,u(a(s)("goodsSelectPopupBeforeTip")),1),p("span",ze,u(a(f)),1),p("span",null,u(a(s)("goodsSelectPopupAfterTip")),1)],512),[[T,a(f)]]),V(d(i,{type:"primary",link:"",onClick:q},{default:n(()=>[P(u(a(s)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[T,a(f)]])]),d(Y,{"current-page":o.page,"onUpdate:current-page":e[6]||(e[6]=l=>o.page=l),"page-size":o.limit,"onUpdate:page-size":e[7]||(e[7]=l=>o.limit=l),layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:e[8]||(e[8]=l=>v()),onCurrentChange:v},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const fo=we(Me,[["__scopeId","data-v-051f1f98"]]);export{fo as default};
