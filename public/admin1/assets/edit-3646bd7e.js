import{d as Y,x as ee,r as y,n as q,cK as V,aQ as te,cm as le,cL as ae,l as ie,q as o,a5 as g,av as de,h as m,c as w,a as _,t as L,u as r,P as x,s as k,w as u,e as s,a6 as O,bZ as oe,F as S,Q as B,i as G,aB as se,K as re,J as ne,ak as ce,aI as ue,L as _e,a0 as pe,E as me,U as fe}from"./index-17984968.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                    */import{g as ve,e as be,a as ye}from"./shop_address-a51b7e52.js";import{c as ge,l as he,a as Ve}from"./qqmap-011f3cfb.js";const we={class:"main-container"},Le={class:"detail-head"},xe=_("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),ke={class:"ml-[1px]"},Ee=_("span",{class:"adorn"},"|",-1),Pe={class:"right"},Ce={class:"flex flex-col"},Ae={id:"container",class:"w-[800px] h-[520px] relative"},Re={class:"fixed-footer-wrap"},Te={class:"fixed-footer !z-[1000]"},Ze=Y({__name:"edit",setup(Me){const N=ee(),E=parseInt(N.query.id),f=y(!1),Q=N.meta.title,p=q({province:[],city:[],district:[]}),P=y(),C=y(),A=y();V(0).then(i=>{p.province=i.data});let R="";te(()=>{const i=document.createElement("script");le().then(e=>{R=e.data.key,i.type="text/javascript",i.src="https://map.qq.com/api/gljs?libraries=tools,service&v=1.exp&key="+e.data.key,document.body.appendChild(i)}),i.onload=()=>{setTimeout(()=>{J()},500)}});let b,T;const j=y(!0),J=()=>{const i=window.TMap,e=i.LatLng,l=new e(t.lat,t.lng);b=new i.Map("container",{center:l,zoom:14}),b.on("tilesloaded",()=>{j.value=!1}),T=ge(b),b.on("click",d=>{b.setCenter(d.latLng),T.updateGeometries({id:"center",position:d.latLng}),D(d.latLng.lat,d.latLng.lng)}),D(l.lat,l.lng)},c=q({province_id:0,city_id:0,district_id:0}),D=(i,e)=>{he({mapKey:R,lat:i,lng:e}).then(({message:l,result:d})=>{l=="query ok"||l=="Success"?(t.lat=d.location.lat,t.lng=d.location.lng,t.address=d.formatted_addresses.recommend,ae(d.ad_info.adcode).then(({data:n})=>{c.province_id=n.province?n.province.id:0,c.city_id=n.city?n.city.id:0,c.district_id=n.district?n.district.id:0})):console.error(l,d)}).catch(l=>{console.log(l)})},F={id:0,contact_name:"",mobile:"",province_id:0,city_id:0,district_id:0,address:"",full_address:"",lat:39.908626,lng:116.39719,is_delivery_address:0,is_refund_address:0,is_default_delivery:0,is_default_refund:0},t=q({...F});E&&(async(i=0)=>{f.value=!0,Object.assign(t,F);const e=await(await ve(i)).data;Object.keys(t).forEach(l=>{e[l]!=null&&(t[l]=e[l])}),f.value=!1})(E);const I=y(),Z=ie(()=>({address_type:[{validator:(i,e,l)=>{!t.is_delivery_address&&!t.is_refund_address&&l(new Error(o("addressTypeRequire"))),l()}}],contact_name:[{required:!0,message:o("contactNamePlaceholder"),trigger:"blur"}],mobile:[{required:!0,message:o("mobilePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(i,e,l)=>{e&&!/^1[3-9]\d{9}$/.test(e)&&l(new Error(o("mobileTips"))),l()}}],address_area:[{validator:(i,e,l)=>{t.province_id||l(new Error(o("provincePlaceholder"))),t.city_id||l(new Error(o("cityPlaceholder"))),p.district.length&&!t.district_id&&l(new Error(o("districtPlaceholder"))),l()}}],address:[{required:!0,message:o("addressPlaceholder"),trigger:"blur"}]}));g(()=>t.province_id,i=>{i?V(t.province_id).then(e=>{p.city=e.data;const l=t.city_id;if(l){let d=!1;for(let n=0;n<e.data.length;n++)if(l==e.data[n].id){d=!0;break}if(d){t.city_id=l;return}}t.city_id=0,M()}):t.city_id=0}),g(()=>t.city_id,i=>{i?V(t.city_id).then(e=>{p.district=e.data;const l=t.district_id;if(l){let d=!1;for(let n=0;n<e.data.length;n++)if(l==e.data[n].id){d=!0;break}if(d){t.district_id=l;return}}M(),t.district_id=0}):t.district_id=0}),g(()=>t.district_id,i=>{i&&M()});const M=de(()=>{setTimeout(()=>{const i=[t.province_id?P.value.selectedLabel:"",t.city_id?C.value.selectedLabel:"",t.district_id?A.value.selectedLabel:""];Ve({mapKey:R,address:i.join("")}).then(({message:e,result:l})=>{if(e=="Success"||e=="query ok"){const d=new window.TMap.LatLng(l.location.lat,l.location.lng);b.setCenter(d),T.updateGeometries({id:"center",position:d}),t.lat=l.location.lat,t.lng=l.location.lng}else console.error(e,l)})},500)},500);g(()=>c.province_id,i=>{i&&V(c.province_id).then(e=>{p.city=e.data,t.province_id=c.province_id,t.city_id=c.city_id})}),g(()=>c.city_id,i=>{i&&V(c.city_id).then(e=>{p.district=e.data,t.city_id=c.city_id,t.district_id=c.district_id})}),g(()=>c.district_id,i=>{i&&(t.district_id=c.district_id)});const H=async i=>{f.value||!i||await i.validate(async e=>{if(e){f.value=!0;const l=t,d=[l.province_id?P.value.selectedLabel:"",l.city_id?C.value.selectedLabel:"",l.district_id?A.value.selectedLabel:"",l.address];l.full_address=d.join(""),(E?be:ye)(l).then(v=>{f.value=!1,history.back()}).catch(()=>{f.value=!1})}})},K=()=>{history.back()};return(i,e)=>{const l=se,d=re,n=ne,v=ce,U=ue,W=_e,X=pe,$=me,z=fe;return m(),w("div",we,[_("div",Le,[_("div",{class:"left",onClick:e[0]||(e[0]=a=>K())},[xe,_("span",ke,L(r(o)("returnToPreviousPage")),1)]),Ee,_("span",Pe,L(r(Q)),1)]),x((m(),k(X,{class:"box-card !border-none",shadow:"never"},{default:u(()=>[s(W,{model:t,"label-width":"90px",ref_key:"formRef",ref:I,rules:r(Z),class:"page-form"},{default:u(()=>[s(d,{label:r(o)("addressType"),prop:"address_type"},{default:u(()=>[_("div",Ce,[_("div",null,[s(l,{modelValue:t.is_delivery_address,"onUpdate:modelValue":e[1]||(e[1]=a=>t.is_delivery_address=a),label:r(o)("deliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),x(s(l,{modelValue:t.is_default_delivery,"onUpdate:modelValue":e[2]||(e[2]=a=>t.is_default_delivery=a),label:r(o)("defaultDeliveryAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[O,t.is_delivery_address]])]),_("div",null,[s(l,{modelValue:t.is_refund_address,"onUpdate:modelValue":e[3]||(e[3]=a=>t.is_refund_address=a),label:r(o)("refundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),x(s(l,{modelValue:t.is_default_refund,"onUpdate:modelValue":e[4]||(e[4]=a=>t.is_default_refund=a),label:r(o)("defaultRefundAddress"),"true-label":1,"false-label":0},null,8,["modelValue","label"]),[[O,t.is_refund_address]])])])]),_:1},8,["label"]),s(d,{label:r(o)("contactName"),prop:"contact_name"},{default:u(()=>[s(n,{modelValue:t.contact_name,"onUpdate:modelValue":e[5]||(e[5]=a=>t.contact_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("contactNamePlaceholder"),class:"input-width",maxlength:"10"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(d,{label:r(o)("mobile"),prop:"mobile"},{default:u(()=>[s(n,{modelValue:t.mobile,"onUpdate:modelValue":e[6]||(e[6]=a=>t.mobile=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("mobilePlaceholder"),class:"input-width",onKeyup:e[7]||(e[7]=a=>r(oe)(a)),onBlur:e[8]||(e[8]=a=>t.mobile=a.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(d,{label:r(o)("fullAddress"),prop:"address_area"},{default:u(()=>[s(U,{modelValue:t.province_id,"onUpdate:modelValue":e[9]||(e[9]=a=>t.province_id=a),"value-key":"id",clearable:"",class:"w-[200px]",ref_key:"provinceRef",ref:P},{default:u(()=>[s(v,{label:r(o)("provincePlaceholder"),value:0},null,8,["label"]),(m(!0),w(S,null,B(p.province,(a,h)=>(m(),k(v,{key:h,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(U,{modelValue:t.city_id,"onUpdate:modelValue":e[10]||(e[10]=a=>t.city_id=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"cityRef",ref:C},{default:u(()=>[s(v,{label:r(o)("cityPlaceholder"),value:0},null,8,["label"]),(m(!0),w(S,null,B(p.city,(a,h)=>(m(),k(v,{key:h,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(U,{modelValue:t.district_id,"onUpdate:modelValue":e[11]||(e[11]=a=>t.district_id=a),"value-key":"id",clearable:"",class:"w-[200px] ml-3",ref_key:"districtRef",ref:A},{default:u(()=>[s(v,{label:r(o)("districtPlaceholder"),value:0},null,8,["label"]),(m(!0),w(S,null,B(p.district,(a,h)=>(m(),k(v,{key:h,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(d,{prop:"address"},{default:u(()=>[s(n,{modelValue:t.address,"onUpdate:modelValue":e[12]||(e[12]=a=>t.address=a),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("addressPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1}),s(d,null,{default:u(()=>[x(_("div",Ae,null,512),[[z,j.value]])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[z,f.value]]),_("div",Re,[_("div",Te,[s($,{type:"primary",onClick:e[13]||(e[13]=a=>H(I.value))},{default:u(()=>[G(L(r(o)("save")),1)]),_:1}),s($,{onClick:e[14]||(e[14]=a=>K())},{default:u(()=>[G(L(r(o)("cancel")),1)]),_:1})])])])}}});export{Ze as default};
