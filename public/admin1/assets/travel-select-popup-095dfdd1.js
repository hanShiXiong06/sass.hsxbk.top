import{d as O,l as C,r as S,n as V,h as D,c as q,a as i,b as J,e as s,w as r,i as v,t as p,u as l,q as o,P,a6 as b,s as K,A as W,bs as Q,a$ as X,R as E,E as Z,J as ee,K as te,bN as ae,L as le,aa as oe,ac as se,T as ne,a1 as ie,U as re}from"./index-17984968.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                       *//* empty css                  */import"./el-form-item-4ed993c7.js";import{g as pe}from"./tourism-ed22e76b.js";import{_ as de}from"./_plugin-vue_export-helper-c27b6911.js";const me={class:"inline-block ml-[10px] text-[14px]"},ce={class:"text-primary mx-[2px]"},ue={class:"flex items-center cursor-pointer"},_e={class:"min-w-[60px] h-[60px] flex items-center justify-center"},ge=["src"],fe=["title"],ve={class:"mt-[16px] flex"},he={class:"flex items-center flex-1"},ye={class:"layui-table-bottom-left-container mr-[10px]"},xe={class:"text-primary mx-[2px]"},Pe={class:"dialog-footer"},we=O({__name:"travel-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue"],setup($,{expose:N,emit:R}){const c=$,_=C({get(){return c.modelValue},set(a){R("update:modelValue",a)}}),f=S(!1),d=V({}),g=C(()=>Object.keys(d).length),t=V({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{goods_name:"",create_time:"",goods_type:"way"}}),k=S(),x=S(),z=(a,e)=>{let m=!1;for(let u=0;u<a.length;u++)if(a[u].way_id==e.way_id){m=!0;break}m?d["goods_"+e.way_id]=e:delete d["goods_"+e.way_id]},B=a=>{a.length?a.forEach(e=>{d["goods_"+e.way_id]=e}):t.data.forEach(e=>{delete d["goods_"+e.way_id]})},h=(a=1,e=null)=>{t.loading=!0,t.page=a;const m=Q(t.searchParam);pe({page:t.page,limit:t.limit,...m}).then(u=>{t.loading=!1,t.data=u.data.data,t.total=u.data.total,e&&e(),T()}).catch(()=>{t.loading=!1})},T=()=>{X(()=>{if(x.value)for(let a=0;a<t.data.length;a++)x.value.toggleRowSelection(t.data[a],!1),d["goods_"+t.data[a].way_id]&&x.value.toggleRowSelection(t.data[a],!0)})},F=a=>{a&&(a.resetFields(),h())},G=()=>{h(1,()=>{if(_.value){let a=[];for(let e=0;e<t.data.length;e++)_.value.indexOf(t.data[e].way_id)!=-1&&(a.push(t.data[e].way_id),d["goods_"+t.data[e].way_id]=t.data[e]||{});_.value=a}}),f.value=!0},I=()=>{for(let a in d)delete d[a];T()},L=()=>{if(c.min&&g.value<c.min){E({type:"warning",message:`${o("travelSelectPopupGoodsMinTip")}${c.min}${o("goodsSelectPopupPiece")}`});return}if(c.max&&c.max>0&&g.value&&g.value>c.max){E({type:"warning",message:`${o("travelSelectPopupGoodsMaxTip")}${c.max}${o("goodsSelectPopupPiece")}`});return}let a=[];for(let e in d)a.push(parseInt(e.replace("goods_","")));_.value.splice(0,_.value.length,...a),f.value=!1};return N({showDialog:f,selectTravel:d,selectGoodsNum:g}),(a,e)=>{const m=Z,u=ee,w=te,U=ae,j=le,y=oe,A=se,M=ne,Y=ie,H=re;return D(),q("div",null,[i("div",{onClick:G},[J(a.$slots,"default",{},()=>[s(m,null,{default:r(()=>[v(p(l(o)("travelSelectPopupAllTravel")),1)]),_:1}),P(i("div",me,[i("span",null,p(l(o)("goodsSelectPopupSelect")),1),i("span",ce,p(l(_).length),1),i("span",null,p(l(o)("goodsSelectPopupPiece")),1)],512),[[b,l(_).length]])],!0)]),s(Y,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=n=>f.value=n),title:l(o)("travelSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:r(()=>[i("span",Pe,[s(m,{onClick:e[7]||(e[7]=n=>f.value=!1)},{default:r(()=>[v(p(l(o)("cancel")),1)]),_:1}),s(m,{type:"primary",onClick:L},{default:r(()=>[v(p(l(o)("confirm")),1)]),_:1})])]),default:r(()=>[s(j,{inline:!0,model:t.searchParam,ref_key:"searchFormRef",ref:k},{default:r(()=>[s(w,{label:l(o)("wayNameSelectPopup"),prop:"goods_name",class:"form-item-wrap"},{default:r(()=>[s(u,{modelValue:t.searchParam.goods_name,"onUpdate:modelValue":e[0]||(e[0]=n=>t.searchParam.goods_name=n),placeholder:l(o)("wayNameSelectPopupPlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(w,{label:l(o)("createTime"),prop:"create_time",class:"form-item-wrap"},{default:r(()=>[s(U,{modelValue:t.searchParam.create_time,"onUpdate:modelValue":e[1]||(e[1]=n=>t.searchParam.create_time=n),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":l(o)("startDate"),"end-placeholder":l(o)("endDate")},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1},8,["label"]),s(w,{class:"form-item-wrap"},{default:r(()=>[s(m,{type:"primary",onClick:e[2]||(e[2]=n=>h())},{default:r(()=>[v(p(l(o)("search")),1)]),_:1}),s(m,{onClick:e[3]||(e[3]=n=>F(k.value))},{default:r(()=>[v(p(l(o)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),P((D(),K(A,{data:t.data,size:"large",ref_key:"travelListTableRef",ref:x,"max-height":"400",onSelect:z,onSelectAll:B},{empty:r(()=>[i("span",null,p(t.loading?"":l(o)("emptyData")),1)]),default:r(()=>[s(y,{type:"selection",width:"55"}),s(y,{label:l(o)("wayInfoPopup"),"min-width":"180",align:"left","show-overflow-tooltip":""},{default:r(({row:n})=>[i("div",ue,[i("div",_e,[i("img",{class:"max-w-[60px] max-h-[60px]",src:l(W)(n.cover_thumb_small)},null,8,ge)]),i("a",{href:"javascript:;",title:n.goods_name,class:"multi-hidden ml-2"},p(n.goods_name),9,fe)])]),_:1},8,["label"]),s(y,{prop:"price",label:l(o)("tourismPricePopup"),"min-width":"120",align:"right"},null,8,["label"]),s(y,{prop:"stock",label:l(o)("tourismStockPopup"),"min-width":"120",align:"right"},null,8,["label"]),s(y,{prop:"create_time",label:l(o)("goodsSelectPopupCreateTime"),"min-width":"120"},null,8,["label"])]),_:1},8,["data"])),[[H,t.loading]]),i("div",ve,[i("div",he,[P(i("div",ye,[i("span",null,p(l(o)("goodsSelectPopupBeforeTip")),1),i("span",xe,p(l(g)),1),i("span",null,p(l(o)("travelSelectPopupAfterTip")),1)],512),[[b,l(g)]]),P(s(m,{type:"primary",link:"",onClick:I},{default:r(()=>[v(p(l(o)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[b,l(g)]])]),s(M,{"current-page":t.page,"onUpdate:current-page":e[4]||(e[4]=n=>t.page=n),"page-size":t.limit,"onUpdate:page-size":e[5]||(e[5]=n=>t.limit=n),layout:"total, sizes, prev, pager, next, jumper",total:t.total,onSizeChange:e[6]||(e[6]=n=>h()),onCurrentChange:h},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const Ye=de(we,[["__scopeId","data-v-3168a80d"]]);export{Ye as default};
