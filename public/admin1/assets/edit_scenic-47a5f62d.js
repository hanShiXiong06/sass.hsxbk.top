import{d as H,x as W,f as X,r as F,n as A,aQ as Y,cm as Z,l as ee,q as n,h as u,c as v,a as p,u as i,t as f,e as a,w as d,F as x,Q as L,s as M,i as S,cN as le,cK as q,cO as te,a5 as ae,cP as oe,J as ne,K as ie,ak as se,aI as de,E as re,L as ce,a0 as ue,p as me,g as pe}from"./index-17984968.js";/* empty css                *//* empty css                */import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-a8924ef7.js";/* empty css                  */import ve from"./index-0ce1f7fc.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";import{J as fe,K as be,L as ge}from"./tourism-ed22e76b.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";import"./index.vue_vue_type_style_index_0_lang-c5bcb8a9.js";/* empty css                  *//* empty css                   */import"./attachment-a816d3ef.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-8693344a.js";/* empty css                        *//* empty css                      *//* empty css                    *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-5615c67a.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-8e50df98.js";/* empty css                */import"./sortable.esm-be94e56d.js";const C=y=>(me("data-v-30454a61"),y=y(),pe(),y),ye={class:"main-container"},Ve={class:"detail-head"},we=C(()=>p("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),ke={class:"ml-[1px]"},xe=C(()=>p("span",{class:"adorn"},"|",-1)),Le={key:0,class:"right"},Me={key:1,class:"right"},Se=C(()=>p("div",{id:"TxMap",class:"w-[800px] h-[500px]"},null,-1)),Ce={class:"fixed-footer-wrap"},Pe={class:"fixed-footer"},Te=H({__name:"edit_scenic",setup(y){const D=W(),j=X(),V=parseInt(D.query.id),w=F(!1),_=A({province:[],city:[],district:[]});(()=>{le(1).then(t=>{_.province=t.data})})();const P=t=>{Object.keys(t).length==0?t.id=e.province_id:(e.province_id=t.id,e.province_name=t.name),q(t.id).then(l=>{_.city=l.data})},T=t=>{Object.keys(t).length==0?t.id=e.city_id:(e.city_id=t.id,e.city_name=t.name),q(t.id).then(l=>{_.district=l.data})},N=t=>{e.district_id=t.id,e.district_name=t.name},O=()=>{e.province_id&&e.city_id&&e.district_id&&e.address&&te({address:e.province_name+e.city_name+e.district_name+e.address}).then(t=>{e.latitude=t.data.result.location.lat,e.longitude=t.data.result.location.lng})};let b=null;const B=()=>{let t=e.latitude,l=e.longitude;e.latitude==0&&(t="39.90469"),e.longitude==0&&(l="116.40717");const r=new window.TMap.LatLng(t,l);b=new window.TMap.Map("TxMap",{center:r,zoom:17,viewMode:"2D",showControl:!0}),b.on("click",c=>{const m={lat:c.latLng.getLat().toFixed(6),lng:c.latLng.getLng().toFixed(6)};R(m.lat,m.lng,1),s.updateGeometries({id:"shop",position:c.latLng})});const s=new window.TMap.MultiMarker({id:"marker-layer",map:b,minimumClusterSize:1});s.updateGeometries({id:"shop",position:r}),b.on("idle",()=>{ae(()=>e.latitude,(c,m)=>{const g=new window.TMap.LatLng(e.latitude,e.longitude);b.panTo(g,1),s.updateGeometries({id:"shop",position:g})})})};Y(()=>{const t=document.createElement("script");Z().then(l=>{t.type="text/javascript",t.src="https://map.qq.com/api/gljs?v=1.exp&key="+l.data.key,document.body.appendChild(t)}),t.onload=()=>{setTimeout(()=>{B()},500)}});const R=(t,l,r)=>{oe({location:t+","+l}).then(s=>{e.province_name=s.data.result.address_component.province,e.city_name=s.data.result.address_component.city,e.district_name=s.data.result.address_component.district,r==1&&(e.address=s.data.result.formatted_addresses.recommend,e.full_address=e.province_name+e.city_name+e.district_name+e.address,e.latitude=t,e.longitude=l)})},U={scenic_id:0,scenic_name:"",latitude:0,longitude:0,province_id:0,province_name:"",city_id:0,city_name:"",district_id:0,district_name:"",address:"",scenic_level:"",open_time:"",telephone:"",scenic_desc:"",surround:"",scenic_cover:"",scenic_images:"",full_address:""},e=A({...U});V&&(async(t=0)=>{Object.assign(e,U);const l=await(await fe(t)).data;Object.keys(e).forEach(r=>{l[r]!=null&&(e[r]=l[r])}),e.province_id>0&&P({}),e.city_id>0&&T({})})(V);const E=F(),$=ee(()=>({scenic_name:[{required:!0,message:n("scenicNamePlaceholder"),trigger:"blur"}],scenic_level:[{required:!0,message:n("scenicLevelPlaceholder"),trigger:"blur"}],scenic_cover:[{required:!0,message:n("scenicCoverPlaceholder"),trigger:"blur"}],addressId:[{required:!0,validator:z,trigger:"blur"}]})),z=(t,l,r)=>{(e.province_name==""||e.city_name==""||e.district_name=="")&&r(new Error(n("addressPlaceholder"))),r()},G=async t=>{w.value||!t||await t.validate(async l=>{l&&(w.value=!0,(V?be:ge)(e).then(c=>{w.value=!1,history.back()}).catch(()=>{w.value=!1}))})},K=()=>{history.back()};return(t,l)=>{const r=ne,s=ie,c=se,m=de,g=ve,k=re,I=_e,J=ce,Q=ue;return u(),v("div",ye,[p("div",Ve,[p("div",{class:"left",onClick:l[0]||(l[0]=o=>i(j).push({path:"/tourism/product/scenic/scenic"}))},[we,p("span",ke,f(i(n)("returnToPreviousPage")),1),xe,i(V)?(u(),v("span",Le,f(i(n)("editScenic")),1)):(u(),v("span",Me,f(i(n)("addScenic")),1))])]),a(Q,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[a(J,{model:e,"label-width":"90px",ref_key:"formRef",ref:E,rules:i($),class:"page-form"},{default:d(()=>[a(s,{label:i(n)("scenicName"),prop:"scenic_name"},{default:d(()=>[a(r,{modelValue:e.scenic_name,"onUpdate:modelValue":l[1]||(l[1]=o=>e.scenic_name=o),modelModifiers:{trim:!0},clearable:"",placeholder:i(n)("scenicNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:i(n)("scenicLevel"),prop:"scenic_level"},{default:d(()=>[a(m,{modelValue:e.scenic_level,"onUpdate:modelValue":l[2]||(l[2]=o=>e.scenic_level=o),clearable:"",class:"input-width"},{default:d(()=>[a(c,{label:i(n)("oneStar"),value:1},null,8,["label"]),a(c,{label:i(n)("twoStar"),value:2},null,8,["label"]),a(c,{label:i(n)("threeStar"),value:3},null,8,["label"]),a(c,{label:i(n)("fourStar"),value:4},null,8,["label"]),a(c,{label:i(n)("fiveStar"),value:5},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(s,{label:i(n)("openTime"),class:"input-width"},{default:d(()=>[a(r,{modelValue:e.open_time,"onUpdate:modelValue":l[3]||(l[3]=o=>e.open_time=o),modelModifiers:{trim:!0},clearable:"",placeholder:i(n)("openTimePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:i(n)("telephone")},{default:d(()=>[a(r,{modelValue:e.telephone,"onUpdate:modelValue":l[4]||(l[4]=o=>e.telephone=o),modelModifiers:{trim:!0},clearable:"",placeholder:i(n)("telephonePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:i(n)("scenicCover"),prop:"scenic_cover"},{default:d(()=>[a(g,{modelValue:e.scenic_cover,"onUpdate:modelValue":l[5]||(l[5]=o=>e.scenic_cover=o)},null,8,["modelValue"])]),_:1},8,["label"]),a(s,{label:i(n)("scenicImgs"),prop:"scenic_images"},{default:d(()=>[a(g,{modelValue:e.scenic_images,"onUpdate:modelValue":l[6]||(l[6]=o=>e.scenic_images=o),limit:"10"},null,8,["modelValue"])]),_:1},8,["label"]),a(s,{label:i(n)("address"),prop:"addressId"},{default:d(()=>[a(m,{modelValue:e.province_name,"onUpdate:modelValue":l[7]||(l[7]=o=>e.province_name=o),"value-key":"name",clearable:"",class:"input-width",onChange:P},{default:d(()=>[a(c,{label:i(n)("provincePlaceholder"),value:""},null,8,["label"]),(u(!0),v(x,null,L(_.province,(o,h)=>(u(),M(c,{key:h,label:o.name,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(m,{modelValue:e.city_name,"onUpdate:modelValue":l[8]||(l[8]=o=>e.city_name=o),"value-key":"id",clearable:"",class:"input-width ml-3",onChange:T},{default:d(()=>[a(c,{label:i(n)("cityPlaceholder"),value:""},null,8,["label"]),(u(!0),v(x,null,L(_.city,(o,h)=>(u(),M(c,{key:h,label:o.name,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(m,{modelValue:e.district_name,"onUpdate:modelValue":l[9]||(l[9]=o=>e.district_name=o),"value-key":"id",clearable:"",class:"input-width ml-3",onChange:N},{default:d(()=>[a(c,{label:i(n)("districtPlaceholder"),value:""},null,8,["label"]),(u(!0),v(x,null,L(_.district,(o,h)=>(u(),M(c,{key:h,label:o.name,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(s,{label:i(n)("detailAddress"),prop:"address"},{default:d(()=>[a(r,{modelValue:e.address,"onUpdate:modelValue":l[10]||(l[10]=o=>e.address=o),modelModifiers:{trim:!0},clearable:"",placeholder:i(n)("detailAddressPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"]),a(k,{class:"ml-3",onClick:O},{default:d(()=>[S(f(i(n)("search")),1)]),_:1})]),_:1},8,["label"]),a(s,null,{default:d(()=>[Se]),_:1}),a(s,{label:i(n)("scenicDesc")},{default:d(()=>[a(I,{modelValue:e.scenic_desc,"onUpdate:modelValue":l[11]||(l[11]=o=>e.scenic_desc=o)},null,8,["modelValue"])]),_:1},8,["label"]),a(s,{label:i(n)("surround")},{default:d(()=>[a(I,{modelValue:e.surround,"onUpdate:modelValue":l[12]||(l[12]=o=>e.surround=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1}),p("div",Ce,[p("div",Pe,[a(k,{type:"primary",onClick:l[13]||(l[13]=o=>G(E.value))},{default:d(()=>[S(f(i(n)("save")),1)]),_:1}),a(k,{onClick:l[14]||(l[14]=o=>K())},{default:d(()=>[S(f(i(n)("cancel")),1)]),_:1})])])])}}});const vl=he(Te,[["__scopeId","data-v-30454a61"]]);export{vl as default};
