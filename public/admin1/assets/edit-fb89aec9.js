import{d as G,x as z,f as Q,r as h,n as W,l as X,q as o,P as Z,u as s,h as x,c as N,e as a,w as d,cW as ee,a as r,i as v,t as m,s as b,bZ as k,F as te,Q as le,B as oe,c6 as U,cS as se,cX as ae,a0 as ie,J as ne,K as re,az as de,aA as me,bN as ue,aB as pe,c7 as _e,L as ce,E as fe,U as xe}from"./index-17984968.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                          *//* empty css                    *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                       *//* empty css                 */import ye from"./index-0ce1f7fc.js";import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                   *//* empty css                       */import{a as ve,e as ge,b as he}from"./task-3bace6e5.js";import{h as be}from"./level-113119c0.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-c5bcb8a9.js";/* empty css                  *//* empty css                   */import"./attachment-a816d3ef.js";import"./index.vue_vue_type_script_setup_true_lang-8693344a.js";/* empty css               *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-5615c67a.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-8e50df98.js";/* empty css                */import"./_plugin-vue_export-helper-c27b6911.js";import"./sortable.esm-be94e56d.js";const we={class:"main-container"},Ve={class:"flex"},ke=r("span",{class:"mx-[10px]"},"至",-1),Te={key:0},Fe={class:"flex flex-col"},Ne={class:"ml-[10px]"},Pe={class:"text-[#999] text-[12px]"},Ee={class:"flex flex-col mt-[10px]"},De={class:"flex -mt-[9px]"},Oe={class:"flex items-center ml-[2px] text-[#666]"},Ce={class:"ml-[10px]"},Ue={class:"flex -mt-[9px]"},Me={class:"flex items-center ml-[2px] text-[#666]"},Le={class:"ml-[10px]"},$e={class:"flex -mt-[9px]"},Se={class:"flex items-center ml-[2px] text-[#666]"},Ye={class:"ml-[10px]"},Re={class:"flex items-center"},He={class:"mr-[10px]"},Be={class:"ml-[10px]"},Ke={class:"flex flex-col mt-[10px]"},Ie={class:"flex -mt-[9px]"},Je={class:"mr-[10px]"},qe=r("span",null,null,-1),Ae={class:"flex items-center text-[#666] -mt-[9px]"},je={class:"mr-[10px]"},Ge={class:"ml-[10px]"},ze=r("span",null,null,-1),Qe={class:"fixed-footer-wrap"},We={class:"fixed-footer"},It=G({__name:"edit",setup(Xe){const P=z(),E=Q(),M=P.meta.title,T=h(!1);let g=h();const e=W({...{id:"",name:"",time_type:"1",time:"",start_time:"2024-01-22 12:52:00",end_time:"",level_type:"1",level:[],cover:"",times:"",rules:[{condition:{type:["order_num"]},reward:{commission:""}}],remark:"",send_time_type:"1",send_time:""}});e.id=h(P.query.id);const L=X(()=>({name:[{required:!0,message:o("taskNamPlaceholder"),trigger:"blur"}],time:[{validator:(n,t,i)=>{e.start_time||i(new Error(o("startTimePlaceholder"))),e.time_type!=2&&!e.end_time&&i(new Error(o("endTimePlaceholder"))),e.time_type!=2&&w(e.end_time)<w(e.start_time)&&i(new Error(o("tmePlaceholder1"))),i()},trigger:["blur","change"]}],times:[{validator:(n,t,i)=>{/^[1-9]\d*|0$/.test(parseFloat(e.times))?i():i(new Error(o("timesRepeatableRulesPlaceholder")))},trigger:["blur","change"]}],level:[{validator:(n,t,i)=>{e.level_type==2&&!e.level.length?i(new Error(o("levelPlaceholder"))):i()},trigger:["blur","change"]}],type:[{validator:(n,t,i)=>{e.rules[0].condition.type.length||i(new Error(o("leastSelectTaskIndex")));const _=u=>{const f=parseFloat(u);return!isNaN(f)&&f%1!==0},p=u=>{let f=parseFloat(u);if(typeof f!="number"||isNaN(f))return!1;const c=f.toString(),y=c.indexOf(".");return y===-1?!0:c.length-y-1<=2};e.rules[0].condition.type.indexOf("order_num")>-1&&(!e.rules[0].condition.order_num||e.rules[0].condition.order_num<=0||_(e.rules[0].condition.order_num))&&i(new Error(o("conditionOrderNumTips3"))),e.rules[0].condition.type.indexOf("order_money")>-1&&(!e.rules[0].condition.order_money||e.rules[0].condition.order_money<=0||!p(e.rules[0].condition.order_money))&&i(new Error(o("conditionOrderMoneyTips3"))),e.rules[0].condition.type.indexOf("child_num")>-1&&(!e.rules[0].condition.child_num||e.rules[0].condition.child_num<=0||_(e.rules[0].condition.child_num))&&i(new Error(o("conditionFenxiaoNumTips3"))),i()},trigger:["blur"]}],send_time_type:[{validator:(n,t,i)=>{e.send_time||i(new Error(o("selectTimePlaceholder1")));const _=/^[1-9]\d*$/;e.send_time_type==2&&!_.test(e.send_time)&&i(new Error(o("selectTimePlaceholder2"))),e.send_time_type==1&&w(e.end_time)>w(e.send_time)&&i(new Error(o("selectTimePlaceholder3"))),i()},trigger:["blur","change"]}],"rules[0].reward.commission":[{required:!0,message:o("taskContentPlaceholder"),trigger:"blur"},{validator:(n,t,i)=>{t<=0&&i(new Error(o("taskCommissionPlaceholder"))),i()},trigger:["blur","change"]}]}));let D=h([]);(()=>{be().then(n=>{D.value=n.data})})();let F=h(!0);const $=()=>{ve({id:e.id}).then(n=>{let t=JSON.parse(JSON.stringify(n.data));t&&Object.keys(t).length&&(e.name=t.name,e.cover=t.cover,e.time_type=t.time_type,e.start_time=t.start_time,e.end_time=t.end_time,e.level_type=t.level_type,e.level=t.level,e.times=t.times.toString(),e.rules=t.rules,e.remark=t.remark,e.send_time_type=t.send_time_type,e.send_time=t.send_time_type==1?se(t.send_time):t.send_time),F.value=!1})};e.id?$():F.value=!1;const S=async n=>{T.value||!n||await n.validate(async t=>{if(t){let i=JSON.parse(JSON.stringify(e));e.time_type==2&&(i.end_time=0),(i.id?ge:he)(i).then(p=>{T.value=!1,E.push("/shop_fenxiao/task/list")}).catch(()=>{T.value=!1})}})},Y=()=>{E.push("/shop_fenxiao/task/list")},R=()=>{var n=new Date,t=n.getFullYear(),i=("0"+(n.getMonth()+1)).slice(-2),_=("0"+n.getDate()).slice(-2),p=("0"+n.getHours()).slice(-2),u=("0"+n.getMinutes()).slice(-2),f=("0"+n.getSeconds()).slice(-2);return`${t}-${i}-${_} ${p}:${u}:${f}`};e.start_time=R();const O=n=>n.valueOf()<Date.now(),w=n=>{var t=new Date(n);return t.getTime()},H=(n,t)=>{n=="2"&&(e.send_time_type="2"),setTimeout(()=>{t&&t.clearValidate("send_time_type")})},B=n=>{e.send_time="",setTimeout(()=>{n&&n.clearValidate("send_time_type")})},K=n=>{let t=["order_num","order_money","child_num"],i=e.rules[0].condition.type[0];t.forEach((_,p)=>{_!=i&&(e.rules[0].condition[_]="")}),setTimeout(()=>{n&&n.clearValidate("type")})};return(n,t)=>{const i=ae,_=ie,p=ne,u=re,f=ye,c=de,y=me,V=ue,I=pe,J=_e,q=ce,C=fe,A=xe;return Z((x(),N("div",we,[a(_,{class:"card !border-none",shadow:"never"},{default:d(()=>[a(i,{content:s(M),icon:s(ee),onBack:t[0]||(t[0]=l=>n.$router.back())},null,8,["content","icon"])]),_:1}),a(_,{class:"card mt-[15px] !border-none",shadow:"never"},{default:d(()=>[a(q,{class:"page-form",model:e,"label-width":"120px",ref_key:"taskFormRef",ref:g,rules:s(L)},{default:d(()=>[a(u,{label:s(o)("taskNam"),prop:"name"},{default:d(()=>[a(p,{modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=l=>e.name=l),modelModifiers:{trim:!0},clearable:"",placeholder:s(o)("taskNamPlaceholder"),class:"input-width",maxlength:"60","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:s(o)("taskCover")},{default:d(()=>[r("div",null,[a(f,{modelValue:e.cover,"onUpdate:modelValue":t[2]||(t[2]=l=>e.cover=l),limit:1},null,8,["modelValue"])])]),_:1},8,["label"]),a(u,{label:s(o)("taskTime")},{default:d(()=>[a(y,{modelValue:e.time_type,"onUpdate:modelValue":t[3]||(t[3]=l=>e.time_type=l),onChange:t[4]||(t[4]=l=>H(l,s(g)))},{default:d(()=>[a(c,{label:"1"},{default:d(()=>[v(m(s(o)("assigntTime")),1)]),_:1}),a(c,{label:"2"},{default:d(()=>[v(m(s(o)("longTerm")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(u,{label:"",prop:"time"},{default:d(()=>[a(V,{class:"!w-[200px]",modelValue:e.start_time,"onUpdate:modelValue":t[5]||(t[5]=l=>e.start_time=l),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime","disabled-date":O,placeholder:s(o)("startTimePlaceholder")},null,8,["modelValue","placeholder"]),r("div",Ve,[ke,e.time_type==2?(x(),N("span",Te,"长期有效")):(x(),b(V,{key:1,class:"!w-[300px]",modelValue:e.end_time,"onUpdate:modelValue":t[6]||(t[6]=l=>e.end_time=l),"value-format":"YYYY-MM-DD HH:mm:ss","disabled-date":O,type:"datetime",placeholder:s(o)("endTimePlaceholder")},null,8,["modelValue","placeholder"]))])]),_:1}),a(u,{label:s(o)("taskType"),prop:"times"},{default:d(()=>[r("div",Fe,[r("div",null,[a(p,{modelValue:e.times,"onUpdate:modelValue":t[7]||(t[7]=l=>e.times=l),modelModifiers:{trim:!0},maxlength:"2","show-word-limit":"",clearable:"",placeholder:s(o)("timesRepeatablePlaceholder"),class:"!w-[180px]",onKeyup:t[8]||(t[8]=l=>s(k)(l))},null,8,["modelValue","placeholder"]),r("span",Ne,m(s(o)("timesNext")),1)]),r("span",Pe,m(s(o)("timesRepeatableHint")),1)])]),_:1},8,["label"]),a(u,{label:s(o)("level")},{default:d(()=>[a(y,{modelValue:e.level_type,"onUpdate:modelValue":t[9]||(t[9]=l=>e.level_type=l)},{default:d(()=>[a(c,{label:"1"},{default:d(()=>[v(m(s(o)("allLevel")),1)]),_:1}),a(c,{label:"2"},{default:d(()=>[v(m(s(o)("portionLevel")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.level_type==2?(x(),b(u,{key:0,label:"",prop:"level"},{default:d(()=>[a(J,{modelValue:e.level,"onUpdate:modelValue":t[10]||(t[10]=l=>e.level=l)},{default:d(()=>[(x(!0),N(te,null,le(s(D),(l,j)=>(x(),b(I,{label:l.level_id+"",key:j},{default:d(()=>[v(m(l.level_name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):oe("",!0),a(u,{label:s(o)("taskIndex"),prop:"type"},{default:d(()=>[a(y,{modelValue:e.rules[0].condition.type[0],"onUpdate:modelValue":t[17]||(t[17]=l=>e.rules[0].condition.type[0]=l),onChange:t[18]||(t[18]=l=>K(s(g)))},{default:d(()=>[r("div",Ee,[a(c,{label:"order_num",class:"!h-[auto] !flex !items-start"},{default:d(()=>[r("div",De,[r("span",null,m(s(o)("conditionOrderNum")),1),r("div",Oe,[a(p,{modelValue:e.rules[0].condition.order_num,"onUpdate:modelValue":t[11]||(t[11]=l=>e.rules[0].condition.order_num=l),clearable:"",onKeyup:t[12]||(t[12]=l=>s(k)(l)),class:"!w-[100px] ml-2",maxlength:"7","show-word-limit":"",disabled:e.rules[0].condition.type.indexOf("order_num")==-1},null,8,["modelValue","disabled"]),r("span",Ce,m(s(o)("conditionOrderNumTips2")),1)])])]),_:1}),a(c,{label:"order_money",class:"my-[15px] !h-[auto] !flex !items-start"},{default:d(()=>[r("div",Ue,[r("span",null,m(s(o)("conditionOrderMoney")),1),r("div",Me,[a(p,{modelValue:e.rules[0].condition.order_money,"onUpdate:modelValue":t[13]||(t[13]=l=>e.rules[0].condition.order_money=l),maxlength:"7",onKeyup:t[14]||(t[14]=l=>s(U)(l)),"show-word-limit":"",clearable:"",class:"!w-[100px] ml-2",disabled:e.rules[0].condition.type.indexOf("order_money")==-1},null,8,["modelValue","disabled"]),r("span",Le,m(s(o)("conditionOrderMoneyTips2")),1)])])]),_:1}),a(c,{label:"child_num",class:"!h-[auto] !flex !items-start"},{default:d(()=>[r("div",$e,[r("span",null,m(s(o)("conditionFenxiaoNum")),1),r("div",Se,[a(p,{modelValue:e.rules[0].condition.child_num,"onUpdate:modelValue":t[15]||(t[15]=l=>e.rules[0].condition.child_num=l),maxlength:"7",onKeyup:t[16]||(t[16]=l=>s(k)(l)),"show-word-limit":"",clearable:"",class:"!w-[100px] ml-2",disabled:e.rules[0].condition.type.indexOf("child_num")==-1},null,8,["modelValue","disabled"]),r("span",Ye,m(s(o)("conditionFenxiaoNumTips2")),1)])])]),_:1})])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(u,{label:s(o)("taskContent"),prop:"rules[0].reward.commission"},{default:d(()=>[r("div",Re,[r("span",He,m(s(o)("return")),1),a(p,{modelValue:e.rules[0].reward.commission,"onUpdate:modelValue":t[19]||(t[19]=l=>e.rules[0].reward.commission=l),clearable:"",onKeyup:t[20]||(t[20]=l=>s(U)(l)),class:"!w-[200px]",maxlength:"7","show-word-limit":""},null,8,["modelValue"]),r("span",Be,m(s(o)("brokerage")),1)])]),_:1},8,["label"]),a(u,{label:s(o)("awardTime"),prop:"send_time_type"},{default:d(()=>[a(y,{modelValue:e.send_time_type,"onUpdate:modelValue":t[24]||(t[24]=l=>e.send_time_type=l),onChange:t[25]||(t[25]=l=>B(s(g)))},{default:d(()=>[r("div",Ke,[a(c,{label:"1",class:"!h-[auto] !flex !items-start",disabled:e.time_type==2},{default:d(()=>[r("div",Ie,[r("span",Je,m(s(o)("fixedTime")),1),a(V,{class:"!w-[200px]",modelValue:e.send_time,"onUpdate:modelValue":t[21]||(t[21]=l=>e.send_time=l),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime",disabled:e.time_type==2||e.send_time_type==2,placeholder:s(o)("selectTimePlaceholder")},null,8,["modelValue","disabled","placeholder"])]),qe]),_:1},8,["disabled"]),a(c,{label:"2",class:"mt-[15px] !h-[auto] !flex !items-start"},{default:d(()=>[r("div",Ae,[r("span",je,m(s(o)("taskAttainment")),1),e.send_time_type==1?(x(),b(p,{key:0,class:"!w-[100px] ml-2",disabled:"true"})):(x(),b(p,{key:1,modelValue:e.send_time,"onUpdate:modelValue":t[22]||(t[22]=l=>e.send_time=l),modelModifiers:{trim:!0},maxlength:"4","show-word-limit":"",clearable:"",class:"!w-[100px] ml-2",onKeyup:t[23]||(t[23]=l=>s(k)(l))},null,8,["modelValue"])),r("span",Ge,m(s(o)("taskAttainment1")),1)]),ze]),_:1})])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(u,{label:s(o)("remark")},{default:d(()=>[a(p,{modelValue:e.remark,"onUpdate:modelValue":t[26]||(t[26]=l=>e.remark=l),maxlength:"200","show-word-limit":"",type:"textarea",clearable:"",placeholder:s(o)("remarkPlaceholder"),class:"!w-[450px]",rows:"6"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1}),r("div",Qe,[r("div",We,[a(C,{type:"primary",onClick:t[27]||(t[27]=l=>S(s(g)))},{default:d(()=>[v(m(s(o)("save")),1)]),_:1}),a(C,{onClick:t[28]||(t[28]=l=>Y())},{default:d(()=>[v(m(s(o)("back")),1)]),_:1})])])])),[[A,s(F)]])}}});export{It as default};
