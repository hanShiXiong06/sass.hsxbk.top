import{d as te,x as oe,f as le,r as v,n as q,l as F,q as l,h as p,c as _,a as c,u as o,t as u,e as a,w as i,c6 as j,bZ as ae,i as y,B as V,v as se,P as ie,s as E,aD as re,aE as de,J as ne,K as ce,L as ue,a0 as pe,E as me,c$ as _e,az as fe,aA as ge,bN as ve,a1 as ye,U as be}from"./index-17984968.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                    *//* empty css                         *//* empty css                *//* empty css                */import{_ as ke}from"./index.vue_vue_type_script_setup_true_lang-a8924ef7.js";import"./el-form-item-4ed993c7.js";/* empty css                    */import{M as xe,N as he,O as Ve,P as we,Q as Pe}from"./tourism-ed22e76b.js";import"./index.vue_vue_type_style_index_0_lang-c5bcb8a9.js";import"./attachment-a816d3ef.js";import"./index.vue_vue_type_script_setup_true_lang-8693344a.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css                    *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css               *//* empty css                    */import"./index.vue_vue_type_script_setup_true_lang-5615c67a.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-8e50df98.js";/* empty css                */import"./_plugin-vue_export-helper-c27b6911.js";const De={class:"main-container"},Ce={class:"detail-head"},Ee=c("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1),Te={class:"ml-[1px]"},Ne=c("span",{class:"adorn"},"|",-1),Re={key:0,class:"right"},Ue={key:1,class:"right"},$e={key:0},Be={class:"fixed-footer-wrap"},Ie={class:"fixed-footer"},Me={key:1},Se=["onClick"],Ye={key:0},qe={class:"text-right text-gray-400 text-[14px] mt-[5px]"},Fe={class:"text-right text-gray-400 text-[12px] mt-[5px]"},je={key:1},ze=c("p",{class:"text-right text-gray-400 text-[14px] mt-[5px]"},"0.00￥",-1),Ae=c("p",{class:"text-right text-gray-400 text-[12px] mt-[5px]"},"0/0",-1),Ke=[ze,Ae],Le={key:1,class:"w-full h-full"},Oe={class:"text-gray-400"},Ze={key:0},Ge={class:"text-right text-gray-400 text-[14px] mt-[5px]"},Je={class:"text-right text-gray-400 text-[12px] mt-[5px]"},Qe={key:1},He=c("p",{class:"text-right text-gray-400 text-[14px] mt-[5px]"},"0.00￥",-1),We=c("p",{class:"text-right text-gray-400 text-[12px] mt-[5px]"},"0/0",-1),Xe=[He,We],et={class:"dialog-footer"},At=te({__name:"edit_ticket",setup(tt){const T=oe(),z=le(),w=parseInt(T.query.id),N=parseInt(T.query.scenic_id),b=v(!1),k=v("first"),A=(r,e)=>{},K=r=>{const e=parseInt(new Date().getTime()/1e3)+"",n=parseInt(new Date(r.day).getTime()/1e3)+"";return e-60*60*24<n},x=v(!1),L=r=>{d.start_date=r.day,d.is_set=1,d.price="",d.end_date="",x.value=!0,m.value[r.day]&&(d.price=m.value[r.day].price)},d=q({is_set:1,start_date:"",end_date:"",price:""}),R={goods_id:0,goods_name:"",buy_content:"",goods_content:"",price:"",is_vip:0,stock:"",scenic_id:0,buy_info:""},s=q({...R});w&&(async(r=0)=>{Object.assign(s,R);const e=await(await xe(r)).data;Object.keys(s).forEach(n=>{e[n]!=null&&(s[n]=e[n])}),s.goods_id=r,B(r)})(w);const U=v(),O=F(()=>({goods_name:[{required:!0,message:l("ticketNamePlaceholder"),trigger:"blur"}],price:[{required:!0,message:l("tickePricePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(r,e,n)=>{parseFloat(e)>9999999999e-2?n(new Error(l("pricePlaceholder3"))):n()}}],stock:[{required:!0,message:l("ticketStockPlaceholder"),trigger:"blur"}]})),Z=async r=>{b.value||!r||await r.validate(async e=>{if(e){b.value=!0,s.scenic_id=N;const n=s;(s.goods_id?he:Ve)(n).then(g=>{g.code>=0&&s.goods_id==0?(s.goods_id=g.data.id,k.value="second"):history.back(),b.value=!1}).catch(()=>{b.value=!1})}})},P=v(!1),$=v(),G=F(()=>({price:[{required:!0,message:l("saleArrPricePlaceholder"),trigger:"blur"},{trigger:"blur",validator:(r,e,n)=>{e<=0?n(new Error(l("saleArrPriceNotZeroTips"))):parseFloat(e)>9999999999e-2?n(new Error(l("pricePlaceholder3"))):n()}}]})),J=async r=>{P.value||!r||await r.validate(async e=>{e&&(P.value=!0,d.goods_id=s.goods_id,we(d).then(n=>{B(s.goods_id),x.value=!1,P.value=!1}))})},Q=()=>{history.back()},m=v([]),B=(r=0)=>{Pe({goods_id:r}).then(e=>{m.value=e.data})};return(r,e)=>{const n=re,D=de,g=ne,f=ce,I=ke,M=ue,C=pe,h=me,H=_e,S=fe,W=ge,Y=ve,X=ye,ee=be;return p(),_("div",De,[c("div",Ce,[c("div",{class:"left",onClick:e[0]||(e[0]=t=>o(z).push(`/tourism/product/scenic/ticket?id=${o(N)}`))},[Ee,c("span",Te,u(o(l)("returnToPreviousPage")),1)]),Ne,o(w)?(p(),_("span",Re,u(o(l)("editTicket")),1)):(p(),_("span",Ue,u(o(l)("addTicket")),1))]),a(C,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[a(D,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),class:"demo-tabs",onTabClick:A},{default:i(()=>[a(n,{label:o(l)("basicData"),name:"first"},null,8,["label"]),a(n,{label:o(l)("ticketPriceCalendar"),name:"second",disabled:!s.goods_id},null,8,["label","disabled"])]),_:1},8,["modelValue"]),k.value=="first"?(p(),_("div",$e,[a(C,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[a(M,{model:s,"label-width":"180px",ref_key:"formRef",ref:U,rules:o(O),class:"page-form"},{default:i(()=>[a(f,{label:o(l)("ticketName"),prop:"goods_name"},{default:i(()=>[a(g,{modelValue:s.goods_name,"onUpdate:modelValue":e[2]||(e[2]=t=>s.goods_name=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(l)("ticketNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(f,{label:o(l)("tickePrice"),prop:"price"},{default:i(()=>[a(g,{modelValue:s.price,"onUpdate:modelValue":e[3]||(e[3]=t=>s.price=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(l)("tickePricePlaceholder"),class:"input-width",onKeyup:e[4]||(e[4]=t=>o(j)(t)),onBlur:e[5]||(e[5]=t=>s.price=t.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(f,{label:o(l)("ticketStock"),prop:"stock"},{default:i(()=>[a(g,{modelValue:s.stock,"onUpdate:modelValue":e[6]||(e[6]=t=>s.stock=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(l)("ticketStockPlaceholder"),class:"input-width",onKeyup:e[7]||(e[7]=t=>o(ae)(t)),onBlur:e[8]||(e[8]=t=>s.stock=t.target.value)},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(f,{label:o(l)("ticketIllustrate")},{default:i(()=>[a(I,{modelValue:s.goods_content,"onUpdate:modelValue":e[9]||(e[9]=t=>s.goods_content=t)},null,8,["modelValue"])]),_:1},8,["label"]),a(f,{label:o(l)("buyDesc")},{default:i(()=>[a(I,{modelValue:s.buy_info,"onUpdate:modelValue":e[10]||(e[10]=t=>s.buy_info=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1}),c("div",Be,[c("div",Ie,[a(h,{type:"primary",onClick:e[11]||(e[11]=t=>Z(U.value))},{default:i(()=>[y(u(o(l)("save")),1)]),_:1}),a(h,{onClick:e[12]||(e[12]=t=>Q())},{default:i(()=>[y(u(o(l)("returnToPreviousPage")),1)]),_:1})])])])):V("",!0),k.value=="second"?(p(),_("div",Me,[a(C,{class:"box-card !border-none",shadow:"never"},{default:i(()=>[a(H,null,{"date-cell":i(({data:t})=>[K(t)==!0?(p(),_("div",{key:0,class:se(["w-full h-full",t.isSelected?"is-selected":""]),onClick:lt=>L(t)},[c("p",null,u(t.day.split("-").slice(1).join("-")),1),m.value&&m.value[t.day]?(p(),_("div",Ye,[c("p",qe,u(m.value[t.day].price)+"￥",1),c("p",Fe,u(m.value[t.day].sell_num)+"/"+u(m.value[t.day].stock_all),1)])):(p(),_("div",je,Ke))],10,Se)):(p(),_("div",Le,[c("p",Oe,u(t.day.split("-").slice(1).join("-")),1),m.value&&m.value[t.day]?(p(),_("div",Ze,[c("p",Ge,u(m.value[t.day].price)+"￥",1),c("p",Je,u(m.value[t.day].sell_num)+"/"+u(m.value[t.day].stock_all),1)])):(p(),_("div",Qe,Xe))]))]),_:1})]),_:1})])):V("",!0)]),_:1}),a(X,{modelValue:x.value,"onUpdate:modelValue":e[20]||(e[20]=t=>x.value=t),title:o(l)("editPrice"),width:"400px","destroy-on-close":!0},{footer:i(()=>[c("span",et,[a(h,{onClick:e[18]||(e[18]=t=>x.value=!1)},{default:i(()=>[y(u(o(l)("cancel")),1)]),_:1}),a(h,{type:"primary",onClick:e[19]||(e[19]=t=>J($.value))},{default:i(()=>[y(u(o(l)("confirm")),1)]),_:1})])]),default:i(()=>[ie((p(),E(M,{model:d,"label-width":"90px",ref_key:"formRulesRef",ref:$,rules:o(G),class:"page-form"},{default:i(()=>[a(f,{label:o(l)("daySetting"),class:"items-center"},{default:i(()=>[a(W,{modelValue:d.is_set,"onUpdate:modelValue":e[13]||(e[13]=t=>d.is_set=t),class:"ml-4 input-width"},{default:i(()=>[a(S,{label:1,size:"large"},{default:i(()=>[y(u(d.start_date),1)]),_:1}),a(S,{label:2,size:"large"},{default:i(()=>[y(u(o(l)("dateRange")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),d.is_set==2?(p(),E(f,{key:0,label:o(l)("startDate"),class:"input-width"},{default:i(()=>[a(Y,{type:"date",modelValue:d.start_date,"onUpdate:modelValue":e[14]||(e[14]=t=>d.start_date=t),placeholder:o(l)("startDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):V("",!0),d.is_set==2?(p(),E(f,{key:1,label:o(l)("endDate"),class:"input-width"},{default:i(()=>[a(Y,{type:"date",modelValue:d.end_date,"onUpdate:modelValue":e[15]||(e[15]=t=>d.end_date=t),placeholder:o(l)("endDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):V("",!0),a(f,{label:o(l)("tickePrice"),prop:"price",class:"input-width"},{default:i(()=>[a(g,{modelValue:d.price,"onUpdate:modelValue":e[16]||(e[16]=t=>d.price=t),clearable:"",placeholder:o(l)("tickePricePlaceholder"),onKeyup:e[17]||(e[17]=t=>o(j)(t)),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[ee,b.value]])]),_:1},8,["modelValue","title"])])}}});export{At as default};
