import{d as oe,l as $,r as k,n as w,h as C,c as D,a as d,b as te,e as n,w as i,i as h,t as c,u as a,q as l,P as E,a6 as G,s as N,A as ae,bs as le,a$ as se,R as B,E as ne,ak as de,aI as ie,K as pe,J as re,bM as ce,L as me,aa as ue,I as ge,aq as _e,ac as fe,T as he,a1 as ve,U as ye,p as Se,g as xe}from"./index-17984968.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css                        *//* empty css                        *//* empty css                *//* empty css                          *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                  */import{_ as R}from"./goods_default-995568ac.js";import{g as Pe}from"./category-02c806c6.js";import{g as be}from"./goods-db78f22e.js";import{_ as ke}from"./_plugin-vue_export-helper-c27b6911.js";const Ce=x=>(Se("data-v-2c88c9ae"),x=x(),xe(),x),Ee={class:"inline-block ml-[10px] text-[14px]"},Ve={class:"text-primary mx-[2px]"},we={class:"flex items-center cursor-pointer"},Ge={class:"min-w-[60px] h-[60px] flex items-center justify-center"},Te=Ce(()=>d("div",{class:"image-slot"},[d("img",{class:"w-[60px] h-[60px]",src:R})],-1)),Ie={key:1,class:"w-[70px] h-[60px]",src:R,fit:"contain"},$e={class:"ml-2"},De=["title"],Ne={class:"mt-[16px] flex"},Be={class:"flex items-center flex-1"},Re={class:"layui-table-bottom-left-container mr-[10px]"},Ue={class:"text-primary mx-[2px]"},ze={class:"dialog-footer"},Fe=oe({__name:"goods-select-popup",props:{modelValue:{type:String,default:""},max:{type:Number,default:0},min:{type:Number,default:0}},emits:["update:modelValue"],setup(x,{expose:U,emit:z}){const g=x,u=$({get(){return g.modelValue},set(t){z("update:modelValue",t)}}),v=k(!1),m=w({}),_=$(()=>Object.keys(m).length),o=w({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{goods_name:"",goods_category:"",select_type:"all",goods_ids:""}}),T=k(),F=t=>{y()},V=w([]);(()=>{Pe().then(t=>{const e=t.data;if(e){const p=[];e.forEach(r=>{const S=[];r.children&&r.children.forEach(f=>{S.push({value:f.category_id,label:f.category_name})}),p.push({value:r.category_id,label:r.category_name,children:S})}),V.splice(0,V.length,...p)}})})();const P=k();k([]);const L=(t,e)=>{let p=!1;for(let r=0;r<t.length;r++)if(t[r].goods_id==e.goods_id){p=!0;break}p?m["goods_"+e.goods_id]=e:delete m["goods_"+e.goods_id]},A=t=>{t.length?t.forEach(e=>{m["goods_"+e.goods_id]=e}):o.data.forEach(e=>{delete m["goods_"+e.goods_id]})},y=(t=1,e=null)=>{o.loading=!0,o.page=t;const p=le(o.searchParam);if(p.select_type=="selected"){const r=[];for(let S in m)r.push(parseInt(S.replace("goods_","")));p.goods_ids=r}else p.goods_ids="";be({page:o.page,limit:o.limit,...p}).then(r=>{o.loading=!1,o.data=r.data.data,o.total=r.data.total,I()}).catch(()=>{o.loading=!1})},I=()=>{se(()=>{if(P.value)for(let t=0;t<o.data.length;t++)P.value.toggleRowSelection(o.data[t],!1),m["goods_"+o.data[t].goods_id]&&P.value.toggleRowSelection(o.data[t],!0)})},M=t=>{t&&(t.resetFields(),y())},O=()=>{o.searchParam.verify_goods_ids=u.value,y(1,t=>{if(u.value){u.value.splice(0,u.value.length,...t),u.value.forEach(e=>{m["goods_"+e]||(m["goods_"+e]={})});for(let e=0;e<o.data.length;e++)u.value.indexOf(o.data[e].goods_id)!=-1&&(m["goods_"+o.data[e].goods_id]=o.data[e])}}),v.value=!0},j=()=>{for(let t in m)delete m[t];I()},q=()=>{if(g.min&&_.value<g.min){B({type:"warning",message:`${l("goodsSelectPopupGoodsMinTip")}${g.min}${l("goodsSelectPopupPiece")}`});return}if(g.max&&g.max>0&&_.value&&_.value>g.max){B({type:"warning",message:`${l("goodsSelectPopupGoodsMaxTip")}${g.max}${l("goodsSelectPopupPiece")}`});return}let t=[];for(let e in m)t.push(parseInt(e.replace("goods_","")));u.value.splice(0,u.value.length,...t),v.value=!1};return U({showDialog:v,selectGoods:m,selectGoodsNum:_}),(t,e)=>{const p=ne,r=de,S=ie,f=pe,J=re,K=ce,H=me,b=ue,Q=ge,W=_e,X=fe,Y=he,Z=ve,ee=ye;return C(),D("div",null,[d("div",{onClick:O},[te(t.$slots,"default",{},()=>[n(p,null,{default:i(()=>[h(c(a(l)("goodsSelectPopupSelectGoodsButton")),1)]),_:1}),E(d("div",Ee,[d("span",null,c(a(l)("goodsSelectPopupSelect")),1),d("span",Ve,c(a(u).length),1),d("span",null,c(a(l)("goodsSelectPopupPiece")),1)],512),[[G,a(u).length]])],!0)]),n(Z,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=s=>v.value=s),title:a(l)("goodsSelectPopupSelectGoodsDialog"),width:"1000px","close-on-press-escape":!1,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:i(()=>[d("span",ze,[n(p,{onClick:e[8]||(e[8]=s=>v.value=!1)},{default:i(()=>[h(c(a(l)("cancel")),1)]),_:1}),n(p,{type:"primary",onClick:q},{default:i(()=>[h(c(a(l)("confirm")),1)]),_:1})])]),default:i(()=>[n(H,{inline:!0,model:o.searchParam,ref_key:"searchFormRef",ref:T},{default:i(()=>[n(f,{prop:"select_type",class:"form-item-wrap"},{default:i(()=>[n(S,{modelValue:o.searchParam.select_type,"onUpdate:modelValue":e[0]||(e[0]=s=>o.searchParam.select_type=s),onChange:F},{default:i(()=>[n(r,{label:a(l)("goodsSelectPopupAllGoods"),value:"all"},null,8,["label"]),n(r,{label:a(l)("goodsSelectPopupSelectedGoods"),value:"selected"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),n(f,{label:a(l)("goodsSelectPopupGoodsName"),prop:"goods_name",class:"form-item-wrap"},{default:i(()=>[n(J,{modelValue:o.searchParam.goods_name,"onUpdate:modelValue":e[1]||(e[1]=s=>o.searchParam.goods_name=s),placeholder:a(l)("goodsSelectPopupGoodsNamePlaceholder"),maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(f,{label:a(l)("goodsSelectPopupGoodsCategory"),prop:"goods_category",class:"form-item-wrap"},{default:i(()=>[n(K,{modelValue:o.searchParam.goods_category,"onUpdate:modelValue":e[2]||(e[2]=s=>o.searchParam.goods_category=s),props:{value:"value",label:"label",emitPath:!1},options:V,placeholder:a(l)("goodsSelectPopupGoodsCategoryPlaceholder"),clearable:""},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),n(f,{class:"form-item-wrap"},{default:i(()=>[n(p,{type:"primary",onClick:e[3]||(e[3]=s=>y())},{default:i(()=>[h(c(a(l)("search")),1)]),_:1}),n(p,{onClick:e[4]||(e[4]=s=>M(T.value))},{default:i(()=>[h(c(a(l)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),E((C(),N(X,{data:o.data,size:"large",ref_key:"goodsListTableRef",ref:P,"max-height":"400",onSelect:L,onSelectAll:A},{empty:i(()=>[d("span",null,c(o.loading?"":a(l)("emptyData")),1)]),default:i(()=>[n(b,{type:"selection",width:"55"}),n(b,{prop:"goods_id",label:a(l)("goodsSelectPopupGoodsInfo"),"min-width":"300"},{default:i(({row:s})=>[d("div",we,[d("div",Ge,[s.goods_cover?(C(),N(Q,{key:0,class:"w-[60px] h-[60px]",src:a(ae)(s.goods_cover),fit:"contain"},{error:i(()=>[Te]),_:2},1032,["src"])):(C(),D("img",Ie))]),d("div",$e,[d("span",{title:s.goods_name,class:"multi-hidden"},c(s.goods_name),9,De),d("div",null,[n(W,null,{default:i(()=>[h(c(s.buy_type_name),1)]),_:2},1024)])])])]),_:1},8,["label"]),n(b,{prop:"price",label:a(l)("goodsSelectPopupPrice"),"min-width":"300",align:"center"},{default:i(({row:s})=>[d("div",null,"ï¿¥"+c(s.price),1)]),_:1},8,["label"]),n(b,{prop:"sale_num",label:a(l)("goodsSelectPopupStock"),"min-width":"220",align:"center"},null,8,["label"])]),_:1},8,["data"])),[[ee,o.loading]]),d("div",Ne,[d("div",Be,[E(d("div",Re,[d("span",null,c(a(l)("goodsSelectPopupBeforeTip")),1),d("span",Ue,c(a(_)),1),d("span",null,c(a(l)("goodsSelectPopupAfterTip")),1)],512),[[G,a(_)]]),E(n(p,{type:"primary",link:"",onClick:j},{default:i(()=>[h(c(a(l)("goodsSelectPopupClearGoods")),1)]),_:1},512),[[G,a(_)]])]),n(Y,{"current-page":o.page,"onUpdate:current-page":e[5]||(e[5]=s=>o.page=s),"page-size":o.limit,"onUpdate:page-size":e[6]||(e[6]=s=>o.limit=s),layout:"total, sizes, prev, pager, next, jumper",total:o.total,onSizeChange:e[7]||(e[7]=s=>y()),onCurrentChange:y},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}});const go=ke(Fe,[["__scopeId","data-v-2c88c9ae"]]);export{go as default};
