import{d as ue,x as ne,r as x,n as j,l as pe,q as a,Y as me,h as V,c as w,a as p,t as m,u as t,e,w as s,i as _,F as S,s as A,c6 as E,B as U,V as J,bZ as z,J as _e,K as ce,bM as fe,az as ge,aA as be,L as ye,aD as Ve,aU as he,aa as ke,E as we,ac as ve,X as xe,ab as Ue,aE as Pe,a0 as Ne,p as Ee,g as $e,R as Ce,bs as Te}from"./index-17984968.js";/* empty css                *//* empty css                    */import{_ as Me}from"./index.vue_vue_type_script_setup_true_lang-a8924ef7.js";import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                *//* empty css                 *//* empty css                    *//* empty css               *//* empty css                     *//* empty css                  *//* empty css                        *//* empty css                  *//* empty css                *//* empty css                       *//* empty css                 */import Ie from"./index-0ce1f7fc.js";/* empty css                          *//* empty css                 */import"./el-form-item-4ed993c7.js";import{g as Fe}from"./category-02c806c6.js";import{a as Re,e as Se,b as qe}from"./goods-db78f22e.js";/* empty css                   */import{_ as De}from"./_plugin-vue_export-helper-c27b6911.js";import"./index.vue_vue_type_style_index_0_lang-c5bcb8a9.js";/* empty css                  *//* empty css                   */import"./attachment-a816d3ef.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-8693344a.js";/* empty css                        *//* empty css                  *//* empty css                  *//* empty css                      *//* empty css                 *//* empty css                 *//* empty css               *//* empty css               *//* empty css                    *//* empty css                         */import"./index.vue_vue_type_script_setup_true_lang-5615c67a.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-8e50df98.js";import"./sortable.esm-be94e56d.js";const b=P=>(Ee("data-v-08539a1d"),P=P(),$e(),P),Ge={class:"main-container"},Be={class:"detail-head"},Ke=b(()=>p("span",{class:"iconfont iconxiangzuojiantou !text-xs"},null,-1)),Ze={class:"ml-[1px]"},Le=b(()=>p("span",{class:"adorn"},"|",-1)),Oe={key:0,class:"right"},je={key:1,class:"right"},Ae=b(()=>p("div",{class:"text-[12px] text-[#999]"},"建议上传图片的大小为150px*150px",-1)),Je=b(()=>p("span",null,"元",-1)),ze=b(()=>p("p",{class:"text-[12px] text-[#a9a9a9]"},"0即为免费预约",-1)),Qe={class:"add-product"},Xe=b(()=>p("span",null,"元",-1)),Ye=b(()=>p("p",{class:"text-[12px] text-[#a9a9a9]"},"价目表显示在项目详情作为参考，价格透明，有助于客户下单，预约后实际支付按照技师报价结算",-1)),He=b(()=>p("span",null,"元",-1)),We={class:"server-tables"},el=b(()=>p("span",null,"元",-1)),ll={class:"flex items-center"},ol={class:"fixed-footer-wrap"},al={class:"fixed-footer"},tl=ue({__name:"edit",setup(P){const Q=ne(),N=parseInt(Q.query.id),$=x(!1),C=x("basic"),q={goods_id:"",goods_name:"",goods_image:"",goods_category:"",virtually_sale:"",sort:"",status:"1",buy_type:"reservation",price_list:[],spec_type:"single",free:!1,price:"",sku_no:"",sku_unit:"次",min_buy:"1",goods_sku_data:[],after_sales:0,goods_content:"",buy_info:""},r=j({...q});N&&(async(n=0)=>{Object.assign(r,q);const o=await(await Re({goods_id:n})).data.goods_info;Object.keys(r).forEach(d=>{o[d]!=null&&(r[d]=o[d]),o[d]!=null&&d=="goods_category"&&(r[d]=Number(o[d]))}),r.spec_type=="single"&&(r.price=o.sku_list[0].price,r.sku_no=o.sku_list[0].sku_no,r.sku_unit=o.sku_list[0].sku_unit,r.min_buy=o.sku_list[0].min_buy,Number(r.price)==0&&(r.free=!0)),r.goods_sku_data=o.sku_list})(N);const T=j([]);(async(n=null)=>{Fe().then(o=>{const d=o.data;if(d){const i=[];d.forEach(y=>{const v=[];y.children&&y.children.forEach(g=>{v.push({value:g.category_id,label:g.category_name})}),i.push({value:y.category_id,label:y.category_name,children:v})}),T.splice(0,T.length,...i)}})})();const D=x(),G=x(),B=x(),X={required:/[\S]+/,number:/^\d{0,10}$/,digit:/^\d{0,10}(.?\d{0,2})$/,special:/^\d{0,10}(.?\d{0,3})$/},M=pe(()=>({goods_name:[{required:!0,message:a("goodsNamePlaceholder"),trigger:"blur"}],goods_image:[{required:!0,message:a("goodsImagePlaceholder"),trigger:"change"}],goods_category:[{required:!0,message:a("categoryIdPlaceholder"),trigger:"change"}],sort:[{trigger:"blur",validator:(n,o,d)=>{isNaN(o)||!X.number.test(o)?d(new Error(a("sortTips"))):d()}}],price:[{required:!0,trigger:"blur",validator:(n,o,d)=>{o==""&&r.buy_type=="reservation"?d(new Error(a("orderPricePricePlaceholder"))):o==""&&r.buy_type=="buy"?d(new Error(a("goodsPricePlaceholder"))):o<0&&r.buy_type=="reservation"?d(new Error(a("orderPriceNotZeroTips"))):o<=0&&r.buy_type=="buy"?d(new Error(a("goodsPriceNotZeroTips"))):d()}}],sku_unit:[{required:!0,message:a("productUnitTips"),trigger:"blur"}],min_buy:[{required:!0,message:a("miniGoodsPlaceholder"),trigger:"blur"},{trigger:"blur",validator:(n,o,d)=>{o<=0?d(new Error(a("minBuyNotZeroTips"))):d()}}]})),Y=n=>{const o=[{key:"basic",verify:!1,ref:D.value},{key:"goods_charge",verify:!1,ref:G.value},{key:"detail",verify:!1,ref:B.value}];o.forEach((d,i)=>{d.ref.validate(y=>{d.verify=y})}),setTimeout(()=>{let d=!0;for(let i=0;i<o.length;i++)if(o[i].verify==!1){C.value=o[i].key,d=!1;break}d&&n&&n()},10)},H=()=>{Y(()=>{if($.value=!0,r.goods_sku_data.length&&!r.goods_sku_data.some(i=>i.is_default)){Ce({message:"请选择多规格的默认规格",type:"error"});return}r.free&&(r.price=0);const n=Te(r);n.price_list=JSON.stringify(n.price_list),n.goods_sku_data=JSON.stringify(n.goods_sku_data),(N?Se:qe)(n).then(d=>{$.value=!1,history.back()}).catch(()=>{$.value=!1})})},K=()=>{history.back()},W=()=>{r.price_list.push({name:"",price:"0",unit:"次"})},ee=n=>{r.price_list.splice(n,1)},le=()=>{r.goods_sku_data.length>0?r.goods_sku_data.push({sku_no:"",sku_image:"",sku_name:"",price:"0",sku_unit:"次",min_buy:1,is_default:0}):r.goods_sku_data.push({sku_no:"",sku_image:"",sku_name:"",price:"0",sku_unit:"次",min_buy:1,is_default:1})},oe=n=>{r.goods_sku_data.splice(n,1)},ae=(n,o)=>{for(const d in r.goods_sku_data)d==o?r.goods_sku_data[d].is_default=n:r.goods_sku_data[d].is_default=0};return(n,o)=>{const d=_e,i=ce,y=fe,v=Ie,g=ge,I=be,F=ye,R=Ve,Z=he,c=ke,k=we,L=ve,te=me("QuestionFilled"),re=xe,se=Ue,O=Me,de=Pe,ie=Ne;return V(),w("div",Ge,[p("div",Be,[p("div",{class:"left",onClick:o[0]||(o[0]=l=>K())},[Ke,p("span",Ze,m(t(a)("returnToPreviousPage")),1)]),Le,t(N)?(V(),w("span",Oe,m(t(a)("editGoods")),1)):(V(),w("span",je,m(t(a)("addGoods")),1))]),e(ie,{class:"box-card !border-none",shadow:"never"},{default:s(()=>[e(de,{modelValue:C.value,"onUpdate:modelValue":o[25]||(o[25]=l=>C.value=l)},{default:s(()=>[e(R,{label:t(a)("basicInfoTab"),name:"basic"},{default:s(()=>[e(F,{model:r,"label-width":"100px",ref_key:"basicFormRef",ref:D,rules:t(M),class:"page-form"},{default:s(()=>[e(i,{label:t(a)("goodsName"),prop:"goods_name"},{default:s(()=>[e(d,{modelValue:r.goods_name,"onUpdate:modelValue":o[1]||(o[1]=l=>r.goods_name=l),modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("goodsNamePlaceholder"),class:"input-width",maxlength:"60"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:t(a)("categoryId"),prop:"goods_category"},{default:s(()=>[e(y,{class:"input-width",modelValue:r.goods_category,"onUpdate:modelValue":o[2]||(o[2]=l=>r.goods_category=l),options:T,props:{value:"value",label:"label",emitPath:!1}},null,8,["modelValue","options"])]),_:1},8,["label"]),e(i,{label:t(a)("goodsImage"),prop:"goods_image"},{default:s(()=>[p("div",null,[e(v,{modelValue:r.goods_image,"onUpdate:modelValue":o[3]||(o[3]=l=>r.goods_image=l),limit:6},null,8,["modelValue"]),Ae])]),_:1},8,["label"]),e(i,{label:t(a)("virtualSaleNum"),prop:"virtual_sale_num"},{default:s(()=>[e(d,{modelValue:r.virtually_sale,"onUpdate:modelValue":o[4]||(o[4]=l=>r.virtually_sale=l),modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("virtualSaleNumPlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:t(a)("sort"),prop:"sort"},{default:s(()=>[e(d,{modelValue:r.sort,"onUpdate:modelValue":o[5]||(o[5]=l=>r.sort=l),modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("sortPlaceholder"),class:"input-width","show-word-limit":"",maxlength:"10"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:t(a)("status")},{default:s(()=>[e(I,{modelValue:r.status,"onUpdate:modelValue":o[6]||(o[6]=l=>r.status=l),class:"ml-4"},{default:s(()=>[e(g,{label:"1"},{default:s(()=>[_(m(t(a)("up")),1)]),_:1}),e(g,{label:"0"},{default:s(()=>[_(m(t(a)("down")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["label"]),e(R,{label:t(a)("goodsChargeTab"),name:"goods_charge"},{default:s(()=>[e(F,{model:r,"label-width":"100px",ref_key:"goodsFormRef",ref:G,rules:t(M),class:"page-form"},{default:s(()=>[e(i,{label:t(a)("goodsModel")},{default:s(()=>[e(I,{modelValue:r.buy_type,"onUpdate:modelValue":o[7]||(o[7]=l=>r.buy_type=l),class:"ml-4"},{default:s(()=>[e(g,{label:"reservation"},{default:s(()=>[_(m(t(a)("order")),1)]),_:1}),e(g,{label:"buy"},{default:s(()=>[_(m(t(a)("fixedPrice")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r.buy_type=="reservation"?(V(),w(S,{key:0},[e(i,{label:t(a)("freeReservation"),prop:"free"},{default:s(()=>[e(Z,{modelValue:r.free,"onUpdate:modelValue":o[8]||(o[8]=l=>r.free=l)},null,8,["modelValue"])]),_:1},8,["label"]),r.free?U("",!0):(V(),A(i,{key:0,label:t(a)("orderPrice"),prop:"price"},{default:s(()=>[p("div",null,[e(d,{modelValue:r.price,"onUpdate:modelValue":o[9]||(o[9]=l=>r.price=l),modelModifiers:{trim:!0},clearable:"",class:"!w-[160px]",onKeyup:o[10]||(o[10]=l=>t(E)(l))},{append:s(()=>[Je]),_:1},8,["modelValue"]),ze])]),_:1},8,["label"])),e(i,{label:t(a)("priceList")},{default:s(()=>[p("div",Qe,[e(L,{data:r.price_list,style:{width:"800px"}},{default:s(()=>[e(c,{label:t(a)("productName"),class:"ml-[20px]"},{default:s(l=>[e(i,{prop:`price_list[${l.$index}].name`,rules:[{required:!0,message:t(a)("productNamePlaceholder"),trigger:"blur"}]},{default:s(()=>[e(d,{modelValue:l.row.name,"onUpdate:modelValue":u=>l.row.name=u,modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("productNamePlaceholder"),class:"!w-[200px]",maxlength:"60"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),e(c,{label:t(a)("productPrice"),width:"200"},{default:s(l=>[e(i,{prop:`price_list[${l.$index}].price`,rules:[{trigger:"blur",validator:(u,h,f)=>{h==""?f(t(a)("productPricePlaceholder")):h<0?f(t(a)("priceNotZeroTips")):f()}}]},{default:s(()=>[e(d,{modelValue:l.row.price,"onUpdate:modelValue":u=>l.row.price=u,modelModifiers:{trim:!0},clearable:"",class:"!w-[160px]",onKeyup:o[11]||(o[11]=u=>t(E)(u))},{append:s(()=>[Xe]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),e(c,{label:t(a)("productUnit"),width:"200"},{default:s(l=>[e(i,{prop:`price_list[${l.$index}].unit`,rules:[{required:!0,message:t(a)("productUnitTips"),trigger:"blur"}]},{default:s(()=>[e(d,{modelValue:l.row.unit,"onUpdate:modelValue":u=>l.row.unit=u,modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("productUnitPlaceholder"),class:"!w-[160px]"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),e(c,{label:t(a)("operations"),width:"150"},{default:s(l=>[e(k,{link:"",type:"primary",onClick:J(u=>ee(l.$index),["prevent"])},{default:s(()=>[_(m(t(a)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),e(k,{type:"primary",onClick:o[12]||(o[12]=l=>W()),class:"mt-[15px]"},{default:s(()=>[_(m(t(a)("addItem")),1)]),_:1}),Ye])]),_:1},8,["label"])],64)):U("",!0),r.buy_type=="buy"?(V(),w(S,{key:1},[e(i,{label:t(a)("goodsSpecification")},{default:s(()=>[e(I,{modelValue:r.spec_type,"onUpdate:modelValue":o[13]||(o[13]=l=>r.spec_type=l),class:"ml-4"},{default:s(()=>[e(g,{label:"single"},{default:s(()=>[_(m(t(a)("singleSpecification")),1)]),_:1}),e(g,{label:"multi"},{default:s(()=>[_(m(t(a)("moreSpecification")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r.spec_type=="single"?(V(),w(S,{key:0},[e(i,{label:t(a)("goodsPrice"),prop:"price"},{default:s(()=>[e(d,{modelValue:r.price,"onUpdate:modelValue":o[14]||(o[14]=l=>r.price=l),modelModifiers:{trim:!0},clearable:"",class:"!w-[160px]",onKeyup:o[15]||(o[15]=l=>t(E)(l))},{append:s(()=>[He]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(i,{label:t(a)("skuNo"),prop:"sku_no"},{default:s(()=>[e(d,{modelValue:r.sku_no,"onUpdate:modelValue":o[16]||(o[16]=l=>r.sku_no=l),modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("skuNoPlaceholder"),class:"!w-[160px]"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:t(a)("goodsUnit"),prop:"sku_unit"},{default:s(()=>[e(d,{modelValue:r.sku_unit,"onUpdate:modelValue":o[17]||(o[17]=l=>r.sku_unit=l),modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("productUnitPlaceholder"),class:"!w-[160px]"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(i,{label:t(a)("miniGoods"),prop:"min_buy"},{default:s(()=>[e(d,{modelValue:r.min_buy,"onUpdate:modelValue":o[18]||(o[18]=l=>r.min_buy=l),modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("miniGoodsPlaceholder"),class:"!w-[160px]",onKeyup:o[19]||(o[19]=l=>t(z)(l))},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):U("",!0),r.spec_type=="multi"?(V(),A(i,{key:1},{default:s(()=>[p("div",We,[e(L,{data:r.goods_sku_data,style:{width:"1500px"}},{default:s(()=>[e(c,{label:t(a)("productName")},{default:s(l=>[e(i,{prop:`goods_sku_data[${l.$index}].sku_name`,rules:[{required:!0,message:t(a)("productNamePlaceholder"),trigger:"blur"}]},{default:s(()=>[e(d,{modelValue:l.row.sku_name,"onUpdate:modelValue":u=>l.row.sku_name=u,modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("productNamePlaceholder"),class:"!w-[200px]",maxlength:"60"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),e(c,{label:"图片",width:"100"},{default:s(l=>[e(v,{modelValue:l.row.sku_image,"onUpdate:modelValue":u=>l.row.sku_image=u,limit:1,width:"50px",height:"50px"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:t(a)("goodsPrice"),width:"200"},{default:s(l=>[e(i,{prop:`goods_sku_data[${l.$index}].price`,rules:[{trigger:"blur",validator:(u,h,f)=>{h===""?f(t(a)("goodsPricePlaceholder")):h<=0?f(t(a)("goodsPriceNotZeroTips")):f()}}]},{default:s(()=>[e(d,{modelValue:l.row.price,"onUpdate:modelValue":u=>l.row.price=u,modelModifiers:{trim:!0},clearable:"",class:"!w-[160px]",onKeyup:o[20]||(o[20]=u=>t(E)(u))},{append:s(()=>[el]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),e(c,{label:t(a)("productUnit"),width:"200"},{default:s(l=>[e(i,{prop:`goods_sku_data[${l.$index}].sku_unit`,rules:[{required:!0,message:t(a)("productUnitTips"),trigger:"blur"}]},{default:s(()=>[e(d,{modelValue:l.row.sku_unit,"onUpdate:modelValue":u=>l.row.sku_unit=u,modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("productUnitPlaceholder"),class:"!w-[160px]"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),e(c,{width:"200"},{header:s(()=>[p("div",ll,[_(m(t(a)("miniGoods"))+" ",1),e(se,{class:"box-item",effect:"light",content:t(a)("miniServiceTips"),placement:"bottom"},{default:s(()=>[e(re,{class:"cursor-pointer"},{default:s(()=>[e(te)]),_:1})]),_:1},8,["content"])])]),default:s(l=>[e(i,{prop:`goods_sku_data[${l.$index}].min_buy`,rules:[{required:!0,message:t(a)("miniGoodsPlaceholder"),trigger:"blur"},{trigger:"blur",validator:(u,h,f)=>{h<=0?f(new n.Error(t(a)("minBuyNotZeroTips"))):f()}}]},{default:s(()=>[e(d,{modelValue:l.row.min_buy,"onUpdate:modelValue":u=>l.row.min_buy=u,modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("miniGoodsPlaceholder"),class:"!w-[160px]",onKeyup:o[21]||(o[21]=u=>t(z)(u))},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop","rules"])]),_:1}),e(c,{label:t(a)("skuNo"),class:"ml-[20px]"},{default:s(l=>[e(i,{prop:`goods_sku_data[${l.$index}].sku_no`},{default:s(()=>[e(d,{modelValue:l.row.sku_no,"onUpdate:modelValue":u=>l.row.sku_no=u,modelModifiers:{trim:!0},clearable:"",placeholder:t(a)("skuNoPlaceholder"),class:"!w-[200px]"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"])]),_:1},8,["label"]),e(c,{label:"默认规格",width:"200"},{default:s(l=>[e(i,null,{default:s(()=>[e(Z,{modelValue:l.row.is_default,"onUpdate:modelValue":u=>l.row.is_default=u,"active-value":1,"inactive-value":0,onChange:u=>ae(u,l.$index)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:1}),e(c,{label:t(a)("operations"),width:"150"},{default:s(l=>[e(k,{link:"",type:"primary",onClick:J(u=>oe(l.$index),["prevent"])},{default:s(()=>[_(m(t(a)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),e(k,{type:"primary",onClick:o[22]||(o[22]=l=>le()),class:"mt-[15px]"},{default:s(()=>[_(m(t(a)("addspec")),1)]),_:1})])]),_:1})):U("",!0)],64)):U("",!0)]),_:1},8,["model","rules"])]),_:1},8,["label"]),e(R,{label:t(a)("goodsDescTab"),name:"detail"},{default:s(()=>[e(F,{model:r,"label-width":"100px",ref_key:"detailFormRef",ref:B,rules:t(M),class:"page-form"},{default:s(()=>[e(i,{label:t(a)("goodsContent")},{default:s(()=>[e(O,{modelValue:r.goods_content,"onUpdate:modelValue":o[23]||(o[23]=l=>r.goods_content=l)},null,8,["modelValue"])]),_:1},8,["label"]),e(i,{label:t(a)("buyInfo")},{default:s(()=>[e(O,{modelValue:r.buy_info,"onUpdate:modelValue":o[24]||(o[24]=l=>r.buy_info=l)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),p("div",ol,[p("div",al,[e(k,{type:"primary",onClick:o[26]||(o[26]=l=>H())},{default:s(()=>[_(m(t(a)("save")),1)]),_:1}),e(k,{onClick:o[27]||(o[27]=l=>K())},{default:s(()=>[_(m(t(a)("cancel")),1)]),_:1})])])])}}});const Hl=De(tl,[["__scopeId","data-v-08539a1d"]]);export{Hl as default};
