import{d as be,r as p,n as H,l as he,q as r,Y as xe,h as _,s as C,w as o,a as d,e as t,i as m,t as u,u as i,P as K,c as h,B as w,F as M,Q,bs as W,R as ke,aP as we,E as Ce,az as Ve,aA as De,K as Pe,L as Ee,aa as Ae,ac as Fe,aj as ze,J as Ne,a1 as Te,a0 as Ue,aq as $e,T as je,U as Se}from"./index-17984968.js";/* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                       *//* empty css                 *//* empty css                  *//* empty css                  */import{g as X,o as Re,a as Be,p as Oe}from"./shop-9dd6766f.js";const qe={key:0,class:"flex mb-2 items-center"},Le={class:"ml-2 mr-4"},Ie={class:"font-bold truncate"},Ge={class:"font-bold"},Je={key:1,class:"flex justify-end"},Ye={class:"pr-4 pl-4 pt-1 pb-1 rounded-md statistic-card bg-gradient-to-r from-indigo-50 from-10% via-sky-50 via-10% to-emerald-50 to-10%"},He={class:"font-bold"},Ke={class:"flex items-center"},Me={class:"mr-2 font-bold"},Qe={class:"mr-4"},We=d("span",{class:"ml-2"},"单位：kg",-1),Xe=d("span",{class:"ml-2"},"单位：元",-1),Ze=d("span",{class:"ml-2 text-slate-400"}," 如不需保价可以留空",-1),el={class:"flex flex-wrap"},ll=["onClick"],tl=["onClick"],al={class:"font-bold truncate"},ol={class:"text-xs"},sl={class:"flex items-center"},rl=d("div",{class:"text-xs pt-1"},"￥",-1),dl={class:"font-bold text-xl text-red-500"},il={class:"dialog-footer"},nl={class:"mt-[10px]"},ul={key:0},pl={key:1},_l={class:"mt-[16px] flex justify-end"},ml={class:"dialog-footer"},Ol=be({__name:"delivery-action",emits:["complete"],setup(cl,{expose:Z,emit:ee}){const x=p(JSON.parse(localStorage.getItem("mr_address"))),U=p(),g=p(),le=async a=>{A.value=!1,x.value=a,s.send_id=a.id,F()},$=()=>{g.value=null,V.value=!0,F()},j=a=>{g.value=a,s.predata=a,V.value=!1},te=()=>{g.value=null},V=p(!1),A=p(!1),ae=async()=>{A.value=!0,await X({})},n=H({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{mobile:"",full_address:""}}),S=p(),D=(a=1)=>{n.loading=!0,n.page=a,X({page:n.page,limit:n.limit,...n.searchParam}).then(e=>{n.loading=!1,n.data=e.data.data,n.total=e.data.total}).catch(()=>{n.loading=!1})};D();const oe=a=>{a&&(a.resetFields(),D())},P=p(!1),b=p(!1);p([]);const R=p(!1),N=p([]),B=p([]),s=H({...{order_id:0,delivery_type:"",express_company_id:"",express_number:"",order_goods_ids:[],weight:"1",bj_price:"",send_id:"",predata:""}}),O=p(),se=he(()=>({delivery_type:[{required:!0,message:r("deliveryTypePlaceholder"),trigger:"blur"}],express_company_id:[{required:!0,validator:re,trigger:"blur"}],express_number:[{required:!0,validator:de,trigger:"blur"}]})),re=(a,e,c)=>{s.delivery_type=="express"&&e===""?c(new Error(r("companyPlaceholder"))):c()},de=(a,e,c)=>{s.delivery_type=="express"&&e===""?c(new Error(r("expressNumberPlaceholder"))):c()},ie=(a,e)=>!(a.status==2||a.delivery_status=="delivery_finish"),y=p([]),q=()=>{if(y.value=W(B.value),s.delivery_type&&s.delivery_type=="virtual")for(const a in y.value)y.value[a].goods_type!="virtual"&&y.value.splice(a,1);else if(s.delivery_type&&s.delivery_type!="virtual")for(const a in y.value)y.value[a].goods_type=="virtual"&&y.value.splice(a,1)},ne=a=>{s.order_goods_ids=W([]);for(const e in a)s.order_goods_ids.push(a[e].order_goods_id)},ue=async a=>{if(s.send_id=x.value.id,!(b.value||!a)){if(s.order_goods_ids.length<=0){ke({message:r("orderGoodsPlaceholder"),type:"warning"});return}await a.validate(async e=>{e&&(b.value=!0,Re(s).then(v=>{b.value=!1,P.value=!1,ee("complete"),L()}).catch(v=>{b.value=!1,L()}))})}},pe=async(a=null)=>{if(b.value=!0,a){s.order_id=a.order_id,s.delivery_type="",B.value=a.order_goods,y.value=a.order_goods,await Be({delivery_type:a.delivery_type}).then(e=>{N.value=e.data;for(const c in e.data){s.delivery_type=c;break}q()});for(let e=0;e<a.order_goods.length;e++)if(a.order_goods[e].goods_type=="virtual"){R.value=!0;break}R.value==!0&&Object.assign(N.value,{virtual:r("virtualDelivery")}),V.value=!0,F()}b.value=!1},L=()=>{s.delivery_type="",s.express_company_id="",s.express_number="",s.order_goods_ids=[],s.send_id=x.value.id},F=async()=>{let a={send_id:x.value.id,order_id:s.order_id,weight:s.weight,bj_price:s.bj_price};const e=await Oe(a);U.value=e.data};return Z({showDialog:P,setFormData:pe}),(a,e)=>{const c=we,v=Ce,_e=Ve,me=De,k=Pe,I=Ee,f=Ae,G=Fe,ce=ze,z=Ne,ve=xe("block"),T=Te,fe=Ue,J=$e,ye=je,Y=Se;return _(),C(T,{modelValue:P.value,"onUpdate:modelValue":e[17]||(e[17]=l=>P.value=l),title:"聚合发货",width:"700px",class:"diy-dialog-wrap","destroy-on-close":!0,onClose:te},{footer:o(()=>[d("span",ml,[t(v,{onClick:e[15]||(e[15]=l=>P.value=!1)},{default:o(()=>[m(u(i(r)("cancel")),1)]),_:1}),t(v,{type:"primary",loading:b.value,onClick:e[16]||(e[16]=l=>ue(O.value))},{default:o(()=>[m(u(i(r)("confirm")),1)]),_:1},8,["loading"])])]),default:o(()=>[K((_(),h("div",null,[t(I,{model:s,"label-width":"100px",ref_key:"formRef",ref:O,rules:i(se),class:"page-form mb-[30px]"},{default:o(()=>[g.value&&s.delivery_type=="express"?(_(),h("div",qe,[t(c,{src:g.value.logo},null,8,["src"]),d("div",Le,[d("div",Ie,u(g.value.channelName),1),d("div",Ge," 预计运费:￥"+u(g.value.preDeliveryFee),1)]),t(v,{type:"primary",size:"small",round:"",onClick:e[0]||(e[0]=l=>$())},{default:o(()=>[m("重新选择")]),_:1})])):w("",!0),!g.value&&s.delivery_type=="express"?(_(),h("div",Je,[t(v,{type:"primary",onClick:e[1]||(e[1]=l=>$())},{default:o(()=>[m("选择快递")]),_:1})])):w("",!0),t(k,{label:i(r)("deliveryType"),prop:"delivery_type"},{default:o(()=>[t(me,{modelValue:s.delivery_type,"onUpdate:modelValue":e[2]||(e[2]=l=>s.delivery_type=l),onChange:q},{default:o(()=>[(_(!0),h(M,null,Q(N.value,(l,E)=>(_(),C(_e,{label:E,key:E},{default:o(()=>[m(u(l),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),t(G,{data:y.value,size:"large",onSelectionChange:ne},{default:o(()=>[t(f,{type:"selection",width:"55",selectable:ie}),t(f,{prop:"goods_name",label:i(r)("goodsName"),"min-width":"200"},null,8,["label"]),t(f,{prop:"num",label:i(r)("num"),"min-width":"80"},null,8,["label"]),t(f,{prop:"status_name",label:i(r)("refundStatusName"),"min-width":"120"},null,8,["label"]),t(f,{prop:"delivery_status_name",label:i(r)("deliveryStatusName"),"min-width":"120",align:"right"},null,8,["label"])]),_:1},8,["data"])])),[[Y,b.value]]),t(T,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=l=>V.value=l),width:"65%","close-on-click-modal":!1},{footer:o(()=>[d("span",il,[t(v,{type:"primary",onClick:e[5]||(e[5]=l=>F())},{default:o(()=>[m("重新报价")]),_:1})])]),default:o(()=>[t(ce,{type:"warning",title:"默认会提前1kg,不保价获取快递运费，如您的重量不一致或者需要保价，您可以修改信息重新获取报价",description:"请提前打包好物品，根据包裹实际重量下单，如长时间未揽收，请到已发货/发单记录里面取消订单重新选择其他渠道下单",closable:!1,"show-icon":""}),t(k,{label:"发件地址",class:"mt-4"},{default:o(()=>[d("div",Ye,[d("div",He,u(x.value.full_address),1),d("div",Ke,[d("div",Me,u(x.value.contact_name),1),d("div",Qe,u(x.value.mobile),1),t(v,{type:"primary",size:"small",round:"",onClick:ae},{default:o(()=>[m("切换地址")]),_:1})])])]),_:1}),t(k,{label:"包裹重量"},{default:o(()=>[t(z,{class:"input-width",type:"number",modelValue:s.weight,"onUpdate:modelValue":e[3]||(e[3]=l=>s.weight=l),placeholder:"请输入重量",style:{width:"88px"}},null,8,["modelValue"]),We]),_:1}),t(k,{label:"保价金额"},{default:o(()=>[t(z,{class:"input-width",type:"number",modelValue:s.bj_price,"onUpdate:modelValue":e[4]||(e[4]=l=>s.bj_price=l),placeholder:"",style:{width:"88px"}},null,8,["modelValue"]),Xe,Ze]),_:1}),d("div",el,[(_(!0),h(M,null,Q(U.value,(l,E)=>(_(),C(ve,{key:E},{default:o(()=>[l.onlinePay=="Y"?(_(),h("div",{key:0,class:"flex items-center w-[260px] p-2 pt-3 m-2 rounded-md statistic-card bg-gradient-to-r from-indigo-50 from-10% via-sky-50 via-10% to-emerald-50 to-10%",onClick:ge=>j(l)},[d("div",null,[t(c,{src:l.logo},null,8,["src"])]),d("div",{class:"ml-2",onClick:ge=>j(l)},[d("div",al,u(l.channelName),1),d("div",ol,"限重:"+u(l.limitWeight)+"kg",1),d("div",sl,[rl,d("div",dl,u(l.preDeliveryFee),1)])],8,tl)],8,ll)):w("",!0)]),_:2},1024))),128))])]),_:1},8,["modelValue"]),t(T,{modelValue:A.value,"onUpdate:modelValue":e[14]||(e[14]=l=>A.value=l),title:"选择地址",width:"800px",class:"diy-dialog-wrap","destroy-on-close":!0},{default:o(()=>[t(fe,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:o(()=>[t(I,{inline:!0,model:n.searchParam,ref_key:"searchFormRef",ref:S},{default:o(()=>[t(k,{label:i(r)("mobile"),prop:"mobile"},{default:o(()=>[t(z,{modelValue:n.searchParam.mobile,"onUpdate:modelValue":e[7]||(e[7]=l=>n.searchParam.mobile=l),placeholder:i(r)("mobilePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(k,{label:i(r)("fullAddress"),prop:"full_address"},{default:o(()=>[t(z,{modelValue:n.searchParam.full_address,"onUpdate:modelValue":e[8]||(e[8]=l=>n.searchParam.full_address=l),placeholder:i(r)("fullAddressPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(k,null,{default:o(()=>[t(v,{type:"primary",onClick:e[9]||(e[9]=l=>D())},{default:o(()=>[m(u(i(r)("search")),1)]),_:1}),t(v,{onClick:e[10]||(e[10]=l=>oe(S.value))},{default:o(()=>[m(u(i(r)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),d("div",nl,[K((_(),C(G,{data:n.data,size:"large"},{empty:o(()=>[d("span",null,u(n.loading?"":i(r)("emptyData")),1)]),default:o(()=>[t(f,{prop:"contact_name",label:i(r)("contactName"),"min-width":"120"},null,8,["label"]),t(f,{prop:"mobile",label:i(r)("mobile"),"min-width":"120"},null,8,["label"]),t(f,{prop:"full_address",label:i(r)("fullAddress"),"min-width":"120","show-overflow-tooltip":!0},null,8,["label"]),t(f,{prop:"is_delivery_address",label:i(r)("addressType"),"min-width":"120",align:"left"},{default:o(({row:l})=>[l.is_delivery_address?(_(),h("div",ul,[m(u(i(r)("deliveryAddress"))+" ",1),l.is_default_delivery?(_(),C(J,{key:0,size:"small"},{default:o(()=>[m(u(i(r)("default")),1)]),_:1})):w("",!0)])):w("",!0),l.is_refund_address?(_(),h("div",pl,[m(u(i(r)("refundAddress"))+" ",1),l.is_default_refund?(_(),C(J,{key:0,size:"small"},{default:o(()=>[m(u(i(r)("default")),1)]),_:1})):w("",!0)])):w("",!0)]),_:1},8,["label"]),t(f,{"min-width":"100"},{default:o(({row:l})=>[t(v,{type:"primary",size:"small",onClick:E=>le(l)},{default:o(()=>[m("选择")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,n.loading]]),d("div",_l,[t(ye,{"current-page":n.page,"onUpdate:current-page":e[11]||(e[11]=l=>n.page=l),"page-size":n.limit,"onUpdate:page-size":e[12]||(e[12]=l=>n.limit=l),layout:"total, sizes, prev, pager, next, jumper",total:n.total,onSizeChange:e[13]||(e[13]=l=>D()),onCurrentChange:D},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}});export{Ol as _};
